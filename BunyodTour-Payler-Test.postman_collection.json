{
        "info": {
                "_postman_id": "payler-test-collection",
                "name": "BunyodTour-Payler-Test",
                "description": "–ö–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ Payler –æ–ø–ª–∞—Ç—ã —Å HMAC –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π",
                "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
        },
        "item": [
                {
                        "name": "1. –°–æ–∑–¥–∞–Ω–∏–µ Payler –ø–ª–∞—Ç–µ–∂–∞",
                        "event": [
                                {
                                        "listen": "test",
                                        "script": {
                                                "exec": [
                                                        "pm.test(\"Status code is 200\", function () {",
                                                        "    pm.response.to.have.status(200);",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Response has redirectUrl\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData).to.have.property('redirectUrl');",
                                                        "    pm.expect(jsonData.success).to.be.true;",
                                                        "});",
                                                        "",
                                                        "pm.test(\"RedirectUrl contains Payler domain\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData.redirectUrl).to.include('payler.com');",
                                                        "});"
                                                ],
                                                "type": "text/javascript"
                                        }
                                }
                        ],
                        "request": {
                                "method": "POST",
                                "header": [
                                        {
                                                "key": "Content-Type",
                                                "value": "application/json",
                                                "type": "text"
                                        }
                                ],
                                "body": {
                                        "mode": "raw",
                                        "raw": "{\n  \"orderNumber\": \"ORD-12345\"\n}"
                                },
                                "url": {
                                        "raw": "{{BASE_URL}}/api/payments/payler/create",
                                        "host": ["{{BASE_URL}}"],
                                        "path": ["api", "payments", "payler", "create"]
                                },
                                "description": "–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ Payler StartSession API.\n–í —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç redirectUrl –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã Payler."
                        },
                        "response": []
                },
                {
                        "name": "2. Callback Success (Charged)",
                        "event": [
                                {
                                        "listen": "prerequest",
                                        "script": {
                                                "exec": [
                                                        "// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é HMAC –ø–æ–¥–ø–∏—Å—å –¥–ª—è orderId=1 –∏ status=Charged",
                                                        "const crypto = require('crypto-js');",
                                                        "const paylerKey = '1a92a7df-45d3-4fe7-8149-2fd0c7e8d366'; // –ë–æ–µ–≤–æ–π PAYLER_KEY",
                                                        "const orderId = '1';",
                                                        "const status = 'Charged';",
                                                        "const message = orderId + status;",
                                                        "const signature = crypto.HmacSHA256(message, paylerKey).toString();",
                                                        "pm.environment.set('VALID_SIGNATURE_CHARGED', signature);",
                                                        "console.log('Generated signature for Charged:', signature);"
                                                ],
                                                "type": "text/javascript"
                                        }
                                },
                                {
                                        "listen": "test",
                                        "script": {
                                                "exec": [
                                                        "pm.test(\"Status code is 200\", function () {",
                                                        "    pm.response.to.have.status(200);",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Response indicates success\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData.success).to.be.true;",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Payment status updated to paid\", function () {",
                                                        "    // –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ callback –±—ã–ª —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω",
                                                        "    pm.response.to.have.status(200);",
                                                        "});"
                                                ],
                                                "type": "text/javascript"
                                        }
                                }
                        ],
                        "request": {
                                "method": "POST",
                                "header": [
                                        {
                                                "key": "Content-Type",
                                                "value": "application/json",
                                                "type": "text"
                                        },
                                        {
                                                "key": "x-payler-signature",
                                                "value": "{{VALID_SIGNATURE_CHARGED}}",
                                                "type": "text"
                                        }
                                ],
                                "body": {
                                        "mode": "raw",
                                        "raw": "{\n  \"orderId\": \"1\",\n  \"status\": \"Charged\"\n}"
                                },
                                "url": {
                                        "raw": "{{BASE_URL}}/api/payments/payler/callback",
                                        "host": ["{{BASE_URL}}"],
                                        "path": ["api", "payments", "payler", "callback"]
                                },
                                "description": "–ò–º–∏—Ç–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–π callback –æ—Ç Payler —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π HMAC –ø–æ–¥–ø–∏—Å—å—é.\n–î–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ 'paid' –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ."
                        },
                        "response": []
                },
                {
                        "name": "3. Callback Fail (Canceled)",
                        "event": [
                                {
                                        "listen": "prerequest",
                                        "script": {
                                                "exec": [
                                                        "// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é HMAC –ø–æ–¥–ø–∏—Å—å –¥–ª—è orderId=1 –∏ status=Canceled",
                                                        "const crypto = require('crypto-js');",
                                                        "const paylerKey = '1a92a7df-45d3-4fe7-8149-2fd0c7e8d366'; // –ë–æ–µ–≤–æ–π PAYLER_KEY",
                                                        "const orderId = '1';",
                                                        "const status = 'Canceled';",
                                                        "const message = orderId + status;",
                                                        "const signature = crypto.HmacSHA256(message, paylerKey).toString();",
                                                        "pm.environment.set('VALID_SIGNATURE_CANCELED', signature);",
                                                        "console.log('Generated signature for Canceled:', signature);"
                                                ],
                                                "type": "text/javascript"
                                        }
                                },
                                {
                                        "listen": "test",
                                        "script": {
                                                "exec": [
                                                        "pm.test(\"Status code is 200\", function () {",
                                                        "    pm.response.to.have.status(200);",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Response indicates success\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData.success).to.be.true;",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Payment status updated to failed\", function () {",
                                                        "    // –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ callback –±—ã–ª —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω",
                                                        "    pm.response.to.have.status(200);",
                                                        "});"
                                                ],
                                                "type": "text/javascript"
                                        }
                                }
                        ],
                        "request": {
                                "method": "POST",
                                "header": [
                                        {
                                                "key": "Content-Type",
                                                "value": "application/json",
                                                "type": "text"
                                        },
                                        {
                                                "key": "x-payler-signature",
                                                "value": "{{VALID_SIGNATURE_CANCELED}}",
                                                "type": "text"
                                        }
                                ],
                                "body": {
                                        "mode": "raw",
                                        "raw": "{\n  \"orderId\": \"1\",\n  \"status\": \"Canceled\"\n}"
                                },
                                "url": {
                                        "raw": "{{BASE_URL}}/api/payments/payler/callback",
                                        "host": ["{{BASE_URL}}"],
                                        "path": ["api", "payments", "payler", "callback"]
                                },
                                "description": "–ò–º–∏—Ç–∏—Ä—É–µ—Ç –Ω–µ—É—Å–ø–µ—à–Ω—ã–π callback –æ—Ç Payler —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π HMAC –ø–æ–¥–ø–∏—Å—å—é.\n–î–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ 'failed'."
                        },
                        "response": []
                },
                {
                        "name": "4. Callback —Å –Ω–µ–≤–µ—Ä–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é",
                        "event": [
                                {
                                        "listen": "test",
                                        "script": {
                                                "exec": [
                                                        "pm.test(\"Status code is 403 Forbidden\", function () {",
                                                        "    pm.response.to.have.status(403);",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Response indicates invalid signature\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData.success).to.be.false;",
                                                        "    pm.expect(jsonData.message).to.include('Invalid signature');",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Security validation works\", function () {",
                                                        "    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏",
                                                        "    pm.expect(pm.response.code).to.equal(403);",
                                                        "});"
                                                ],
                                                "type": "text/javascript"
                                        }
                                }
                        ],
                        "request": {
                                "method": "POST",
                                "header": [
                                        {
                                                "key": "Content-Type",
                                                "value": "application/json",
                                                "type": "text"
                                        },
                                        {
                                                "key": "x-payler-signature",
                                                "value": "WRONG_SIGNATURE_12345",
                                                "type": "text"
                                        }
                                ],
                                "body": {
                                        "mode": "raw",
                                        "raw": "{\n  \"orderId\": \"1\",\n  \"status\": \"Charged\"\n}"
                                },
                                "url": {
                                        "raw": "{{BASE_URL}}/api/payments/payler/callback",
                                        "host": ["{{BASE_URL}}"],
                                        "path": ["api", "payments", "payler", "callback"]
                                },
                                "description": "–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã, –æ—Ç–ø—Ä–∞–≤–ª—è—è callback —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π HMAC –ø–æ–¥–ø–∏—Å—å—é.\n–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 403 Forbidden —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º 'Invalid signature'."
                        },
                        "response": []
                },
                {
                        "name": "5. Callback –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏",
                        "event": [
                                {
                                        "listen": "test",
                                        "script": {
                                                "exec": [
                                                        "pm.test(\"Status code is 403 Forbidden\", function () {",
                                                        "    pm.response.to.have.status(403);",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Response indicates missing signature\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData.success).to.be.false;",
                                                        "    pm.expect(jsonData.message).to.include('Invalid signature');",
                                                        "});"
                                                ],
                                                "type": "text/javascript"
                                        }
                                }
                        ],
                        "request": {
                                "method": "POST",
                                "header": [
                                        {
                                                "key": "Content-Type",
                                                "value": "application/json",
                                                "type": "text"
                                        }
                                ],
                                "body": {
                                        "mode": "raw",
                                        "raw": "{\n  \"orderId\": \"1\",\n  \"status\": \"Charged\"\n}"
                                },
                                "url": {
                                        "raw": "{{BASE_URL}}/api/payments/payler/callback",
                                        "host": ["{{BASE_URL}}"],
                                        "path": ["api", "payments", "payler", "callback"]
                                },
                                "description": "–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã, –æ—Ç–ø—Ä–∞–≤–ª—è—è callback –±–µ–∑ HMAC –ø–æ–¥–ø–∏—Å–∏.\n–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 403 Forbidden."
                        },
                        "response": []
                },
                {
                        "name": "6. –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)",
                        "event": [
                                {
                                        "listen": "test",
                                        "script": {
                                                "exec": [
                                                        "pm.test(\"Status code is 200\", function () {",
                                                        "    pm.response.to.have.status(200);",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Response contains order data\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData).to.have.property('success');",
                                                        "    pm.expect(jsonData.success).to.be.true;",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Order has payment status\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    if (jsonData.order) {",
                                                        "        pm.expect(jsonData.order).to.have.property('paymentStatus');",
                                                        "        console.log('Current payment status:', jsonData.order.paymentStatus);",
                                                        "    }",
                                                        "});"
                                                ],
                                                "type": "text/javascript"
                                        }
                                }
                        ],
                        "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                        "raw": "{{BASE_URL}}/api/orders/1",
                                        "host": ["{{BASE_URL}}"],
                                        "path": ["api", "orders", "1"]
                                },
                                "description": "–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã.\n–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö callback –∑–∞–ø—Ä–æ—Å–æ–≤."
                        },
                        "response": []
                },
                {
                        "name": "7. –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã",
                        "event": [
                                {
                                        "listen": "test",
                                        "script": {
                                                "exec": [
                                                        "pm.test(\"Status code is 200\", function () {",
                                                        "    pm.response.to.have.status(200);",
                                                        "});",
                                                        "",
                                                        "pm.test(\"Payler method is available\", function () {",
                                                        "    var jsonData = pm.response.json();",
                                                        "    pm.expect(jsonData.success).to.be.true;",
                                                        "    var paylerMethod = jsonData.data.find(method => method.id === 'payler');",
                                                        "    pm.expect(paylerMethod).to.exist;",
                                                        "    console.log('Payler enabled:', paylerMethod.enabled);",
                                                        "});"
                                                ],
                                                "type": "text/javascript"
                                        }
                                }
                        ],
                        "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                        "raw": "{{BASE_URL}}/api/payments/payment-methods",
                                        "host": ["{{BASE_URL}}"],
                                        "path": ["api", "payments", "payment-methods"]
                                },
                                "description": "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Payler –≤ —Å–ø–∏—Å–∫–µ –º–µ—Ç–æ–¥–æ–≤ –æ–ø–ª–∞—Ç—ã.\n–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PAYLER_KEY."
                        },
                        "response": []
                }
        ],
        "event": [
                {
                        "listen": "prerequest",
                        "script": {
                                "id": "global-prerequest",
                                "exec": [
                                        "// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤",
                                        "console.log('üîÑ Executing request to:', pm.request.url.toString());"
                                ],
                                "type": "text/javascript"
                        }
                },
                {
                        "listen": "test",
                        "script": {
                                "id": "global-test",
                                "exec": [
                                        "// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤",
                                        "pm.test(\"Response time is less than 5000ms\", function () {",
                                        "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                                        "});",
                                        "",
                                        "pm.test(\"Response has valid JSON format\", function () {",
                                        "    try {",
                                        "        pm.response.json();",
                                        "    } catch (e) {",
                                        "        pm.expect.fail('Response is not valid JSON');",
                                        "    }",
                                        "});"
                                ],
                                "type": "text/javascript"
                        }
                }
        ],
        "variable": [
                {
                        "key": "BASE_URL",
                        "value": "http://localhost:5000",
                        "type": "string"
                },
                {
                        "key": "PAYLER_KEY",
                        "value": "1a92a7df-45d3-4fe7-8149-2fd0c7e8d366",
                        "type": "string",
                        "description": "–ë–æ–µ–≤–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á Payler –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HMAC –ø–æ–¥–ø–∏—Å–µ–π"
                }
        ]
}
