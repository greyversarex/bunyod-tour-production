<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="b2b.page_title">Партнерская программа для турагентов - Bunyod-Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/public/js/i18n.js"></script>
    <script src="/public/js/utils.js"></script>
    <link rel="stylesheet" href="/public/css/layout.css?v=1.6">
</head>
<body class="bg-gray-50">
    <div id="header-container"></div>

    <!-- Главная секция -->
    <section class="relative bg-gradient-to-r from-blue-600 to-blue-800 text-white py-20" style="margin-top: 64px;">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-6" data-i18n="b2b.hero_title">
                    Станьте партнером Bunyod-Tour
                </h1>
                <p class="text-xl md:text-2xl text-blue-100 max-w-3xl mx-auto" data-i18n="b2b.hero_subtitle">
                    Присоединяйтесь к нашей программе B2B-партнерства и получайте эксклюзивные условия для ваших клиентов
                </p>
            </div>
        </div>
    </section>

    <!-- Преимущества партнерства -->
    <section class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12 text-gray-800" data-i18n="b2b.benefits_title">
                Почему стоит работать с нами?
            </h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="text-center p-6">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-percentage text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3" data-i18n="b2b.benefit1_title">Выгодные комиссии</h3>
                    <p class="text-gray-600" data-i18n="b2b.benefit1_text">
                        Получайте конкурентные комиссионные за каждое приведенное бронирование
                    </p>
                </div>
                <div class="text-center p-6">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-headset text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3" data-i18n="b2b.benefit2_title">Поддержка 24/7</h3>
                    <p class="text-gray-600" data-i18n="b2b.benefit2_text">
                        Персональный менеджер и техническая поддержка в любое время
                    </p>
                </div>
                <div class="text-center p-6">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-purple-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3" data-i18n="b2b.benefit3_title">Личный кабинет</h3>
                    <p class="text-gray-600" data-i18n="b2b.benefit3_text">
                        Удобная система отслеживания бронирований и статистики
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Форма заявки -->
    <section class="py-16 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4">
            <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12">
                <h2 class="text-3xl font-bold mb-4 text-center text-gray-800" data-i18n="b2b.form_title">
                    Заявка на партнерство
                </h2>
                <p class="text-center text-gray-600 mb-8" data-i18n="b2b.form_subtitle">
                    Заполните форму, и мы свяжемся с вами в течение 24 часов
                </p>

                <form id="partnershipForm" class="space-y-6">
                    <!-- ФИО -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" data-i18n="b2b.form_fullname">
                            ФИО (полное) <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="fullName" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            data-i18n-placeholder="b2b.form_fullname_placeholder">
                    </div>

                    <!-- Гражданство -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" data-i18n="b2b.form_citizenship">
                            Гражданство <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="citizenship" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            data-i18n-placeholder="b2b.form_citizenship_placeholder">
                    </div>

                    <!-- Адрес -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" data-i18n="b2b.form_address">
                            Адрес <span class="text-red-500">*</span>
                        </label>
                        <textarea id="address" required rows="3"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            data-i18n-placeholder="b2b.form_address_placeholder"></textarea>
                    </div>

                    <!-- Телефон и Email -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2" data-i18n="b2b.form_phone">
                                Телефон <span class="text-red-500">*</span>
                            </label>
                            <input type="tel" id="phone" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                data-i18n-placeholder="b2b.form_phone_placeholder">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2" data-i18n="b2b.form_email">
                                Email <span class="text-red-500">*</span>
                            </label>
                            <input type="email" id="email" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                data-i18n-placeholder="b2b.form_email_placeholder">
                        </div>
                    </div>

                    <!-- Загрузка документов -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2" data-i18n="b2b.form_id_document">
                            Документ, удостоверяющий личность <span class="text-red-500">*</span>
                        </label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input type="file" id="idDocument" accept="image/*,.pdf" required
                                class="hidden" onchange="handleFileSelect('idDocument', 'idDocPreview')">
                            <label for="idDocument" class="cursor-pointer">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600" data-i18n="b2b.form_upload_hint">
                                    Нажмите для выбора файла или перетащите сюда
                                </p>
                                <p class="text-sm text-gray-500 mt-2" data-i18n="b2b.form_upload_formats">
                                    Форматы: JPG, PNG, PDF (макс. 10MB)
                                </p>
                            </label>
                            <div id="idDocPreview" class="mt-4 hidden">
                                <p class="text-sm text-green-600"></p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2" data-i18n="b2b.form_other_documents">
                            Другие документы (опционально)
                        </label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input type="file" id="otherDocuments" accept="image/*,.pdf" multiple
                                class="hidden" onchange="handleFileSelect('otherDocuments', 'otherDocsPreview')">
                            <label for="otherDocuments" class="cursor-pointer">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600" data-i18n="b2b.form_upload_hint">
                                    Нажмите для выбора файлов или перетащите сюда
                                </p>
                                <p class="text-sm text-gray-500 mt-2" data-i18n="b2b.form_upload_formats_multiple">
                                    Можно загрузить несколько файлов (макс. 10MB каждый)
                                </p>
                            </label>
                            <div id="otherDocsPreview" class="mt-4 hidden">
                                <p class="text-sm text-green-600"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Чекбоксы согласия -->
                    <div class="space-y-4 bg-gray-50 p-6 rounded-lg">
                        <div class="flex items-start">
                            <input type="checkbox" id="partnershipAgreement" required
                                class="mt-1 w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <label for="partnershipAgreement" class="ml-3 text-gray-700">
                                <span data-i18n="b2b.form_agreement1">Согласен с</span>
                                <a href="/partnership-agreement.pdf" target="_blank" class="text-blue-600 hover:underline" data-i18n="b2b.form_agreement1_link">
                                    Договором о партнерстве
                                </a>
                                <span class="text-red-500">*</span>
                            </label>
                        </div>
                        <div class="flex items-start">
                            <input type="checkbox" id="privacyAgreement" required
                                class="mt-1 w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <label for="privacyAgreement" class="ml-3 text-gray-700">
                                <span data-i18n="b2b.form_agreement2">Согласен с</span>
                                <a href="/privacy-policy-ru.pdf" target="_blank" class="text-blue-600 hover:underline" data-i18n="b2b.form_agreement2_link">
                                    Политикой конфиденциальности
                                </a>
                                <span class="text-red-500">*</span>
                            </label>
                        </div>
                    </div>

                    <!-- Кнопка отправки -->
                    <div class="text-center">
                        <button type="submit" id="submitBtn"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-12 rounded-lg text-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <span id="submitText" data-i18n="b2b.form_submit">Отправить заявку</span>
                            <span id="loadingText" class="hidden" data-i18n="b2b.form_submitting">Отправка...</span>
                        </button>
                    </div>

                    <!-- Уведомление -->
                    <div id="notification" class="hidden"></div>
                </form>
            </div>
        </div>
    </section>

    <div id="footer-container"></div>

    <script>
        // Загрузка хедера и футера
        loadComponent('header-container', '/_header.html');
        loadComponent('footer-container', '/_footer.html');

        // Обработка выбора файлов
        function handleFileSelect(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const files = input.files;

            if (files.length > 0) {
                preview.classList.remove('hidden');
                if (files.length === 1) {
                    preview.innerHTML = `<p class="text-sm text-green-600"><i class="fas fa-check-circle"></i> ${files[0].name}</p>`;
                } else {
                    preview.innerHTML = `<p class="text-sm text-green-600"><i class="fas fa-check-circle"></i> ${getTranslation('b2b.files_selected')}: ${files.length}</p>`;
                }
            } else {
                preview.classList.add('hidden');
            }
        }

        // Отправка формы
        document.getElementById('partnershipForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const loadingText = document.getElementById('loadingText');

            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            loadingText.classList.remove('hidden');

            try {
                const formData = new FormData();
                formData.append('fullName', document.getElementById('fullName').value.trim());
                formData.append('citizenship', document.getElementById('citizenship').value.trim());
                formData.append('address', document.getElementById('address').value.trim());
                formData.append('phone', document.getElementById('phone').value.trim());
                formData.append('email', document.getElementById('email').value.trim());
                formData.append('partnershipAgreement', document.getElementById('partnershipAgreement').checked);
                formData.append('privacyAgreement', document.getElementById('privacyAgreement').checked);

                // Добавляем файлы
                const idDoc = document.getElementById('idDocument').files[0];
                if (idDoc) formData.append('idDocument', idDoc);

                const otherDocs = document.getElementById('otherDocuments').files;
                for (let i = 0; i < otherDocs.length; i++) {
                    formData.append('otherDocuments', otherDocs[i]);
                }

                const response = await fetch('/api/agent-applications', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNotification(getTranslation('b2b.success_message'), 'success');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    showNotification(data.message || getTranslation('b2b.error_message'), 'error');
                }
            } catch (error) {
                console.error('Error submitting application:', error);
                showNotification(getTranslation('b2b.error_submit'), 'error');
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                loadingText.classList.add('hidden');
            }
        });

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.className = `mt-6 p-4 rounded-lg ${
                type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
            }`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            notification.classList.remove('hidden');

            setTimeout(() => {
                notification.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>
