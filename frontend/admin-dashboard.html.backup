<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Bunyod-Tour</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- üåê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –¶–ï–ù–¢–†–ê–õ–¨–ù–û–ô –°–ò–°–¢–ï–ú–´ i18n -->
    <script src="/public/js/i18n.js"></script>
    <script src="/public/js/utils.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f3f4f6;
        }
        
        .sidebar {
            width: 260px;
            background: #3E3E3E;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–æ–º */
        .sidebar nav {
            max-height: calc(100vh - 120px); /* –í—ã—á–∏—Ç–∞–µ–º –≤—ã—Å–æ—Ç—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
            overflow-y: auto;
            overflow-x: hidden;
            /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
        }
        
        /* –°—Ç–∏–ª–∏ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è WebKit –±—Ä–∞—É–∑–µ—Ä–æ–≤ */
        .sidebar nav::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar nav::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .sidebar nav::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.3);
            border-radius: 3px;
        }
        
        .sidebar nav::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255,255,255,0.5);
        }
        
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }
        
        .main-content.expanded {
            margin-left: 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .nav-item {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #4A4A4A;
            color: white;
        }
        
        .nav-group {
            margin-bottom: 4px;
        }
        
        .nav-parent {
            position: relative;
        }
        
        .nav-arrow {
            margin-left: auto;
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        .nav-arrow.rotated {
            transform: rotate(180deg);
        }
        
        .nav-submenu {
            margin-left: 16px;
            border-left: 2px solid rgba(255,255,255,0.1);
            padding-left: 8px;
        }
        
        .nav-subitem {
            color: rgba(255,255,255,0.6);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
            border-radius: 6px;
            margin-bottom: 2px;
        }
        
        .nav-subitem:hover, .nav-subitem.active {
            background: #2F2F2F;
            color: rgba(255,255,255,0.9);
        }
        
        .tab-button {
            padding: 10px 24px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab-button:hover {
            color: #4b5563;
        }
        
        .tab-button.active {
            color: #3E3E3E;
            border-bottom-color: #3E3E3E;
        }
        
        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #f9fafb;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .data-table tr:hover {
            background: #f9fafb;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 32px;
            position: relative;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3E3E3E;
            box-shadow: 0 0 0 3px rgba(62,62,62,0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #3E3E3E;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2F2F2F;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fed7aa;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .checkbox-item:hover {
            background: #f3f4f6;
        }
        
        .checkbox-item.selected {
            background: #3E3E3E;
            color: white;
            border-color: #3E3E3E;
        }
        
        .search-bar {
            position: relative;
            max-width: 400px;
        }
        
        .search-bar input {
            width: 100%;
            padding: 10px 40px 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
        }
        
        .search-bar i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
    </style>
</head>
<body>
    
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4" style="background-color: #3E3E3E;">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2" data-translate="admin.admin_panel">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                <p class="text-gray-600" data-translate="admin.login_message">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
            </div>
            <form id="loginForm">
                <div class="mb-6">
                    <label class="form-label" data-translate="admin.username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="username" class="form-input" placeholder="admin" required>
                </div>
                <div class="mb-6">
                    <label class="form-label" data-translate="admin.password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt"></i>
                    <span data-translate="admin.login_button">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</span>
                </button>
                <div class="mt-4 text-center text-sm text-gray-500">
                    <span data-translate="admin.test_credentials">–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: admin / admin123</span>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="p-6 border-b border-white/20">
                <div class="flex items-center mb-2">
                    <img src="/Logo-Ru_1754635713718.png" alt="Bunyod-Tour Logo" class="w-10 h-10 mr-3 rounded-full">
                    <h2 class="text-white text-xl font-bold">Bunyod-Tour</h2>
                </div>
                <p class="text-white/60 text-sm mt-1" data-translate="admin.control_panel">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
            </div>
            
            <nav class="p-4">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span data-translate="admin.dashboard">–ì–ª–∞–≤–Ω–∞—è</span>
                </a>
                <a href="#" class="nav-item" data-section="tours">
                    <i class="fas fa-map-marked-alt"></i>
                    <span data-translate="admin.tours">–¢—É—Ä—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="categories">
                    <i class="fas fa-tags"></i>
                    <span data-translate="admin.categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                </a>
                <a href="#" class="nav-item" data-section="price-calculator">
                    <i class="fas fa-calculator"></i>
                    <span data-translate="admin.price_calculator">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–Ω</span>
                </a>
                <a href="#" class="nav-item" data-section="banner-management">
                    <i class="fas fa-images"></i>
                    <span data-translate="admin.banner_management">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–æ–º</span>
                </a>
                <a href="#" class="nav-item" data-section="bookings">
                    <i class="fas fa-calendar-check"></i>
                    <span data-translate="admin.bookings">–ó–∞–∫–∞–∑—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="hotels">
                    <i class="fas fa-hotel"></i>
                    <span data-translate="admin.hotels">–û—Ç–µ–ª–∏</span>
                </a>
                <a href="#" class="nav-item" data-section="guides">
                    <i class="fas fa-user-tie"></i>
                    <span data-translate="admin.guides">–ì–∏–¥—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="tour-agents">
                    <i class="fas fa-handshake"></i>
                    <span data-translate="admin.tour_agents">–¢—É—Ä–∞–≥–µ–Ω—Ç—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="drivers">
                    <i class="fas fa-id-card"></i>
                    <span data-translate="admin.drivers">–í–æ–¥–∏—Ç–µ–ª–∏</span>
                </a>
                <a href="#" class="nav-item" data-section="trips">
                    <i class="fas fa-route"></i>
                    <span data-translate="admin.trips">–ü–æ–µ–∑–¥–∫–∏</span>
                </a>
                <a href="#" class="nav-item" data-section="transfers">
                    <i class="fas fa-shuttle-van"></i>
                    <span data-translate="admin.transfers">–¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="countries">
                    <i class="fas fa-globe"></i>
                    <span data-translate="admin.countries">–°—Ç—Ä–∞–Ω—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="cities">
                    <i class="fas fa-city"></i>
                    <span data-translate="admin.cities">–ì–æ—Ä–æ–¥–∞</span>
                </a>
                <a href="#" class="nav-item" data-section="customers">
                    <i class="fas fa-users"></i>
                    <span data-translate="admin.customers">–ö–ª–∏–µ–Ω—Ç—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="reviews">
                    <i class="fas fa-star"></i>
                    <span data-translate="admin.reviews">–û—Ç–∑—ã–≤—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="news">
                    <i class="fas fa-newspaper"></i>
                    <span data-translate="admin.news">–ù–æ–≤–æ—Å—Ç–∏</span>
                </a>
                <a href="#" class="nav-item" data-section="payments">
                    <i class="fas fa-credit-card"></i>
                    <span data-translate="admin.payments">–ü–ª–∞—Ç–µ–∂–∏</span>
                </a>
                <a href="#" class="nav-item" data-section="exchange-rates">
                    <i class="fas fa-exchange-alt"></i>
                    <span data-translate="admin.exchange_rates">–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç</span>
                </a>
                <a href="#" class="nav-item" data-section="cms">
                    <i class="fas fa-edit"></i>
                    <span data-translate="admin.cms_content">CMS - –ö–æ–Ω—Ç–µ–Ω—Ç</span>
                </a>
                <a href="#" class="nav-item" data-section="translations">
                    <i class="fas fa-language"></i>
                    <span data-translate="admin.translations">–ü–µ—Ä–µ–≤–æ–¥—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span data-translate="admin.settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span data-translate="admin.logout">–í—ã—Ö–æ–¥</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="bg-white shadow-sm px-6 py-4 flex justify-between items-center">
                <button class="lg:hidden" onclick="toggleSidebar()">
                    <i class="fas fa-bars text-gray-600 text-xl"></i>
                </button>
                <h1 class="text-2xl font-semibold text-gray-800" id="sectionTitle" data-translate="admin.dashboard">–ì–ª–∞–≤–Ω–∞—è</h1>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-semibold">
                            A
                        </div>
                        <span class="text-gray-700 font-medium" data-translate="admin.administrator">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                        <button onclick="logout()" class="flex items-center gap-2 px-3 py-2 bg-red-50 hover:bg-red-100 rounded-lg transition-colors text-red-600">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="font-medium">–í—ã—Ö–æ–¥</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="p-6" id="contentArea">
                <!-- Dashboard Section -->
                <section id="dashboardSection">
                    <!-- Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-map text-blue-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+12%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">156</h3>
                            <p class="text-gray-600 text-sm mt-1" data-translate="admin.active_tours">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç—É—Ä–æ–≤</p>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-users text-green-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+23%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">342</h3>
                            <p class="text-gray-600 text-sm mt-1" data-translate="admin.orders_this_month">–ó–∞–∫–∞–∑–æ–≤ –∑–∞ –º–µ—Å—è—Ü</p>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-dollar-sign text-purple-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+18%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">$45,678</h3>
                            <p class="text-gray-600 text-sm mt-1" data-translate="admin.monthly_revenue">–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</p>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-users text-orange-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+8%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">1,234</h3>
                            <p class="text-gray-600 text-sm mt-1" data-translate="admin.active_customers">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4" data-translate="admin.recent_orders">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h2>
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th data-translate="table.order_number">‚Ññ –ó–∞–∫–∞–∑–∞</th>
                                        <th data-translate="table.client">–ö–ª–∏–µ–Ω—Ç</th>
                                        <th data-translate="table.tour">–¢—É—Ä</th>
                                        <th data-translate="table.date">–î–∞—Ç–∞</th>
                                        <th data-translate="table.amount">–°—É–º–º–∞</th>
                                        <th data-translate="table.status">–°—Ç–∞—Ç—É—Å</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="recentOrdersTable">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4" data-translate="admin.sales_chart">–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4" data-translate="admin.popular_destinations">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="destinationsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Tours Section -->
                <section id="toursSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <div class="search-bar">
                            <input type="text" data-translate-placeholder="placeholder.search_tours" placeholder="–ü–æ–∏—Å–∫ —Ç—É—Ä–æ–≤..." id="tourSearch">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-primary" onclick="openTourModal()">
                            <i class="fas fa-plus"></i>
                            <span data-translate="btn.add_tour">–î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä</span>
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th data-translate="table.name">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th data-translate="table.category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                        <th data-translate="table.country">–°—Ç—Ä–∞–Ω–∞</th>
                                        <th data-translate="table.city">–ì–æ—Ä–æ–¥</th>
                                        <th data-translate="table.duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                                        <th data-translate="table.price">–¶–µ–Ω–∞</th>
                                        <th data-translate="table.status">–°—Ç–∞—Ç—É—Å</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="toursTable">
                                    <!-- Tours will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Categories Section -->
                <section id="categoriesSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <div class="search-bar">
                            <input type="text" data-translate-placeholder="placeholder.search_categories" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π..." id="categorySearch">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-primary" onclick="openCategoryModal()">
                            <i class="fas fa-plus"></i>
                            <span data-translate="btn.add_category">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</span>
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th data-translate="table.name_ru">–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</th>
                                        <th data-translate="table.name_en">–ù–∞–∑–≤–∞–Ω–∏–µ (EN)</th>
                                        <th>–¢–∏–ø</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="categoriesTable">
                                    <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Bookings Section -->
                <section id="bookingsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex gap-2 mb-4">
                            <button class="tab-button active" data-status="all" data-translate="tab.all_orders">–í—Å–µ –∑–∞–∫–∞–∑—ã</button>
                            <button class="tab-button" data-status="pending" data-translate="status.pending">–û–∂–∏–¥–∞—é—â–∏–µ</button>
                            <button class="tab-button" data-status="confirmed" data-translate="status.confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ</button>
                            <button class="tab-button" data-status="paid" data-translate="status.paid">–û–ø–ª–∞—á–µ–Ω–Ω—ã–µ</button>
                            <button class="tab-button" data-status="completed" data-translate="status.completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</button>
                            <button class="tab-button" data-status="cancelled" data-translate="status.cancelled">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th data-translate="table.order_number">‚Ññ –ó–∞–∫–∞–∑–∞</th>
                                        <th>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</th>
                                        <th data-translate="table.client">–ö–ª–∏–µ–Ω—Ç</th>
                                        <th data-translate="table.tour">–¢—É—Ä</th>
                                        <th>–î–∞—Ç–∞ —Ç—É—Ä–∞</th>
                                        <th>–ö–æ–ª-–≤–æ —á–µ–ª–æ–≤–µ–∫</th>
                                        <th data-translate="table.amount">–°—É–º–º–∞</th>
                                        <th>–û–ø–ª–∞—Ç–∞</th>
                                        <th data-translate="table.status">–°—Ç–∞—Ç—É—Å</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="bookingsTable">
                                    <!-- Bookings will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Hotels Section -->
                <section id="hotelsSection" style="display: none;">
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold" data-translate="admin.manage_hotels">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–µ–ª—è–º–∏</h2>
                            <button class="btn btn-primary" onclick="openHotelModal()">
                                <i class="fas fa-plus"></i>
                                –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–µ–ª—å
                            </button>
                        </div>
                        
                        <!-- Search and Filter -->
                        <div class="flex justify-between items-center mb-4">
                            <div class="search-bar">
                                <input type="text" id="hotelSearch" data-translate-placeholder="placeholder.search_hotels" placeholder="–ü–æ–∏—Å–∫ –æ—Ç–µ–ª–µ–π..." onkeyup="searchHotels()">
                                <i class="fas fa-search"></i>
                            </div>
                            <select id="hotelFilter" onchange="filterHotels()" class="form-input" style="max-width: 200px;">
                                <option value="">–í—Å–µ –æ—Ç–µ–ª–∏</option>
                                <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                                <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="hotelsList">
                        <!-- Hotels will be loaded here -->
                    </div>
                </section>

                <!-- Guides Section -->
                <section id="guidesSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-xl font-semibold" data-translate="admin.manage_guides">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∏–¥–∞–º–∏</h2>
                        <button class="btn btn-primary" onclick="openGuideModal()">
                            <i class="fas fa-plus"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –≥–∏–¥–∞
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="guidesList">
                        <!-- Guides will be loaded here -->
                    </div>
                </section>

                <!-- Tour Agents Section -->
                <section id="tourAgentsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold" data-translate="admin.manage_tour_agents">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞–º–∏</h2>
                            <button class="btn btn-primary" onclick="openTourAgentModal()">
                                <i class="fas fa-plus"></i>
                                –î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞
                            </button>
                        </div>
                        
                        <!-- Search and Filter -->
                        <div class="flex justify-between items-center mb-4">
                            <div class="search-bar">
                                <input type="text" id="tourAgentSearch" data-translate-placeholder="placeholder.search_tour_agents" placeholder="–ü–æ–∏—Å–∫ —Ç—É—Ä–∞–≥–µ–Ω—Ç–æ–≤..." onkeyup="searchTourAgents()">
                                <i class="fas fa-search"></i>
                            </div>
                            <select id="tourAgentFilter" onchange="filterTourAgents()" class="form-input" style="max-width: 200px;">
                                <option value="">–í—Å–µ —Ç—É—Ä–∞–≥–µ–Ω—Ç—ã</option>
                                <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                                <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="tourAgentsList">
                        <!-- Tour agents will be loaded here -->
                    </div>
                </section>

                <!-- Drivers Section -->
                <section id="driversSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-xl font-semibold" data-translate="admin.manage_drivers">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏</h2>
                        <button class="btn btn-primary" onclick="openDriverModal()">
                            <i class="fas fa-plus"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="driversList">
                        <!-- Drivers will be loaded here -->
                    </div>
                </section>

                <!-- Trips Section -->
                <section id="tripsSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-xl font-semibold" data-translate="admin.manage_trips">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∞–º–∏</h2>
                        <button class="btn btn-primary" onclick="openTripModal()">
                            <i class="fas fa-plus"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –ø–æ–µ–∑–¥–∫—É
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                                        <th>–û—Ç</th>
                                        <th>–î–æ</th>
                                        <th>–í–æ–¥–∏—Ç–µ–ª—å</th>
                                        <th>–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</th>
                                        <th>–í—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è</th>
                                        <th data-translate="table.status">–°—Ç–∞—Ç—É—Å</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="tripsTable">
                                    <!-- Trips will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Transfers Section -->
                <section id="transfersSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-xl font-semibold" data-translate="admin.transfer_requests">–ó–∞—è–≤–∫–∏ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä</h2>
                        <div class="flex gap-2">
                            <button class="btn btn-outline-primary" onclick="loadTransferRequests()">
                                <i class="fas fa-sync"></i>
                                –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                            <select class="form-control" id="transferStatusFilter" onchange="filterTransferRequests()">
                                <option value="all">–í—Å–µ –∑–∞—è–≤–∫–∏</option>
                                <option value="pending">–û–∂–∏–¥–∞—é—Ç</option>
                                <option value="approved">–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</option>
                                <option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–§–ò–û –∫–ª–∏–µ–Ω—Ç–∞</th>
                                        <th>–ö–æ–Ω—Ç–∞–∫—Ç—ã</th>
                                        <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                                        <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                                        <th>–ü–∞—Å—Å–∞–∂–∏—Ä—ã</th>
                                        <th>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</th>
                                        <th data-translate="table.status">–°—Ç–∞—Ç—É—Å</th>
                                        <th>–ù–∞–∑–Ω–∞—á–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—å</th>
                                        <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="transferRequestsTable">
                                    <!-- Transfer requests will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="stat-card">
                            <div class="stat-icon bg-yellow-100 text-yellow-600">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="pendingTransfersCount">0</div>
                                <div class="stat-label">–û–∂–∏–¥–∞—é—Ç</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-green-100 text-green-600">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="approvedTransfersCount">0</div>
                                <div class="stat-label">–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-red-100 text-red-600">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="rejectedTransfersCount">0</div>
                                <div class="stat-label">–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-blue-100 text-blue-600">
                                <i class="fas fa-shuttle-van"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalTransfersCount">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Countries Section -->
                <section id="countriesSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-xl font-semibold" data-translate="admin.manage_countries">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∞–º–∏</h2>
                        <button class="btn btn-primary" onclick="openCountryModal()">
                            <i class="fas fa-plus mr-2"></i>
                            –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="countriesList">
                        <!-- Countries will be loaded here -->
                    </div>
                </section>

                <!-- Cities Section -->
                <section id="citiesSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-xl font-semibold" data-translate="admin.manage_cities">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞–º–∏</h2>
                        <button class="btn btn-primary" onclick="openCityModal()">
                            <i class="fas fa-plus mr-2"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="citiesList">
                        <!-- Cities will be loaded here -->
                    </div>
                </section>

                <!-- Reviews Section -->
                <section id="reviewsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex gap-2 mb-4">
                            <button class="tab-button active" data-filter="all">–í—Å–µ –æ—Ç–∑—ã–≤—ã</button>
                            <button class="tab-button" data-filter="pending">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</button>
                            <button class="tab-button" data-filter="approved">–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</button>
                            <button class="tab-button" data-filter="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th data-translate="table.date">–î–∞—Ç–∞</th>
                                        <th>–ò–º—è —Ç—É—Ä–∏—Å—Ç–∞</th>
                                        <th data-translate="table.tour">–¢—É—Ä</th>
                                        <th>–†–µ–π—Ç–∏–Ω–≥</th>
                                        <th>–û—Ç–∑—ã–≤</th>
                                        <th>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</th>
                                        <th data-translate="table.status">–°—Ç–∞—Ç—É—Å</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="reviewsTable">
                                    <!-- Reviews will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- News Section -->
                <section id="newsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</h2>
                            <button class="btn btn-primary" onclick="openNewsModal()">
                                <i class="fas fa-plus mr-2"></i>
                                –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å
                            </button>
                        </div>
                        <div class="flex gap-2 mb-4">
                            <button class="tab-button active" data-filter="all">–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</button>
                            <button class="tab-button" data-filter="published">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ</button>
                            <button class="tab-button" data-filter="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</button>
                            <button class="tab-button" data-filter="featured">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</button>
                        </div>
                        <div class="flex gap-4 mb-4">
                            <div class="stat-card flex-1">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-newspaper text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 text-sm" data-translate="admin.total_news">–í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π</p>
                                        <p class="text-2xl font-bold" id="totalNewsCount">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card flex-1">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-check-circle text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 text-sm" data-translate="admin.published">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</p>
                                        <p class="text-2xl font-bold" id="publishedNewsCount">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card flex-1">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-edit text-yellow-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 text-sm" data-translate="admin.drafts">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</p>
                                        <p class="text-2xl font-bold" id="draftNewsCount">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card flex-1">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-eye text-purple-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 text-sm" data-translate="admin.total_views">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</p>
                                        <p class="text-2xl font-bold" id="totalNewsViews">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th data-translate="table.title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                                        <th data-translate="table.category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                        <th data-translate="table.status">–°—Ç–∞—Ç—É—Å</th>
                                        <th data-translate="table.author">–ê–≤—Ç–æ—Ä</th>
                                        <th data-translate="table.publish_date">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</th>
                                        <th data-translate="table.views">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="newsTable">
                                    <!-- News will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- CMS Section -->
                <section id="cmsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex gap-2 mb-4">
                            <button class="tab-button active" onclick="switchCMSTab('blocks')">–ë–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</button>
                            <button class="tab-button" onclick="switchCMSTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞</button>
                            <button class="tab-button" onclick="switchCMSTab('pages')">–°—Ç—Ä–∞–Ω–∏—Ü—ã</button>
                            <button class="tab-button" onclick="switchCMSTab('menus')">–ú–µ–Ω—é</button>
                        </div>
                    </div>

                    <!-- CMS Content Blocks Tab -->
                    <div id="cmsBlocksTab">
                        <div class="mb-6 flex justify-between items-center">
                            <h2 class="text-xl font-semibold">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
                            <button class="btn btn-primary" onclick="openContentBlockModal()">
                                <i class="fas fa-plus"></i>
                                <span>–°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</span>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm">
                            <div class="overflow-x-auto">
                                <table class="data-table w-full">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>–¢–∏–ø</th>
                                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</th>
                                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ (EN)</th>
                                            <th>–°—Ç–∞—Ç—É—Å</th>
                                            <th>–û–±–Ω–æ–≤–ª–µ–Ω–æ</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="contentBlocksTable">
                                        <!-- CMS Content blocks will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Site Settings Tab -->
                    <div id="cmsSettingsTab" style="display: none;">
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞</h2>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <form id="siteSettingsForm">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="form-group">
                                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ (RU)</label>
                                        <input type="text" class="form-input" id="siteTitle_ru" name="siteTitle_ru">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ (EN)</label>
                                        <input type="text" class="form-input" id="siteTitle_en" name="siteTitle_en">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞ (RU)</label>
                                        <textarea class="form-input" rows="3" id="siteDescription_ru" name="siteDescription_ru"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞ (EN)</label>
                                        <textarea class="form-input" rows="3" id="siteDescription_en" name="siteDescription_en"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-input" id="contactEmail" name="contactEmail">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                        <input type="text" class="form-input" id="contactPhone" name="contactPhone">
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- CMS Pages Tab -->
                    <div id="cmsPagesTab" style="display: none;">
                        <div class="mb-6 flex justify-between items-center">
                            <h2 class="text-xl font-semibold">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏</h2>
                            <button class="btn btn-primary" onclick="openPageModal()">
                                <i class="fas fa-plus"></i>
                                <span>–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</span>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm">
                            <div class="overflow-x-auto">
                                <table class="data-table w-full">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Slug</th>
                                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</th>
                                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ (EN)</th>
                                            <th>–°—Ç–∞—Ç—É—Å</th>
                                            <th>–û–±–Ω–æ–≤–ª–µ–Ω–æ</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cmsPagesTable">
                                        <!-- CMS Pages will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- CMS Menus Tab -->
                    <div id="cmsMenusTab" style="display: none;">
                        <div class="mb-6 flex justify-between items-center">
                            <h2 class="text-xl font-semibold">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é</h2>
                            <button class="btn btn-primary" onclick="openMenuItemModal()">
                                <i class="fas fa-plus"></i>
                                <span>–°–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é</span>
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm">
                            <div class="overflow-x-auto">
                                <table class="data-table w-full">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</th>
                                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ (EN)</th>
                                            <th>URL</th>
                                            <th>–¢–∏–ø</th>
                                            <th>–ü–æ—Ä—è–¥–æ–∫</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cmsMenusTable">
                                        <!-- CMS Menu items will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –£–î–ê–õ–ï–ù–û: –í—Å—è Enhanced Tours Form Tab –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ -->
                </section>

                <!-- Translations Section -->
                <section id="translationsSection" style="display: none;">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ —Ç—É—Ä–æ–≤</h2>
                        <p class="text-gray-600">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —Ç—É—Ä–æ–≤ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏</p>
                    </div>
                    
                    <!-- Translation Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-language text-blue-600 text-xl"></i>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800" id="supportedLanguagesCount">6</h3>
                            <p class="text-gray-600 text-sm mt-1">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤</p>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800" id="translatedToursCount">0</h3>
                            <p class="text-gray-600 text-sm mt-1">–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ç—É—Ä–æ–≤</p>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-clock text-orange-600 text-xl"></i>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800" id="pendingTranslationsCount">0</h3>
                            <p class="text-gray-600 text-sm mt-1">–¢—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∞</p>
                        </div>
                    </div>

                    <!-- Translation Tools -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Single Tour Translation -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-map-marker-alt text-blue-600 mr-2"></i>
                                –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –æ–¥–∏–Ω —Ç—É—Ä
                            </h3>
                            <p class="text-gray-600 mb-6 text-sm">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç—É—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —è–∑—ã–∫–∏</p>
                            
                            <form id="singleTranslationForm">
                                <div class="form-group mb-4">
                                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä</label>
                                    <select class="form-input" id="translationTourSelect" required>
                                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä --</option>
                                    </select>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-full" id="translateSingleBtn">
                                    <i class="fas fa-language mr-2"></i>
                                    –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç—É—Ä
                                </button>
                            </form>
                        </div>

                        <!-- Batch Translation -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-globe text-green-600 mr-2"></i>
                                –ú–∞—Å—Å–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥
                            </h3>
                            <p class="text-gray-600 mb-6 text-sm">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –≤—Å–µ —Ç—É—Ä—ã –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç—É—Ä—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>
                            
                            <div class="space-y-4">
                                <button class="btn btn-success w-full" onclick="batchTranslateAllTours()">
                                    <i class="fas fa-rocket mr-2"></i>
                                    –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å–µ —Ç—É—Ä—ã
                                </button>
                                
                                <button class="btn btn-outline w-full" onclick="showBatchTranslationModal()">
                                    <i class="fas fa-check-square mr-2"></i>
                                    –í—ã–±—Ä–∞—Ç—å —Ç—É—Ä—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Manual Text Translation -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                        <h3 class="text-lg font-semibold mb-4">
                            <i class="fas fa-edit text-purple-600 mr-2"></i>
                            –†—É—á–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞
                        </h3>
                        <p class="text-gray-600 mb-6 text-sm">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç —Å –æ–¥–Ω–æ–≥–æ —è–∑—ã–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–π</p>
                        
                        <form id="manualTranslationForm" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <div class="form-group mb-4">
                                    <label class="form-label">–ò—Å—Ö–æ–¥–Ω—ã–π —è–∑—ã–∫</label>
                                    <select class="form-input" id="sourceLanguage" required>
                                        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                        <option value="en">English</option>

                                        <option value="fa">ŸÅÿßÿ±ÿ≥€å (Farsi)</option>
                                        <option value="de">Deutsch</option>
                                        <option value="zh">‰∏≠Êñá (Chinese)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
                                    <textarea class="form-input" id="sourceText" rows="8" data-translate-placeholder="placeholder.enter_text_for_translation" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞..." required></textarea>
                                </div>
                            </div>
                            
                            <div>
                                <div class="form-group mb-4">
                                    <label class="form-label">–¶–µ–ª–µ–≤–æ–π —è–∑—ã–∫</label>
                                    <select class="form-input" id="targetLanguage" required>
                                        <option value="en">English</option>
                                        <option value="ru">–†—É—Å—Å–∫–∏–π</option>

                                        <option value="fa">ŸÅÿßÿ±ÿ≥€å (Farsi)</option>
                                        <option value="de">Deutsch</option>
                                        <option value="zh">‰∏≠Êñá (Chinese)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
                                    <textarea class="form-input" id="translatedText" rows="8" data-translate-placeholder="placeholder.translated_text_will_appear" placeholder="–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..." readonly></textarea>
                                </div>
                            </div>
                            
                            <div class="lg:col-span-2">
                                <button type="submit" class="btn btn-primary" id="manualTranslateBtn">
                                    <i class="fas fa-arrow-right mr-2"></i>
                                    –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç
                                </button>
                                
                                <button type="button" class="btn btn-outline ml-4" onclick="copyTranslation()">
                                    <i class="fas fa-copy mr-2"></i>
                                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Translation Progress -->
                    <div class="bg-white rounded-xl shadow-sm p-6" id="translationProgress" style="display: none;">
                        <h3 class="text-lg font-semibold mb-4">
                            <i class="fas fa-spinner fa-spin text-blue-600 mr-2"></i>
                            –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–µ—Ä–µ–≤–æ–¥–∞
                        </h3>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-600" id="progressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–µ—Ä–µ–≤–æ–¥—É...</p>
                        <div id="translationResults" class="mt-4 space-y-2"></div>
                    </div>
                </section>

                <!-- Price Calculator Section -->
                <section id="priceCalculatorSection" style="display: none;">
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                        <h2 class="text-2xl font-semibold mb-6">
                            <i class="fas fa-calculator text-blue-600 mr-3"></i>
                            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω
                        </h2>
                        <p class="text-gray-600 mb-6">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏ –∏ –∏—Ö —Ü–µ–Ω–∞–º–∏. –≠—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—É—Ä–æ–≤.</p>
                        
                        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ -->
                        <div class="mb-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <h3 class="font-semibold text-blue-800 mb-4">
                                <i class="fas fa-plus mr-2"></i>
                                –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</label>
                                    <input type="text" id="newComponentName" class="form-input" data-translate-placeholder="placeholder.service_name_example" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–±–µ–¥ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">–¶–µ–Ω–∞ (TJS)</label>
                                    <input type="number" id="newComponentPrice" class="form-input" min="0" step="0.01" placeholder="0.00">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">–ï–¥–∏–Ω–∏—Ü–∞</label>
                                    <input type="text" id="newComponentUnit" class="form-input" placeholder="—á–µ–ª–æ–≤–µ–∫, –¥–µ–Ω—å, –∫–º">
                                </div>
                                <div class="flex items-end">
                                    <button onclick="addNewComponent()" class="btn btn-primary w-full">
                                        <i class="fas fa-plus mr-2"></i>
                                        –î–æ–±–∞–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            <div class="mt-3">
                                <label class="block text-sm font-medium text-gray-700 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                <input type="text" id="newComponentDescription" class="form-input" data-translate-placeholder="placeholder.component_additional_info" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ">
                            </div>
                        </div>
                        
                        <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
                        <div id="priceCalculatorComponents">
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ü–µ–Ω...
                            </div>
                        </div>
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                        <div class="mt-6 flex gap-4">
                            <button class="btn btn-success" onclick="refreshPriceComponents()">
                                <i class="fas fa-refresh mr-2"></i>
                                –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                            <button class="btn btn-secondary" onclick="initializeDefaultComponents()">
                                <i class="fas fa-download mr-2"></i>
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Banner Management Section -->
                <section id="bannerManagementSection" style="display: none;">
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                        <h2 class="text-2xl font-semibold mb-6">
                            <i class="fas fa-images text-blue-600 mr-3"></i>
                            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–æ–º
                        </h2>
                        <p class="text-gray-600 mb-6">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–∞–π–¥–∞–º–∏ –±–∞–Ω–Ω–µ—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</p>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- –¢–µ–∫—É—â–∏–µ —Å–ª–∞–π–¥—ã -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4">–¢–µ–∫—É—â–∏–µ —Å–ª–∞–π–¥—ã</h3>
                                <div id="currentSlides" class="space-y-4">
                                    <!-- Slides will be loaded here -->
                                </div>
                            </div>
                            
                            <!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–ª–∞–π–¥ -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–ª–∞–π–¥</h3>
                                <form id="bannerForm" class="space-y-4">
                                    <div class="form-group">
                                        <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (–†—É—Å—Å–∫–∏–π)</label>
                                        <input type="text" class="form-input" id="bannerTitleRu" data-translate-placeholder="placeholder.slide_title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–∞–π–¥–∞">
                                    </div>
                                    
                                    
                                    <div class="form-group">
                                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–†—É—Å—Å–∫–∏–π)</label>
                                        <textarea class="form-input" rows="3" id="bannerDescRu" data-translate-placeholder="placeholder.slide_description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∞–π–¥–∞"></textarea>
                                    </div>
                                    
                                    
                                    <div class="form-group">
                                        <label class="form-label">–§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                                        <input type="file" class="form-input" id="bannerImageFile" accept="image/*">
                                        <small class="text-gray-500 mt-1 block">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ (–†—É—Å—Å–∫–∏–π)</label>
                                        <input type="text" class="form-input" id="bannerButtonTextRu" data-translate-placeholder="placeholder.learn_more" placeholder="–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ">
                                    </div>
                                    
                                    
                                    <div class="form-group">
                                        <label class="form-label">–°—Å—ã–ª–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                        <input type="url" class="form-input" id="bannerLink" placeholder="https://example.com">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                                        <input type="number" class="form-input" id="bannerOrder" value="1" min="1">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="bannerActive" checked> –ê–∫—Ç–∏–≤–Ω—ã–π
                                        </label>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary w-full">
                                        <i class="fas fa-plus mr-2"></i>
                                        –î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settingsSection" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">–û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                            <form id="generalSettingsForm">
                                <div class="form-group">
                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                                    <input type="text" class="form-input" value="Bunyod-Tour">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                                    <input type="email" class="form-input" value="admin@bunyod-tour.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</label>
                                    <input type="email" class="form-input" value="community@bunyod-tour.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–∏</label>
                                    <input type="tel" class="form-input" value="+992 123 456 789">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                </button>
                            </form>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π</h3>
                            <form id="paymentSettingsForm">
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> Payme
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="Merchant ID">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> Click
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="Service ID">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> Stripe
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="API Key">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> PayPal
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="Client ID">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                </button>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Exchange Rates Section -->
                <section id="exchange-ratesSection" style="display: none;">
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏ –≤–∞–ª—é—Ç</h2>
                        <p class="text-gray-600 mt-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ü–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ</p>
                    </div>

                    <!-- Exchange Rates Table -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold">–¢–µ–∫—É—â–∏–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç</h3>
                            <div class="flex gap-2">
                                <button onclick="openAddExchangeRateModal()" class="btn btn-primary">
                                    <i class="fas fa-plus"></i>
                                    –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª—é—Ç—É
                                </button>
                                <button onclick="loadExchangeRates()" class="btn btn-secondary">
                                    <i class="fas fa-sync-alt"></i>
                                    –û–±–Ω–æ–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>–í–∞–ª—é—Ç–∞</th>
                                        <th data-translate="table.name">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–°–∏–º–≤–æ–ª</th>
                                        <th>–ö—É—Ä—Å –∫ TJS</th>
                                        <th>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</th>
                                        <th data-translate="table.actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="exchangeRatesTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center py-8 text-gray-500">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            –ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Exchange Rate Calculator -->
                    <div class="mt-6 bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–∞–ª—é—Ç</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label">–°—É–º–º–∞ –≤ TJS</label>
                                <input type="number" class="form-input" id="calcAmount" placeholder="100" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤</label>
                                <select class="form-input" id="calcTargetCurrency">
                                    <option value="USD">USD - –î–æ–ª–ª–∞—Ä –°–®–ê</option>
                                    <option value="EUR">EUR - –ï–≤—Ä–æ</option>
                                    <option value="TJS">TJS - –°–æ–º–æ–Ω–∏</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
                                <div class="form-input bg-gray-50" id="calcResult">0</div>
                            </div>
                        </div>
                        <button onclick="calculateCurrency()" class="btn btn-primary mt-4">
                            <i class="fas fa-calculator"></i>
                            –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Exchange Rate Modal -->
    <div id="exchangeRateModal" class="modal">
        <div class="modal-content" style="width: 500px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="exchangeRateModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã</h2>
                <button onclick="closeExchangeRateModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="exchangeRateForm">
                <input type="hidden" id="editCurrency">
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–¥ –≤–∞–ª—é—Ç—ã *</label>
                    <input type="text" class="form-input" id="editCurrencyCode" maxlength="3" placeholder="USD, EUR, CNY..." 
                           style="text-transform: uppercase;" required>
                    <small class="text-gray-500 mt-1">3-–±—É–∫–≤–µ–Ω–Ω—ã–π –∫–æ–¥ –≤–∞–ª—é—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: USD, EUR, CNY)</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" class="form-input" id="editCurrencyName" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°–∏–º–≤–æ–ª</label>
                    <input type="text" class="form-input" id="editCurrencySymbol" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö—É—Ä—Å –∫ TJS</label>
                    <input type="number" class="form-input" id="editCurrencyRate" step="0.0001" min="0" required>
                    <small class="text-gray-500 mt-1">1 TJS = ? –µ–¥–∏–Ω–∏—Ü —ç—Ç–æ–π –≤–∞–ª—é—Ç—ã</small>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeExchangeRateModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content" style="width: 500px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="categoryModalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                <button onclick="closeCategoryModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="categoryForm">
                <input type="hidden" id="editCategoryId">
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–†—É—Å—Å–∫–∏–π) *</label>
                    <input type="text" class="form-input" id="categoryNameRu" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (English) *</label>
                    <input type="text" class="form-input" id="categoryNameEn" placeholder="Example: Day Tours" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                    <select class="form-input" id="categoryType" required>
                        <option value="tour">–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç—É—Ä–æ–≤</option>
                        <option value="hotel">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ—Ç–µ–ª–µ–π</option>
                    </select>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeCategoryModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Slide Edit Modal -->
    <div id="slideEditModal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="slideEditModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–∞–π–¥</h2>
                <button onclick="closeSlideEditModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="slideEditForm" onsubmit="event.preventDefault(); saveSlideEdit();">
                <input type="hidden" id="editSlideId">
                
                <div class="form-group">
                    <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (–†—É—Å—Å–∫–∏–π) *</label>
                    <input type="text" class="form-input" id="editSlideTitleRu" required placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–∞–π–¥–∞">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–†—É—Å—Å–∫–∏–π)</label>
                    <textarea class="form-input" rows="3" id="editSlideDescRu" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∞–π–¥–∞"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                    <input type="file" class="form-input" id="editSlideImageFile" accept="image/*">
                    <small class="text-gray-500 mt-1 block">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë</small>
                    <div class="mt-2">
                        <img id="editSlideImagePreview" class="w-24 h-16 object-cover rounded border" style="display: none;" alt="–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ (–†—É—Å—Å–∫–∏–π)</label>
                    <input type="text" class="form-input" id="editSlideButtonTextRu" placeholder="–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°—Å—ã–ª–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="url" class="form-input" id="editSlideLink" placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                    <input type="number" class="form-input" id="editSlideOrder" value="1" min="1">
                </div>
                
                <div class="form-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="editSlideActive"> –ê–∫—Ç–∏–≤–Ω—ã–π
                    </label>
                </div>
                
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeSlideEditModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save mr-2"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hotel Modal -->
    <div id="hotelModal" class="modal">
        <div class="modal-content" style="width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="hotelModalTitle">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–µ–ª—å</h2>
                <button onclick="closeHotelModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="hotelForm">
                <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ ID -->
                <input type="hidden" id="hotel-id">
                
                <div class="grid grid-cols-1 gap-4">
                    <!-- üåê –ú–ù–û–ì–û–Ø–ó–´–ß–ù–´–ï –ü–û–õ–Ø –û–¢–ï–õ–ï–ô -->
                    <div class="p-4 rounded-lg border border-gray-200">
                        <h4 class="font-medium text-gray-700 mb-3">üåê –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–µ)</h4>
                        <div class="grid grid-cols-1 gap-3">
                            <div class="form-group">
                                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è (–†—É—Å—Å–∫–∏–π) *</label>
                                <input type="text" class="form-input" id="hotelNameRu" data-translate-placeholder="placeholder.hotel_name_example" placeholder="–û—Ç–µ–ª—å –•–∏–ª—Ç–æ–Ω –î—É—à–∞–Ω–±–µ, –°–µ—Ä–µ–Ω–∞ –û—Ç–µ–ª—å –∏ —Ç.–¥." required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è (English) *</label>
                                <input type="text" class="form-input" id="hotelNameEn" placeholder="Hilton Dushanbe, Serena Hotel, etc." required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 rounded-lg border border-gray-200">
                        <h4 class="font-medium text-gray-700 mb-3">üìù –û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–µ–ª—è (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–µ)</h4>
                        <div class="grid grid-cols-1 gap-3">
                            <div class="form-group">
                                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–µ–ª—è (–†—É—Å—Å–∫–∏–π) *</label>
                                <textarea class="form-input" rows="4" id="hotelDescRu" data-translate-placeholder="placeholder.hotel_description_ru" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–µ–ª—è, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–µ–ª—è (English) *</label>
                                <textarea class="form-input" rows="4" id="hotelDescEn" placeholder="Brief description of the hotel, location and features in English..." required></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ê–¥—Ä–µ—Å</label>
                        <input type="text" class="form-input" id="hotelAddress" required>
                    </div>
                    
                    
                    <div class="form-group">
                        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥</label>
                        <select class="form-input" id="hotelStars">
                            <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                            <option value="1">‚≠ê 1 –∑–≤–µ–∑–¥–∞</option>
                            <option value="2">‚≠ê‚≠ê 2 –∑–≤–µ–∑–¥—ã</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê 3 –∑–≤–µ–∑–¥—ã</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4 –∑–≤–µ–∑–¥—ã</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 –∑–≤–µ–∑–¥</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ë—Ä–µ–Ω–¥ –æ—Ç–µ–ª—è</label>
                        <div class="flex gap-2">
                            <select class="form-input flex-1" id="hotelBrand">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–µ–Ω–¥</option>
                                <option value="Four Seasons">Four Seasons</option>
                                <option value="Ritz-Carlton">Ritz-Carlton</option>
                                <option value="St. Regis">St. Regis</option>
                                <option value="Waldorf Astoria">Waldorf Astoria</option>
                                <option value="Conrad">Conrad</option>
                                <option value="Hilton">Hilton</option>
                                <option value="Marriott">Marriott</option>
                                <option value="Sheraton">Sheraton</option>
                                <option value="Westin">Westin</option>
                                <option value="Hyatt">Hyatt</option>
                                <option value="InterContinental">InterContinental</option>
                                <option value="Crowne Plaza">Crowne Plaza</option>
                                <option value="Holiday Inn">Holiday Inn</option>
                                <option value="Radisson">Radisson</option>
                                <option value="Novotel">Novotel</option>
                                <option value="Ibis">Ibis</option>
                                <option value="Best Western">Best Western</option>
                                <option value="Serena Hotels">Serena Hotels</option>
                                <option value="Golden Tulip">Golden Tulip</option>
                                <option value="–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π –æ—Ç–µ–ª—å">–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π –æ—Ç–µ–ª—å</option>
                                <option value="custom">+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –±—Ä–µ–Ω–¥</option>
                            </select>
                        </div>
                        <input type="text" class="form-input mt-2" id="hotelBrandCustom" data-translate-placeholder="placeholder.enter_new_brand" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±—Ä–µ–Ω–¥–∞" style="display: none;">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ—Ç–µ–ª—è</label>
                        <select class="form-input" id="hotelCategory">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="STANDARD" data-i18n="hotel.category.STANDARD">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                            <option value="SEMI_LUX" data-i18n="hotel.category.SEMI_LUX">–ü–æ–ª—É–ª—é–∫—Å</option>
                            <option value="LUX" data-i18n="hotel.category.LUX">–õ—é–∫—Å</option>
                            <option value="DELUXE" data-i18n="hotel.category.DELUXE">–î–µ–ª—é–∫—Å</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                        <select class="form-input" id="hotelCountry" onchange="loadCitiesForCountry(this.value, 'hotelCity')">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ì–æ—Ä–æ–¥</label>
                        <select class="form-input" id="hotelCity">
                            <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                        </select>
                    </div>
                    
                    <!-- –ù–û–í–û–ï: –°–µ–∫—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–æ–º–µ—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏ -->
                    <div class="form-group">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ–º–µ—Ä–æ–≤ –∏ —Ü–µ–Ω—ã</label>
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <p class="text-sm text-gray-600 mb-3">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–µ–Ω—ã –∑–∞ –Ω–æ—á—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –Ω–æ–º–µ—Ä–æ–≤ (–≤ USD)</p>
                            
                            <!-- SGL - –û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-200">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="roomSGL" class="rounded">
                                    <label for="roomSGL" class="font-medium">SGL - –û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceSGL" class="form-input w-20" placeholder="100" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ –Ω–æ—á—å</span>
                                </div>
                            </div>
                            
                            <!-- TWL - –î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-200">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="roomTWL" class="rounded">
                                    <label for="roomTWL" class="font-medium">TWL - –î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceTWL" class="form-input w-20" placeholder="150" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ –Ω–æ—á—å</span>
                                </div>
                            </div>
                            
                            <!-- DBL - –î–≤—É—Ö—Å–ø–∞–ª—å–Ω—ã–π -->
                            <div class="flex items-center justify-between py-2">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="roomDBL" class="rounded">
                                    <label for="roomDBL" class="font-medium">DBL - –î–≤—É—Ö—Å–ø–∞–ª—å–Ω—ã–π</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceDBL" class="form-input w-20" placeholder="180" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ –Ω–æ—á—å</span>
                                </div>
                            </div>
                        </div>
                        <small class="text-gray-500 mt-2 block">–û—Ç–º–µ—Ç—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –Ω–æ–º–µ—Ä–æ–≤ –∏ —É–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É –∑–∞ –Ω–æ—á—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ</small>
                    </div>
                    
                    <!-- üçΩÔ∏è –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è -->
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø—ã –ø–∏—Ç–∞–Ω–∏—è –∏ —Ü–µ–Ω—ã</label>
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <p class="text-sm text-gray-600 mb-3">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—É –∑–∞ –ø–∏—Ç–∞–Ω–∏–µ (–≤ USD –∑–∞ —Å—É—Ç–∫–∏)</p>
                            
                            <!-- RO - –ë–µ–∑ –ø–∏—Ç–∞–Ω–∏—è -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-200">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="mealRO" class="rounded">
                                    <label for="mealRO" class="font-medium">RO - –ë–µ–∑ –ø–∏—Ç–∞–Ω–∏—è</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceMealRO" class="form-input w-20" placeholder="0" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ —Å—É—Ç–∫–∏</span>
                                </div>
                            </div>
                            
                            <!-- BB - –ó–∞–≤—Ç—Ä–∞–∫ -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-200">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="mealBB" class="rounded">
                                    <label for="mealBB" class="font-medium">BB - –ó–∞–≤—Ç—Ä–∞–∫</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceMealBB" class="form-input w-20" placeholder="15" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ —Å—É—Ç–∫–∏</span>
                                </div>
                            </div>
                            
                            <!-- HB - –ü–æ–ª—É–ø–∞–Ω—Å–∏–æ–Ω -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-200">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="mealHB" class="rounded">
                                    <label for="mealHB" class="font-medium">HB - –ü–æ–ª—É–ø–∞–Ω—Å–∏–æ–Ω</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceMealHB" class="form-input w-20" placeholder="35" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ —Å—É—Ç–∫–∏</span>
                                </div>
                            </div>
                            
                            <!-- FB - –ü–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω -->
                            <div class="flex items-center justify-between py-2 border-b border-gray-200">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="mealFB" class="rounded">
                                    <label for="mealFB" class="font-medium">FB - –ü–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceMealFB" class="form-input w-20" placeholder="55" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ —Å—É—Ç–∫–∏</span>
                                </div>
                            </div>
                            
                            <!-- AI - –í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ -->
                            <div class="flex items-center justify-between py-2">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="mealAI" class="rounded">
                                    <label for="mealAI" class="font-medium">AI - –í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>$</span>
                                    <input type="number" id="priceMealAI" class="form-input w-20" placeholder="85" min="0" step="1" disabled>
                                    <span class="text-sm text-gray-500">/ —Å—É—Ç–∫–∏</span>
                                </div>
                            </div>
                        </div>
                        <small class="text-gray-500 mt-2 block">–û—Ç–º–µ—Ç—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –ø–∏—Ç–∞–Ω–∏—è –∏ —É–∫–∞–∂–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—É –∑–∞ –∫–∞–∂–¥—ã–π</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ—Ç–µ–ª—è</label>
                        <div id="hotel-uploader-container"></div>
                        <input type="hidden" id="hotelImages">
                        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç–µ–ª—è -->
                        <div id="hotelImagesList" class="mt-3">
                            <p class="text-gray-500 text-sm">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–£–¥–æ–±—Å—Ç–≤–∞</label>
                        <div class="checkbox-group" id="hotelAmenities">
                            <label class="checkbox-item">
                                <input type="checkbox" value="WiFi"> WiFi
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–ó–∞–≤—Ç—Ä–∞–∫"> –ó–∞–≤—Ç—Ä–∞–∫
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–ü–∞—Ä–∫–æ–≤–∫–∞"> –ü–∞—Ä–∫–æ–≤–∫–∞
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–†–µ—Å—Ç–æ—Ä–∞–Ω"> –†–µ—Å—Ç–æ—Ä–∞–Ω
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–ë–∞—Å—Å–µ–π–Ω"> –ë–∞—Å—Å–µ–π–Ω
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–°–ø–∞"> –°–ø–∞
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä"> –§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä"> –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–ú–∏–Ω–∏-–±–∞—Ä"> –ú–∏–Ω–∏-–±–∞—Ä
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="–¢—Ä–∞–Ω—Å—Ñ–µ—Ä"> –¢—Ä–∞–Ω—Å—Ñ–µ—Ä
                            </label>
                        </div>
                        <div class="mt-3 flex gap-2">
                            <input type="text" class="form-input flex-1" id="newAmenity" data-translate-placeholder="placeholder.enter_new_amenity" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞">
                            <button type="button" onclick="addNewAmenity()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="hotelActive" checked> –ê–∫—Ç–∏–≤–Ω—ã–π
                        </label>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeHotelModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tour Modal -->
    <div id="tourModal" class="modal">
        <div class="modal-content" style="width: 800px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">–î–æ–±–∞–≤–∏—Ç—å/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä</h2>
                <button onclick="closeTourModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="tourForm">
                <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è ID —Ç—É—Ä–∞ -->
                <input type="hidden" id="tour-id">
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group col-span-2">
                        <label class="form-label">–¢–∏–ø —Ç—É—Ä–∞</label>
                        <select class="form-input" id="tourType" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—É—Ä–∞</option>
                            <option value="–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π</option>
                            <option value="–ì—Ä—É–ø–ø–æ–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π">–ì—Ä—É–ø–ø–æ–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π</option>
                            <option value="–ì—Ä—É–ø–ø–æ–≤–æ–π –æ–±—â–∏–π">–ì—Ä—É–ø–ø–æ–≤–æ–π –æ–±—â–∏–π</option>
                        </select>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–∞ (–†—É—Å—Å–∫–∏–π)</label>
                        <input type="text" class="form-input" id="tourTitleRu" required>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–∞ (English)</label>
                        <input type="text" class="form-input" id="tourTitleEn" required>
                    </div>
                    
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–†—É—Å—Å–∫–∏–π)</label>
                        <textarea class="form-input" rows="4" id="tourDescRu" required></textarea>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (English)</label>
                        <textarea class="form-input" rows="4" id="tourDescEn" required></textarea>
                    </div>
                    


                    <!-- –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—É—Ä–∞ –ø–æ –¥–Ω—è–º -->
                    <div class="form-group col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <label class="form-label">–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—É—Ä–∞ –ø–æ –¥–Ω—è–º</label>
                            <button type="button" onclick="addNewDay()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                                <i class="fas fa-plus"></i>
                                –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å
                            </button>
                        </div>

                        <!-- –¢–∞–±—ã –ø–æ –¥–Ω—è–º -->
                        <div class="bg-white border rounded-lg">
                            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–Ω—è–º -->
                            <div id="dayTabs" class="flex flex-wrap border-b bg-gray-50 rounded-t-lg">
                                <!-- –¢–∞–±—ã –¥–Ω–µ–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>

                            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–Ω–µ–π -->
                            <div id="dayContents" class="p-4">
                                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>

                        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è -->
                        <div class="bg-gray-50 p-4 rounded border mt-4" id="activityForm">
                            <div class="mb-3">
                                <h4 class="font-semibold text-gray-700 mb-2" id="currentDayLabel">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –î–µ–Ω—å 1</h4>
                            </div>
                            <div class="grid grid-cols-4 gap-3 mb-3">
                                <input type="time" class="form-input" id="newItineraryTime" placeholder="08:00">
                                <input type="text" class="form-input col-span-2" id="newItineraryTitle" data-translate-placeholder="placeholder.meeting_with_guide" placeholder="–í—Å—Ç—Ä–µ—á–∞ —Å –≥–∏–¥–æ–º">
                                <button type="button" onclick="addItineraryToCurrentDay()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                                    –î–æ–±–∞–≤–∏—Ç—å
                                </button>
                            </div>
                            <textarea class="form-input" rows="2" id="newItineraryDesc" data-translate-placeholder="placeholder.detailed_stage_description" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–∞–ø–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã"></textarea>
                        </div>

                        <small class="text-gray-500">–°–æ–∑–¥–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Ç—É—Ä–∞ –ø–æ –¥–Ω—è–º. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π.</small>
                    </div>

                    <!-- –î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–∞ -->
                    <div class="form-group col-span-2">
                        <label class="form-label">–î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–∞</label>
                        <div id="startTimesList" class="space-y-2 mb-3">
                            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ -->
                        </div>
                        <div class="flex gap-2">
                            <input type="time" class="form-input flex-1" id="newStartTime" placeholder="07:30">
                            <button type="button" onclick="addStartTime()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                                –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è
                            </button>
                        </div>
                        <small class="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–∞</small>
                    </div>

                    
                    <div class="form-group">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç—É—Ä–∞</label>
                        <div class="flex gap-2 mb-2">
                            <select class="form-input flex-1" id="availableCategories">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                            </select>
                            <button type="button" onclick="addCategoryToTour()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="selectedCategories" class="space-y-1 max-h-32 overflow-y-auto border rounded p-2 bg-gray-50">
                            <small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                        </div>
                        <input type="hidden" id="tourCategory" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ë–ª–æ–∫–∏ —Ç—É—Ä–æ–≤ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                        <div class="checkbox-group" id="tourBlocksCheckboxes">
                            <!-- –ë–ª–æ–∫–∏ —Ç—É—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –ë–î -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°—Ç—Ä–∞–Ω—ã (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                        <div class="flex gap-2 mb-2">
                            <select class="form-input flex-1" id="availableCountries">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                            </select>
                            <button type="button" onclick="addCountryToTour()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="selectedCountries" class="space-y-1 max-h-32 overflow-y-auto border rounded p-2 bg-gray-50">
                            <small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                        </div>
                        <input type="hidden" id="tourCountries" required>
                        <!-- Legacy field for backward compatibility -->
                        <input type="hidden" id="tourCountry">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ì–æ—Ä–æ–¥–∞ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                        <div class="flex gap-2 mb-2">
                            <select class="form-input flex-1" id="availableCities">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                            </select>
                            <button type="button" onclick="addCityToTour()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="selectedCities" class="space-y-1 max-h-32 overflow-y-auto border rounded p-2 bg-gray-50">
                            <small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                        </div>
                        <input type="hidden" id="tourCities" required>
                        <!-- Legacy field for backward compatibility -->
                        <input type="hidden" id="tourCity">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" id="durationLabel">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–µ–π)</label>
                        <input type="number" class="form-input" id="tourDurationDays" min="1" required>
                        <div id="durationHoursField" style="display: none;">
                            <label class="form-label mt-2">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —á–∞—Å–∞—Ö</label>
                            <input type="number" class="form-input" id="tourDurationHours" placeholder="8" min="1" max="24">
                        </div>
                    </div>
                    
                    
                    
                    <!-- Component-based Pricing System -->
                    <div class="form-group col-span-2">
                        <label class="form-label">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—É—Ä–∞ –∏ —Ü–µ–Ω—ã (TJS)</label>
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <div class="mb-3 text-sm text-gray-600">
                                –û—Ç–º–µ—Ç—å—Ç–µ –Ω—É–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–µ–Ω—ã –∑–∞ –Ω–æ—á—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
                            </div>
                            
                            <!-- Price Components Selection with Inline Price Editing -->
                            <div id="tourPricingComponents" class="space-y-4">
                                <div class="text-center text-gray-500 py-4">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ü–µ–Ω...
                                </div>
                            </div>
                            
                            <!-- Calculated Total -->
                            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                                    <span class="text-xl font-bold text-blue-600" id="calculatedTotalPrice">0 TJS</span>
                                </div>
                                <div class="mt-2">
                                    <label class="form-label">–¢–∏–ø —Ü–µ–Ω—ã</label>
                                    <select class="form-input" id="tourPriceType" required>
                                        <option value="–∑–∞ —á–µ–ª–æ–≤–µ–∫–∞">–ó–∞ —á–µ–ª–æ–≤–µ–∫–∞</option>
                                        <option value="–∑–∞ –≥—Ä—É–ø–ø—É">–ó–∞ –≥—Ä—É–ø–ø—É</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Hidden fields -->
                            <input type="hidden" id="tourPricingData" value="">
                            <input type="hidden" id="tourPrice" value="0">
                        </div>
                    </div>
                    
                    
                    <div class="form-group">
                        <label class="form-label" data-translate="form.pickup_info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏—ë–º–µ/—Å–±–æ—Ä–µ</label>
                        <input type="text" class="form-input" id="tourPickupInfo" data-translate-placeholder="placeholder.pickup_info_example" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–∏—ë–º –≤–∫–ª—é—á—ë–Ω, –ú–µ—Å—Ç–æ —Å–±–æ—Ä–∞: –æ—Ç–µ–ª—å, –∏ —Ç.–¥." required>
                        <small class="text-gray-500">–£–∫–∞–∂–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏—ë–º–µ/–º–µ—Å—Ç–µ —Å–±–æ—Ä–∞ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" data-translate="form.tour_languages">–Ø–∑—ã–∫–∏ —Ç—É—Ä–∞</label>
                        <div class="flex gap-2 mb-2">
                            <select class="form-input flex-1" id="availableLanguages">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                                <option value="–†—É—Å—Å–∫–∏–π">–†—É—Å—Å–∫–∏–π</option>
                                <option value="–ê–Ω–≥–ª–∏–π—Å–∫–∏–π">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                                <option value="–¢–∞–¥–∂–∏–∫—Å–∫–∏–π">–¢–∞–¥–∂–∏–∫—Å–∫–∏–π</option>
                                <option value="–£–∑–±–µ–∫—Å–∫–∏–π">–£–∑–±–µ–∫—Å–∫–∏–π</option>
                                <option value="–ö–∏—Ä–≥–∏–∑—Å–∫–∏–π">–ö–∏—Ä–≥–∏–∑—Å–∫–∏–π</option>
                                <option value="–ö–∞–∑–∞—Ö—Å–∫–∏–π">–ö–∞–∑–∞—Ö—Å–∫–∏–π</option>
                                <option value="–¢—É—Ä–∫–º–µ–Ω—Å–∫–∏–π">–¢—É—Ä–∫–º–µ–Ω—Å–∫–∏–π</option>
                                <option value="–ü–µ—Ä—Å–∏–¥—Å–∫–∏–π">–ü–µ—Ä—Å–∏–¥—Å–∫–∏–π</option>
                                <option value="–ê—Ä–∞–±—Å–∫–∏–π">–ê—Ä–∞–±—Å–∫–∏–π</option>
                                <option value="–ö–∏—Ç–∞–π—Å–∫–∏–π">–ö–∏—Ç–∞–π—Å–∫–∏–π</option>
                                <option value="–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                                <option value="–ù–µ–º–µ—Ü–∫–∏–π">–ù–µ–º–µ—Ü–∫–∏–π</option>
                                <option value="–ò—Å–ø–∞–Ω—Å–∫–∏–π">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                                <option value="–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π">–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π</option>
                            </select>
                            <button type="button" onclick="addLanguageToTour()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="selectedLanguages" class="space-y-1 max-h-32 overflow-y-auto border rounded p-2 bg-gray-50">
                            <small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                        </div>
                        <input type="hidden" id="tourLanguages">
                    </div>
                    
                    
                    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–µ -->
                    
                    
                    <!-- –ü–æ–ª–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ç—É—Ä–∞ —É–¥–∞–ª–µ–Ω–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                    
                    <div class="form-group">
                        <label class="form-label" data-translate="form.min_people">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π</label>
                        <input type="number" class="form-input" id="tourMinPeople" min="1" placeholder="2">
                        <small class="text-gray-500">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" data-translate="form.max_people">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π</label>
                        <input type="number" class="form-input" id="tourMaxPeople" min="1" placeholder="12">
                        <small class="text-gray-500">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</small>
                    </div>
                    
                    <!-- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ç—É—Ä–∞ -->
                    <div class="form-group col-span-2">
                        <label class="form-label" data-translate="form.available_months">–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Å—è—Ü—ã</label>
                        <div class="grid grid-cols-4 gap-2 mt-2">
                            <label class="checkbox-item">
                                <input type="checkbox" value="1" id="month-1"> –Ø–Ω–≤–∞—Ä—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="2" id="month-2"> –§–µ–≤—Ä–∞–ª—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="3" id="month-3"> –ú–∞—Ä—Ç
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="4" id="month-4"> –ê–ø—Ä–µ–ª—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="5" id="month-5"> –ú–∞–π
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="6" id="month-6"> –ò—é–Ω—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="7" id="month-7"> –ò—é–ª—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="8" id="month-8"> –ê–≤–≥—É—Å—Ç
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="9" id="month-9"> –°–µ–Ω—Ç—è–±—Ä—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="10" id="month-10"> –û–∫—Ç—è–±—Ä—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="11" id="month-11"> –ù–æ—è–±—Ä—å
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="12" id="month-12"> –î–µ–∫–∞–±—Ä—å
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label" data-translate="form.available_days">–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏</label>
                        <div class="grid grid-cols-4 gap-2 mt-2">
                            <label class="checkbox-item">
                                <input type="checkbox" value="1" id="day-1"> –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="2" id="day-2"> –í—Ç–æ—Ä–Ω–∏–∫
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="3" id="day-3"> –°—Ä–µ–¥–∞
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="4" id="day-4"> –ß–µ—Ç–≤–µ—Ä–≥
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="5" id="day-5"> –ü—è—Ç–Ω–∏—Ü–∞
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="6" id="day-6"> –°—É–±–±–æ—Ç–∞
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="0" id="day-0"> –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
                            </label>
                        </div>
                    </div>
                    
                    <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <div class="form-group col-span-2">
                        <label class="form-label">
                            <i class="fas fa-images text-blue-600 mr-2"></i>
                            <span data-translate="form.tour_photos">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç—É—Ä–∞</span>
                        </label>
                        
                        <div id="tour-uploader-container"></div>
                        <p class="text-gray-500 text-sm mt-2">
                            –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç –≥–ª–∞–≤–Ω–æ–π –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç—É—Ä–∞
                        </p>
                        <input type="hidden" id="tourImages">
                        
                        <!-- –°–ø–∏—Å–æ–∫ –≥–∞–ª–µ—Ä–µ–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                        <div id="galleryImagesList" class="space-y-2 mt-4">
                            <!-- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">–£—Å–ª—É–≥–∏ –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –≤ —Ç—É—Ä</label>
                        <div class="text-sm text-gray-600 mb-3">
                            ‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Ç—É—Ä–∞
                        </div>
                        <div class="checkbox-group" id="includesOptions">
                            <!-- –£—Å–ª—É–≥–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
                            <div class="text-center text-gray-400 py-4" id="includesPlaceholder">
                                <i class="fas fa-magic mr-2"></i>
                                –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—É—Ä–∞ –≤—ã—à–µ, –∏ —É—Å–ª—É–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">–ù–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ —Ç—É—Ä</label>
                        <div class="text-sm text-gray-600 mb-3">
                            ‚ùå –£—Å–ª—É–≥–∏ –∏ —Ä–∞—Å—Ö–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—É—Ä–∏—Å—Ç—ã –æ–ø–ª–∞—á–∏–≤–∞—é—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
                        </div>
                        <div class="flex gap-2 mb-3">
                            <input type="text" id="newExcludedService" class="form-input flex-1" data-translate-placeholder="placeholder.enter_service_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏">
                            <button type="button" onclick="addNewExcludedService()" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="checkbox-group" id="excludedOptions">
                            <!-- –ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                            <div class="text-center text-gray-400 py-4" id="excludedPlaceholder">
                                <i class="fas fa-info-circle mr-2"></i>
                                –î–æ–±–∞–≤—å—Ç–µ —É—Å–ª—É–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç—É—Ä–∞
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group col-span-2" id="hotelSection">
                        <label class="form-label">–°–≤—è–∑–∞–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏</label>
                        <div class="checkbox-group" id="hotelCheckboxes">
                            <!-- Hotels will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–∏–¥—ã</label>
                        <div class="checkbox-group" id="guideCheckboxes">
                            <!-- Guides will be loaded here -->
                        </div>
                    </div>
                    
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeTourModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category List Modal -->
    <div id="categoryListModal" class="modal">
        <div class="modal-content max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                <button type="button" onclick="closeCategoryListModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-2 max-h-96 overflow-y-auto">
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã', 'Day Tours')">
                        <div class="font-medium">–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Day Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã', 'Multi-day Tours')">
                        <div class="font-medium">–ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Multi-day Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–≠–∫—Å–∫—É—Ä—Å–∏–∏', 'Excursions')">
                        <div class="font-medium">–≠–∫—Å–∫—É—Ä—Å–∏–∏</div>
                        <div class="text-sm text-gray-500">Excursions</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ì–æ—Ä–æ–¥—Å–∫–∏–µ —Ç—É—Ä—ã', 'City Tours')">
                        <div class="font-medium">–ì–æ—Ä–æ–¥—Å–∫–∏–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">City Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ü—Ä–∏—Ä–æ–¥–∞/—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', 'Nature/Eco Tours')">
                        <div class="font-medium">–ü—Ä–∏—Ä–æ–¥–∞/—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Nature/Eco Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ö—É–ª—å—Ç—É—Ä–Ω–æ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—É—Ä—ã', 'Cultural Educational Tours')">
                        <div class="font-medium">–ö—É–ª—å—Ç—É—Ä–Ω–æ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Cultural Educational Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', 'Historical Tours')">
                        <div class="font-medium">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Historical Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ü–æ—Ö–æ–¥—ã/—Ç—Ä–µ–∫–∏–Ω–≥–∏', 'Hiking/Trekking')">
                        <div class="font-medium">–ü–æ—Ö–æ–¥—ã/—Ç—Ä–µ–∫–∏–Ω–≥–∏</div>
                        <div class="text-sm text-gray-500">Hiking/Trekking</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ì–æ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã', 'Mountain Landscapes')">
                        <div class="font-medium">–ì–æ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã</div>
                        <div class="text-sm text-gray-500">Mountain Landscapes</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–û–∑–µ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã', 'Lake Landscapes')">
                        <div class="font-medium">–û–∑–µ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã</div>
                        <div class="text-sm text-gray-500">Lake Landscapes</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', 'Adventure Tours')">
                        <div class="font-medium">–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Adventure Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', 'Gastronomic Tours')">
                        <div class="font-medium">–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Gastronomic Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ê–≤—Ç–æ—Ç—É—Ä—ã/—Å–∞—Ñ–∞—Ä–∏/–¥–∂–∏–ø-—Ç—É—Ä—ã', 'Auto Tours/Safari/Jeep Tours')">
                        <div class="font-medium">–ê–≤—Ç–æ—Ç—É—Ä—ã/—Å–∞—Ñ–∞—Ä–∏/–¥–∂–∏–ø-—Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Auto Tours/Safari/Jeep Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('–ê–≥—Ä–æ—Ç—É—Ä—ã', 'Agro Tours')">
                        <div class="font-medium">–ê–≥—Ä–æ—Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">Agro Tours</div>
                    </div>
                    <div class="category-item p-3 border rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300" onclick="selectCategory('VIP —Ç—É—Ä—ã', 'VIP Tours')">
                        <div class="font-medium">VIP —Ç—É—Ä—ã</div>
                        <div class="text-sm text-gray-500">VIP Tours</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- News Modal -->
    <div id="newsModal" class="modal">
        <div class="modal-content" style="width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="newsModalTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h2>
                <button onclick="closeNewsModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="newsForm" onsubmit="event.preventDefault(); saveNews();">
                <input type="hidden" id="newsId">
                
                <!-- üåê –ú–ù–û–ì–û–Ø–ó–´–ß–ù–´–ï –ü–û–õ–Ø –ù–û–í–û–°–¢–ï–ô -->
                <div class="mb-4">
                    <h4 class="font-medium text-gray-800 mb-3">üåê –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π)</h4>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="form-group">
                            <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (–†—É—Å—Å–∫–∏–π) *</label>
                            <input type="text" id="newsTitleRu" class="form-input" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (English) *</label>
                            <input type="text" id="newsTitleEn" class="form-input" placeholder="News title in English" required>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-medium text-gray-800 mb-3">üìù –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–µ)</h4>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="form-group">
                            <label class="form-label">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–†—É—Å—Å–∫–∏–π)</label>
                            <textarea id="newsExcerptRu" class="form-input" rows="2" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (English)</label>
                            <textarea id="newsExcerptEn" class="form-input" rows="2" placeholder="Brief news description in English"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-medium text-gray-800 mb-3">üìÑ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π)</h4>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="form-group">
                            <label class="form-label">–ö–æ–Ω—Ç–µ–Ω—Ç (–†—É—Å—Å–∫–∏–π) *</label>
                            <textarea id="newsContentRu" class="form-input" rows="8" placeholder="–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ö–æ–Ω—Ç–µ–Ω—Ç (English) *</label>
                            <textarea id="newsContentEn" class="form-input" rows="8" placeholder="Full news content in English" required></textarea>
                        </div>
                    </div>
                </div>
                
                
                <div class="form-group mb-4">
                    <label class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</label>
                    <input type="file" id="newsImageFile" class="form-input" accept="image/*">
                    <div id="newsImagePreview" class="mt-2" style="display: none;">
                        <img id="newsImagePreviewImg" class="w-32 h-32 object-cover rounded" alt="–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label flex items-center">
                            <input type="checkbox" id="newsPublished" checked>
                            <span class="ml-2">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label flex items-center">
                            <input type="checkbox" id="newsFeatured">
                            <span class="ml-2">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è (–º–∏–Ω)</label>
                        <input type="number" id="newsReadTime" class="form-input" min="1" placeholder="5">
                    </div>
                </div>
                
                
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeNewsModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trip Creation Modal -->
    <div id="tripModal" class="modal">
        <div class="modal-content" style="width: 700px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">–°–æ–∑–¥–∞—Ç—å –ø–æ–µ–∑–¥–∫—É</h2>
                <button onclick="closeTripModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="tripForm" onsubmit="event.preventDefault(); createTrip();">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ *</label>
                        <input type="text" name="direction" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê—ç—Ä–æ–ø–æ—Ä—Ç - –ì–æ—Ä–æ–¥" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–í–æ–¥–∏—Ç–µ–ª—å *</label>
                        <select name="driverId" id="tripDriverId" class="form-input" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–í—Ä–µ–º—è –ø—Ä–∏—ë–º–∞ *</label>
                        <input type="time" name="pickupTime" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–í—Ä–µ–º—è –≤—ã—Å–∞–¥–∫–∏ *</label>
                        <input type="time" name="dropoffTime" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-group mb-4">
                    <label class="form-label">–ú–µ—Å—Ç–æ –ø—Ä–∏—ë–º–∞ *</label>
                    <input type="text" name="pickupLocation" class="form-input" placeholder="–ê–¥—Ä–µ—Å –ø–æ—Å–∞–¥–∫–∏" required>
                </div>
                
                <!-- –ü–æ–ª–µ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ç—É—Ä—É -->
                <div class="form-group mb-4">
                    <label class="form-label">–¢—É—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <select name="tourId" id="tripTourId" class="form-input">
                        <option value="">–ù–µ —Å–≤—è–∑–∞–Ω —Å —Ç—É—Ä–æ–º</option>
                    </select>
                    <small class="text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä, –µ—Å–ª–∏ –ø–æ–µ–∑–¥–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ç—É—Ä–æ–º</small>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–û—Ç–∫—É–¥–∞ *</label>
                        <input type="text" name="routeFrom" class="form-input" placeholder="–ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ö—É–¥–∞ *</label>
                        <input type="text" name="routeTo" class="form-input" placeholder="–ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞" required>
                    </div>
                </div>
                
                <div class="form-group mb-6">
                    <label class="form-label">–ú–µ—Å—Ç–æ –≤—ã—Å–∞–¥–∫–∏ *</label>
                    <input type="text" name="dropoffLocation" class="form-input" placeholder="–ê–¥—Ä–µ—Å –≤—ã—Å–∞–¥–∫–∏" required>
                </div>
                
                <div class="flex justify-end gap-4">
                    <button type="button" onclick="closeTripModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                        –°–æ–∑–¥–∞—Ç—å –ø–æ–µ–∑–¥–∫—É
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Booking Details Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content" style="width: 700px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h2>
                <button onclick="closeBookingModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="bookingDetails">
                <!-- Booking details will be loaded here -->
            </div>
            
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeBookingModal()" class="btn btn-secondary">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
                <button onclick="confirmBooking()" class="btn btn-success">
                    <i class="fas fa-check"></i>
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
                <button onclick="cancelBooking()" class="btn btn-danger">
                    <i class="fas fa-times"></i>
                    –û—Ç–º–µ–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Country Modal -->
    <div id="countryModal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="countryModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</h2>
                <button onclick="closeCountryModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="countryForm" onsubmit="event.preventDefault(); saveCountry();">
                <input type="hidden" id="countryId">
                
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (English) *</label>
                        <input type="text" id="countryName" class="form-input" placeholder="Kazakhstan, Uzbekistan" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (–†—É—Å—Å–∫–∏–π) *</label>
                        <input type="text" id="countryNameRu" class="form-input" placeholder="–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω" required>
                    </div>
                    
                    <div class="form-group">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã *</label>
                        <input type="text" id="countryCode" class="form-input" placeholder="KZ, UZ" maxlength="3" required>
                    </div>
                </div>
                
                <div class="flex justify-end gap-4">
                    <button type="button" onclick="closeCountryModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- City Modal -->
    <div id="cityModal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="cityModalTitle">–î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥</h2>
                <button onclick="closeCityModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="cityForm" onsubmit="event.preventDefault(); saveCity();">
                <input type="hidden" id="cityId">
                
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–°—Ç—Ä–∞–Ω–∞ *</label>
                        <select id="cityCountryId" class="form-input" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (English) *</label>
                        <input type="text" id="cityName" class="form-input" placeholder="Almaty, Tashkent" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (–†—É—Å—Å–∫–∏–π) *</label>
                        <input type="text" id="cityNameRu" class="form-input" placeholder="–ê–ª–º–∞—Ç—ã, –¢–∞—à–∫–µ–Ω—Ç" required>
                    </div>
                    
                    <div class="form-group">
                    </div>
                </div>
                
                <div class="flex justify-end gap-4">
                    <button type="button" onclick="closeCityModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Content Block Modal -->
    <div id="contentBlockModal" class="modal">
        <div class="modal-content" style="width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="contentBlockModalTitle">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
                <button onclick="closeContentBlockModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="contentBlockForm">
                <div class="grid grid-cols-1 gap-4">
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø –±–ª–æ–∫–∞</label>
                        <select class="form-input" id="blockType" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="hero_banner">–ì–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä</option>
                            <option value="about_section">–û –Ω–∞—Å</option>
                            <option value="services_section">–£—Å–ª—É–≥–∏</option>
                            <option value="tours_section">–¢—É—Ä—ã</option>
                            <option value="testimonials">–û—Ç–∑—ã–≤—ã</option>
                            <option value="contact_info">–ö–æ–Ω—Ç–∞–∫—Ç—ã</option>
                            <option value="footer_text">–¢–µ–∫—Å—Ç —Ñ—É—Ç–µ—Ä–∞</option>
                            <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
                        </select>
                    </div>
                    
                    <!-- Multilingual fields for each supported language -->
                    <div class="form-group">
                        <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (–†—É—Å—Å–∫–∏–π)</label>
                        <input type="text" class="form-input" id="blockTitle_ru">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (English)</label>
                        <input type="text" class="form-input" id="blockTitle_en">
                    </div>
                    
                    
                    <div class="form-group">
                        <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (ŸÅÿßÿ±ÿ≥€å)</label>
                        <input type="text" class="form-input" id="blockTitle_fa">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (Deutsch)</label>
                        <input type="text" class="form-input" id="blockTitle_de">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ (‰∏≠Êñá)</label>
                        <input type="text" class="form-input" id="blockTitle_zh">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (–†—É—Å—Å–∫–∏–π)</label>
                        <textarea class="form-input" rows="4" id="blockContent_ru"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (English)</label>
                        <textarea class="form-input" rows="4" id="blockContent_en"></textarea>
                    </div>
                    
                    
                    <div class="form-group">
                        <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (ŸÅÿßÿ±ÿ≥€å)</label>
                        <textarea class="form-input" rows="4" id="blockContent_fa"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (Deutsch)</label>
                        <textarea class="form-input" rows="4" id="blockContent_de"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (‰∏≠Êñá)</label>
                        <textarea class="form-input" rows="4" id="blockContent_zh"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="number" class="form-input" id="blockOrder" min="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="blockActive" checked>
                            –ê–∫—Ç–∏–≤–µ–Ω
                        </label>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeContentBlockModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Driver Modal -->
    <div id="driverModal" class="modal">
        <div class="modal-content" style="width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è</h2>
                <button onclick="closeDriverModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="driverForm" onsubmit="event.preventDefault(); saveDriver();">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–ò–º—è *</label>
                        <input type="text" name="name" class="form-input" placeholder="–ü–æ–ª–Ω–æ–µ –∏–º—è –≤–æ–¥–∏—Ç–µ–ª—è" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" name="email" class="form-input" placeholder="email@example.com" required>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="phone" class="form-input" placeholder="+992 000 000 000">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–û–ø—ã—Ç (–ª–µ—Ç)</label>
                        <input type="number" name="experience" class="form-input" min="0" max="50" placeholder="5">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–ù–æ–º–µ—Ä —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è</label>
                        <input type="text" name="licenseNumber" class="form-input" placeholder="–°–µ—Ä–∏—è –∏ –Ω–æ–º–µ—Ä">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–∞–≤</label>
                        <select name="licenseCategory" class="form-input">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="B">B - –õ–µ–≥–∫–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</option>
                            <option value="C">C - –ì—Ä—É–∑–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</option>
                            <option value="D">D - –ê–≤—Ç–æ–±—É—Å—ã</option>
                            <option value="BE">BE - –õ–µ–≥–∫–æ–≤—ã–µ —Å –ø—Ä–∏—Ü–µ–ø–æ–º</option>
                            <option value="CE">CE - –ì—Ä—É–∑–æ–≤—ã–µ —Å –ø—Ä–∏—Ü–µ–ø–æ–º</option>
                            <option value="DE">DE - –ê–≤—Ç–æ–±—É—Å—ã —Å –ø—Ä–∏—Ü–µ–ø–æ–º</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</label>
                        <input type="text" name="vehicleBrand" class="form-input" placeholder="Toyota, Mercedes, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</label>
                        <input type="number" name="vehicleYear" class="form-input" min="1990" max="2025" placeholder="2020">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–¶–µ–Ω–∞ –∑–∞ –¥–µ–Ω—å (TJS)</label>
                        <input type="number" name="pricePerDay" class="form-input" min="0" step="0.01" placeholder="200.00">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¶–µ–Ω–∞ –∑–∞ —á–∞—Å (TJS)</label>
                        <input type="number" name="pricePerHour" class="form-input" min="0" step="0.01" placeholder="25.00">
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">–Ø–∑—ã–∫–∏</label>
                    <input type="text" name="languages" class="form-input" placeholder="–†—É—Å—Å–∫–∏–π, –¢–∞–¥–∂–∏–∫—Å–∫–∏–π, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π">
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">–†–∞–±–æ—á–∏–µ –∑–æ–Ω—ã</label>
                    <input type="text" name="workingAreas" class="form-input" placeholder="–î—É—à–∞–Ω–±–µ, –•—É–¥–∂–∞–Ω–¥, –ö—É–ª—è–±">
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">–¢–∏–ø—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" name="vehicleTypes" value="sedan"> –°–µ–¥–∞–Ω
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="vehicleTypes" value="suv"> –í–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="vehicleTypes" value="minibus"> –ú–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="vehicleTypes" value="bus"> –ê–≤—Ç–æ–±—É—Å
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="vehicleTypes" value="truck"> –ì—Ä—É–∑–æ–≤–∏–∫
                        </label>
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea name="description" class="form-input" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–¥–∏—Ç–µ–ª–µ"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–ê–≤–∞—Ç–∞—Ä</label>
                        <input type="file" name="avatar" class="form-input" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–§–æ—Ç–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞</label>
                        <input type="file" name="vehiclePhotos" class="form-input" accept="image/*" multiple>
                    </div>
                </div>
                
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" onclick="closeDriverModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Transfer Modal -->
    <div id="transferModal" class="modal">
        <div class="modal-content" style="width: 700px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä</h2>
                <button onclick="closeTransferModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="transferForm" onsubmit="event.preventDefault(); createTransfer();">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–ö–ª–∏–µ–Ω—Ç *</label>
                        <input type="text" name="clientName" class="form-input" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞</label>
                        <input type="tel" name="clientPhone" class="form-input" placeholder="+992 000 000 000">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–û—Ç *</label>
                        <input type="text" name="pickupLocation" class="form-input" placeholder="–ú–µ—Å—Ç–æ –ø–æ–¥–∞—á–∏" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–î–æ *</label>
                        <input type="text" name="dropoffLocation" class="form-input" placeholder="–ú–µ—Å—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è" required>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–î–∞—Ç–∞ *</label>
                        <input type="date" name="transferDate" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–í—Ä–µ–º—è *</label>
                        <input type="time" name="transferTime" class="form-input" required>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–í–æ–¥–∏—Ç–µ–ª—å *</label>
                        <select name="driverId" id="transferDriverId" class="form-input" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞</label>
                        <select name="vehicleType" class="form-input">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="sedan">–°–µ–¥–∞–Ω</option>
                            <option value="suv">–í–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫</option>
                            <option value="minibus">–ú–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å</option>
                            <option value="bus">–ê–≤—Ç–æ–±—É—Å</option>
                            <option value="truck">–ì—Ä—É–∑–æ–≤–∏–∫</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å (TJS)</label>
                        <input type="number" name="cost" class="form-input" min="0" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</label>
                        <input type="number" name="passengerCount" class="form-input" min="1" max="50" value="1">
                    </div>
                </div>

                <div class="form-group mb-6">
                    <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                    <textarea name="notes" class="form-input" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–µ"></textarea>
                </div>
                
                <div class="flex justify-end gap-4">
                    <button type="button" onclick="closeTransferModal()" class="btn btn-secondary">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary">
                        –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="components/ObjectUploader.js"></script>
    <script>
        // –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON (—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è —Å –±—ç–∫–µ–Ω–¥–æ–º)
        function safeJsonParse(jsonString) {
            if (!jsonString) return null;
            if (typeof jsonString === 'object') return jsonString;
            
            try {
                return JSON.parse(jsonString);
            } catch (error) {
                console.warn('JSON parsing error:', error, 'String:', jsonString);
                return null;
            }
        }

        // Global variables
        let currentSection = 'dashboard';
        let currentBookingId = null;
        let currentTourId = null;
        let currentContentBlockId = null;
        
        // === üåê –Ø–ó–´–ö–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò ===
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é —è–∑—ã–∫–æ–≤
        function toggleAdminLanguageDropdown() {
            const dropdown = document.getElementById('languageDropdownAdmin');
            if (dropdown) {
                dropdown.classList.toggle('hidden');
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function switchAdminLanguage(lang) {
            console.log(`üåê –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –Ω–∞: ${lang}`);
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —è–∑—ã–∫–∞
            if (!lang || !['ru', 'en'].includes(lang)) {
                console.warn('‚ö†Ô∏è –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —è–∑—ã–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É—Å—Å–∫–∏–π');
                lang = 'ru';
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã i18n.js
            if (typeof switchSiteLanguage === 'function') {
                switchSiteLanguage(lang);
            } else {
                console.warn('‚ö†Ô∏è switchSiteLanguage –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –≤—Ä—É—á–Ω—É—é');
                currentLanguage = lang;
                localStorage.setItem('selectedLanguage', lang);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            updateAdminLanguageButton(lang);
            
            // –ü–µ—Ä–µ–≤–æ–¥–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            translateAdminInterface(lang);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown
            const dropdown = document.getElementById('languageDropdownAdmin');
            if (dropdown) {
                dropdown.classList.add('hidden');
            }
            
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞
        function updateAdminLanguageButton(lang) {
            const currentLangElement = document.getElementById('currentLanguageAdmin');
            if (currentLangElement) {
                const langLabels = {
                    'ru': 'RU',
                    'en': 'EN'
                };
                currentLangElement.textContent = langLabels[lang] || 'RU';
            }
        }
        
        // –ü–µ—Ä–µ–≤–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function translateAdminInterface(lang) {
            // –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-translate –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (typeof getTranslation === 'function') {
                    const translation = getTranslation(key, lang);
                    if (translation && translation !== key) {
                        element.textContent = translation;
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤
            updateSectionTitles(lang);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º placeholders
            updatePlaceholders(lang);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ä–∞–∑–¥–µ–ª–æ–≤
        function updateSectionTitles(lang) {
            const sectionTitles = {
                'ru': {
                    dashboard: '–ì–ª–∞–≤–Ω–∞—è',
                    tours: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏',
                    bookings: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏',
                    hotels: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–µ–ª—è–º–∏',
                    guides: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∏–¥–∞–º–∏',
                    drivers: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏',
                    trips: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∞–º–∏',
                    transfers: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–º–∏',
                    countries: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∞–º–∏',
                    cities: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞–º–∏',
                    customers: '–ö–ª–∏–µ–Ω—Ç—ã',
                    reviews: '–ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤',
                    payments: '–ü–ª–∞—Ç–µ–∂–∏',
                    cms: 'CMS - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º',
                    settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏'
                },
                'en': {
                    dashboard: 'Dashboard',
                    tours: 'Tours Management',
                    bookings: 'Bookings Management',
                    hotels: 'Hotels Management',
                    guides: 'Guides Management',
                    drivers: 'Drivers Management',
                    trips: 'Trips Management',
                    transfers: 'Transfers Management',
                    countries: 'Countries Management',
                    cities: 'Cities Management',
                    customers: 'Customers',
                    reviews: 'Reviews Moderation',
                    payments: 'Payments',
                    cms: 'CMS - Content Management',
                    settings: 'Settings'
                }
            };
            
            const currentSectionTitle = sectionTitles[lang] && sectionTitles[lang][currentSection];
            if (currentSectionTitle) {
                const sectionTitleElement = document.getElementById('sectionTitle');
                if (sectionTitleElement) {
                    sectionTitleElement.textContent = currentSectionTitle;
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ placeholders
        function updatePlaceholders(lang) {
            const placeholders = {
                'ru': {
                    search: '–ü–æ–∏—Å–∫...',
                    name: '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ',
                    email: '–í–≤–µ–¥–∏—Ç–µ email',
                    phone: '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω'
                },
                'en': {
                    search: 'Search...',
                    name: 'Enter name',
                    email: 'Enter email',
                    phone: 'Enter phone'
                }
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º placeholders –≤ —Ñ–æ—Ä–º–∞—Ö
            document.querySelectorAll('input[placeholder], textarea[placeholder]').forEach(element => {
                const currentPlaceholder = element.getAttribute('placeholder');
                // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö placeholders
                Object.keys(placeholders[lang]).forEach(key => {
                    if (currentPlaceholder && currentPlaceholder.toLowerCase().includes(key)) {
                        element.setAttribute('placeholder', placeholders[lang][key]);
                    }
                });
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function initializeAdminLanguage() {
            console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
            
            let savedLanguage = 'ru'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä—É—Å—Å–∫–∏–π
            
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —è–∑—ã–∫
            try {
                savedLanguage = localStorage.getItem('selectedLanguage') || 'ru';
            } catch (error) {
                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage:', error);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —è–∑—ã–∫–∞
            if (!['ru', 'en'].includes(savedLanguage)) {
                savedLanguage = 'ru';
            }
            
            console.log(`üì± –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫: ${savedLanguage}`);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —è–∑—ã–∫
            updateAdminLanguageButton(savedLanguage);
            translateAdminInterface(savedLanguage);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (typeof currentLanguage !== 'undefined') {
                currentLanguage = savedLanguage;
            }
            
        }
        
        // API URL Configuration
        function getApiUrl() {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            
            console.log('Current location:', {
                hostname: hostname,
                protocol: protocol,
                port: window.location.port,
                href: window.location.href
            });
            
            // Always use relative URL for unified server
            return '/api';
            
        }

        // Authorization helper
        function getAuthHeaders() {
            const token = localStorage.getItem('authToken');
            if (token) {
                return {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                };
            }
            return {
                'Content-Type': 'application/json'
            };
        }
        
        // Authentication
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            console.log('üîê Login form submitted');
            e.preventDefault();
            const usernameElement = document.getElementById('username');
            const passwordElement = document.getElementById('password');
            
            if (!usernameElement || !passwordElement) {
                alert('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞');
                return;
            }
            
            const username = usernameElement.value;
            const password = passwordElement.value;
            
            console.log('üîí Password length:', password.length);
            
            // API login using unified server
            const apiUrl = getApiUrl();
            console.log('üåê API URL:', apiUrl);
            
            fetch(`${apiUrl}/admin/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            })
            .then(res => {
                console.log('üì° Response status:', res.status);
                return res.json();
            })
            .then(data => {
                console.log('üìä Response data:', data);
                if (data.success) {
                    localStorage.setItem('authToken', data.data.token);
                    localStorage.setItem('user', JSON.stringify(data.data.admin));
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('adminDashboard').style.display = 'block';
                    loadDashboard();
                } else {
                    console.log('‚ùå Login failed:', data.message);
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ' + (data.message || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏'));
                }
            })
            .catch(err => {
                console.error('üö® Login error:', err);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + err.message);
            });
        });
        
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
            }
        }
        
        // Navigation
        document.querySelectorAll('.nav-item[data-section], .nav-subitem[data-section]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const section = this.dataset.section;
                switchSection(section);
                
                // Update active state
                document.querySelectorAll('.nav-item, .nav-subitem').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                
            });
        });
        
        function switchSection(section) {
            // Hide all sections
            document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
            
            // Show selected section
            const sectionElement = document.getElementById(section + 'Section');
            if (sectionElement) {
                sectionElement.style.display = 'block';
            }
            
            // Update title
            const titles = {
                dashboard: '–ì–ª–∞–≤–Ω–∞—è',
                tours: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏',
                bookings: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏',
                hotels: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–µ–ª—è–º–∏',
                guides: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∏–¥–∞–º–∏',
                drivers: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏',
                trips: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∞–º–∏',
                transfers: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–º–∏',
                countries: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∞–º–∏',
                cities: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞–º–∏',
                customers: '–ö–ª–∏–µ–Ω—Ç—ã',
                reviews: '–ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤',
                payments: '–ü–ª–∞—Ç–µ–∂–∏',
                cms: 'CMS - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º',
                settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏'
            };
            const sectionTitleElement = document.getElementById('sectionTitle');
            if (sectionTitleElement) {
                sectionTitleElement.textContent = titles[section] || '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å';
            }
            
            // Load section data
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'tours':
                    loadTours();
                    break;
                case 'bookings':
                    loadBookings();
                    break;
                case 'hotels':
                    loadHotels();
                    break;
                case 'guides':
                    loadGuides();
                    break;
                case 'drivers':
                    loadDrivers();
                    break;
                case 'trips':
                    loadTrips();
                    break;
                case 'transfers':
                    loadTransfers();
                    break;
                case 'countries':
                    loadCountries();
                    break;
                case 'cities':
                    loadCities();
                    break;
                case 'reviews':
                    loadReviews();
                    break;
                case 'news':
                    loadNews();
                    break;
                case 'cms':
                    loadCMSContentBlocks();
                    break;
            }
        }
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebar').classList.toggle('collapsed');
            document.getElementById('mainContent').classList.toggle('expanded');
        }
        
        // Dashboard functions
        function loadDashboard() {
            loadDashboardStats();
            loadRecentOrders();
            loadCharts();
        }
        
        function loadDashboardStats() {
            // Check if user is authenticated first
            const token = localStorage.getItem('authToken');
            if (!token) {
                console.log('No auth token found, user needs to login');
                return;
            }
            
            // Use the new dedicated dashboard stats endpoint
            fetch(`${getApiUrl()}/admin/dashboard-stats`, { 
                headers: getAuthHeaders() 
            })
                .then(response => {
                    if (response.status === 401 || response.status === 403) {
                        // Token is invalid, redirect to login
                        console.log('Token invalid, redirecting to login');
                        logout();
                        return null;
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) return; // Handle logout case
                    
                    console.log('Dashboard stats loaded:', data);
                    if (data.success) {
                        const stats = data.data.stats;
                        const revenue = data.data.recentOrders.reduce((total, order) => 
                            total + (parseFloat(order.totalAmount) || 0), 0);
                        
                        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                        const statsCards = document.querySelectorAll('.stat-card h3');
                        if (statsCards.length >= 4) {
                            statsCards[0].textContent = stats.tours || 0;
                            statsCards[1].textContent = stats.orders || 0; 
                            statsCards[2].textContent = '$' + revenue.toFixed(2);
                            statsCards[3].textContent = stats.customers || 0;
                        }
                    } else {
                        console.error('Dashboard stats API error:', data.message);
                        // Show default values if API fails
                        showDefaultStats();
                    }
                })
                .catch(err => {
                    console.error('Error loading dashboard stats:', err);
                    showDefaultStats();
                });
        }
        
        function showDefaultStats() {
            const statsCards = document.querySelectorAll('.stat-card h3');
            if (statsCards.length >= 4) {
                statsCards[0].textContent = '-';
                statsCards[1].textContent = '-';
                statsCards[2].textContent = '$0.00';
                statsCards[3].textContent = '-';
            }
        }
        
        function loadRecentOrders() {
            fetch(`${getApiUrl()}/orders?limit=5`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('recentOrdersTable');
                    const orders = data.data || data.orders || [];
                    if (orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = orders.map(order => `
                        <tr>
                            <td class="font-medium">${order.orderNumber || 'N/A'}</td>
                            <td>${order.customer?.fullName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                            <td>${getTourName(order.tour)}</td>
                            <td>${formatDate(order.createdAt)}</td>
                            <td class="font-semibold">$${order.totalAmount}</td>
                            <td>${getStatusBadge(order.status)}</td>
                            <td>
                                <button onclick="viewBooking(${order.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(err => {
                    console.error('Error loading orders:', err);
                    document.getElementById('recentOrdersTable').innerHTML = 
                        '<tr><td colspan="7" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                });
        }
        
        function loadCharts() {
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ charts –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö
            if (salesChart) {
                salesChart.destroy();
                salesChart = null;
            }
            if (destinationsChart) {
                destinationsChart.destroy();
                destinationsChart = null;
            }
            
            // Sales Chart
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                salesChart = new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω'],
                        datasets: [{
                            label: '–ü—Ä–æ–¥–∞–∂–∏',
                            data: [12000, 19000, 15000, 25000, 22000, 30000],
                            borderColor: '#3E3E3E',
                            backgroundColor: 'rgba(62, 62, 62, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Destinations Chart
            const destCtx = document.getElementById('destinationsChart');
            if (destCtx) {
                destinationsChart = new Chart(destCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω', '–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω', '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', '–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω'],
                        datasets: [{
                            data: [45, 25, 20, 10],
                            backgroundColor: ['#3E3E3E', '#10b981', '#f59e0b', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Chart.js —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
        let salesChart = null;
        let destinationsChart = null;
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
        let selectedCategories = [];
        let selectedLanguages = [];
        let selectedGuideLanguages = []; // –î–ª—è –≥–∏–¥–æ–≤
        let selectedCountries = []; // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω
        let selectedCities = []; // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–æ–≤
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        window.tourLanguages = window.tourLanguages || [];
        window.tourHighlights = window.tourHighlights || [];
        window.tourItinerary = window.tourItinerary || [];
        window.tourStartTimes = window.tourStartTimes || [];
        window.editStartTimes = window.editStartTimes || [];
        window.tourGalleryImages = window.tourGalleryImages || [];
        window.uploadedTourImages = window.uploadedTourImages || [];

        // Load categories from API for tour form
        function loadCategoriesForTourForm() {
            console.log('üè∑Ô∏è Starting loadCategoriesForTourForm()...');
            console.log('üè∑Ô∏è API URL:', `${getApiUrl()}/categories`);
            
            return fetch(`${getApiUrl()}/categories`, {
                headers: getAuthHeaders()
            })
                .then(res => {
                    console.log('üè∑Ô∏è Categories API response status:', res.status);
                    return res.json();
                })
                .then(data => {
                    console.log('üè∑Ô∏è Categories API response data:', data);
                    const categories = data.data || data.categories || [];
                    console.log('üè∑Ô∏è Processed categories array:', categories);
                    
                    // Update available categories select
                    const availableSelect = document.getElementById('availableCategories');
                    if (availableSelect) {
                        // If no categories, add predefined ones
                        if (categories.length === 0) {
                            availableSelect.innerHTML = `
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                                <option value="add_day_tours" data-name="–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã">–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_multi_day_tours" data-name="–ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã">–ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_excursions" data-name="–≠–∫—Å–∫—É—Ä—Å–∏–∏">–≠–∫—Å–∫—É—Ä—Å–∏–∏ (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_city_tours" data-name="–ì–æ—Ä–æ–¥—Å–∫–∏–µ —Ç—É—Ä—ã">–ì–æ—Ä–æ–¥—Å–∫–∏–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_nature_eco_tours" data-name="–ü—Ä–∏—Ä–æ–¥–∞/—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã">–ü—Ä–∏—Ä–æ–¥–∞/—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_cultural_tours" data-name="–ö—É–ª—å—Ç—É—Ä–Ω–æ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—É—Ä—ã">–ö—É–ª—å—Ç—É—Ä–Ω–æ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_historical_tours" data-name="–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_hiking_trekking" data-name="–ü–æ—Ö–æ–¥—ã/—Ç—Ä–µ–∫–∏–Ω–≥–∏">–ü–æ—Ö–æ–¥—ã/—Ç—Ä–µ–∫–∏–Ω–≥–∏ (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_mountain_landscapes" data-name="–ì–æ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã">–ì–æ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_lake_landscapes" data-name="–û–∑–µ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã">–û–∑–µ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_adventure_tours" data-name="–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã">–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_gastronomic_tours" data-name="–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã">–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_auto_tours" data-name="–ê–≤—Ç–æ—Ç—É—Ä—ã/—Å–∞—Ñ–∞—Ä–∏/–¥–∂–∏–ø-—Ç—É—Ä—ã">–ê–≤—Ç–æ—Ç—É—Ä—ã/—Å–∞—Ñ–∞—Ä–∏/–¥–∂–∏–ø-—Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_agro_tours" data-name="–ê–≥—Ä–æ—Ç—É—Ä—ã">–ê–≥—Ä–æ—Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                                <option value="add_vip_tours" data-name="VIP —Ç—É—Ä—ã">VIP —Ç—É—Ä—ã (—Å–æ–∑–¥–∞—Ç—å)</option>
                            `;
                        } else {
                            availableSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>' +
                                categories.map(cat => {
                                    let categoryName;
                                    try {
                                        if (cat.name && typeof cat.name === 'string') {
                                            const parsed = JSON.parse(cat.name);
                                            categoryName = parsed.ru || parsed.en || '–ë–µ–∑—ã–º—è–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è';
                                        } else if (cat.name && cat.name.ru) {
                                            categoryName = cat.name.ru;
                                        } else if (cat.title) {
                                            const parsed = typeof cat.title === 'string' ? JSON.parse(cat.title) : cat.title;
                                            categoryName = parsed.ru || parsed.en || '–ë–µ–∑—ã–º—è–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è';
                                        } else {
                                            categoryName = '–ë–µ–∑—ã–º—è–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è';
                                        }
                                    } catch (e) {
                                        categoryName = cat.name || cat.title || '–ë–µ–∑—ã–º—è–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è';
                                    }
                                    return `<option value="${cat.id}" data-name="${categoryName}">${categoryName}</option>`;
                                }).join('');
                        }
                    }
                    
                    console.log('‚úÖ Categories loaded successfully for availableCategories select');
                    return categories;
                })
                .catch(err => {
                    console.error('Error loading categories:', err);
                    return [];
                });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–∞
        window.tourHighlights = [];
        window.tourItinerary = [];
        window.tourStartTimes = [];
        window.editStartTimes = [];


        // –§—É–Ω–∫—Ü–∏–∏ removeHighlight –∏ updateHighlightsList —É–¥–∞–ª–µ–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã–±–æ—Ä —É—Å–ª—É–≥ –∏–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function getSafeImageUrl(url) {
            if (!url || typeof url !== 'string') {
                return '#';
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ URL –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç JavaScript –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
            if (url.includes('${') || url.includes('javascript:') || url.includes('data:') || url.includes('<script')) {
                return '#';
            }
            return url;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è HTML
        function populateImagesInContainer(container, imageUrls) {
            if (!container) return;
            
            const imageElements = container.querySelectorAll('[data-image-placeholder]');
            imageElements.forEach((img, index) => {
                const placeholder = img.getAttribute('data-image-placeholder');
                let imageUrl = '';
                
                if (placeholder === 'tour-image' && imageUrls && imageUrls[index]) {
                    imageUrl = imageUrls[index];
                } else if (placeholder === 'hotel-gallery' && imageUrls && imageUrls[index]) {
                    imageUrl = imageUrls[index];
                } else if (placeholder === 'hotel-thumb' && imageUrls && imageUrls[index]) {
                    imageUrl = imageUrls[index];
                }
                
                if (imageUrl) {
                    img.src = getSafeImageUrl(imageUrl);
                } else {
                    img.style.display = 'none';
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
        window.tourGalleryImages = window.tourGalleryImages || [];

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–∞–ª–µ—Ä–µ–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function addGalleryImage() {
            const imageUrlInput = document.getElementById('newImageUrl');
            const imageUrl = imageUrlInput.value.trim();
            
            if (imageUrl && !window.tourGalleryImages.includes(imageUrl)) {
                window.tourGalleryImages.push(imageUrl);
                updateGalleryImagesList();
                imageUrlInput.value = '';
            } else if (window.tourGalleryImages.includes(imageUrl)) {
                alert('–≠—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            }
        }

        function removeGalleryImage(index) {
            window.tourGalleryImages.splice(index, 1);
            updateGalleryImagesList();
        }

        function updateGalleryImagesList() {
            const galleryContainer = document.getElementById('galleryImagesList');
            if (!galleryContainer) {
                console.warn('galleryImagesList container not found');
                return;
            }
            galleryContainer.innerHTML = window.tourGalleryImages.map((imageUrl, index) => {
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const safeImageUrl = getSafeImageUrl(imageUrl);
                return `
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded border">
                    <div class="flex items-center gap-3">
                        <img src="${safeImageUrl}" alt="Preview" class="w-12 h-12 object-cover rounded" onerror="this.style.display='none';">
                        <div class="flex-1 min-w-0">
                            <div class="text-sm font-medium text-gray-900 truncate">${imageUrl}</div>
                        </div>
                    </div>
                    <button type="button" onclick="removeGalleryImage(${index})" class="text-red-500 hover:text-red-700 ml-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                `;
            }).join('');
        }

        // Initialize global variable for uploaded tour images
        window.uploadedTourImages = [];

        // Function to handle file upload for tour images
        function handleTourImageUpload(input) {
            const files = input.files;
            if (!files || files.length === 0) return;
            
            window.uploadedTourImages = []; // Reset uploaded images
            const previewContainer = document.getElementById('tourImagePreview');
            previewContainer.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        window.uploadedTourImages.push({
                            file: file,
                            dataURL: e.target.result,
                            isMain: index === 0 // First image becomes main image
                        });
                        
                        // Create preview element
                        const previewDiv = document.createElement('div');
                        previewDiv.className = 'relative border rounded-lg overflow-hidden';
                        
                        previewDiv.innerHTML = `
                            <img src="#" alt="Preview ${index + 1}" class="w-full h-32 object-cover" onload="this.src = '${e.target.result}'">
                            <div class="absolute top-2 left-2">
                                ${index === 0 ? '<span class="bg-green-500 text-white text-xs px-2 py-1 rounded">–ì–ª–∞–≤–Ω–æ–µ</span>' : ''}
                            </div>
                            <button type="button" onclick="removeUploadedImage(${index})" 
                                    class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                            <div class="p-2 bg-gray-50">
                                <p class="text-xs text-gray-600 truncate">${file.name}</p>
                            </div>
                        `;
                        
                        previewContainer.appendChild(previewDiv);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Show preview container
            if (files.length > 0) {
                previewContainer.style.display = 'grid';
            }
        }

        // Function to remove uploaded image
        function removeUploadedImage(index) {
            window.uploadedTourImages.splice(index, 1);
            
            // Reassign main image (first one becomes main)
            if (window.uploadedTourImages.length > 0) {
                window.uploadedTourImages[0].isMain = true;
                window.uploadedTourImages.forEach((img, i) => {
                    if (i > 0) img.isMain = false;
                });
            }
            
            // Update preview
            const previewContainer = document.getElementById('tourImagePreview');
            previewContainer.innerHTML = '';
            
            window.uploadedTourImages.forEach((imageData, i) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'relative border rounded-lg overflow-hidden';
                
                previewDiv.innerHTML = `
                    <img src="#" alt="Preview ${i + 1}" class="w-full h-32 object-cover" onload="this.src = '${imageData.dataURL}'">
                    <div class="absolute top-2 left-2">
                        ${i === 0 ? '<span class="bg-green-500 text-white text-xs px-2 py-1 rounded">–ì–ª–∞–≤–Ω–æ–µ</span>' : ''}
                    </div>
                    <button type="button" onclick="removeUploadedImage(${i})" 
                            class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                    <div class="p-2 bg-gray-50">
                        <p class="text-xs text-gray-600 truncate">${imageData.file.name}</p>
                    </div>
                `;
                
                previewContainer.appendChild(previewDiv);
            });
            
            if (window.uploadedTourImages.length === 0) {
                previewContainer.style.display = 'none';
                // Clear file input
                const tourImagesElement = document.getElementById('tourImages');
                if (tourImagesElement) tourImagesElement.value = '';
            }
        }

        // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É—Ä–∞ —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        function createFullTour(event) {
            event.preventDefault();
            
            // Process uploaded images - convert to base64 or use URLs from uploaded images
            let mainImage = '';
            let allImages = [];
            
            if (window.uploadedTourImages && window.uploadedTourImages.length > 0) {
                // Use uploaded images
                const mainImageData = window.uploadedTourImages.find(img => img.isMain) || window.uploadedTourImages[0];
                mainImage = mainImageData.dataURL; // base64 data
                allImages = window.uploadedTourImages.map(img => img.dataURL);
            } else {
                // Fallback to old URL system (if no images uploaded)
                mainImage = '';
                allImages = [];
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –∏–∑ —á–µ–∫–±–æ–∫—Å–æ–≤
            const serviceCheckboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked');
            const includedServices = Array.from(serviceCheckboxes).map(cb => cb.value);
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const tourData = {
                title: {
                    ru: safeGetValue('tourTitleRu', ''),
                    en: safeGetValue('tourTitleEn', ''),
                    tj: safeGetValue('tourTitleTj', '')
                },
                description: {
                    ru: safeGetValue('tourDescRu', ''),
                    en: safeGetValue('tourDescEn', ''),
                    tj: safeGetValue('tourDescTj', '')
                },
                duration: '',  // –ü–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ —Ñ–æ—Ä–º—ã
                durationDays: safeGetValue('tourDurationDays', 1, 'int'),
                price: safeGetValue('tourPrice', ''),
                priceType: safeGetValue('tourPriceType', '–∑–∞ —á–µ–ª–æ–≤–µ–∫–∞'),
                country: safeGetValue('tourCountry', ''),
                city: safeGetValue('tourCity', ''),
                categoryId: safeGetValue('tourCategory', null, 'int'),
                tourBlockIds: Array.from(document.querySelectorAll('input[name="tourBlocks"]:checked')).map(cb => parseInt(cb.value)),
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–µ
                pickupInfo: safeGetValue('tourPickupInfo', ''),
                languages: safeGetValue('tourLanguages', ''),
                // difficulty field removed per user request
                minPeople: safeGetValue('tourMinPeople', null, 'int'),
                maxPeople: safeGetValue('tourMaxPeople', null, 'int'),
                
                // Images - using uploaded files
                mainImage: mainImage || '',
                images: JSON.stringify(allImages),
                
                // –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ
                includes: JSON.stringify(includedServices),
                
                // –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—É—Ä–∞  
                itinerary: JSON.stringify(convertDaysItineraryToArray()), // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –º–∞—Å—Å–∏–≤
                
                // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
                startTimeOptions: JSON.stringify(window.tourStartTimes || []),
                
                // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ç—É—Ä–∞ (–º–µ—Å—è—Ü—ã –∏ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏)
                availableMonths: JSON.stringify(getSelectedCheckboxValues('month-')),
                availableDays: JSON.stringify(getSelectedCheckboxValues('day-')),
                
                // –£—Å–ª—É–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ç—É—Ä–∞
            };
            
            console.log('üíæ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é saveTourForm –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã');
            
            // –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è POST/PUT
            
            const titleRuElement = document.getElementById('tourTitleRu');
            if (!titleRuElement || !titleRuElement.value || titleRuElement.value.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ');
                return;
            }
            
            const tourPriceElement = document.getElementById('tourPrice');
            if (!tourPriceElement || !tourPriceElement.value || isNaN(parseFloat(tourPriceElement.value))) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç—É—Ä–∞');
                return;
            }
            
            const tourDurationElement = document.getElementById('tourDurationDays');
            if (!tourDurationElement || !tourDurationElement.value || isNaN(parseInt(tourDurationElement.value))) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—É—Ä–∞ –≤ –¥–Ω—è—Ö');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º ID —Ç—É—Ä–∞ –∏–∑ —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è
            const tourId = safeGetValue('tour-id', '');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (boolean, –Ω–µ —Å—Ç—Ä–æ–∫–∞!)
            const isEditing = Boolean(tourId && tourId.trim() !== '');
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
            proceedWithTourSaving(isEditing, tourId);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—É—Ä–∞
        function proceedWithTourSaving(isEditing, tourId) {
            console.log('üöÄ Proceeding with tour saving:', { isEditing, tourId });
            
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ null  
            const titleRuElement = document.getElementById('tourTitleRu');
            const titleEnElement = document.getElementById('tourTitleEn');
            const titleTjElement = document.getElementById('tourTitleTj');
            const descRuElement = document.getElementById('tourDescRu');
            const descEnElement = document.getElementById('tourDescEn');
            const descTjElement = document.getElementById('tourDescTj');
            const priceElement = document.getElementById('tourPrice');
            const durationElement = document.getElementById('tourDurationDays');
            
            const formData = {
                title: JSON.stringify({
                    ru: titleRuElement ? titleRuElement.value : '',
                    en: titleEnElement ? titleEnElement.value : (titleRuElement ? titleRuElement.value : '')
                }),
                shortDescription: JSON.stringify({
                    ru: descRuElement ? descRuElement.value : '',
                    en: descEnElement ? descEnElement.value : (descRuElement ? descRuElement.value : '')
                }),
                description: JSON.stringify({
                    ru: descRuElement ? descRuElement.value : '',
                    en: descEnElement ? descEnElement.value : (descRuElement ? descRuElement.value : '')
                }),
                price: priceElement ? parseFloat(priceElement.value) : 0,
                priceType: safeGetValue('tourPriceType', '–∑–∞ —á–µ–ª–æ–≤–µ–∫–∞'),
                originalPrice: safeGetValue('tourOriginalPrice', null, 'float'),
                durationDays: durationElement ? parseInt(durationElement.value) : 1,
                format: safeGetValue('tourType', ''),
                tourType: safeGetValue('tourType', ''),
                difficulty: safeGetValue('tourDifficulty', '–õ–µ–≥–∫–∏–π'),
                maxPeople: safeGetValue('tourMaxPeople', null, 'int'),
                minPeople: safeGetValue('tourMinPeople', null, 'int'),
                country: safeGetValue('tourCountry', ''),
                city: safeGetValue('tourCity', ''),
                pickupInfo: safeGetValue('tourPickupInfo', ''),
                mainImage: safeGetValue('tourMainImage', ''),
                images: JSON.stringify(window.tourGalleryImages || []),
                // –£—Å–ª—É–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                itinerary: JSON.stringify(convertDaysItineraryToArray()), // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –º–∞—Å—Å–∏–≤
                startTimeOptions: JSON.stringify(window.tourStartTimes || []),
                languages: JSON.stringify(window.tourLanguages || ['–†—É—Å—Å–∫–∏–π']),
                availableMonths: JSON.stringify(getSelectedCheckboxValues('month-')),
                availableDays: JSON.stringify(getSelectedCheckboxValues('day-')),
                categoryId: selectedCategories.length > 0 ? selectedCategories[0].id : null,
                tourBlockIds: Array.from(document.querySelectorAll('input[name="tourBlocks"]:checked')).map(cb => parseInt(cb.value)),
                isFeatured: safeGetValue('tourIsFeatured', false, 'checkbox'),
                isActive: true,
                // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏
                hotelIds: Array.from(document.querySelectorAll('input[name="selectedHotels"]:checked')).map(cb => parseInt(cb.value)),
                // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≥–∏–¥–æ–≤ 
                guideIds: Array.from(document.querySelectorAll('input[name="selectedGuides"]:checked')).map(cb => parseInt(cb.value)),
                // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ü–µ–Ω—ã (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è)
                pricingComponents: safeGetValue('tourPricingData', '[]')
            };
            
            console.log('üì§ Sending tour data:', formData);
            
            const apiUrl = getApiUrl();
            const url = isEditing ? `${apiUrl}/tours/${tourId}` : `${apiUrl}/tours`;
            const method = isEditing ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert(isEditing ? '–¢—É—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!' : '–¢—É—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    document.getElementById('tourModal').style.display = 'none';
                    loadTours(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤
                    resetTourForm(); // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                } else {
                    console.error('‚ùå Failed to save tour:', data.message);
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—É—Ä–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('üö® Error saving tour:', err);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + err.message);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã
        function resetTourForm() {
            // –û—á–∏—â–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã
            window.tourGalleryImages = [];
            window.tourHighlights = [];
            window.tourItinerary = [];
            window.tourStartTimes = [];
            window.editStartTimes = [];
            
            // –û—á–∏—â–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ü–µ–Ω—ã
            selectedTourComponents = [];
            document.getElementById('tourPricingData').value = '';
            document.getElementById('tourPrice').value = '0';
            document.getElementById('calculatedTotalPrice').textContent = '0 TJS';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Ü–µ–Ω—ã
            document.querySelectorAll('#tourPricingComponents input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('#tourPricingComponents input[type="number"]').forEach(input => {
                if (input.id.startsWith('quantity_')) {
                    input.value = '1';
                }
            });
            document.querySelectorAll('[id^="quantity_container_"]').forEach(container => {
                container.style.display = 'none';
            });
            document.querySelectorAll('[id^="price_"]').forEach(priceInput => {
                priceInput.disabled = true;
                // Reset to original price from component data
                const componentId = priceInput.id.replace('price_', '');
                const component = tourPricingComponents.find(c => c.id == componentId);
                if (component) {
                    priceInput.value = component.price;
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ (updateIncludesList —É–¥–∞–ª–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º —á–µ–∫–±–æ–∫—Å—ã)
            updateGalleryImagesList();
            // updateHighlightsList —É–¥–∞–ª–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º —á–µ–∫–±–æ–∫—Å—ã —É—Å–ª—É–≥
            updateItineraryList();
            updateStartTimesList();
        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π —Ç—É—Ä–∞
        window.tourDaysItinerary = window.tourDaysItinerary || {}; // –û–±—ä–µ–∫—Ç —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –ø–æ –¥–Ω—è–º
        window.currentActiveDay = 1; // –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å

        function initializeDayProgram() {
            if (!window.tourDaysItinerary[1]) {
                window.tourDaysItinerary[1] = [];
            }
            updateDayTabs();
            updateDayContents();
            switchToDay(1);
        }

        function addNewDay() {
            const maxDay = Math.max(...Object.keys(window.tourDaysItinerary).map(d => parseInt(d)), 0);
            const newDay = maxDay + 1;
            window.tourDaysItinerary[newDay] = [];
            updateDayTabs();
            updateDayContents();
            switchToDay(newDay);
        }

        function removeDay(dayNumber) {
            if (Object.keys(window.tourDaysItinerary).length <= 1) {
                alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –ø—Ä–æ–≥—Ä–∞–º–º—ã');
                return;
            }
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –î–µ–Ω—å ${dayNumber} –∏ –≤—Å—é –µ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º—É?`)) {
                delete window.tourDaysItinerary[dayNumber];
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–µ–Ω—å
                const firstDay = Math.min(...Object.keys(window.tourDaysItinerary).map(d => parseInt(d)));
                switchToDay(firstDay);
                
                updateDayTabs();
                updateDayContents();
            }
        }

        function switchToDay(dayNumber) {
            window.currentActiveDay = dayNumber;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±—ã
            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.classList.remove('bg-blue-500', 'text-white');
                tab.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            const activeTab = document.querySelector(`[data-day="${dayNumber}"]`);
            if (activeTab) {
                activeTab.classList.remove('bg-gray-200', 'text-gray-700');
                activeTab.classList.add('bg-blue-500', 'text-white');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            document.querySelectorAll('.day-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            const activeContent = document.getElementById(`day-content-${dayNumber}`);
            if (activeContent) {
                activeContent.classList.remove('hidden');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('currentDayLabel').textContent = `–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –î–µ–Ω—å ${dayNumber}`;
        }

        function addItineraryToCurrentDay() {
            const time = safeGetValue('newItineraryTime', '');
            const itineraryTitle = safeGetValue('newItineraryTitle', '').trim();
            const desc = safeGetValue('newItineraryDesc', '').trim();
            
            if (time && itineraryTitle) {
                const itineraryItem = { 
                    time, 
                    title: itineraryTitle, 
                    description: desc || ''
                };
                
                if (!window.tourDaysItinerary[window.currentActiveDay]) {
                    window.tourDaysItinerary[window.currentActiveDay] = [];
                }
                
                window.tourDaysItinerary[window.currentActiveDay].push(itineraryItem);
                updateDayContents();
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('newItineraryTime').value = '';
                document.getElementById('newItineraryTitle').value = '';
                document.getElementById('newItineraryDesc').value = '';
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä–µ–º—è –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏');
            }
        }

        function removeItineraryFromDay(dayNumber, index) {
            if (window.tourDaysItinerary[dayNumber]) {
                window.tourDaysItinerary[dayNumber].splice(index, 1);
                updateDayContents();
            }
        }

        function updateDayTabs() {
            const tabsContainer = document.getElementById('dayTabs');
            if (!tabsContainer) return;
            
            const days = Object.keys(window.tourDaysItinerary).map(d => parseInt(d)).sort((a, b) => a - b);
            
            tabsContainer.innerHTML = days.map(day => `
                <button type="button" 
                        class="day-tab px-4 py-2 font-medium rounded-t-lg border-b-2 ${day === window.currentActiveDay ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" 
                        data-day="${day}" 
                        onclick="switchToDay(${day})">
                    –î–µ–Ω—å ${day}
                    ${days.length > 1 ? `<button type="button" onclick="event.stopPropagation(); removeDay(${day})" class="ml-2 text-red-500 hover:text-red-700"><i class="fas fa-times text-xs"></i></button>` : ''}
                </button>
            `).join('');
        }

        function updateDayContents() {
            const contentsContainer = document.getElementById('dayContents');
            if (!contentsContainer) return;
            
            const days = Object.keys(window.tourDaysItinerary).map(d => parseInt(d)).sort((a, b) => a - b);
            
            contentsContainer.innerHTML = days.map(day => {
                const dayItinerary = window.tourDaysItinerary[day] || [];
                const isVisible = day === window.currentActiveDay ? '' : 'hidden';
                
                return `
                    <div id="day-content-${day}" class="day-content ${isVisible}">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–Ω—è ${day}</h3>
                            ${dayItinerary.length === 0 ? 
                                '<p class="text-gray-500 text-center py-8 italic">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–Ω—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∏–∂–µ.</p>' :
                                dayItinerary.map((item, index) => `
                                    <div class="bg-gray-50 p-3 rounded border mb-3">
                                        <div class="flex justify-between items-start mb-2">
                                            <div class="flex items-center gap-3">
                                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-medium">${item.time}</span>
                                                <strong class="text-gray-800">${item.title}</strong>
                                            </div>
                                            <button type="button" onclick="removeItineraryFromDay(${day}, ${index})" class="text-red-500 hover:text-red-700">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        ${item.description ? `<p class="text-gray-600 text-sm ml-16">${item.description}</p>` : ''}
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
        function convertLegacyItinerary() {
            if (window.tourItinerary && window.tourItinerary.length > 0) {
                window.tourDaysItinerary = { 1: [...window.tourItinerary] };
                window.tourItinerary = []; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É
            }
        }

        // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è API
        function convertDaysItineraryToArray() {
            const daysItinerary = window.tourDaysItinerary || {};
            const allActivities = [];
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –¥–Ω–µ–π –≤ –æ–¥–∏–Ω –º–∞—Å—Å–∏–≤ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            Object.keys(daysItinerary)
                .sort((a, b) => parseInt(a) - parseInt(b)) // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É
                .forEach(day => {
                    const dayActivities = daysItinerary[day] || [];
                    dayActivities.forEach(activity => {
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –¥–Ω—è –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
                        allActivities.push({
                            ...activity,
                            day: parseInt(day) // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–Ω–µ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                        });
                    });
                });
                
            return allActivities;
        }

        // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–æ–π
        function updateItineraryList() {
            // –§—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞ –≤ –Ω–æ–≤–æ–π –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
            // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ initializeDayProgram()
            console.log('üìù updateItineraryList –≤—ã–∑–≤–∞–Ω–∞ (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)');
        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–∞ (–±—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ)
        function addStartTime() {
            const input = document.getElementById('newStartTime');
            const time = input.value;
            
            if (time && !window.tourStartTimes.includes(time)) {
                window.tourStartTimes.push(time);
                updateStartTimesList();
                input.value = '';
            } else if (window.tourStartTimes.includes(time)) {
                alert('–≠—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
            }
        }

        function removeStartTime(index) {
            window.tourStartTimes.splice(index, 1);
            updateStartTimesList();
        }

        function updateStartTimesList() {
            const container = document.getElementById('startTimesList');
            container.innerHTML = window.tourStartTimes.map((time, index) => `
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                    <span>üïê ${time}</span>
                    <button type="button" onclick="removeStartTime(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–∞ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
        function addEditStartTime() {
            const input = document.getElementById('editNewStartTime');
            const time = input.value;
            
            if (time && !window.editStartTimes.includes(time)) {
                window.editStartTimes.push(time);
                updateStartTimesList();
                input.value = '';
            } else if (window.editStartTimes.includes(time)) {
                alert('–≠—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
            }
        }

        function removeEditStartTime(index) {
            window.editStartTimes.splice(index, 1);
            updateStartTimesList();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —è–∑—ã–∫–∞–º–∏ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function addEditLanguageToTour() {
            const select = document.getElementById('eAvailableLanguages');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const language = selectedOption.value;
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —è–∑—ã–∫–∏
                const eTourLanguagesField4 = document.getElementById('eTourLanguages');
                let currentLanguages = eTourLanguagesField4.value ? eTourLanguagesField4.value.split(', ') : [];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ
                if (currentLanguages.includes(language)) {
                    alert('–≠—Ç–æ—Ç —è–∑—ã–∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω');
                    return;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —è–∑—ã–∫
                currentLanguages.push(language);
                eTourLanguagesField4.value = currentLanguages.join(', ');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateEditSelectedLanguages();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                select.selectedIndex = 0;
            }
        }

        function updateEditSelectedLanguages() {
            const eTourLanguagesField2 = document.getElementById('eTourLanguages');
            const container = document.getElementById('eSelectedLanguages');
            
            if (!container) return;
            
            const languages = eTourLanguagesField2.value ? eTourLanguagesField2.value.split(', ') : [];
            
            if (languages.length === 0 || (languages.length === 1 && languages[0] === '')) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                return;
            }
            
            container.innerHTML = (Array.isArray(languages) ? languages : []).map((language, index) => `
                <div class="flex items-center justify-between bg-blue-100 text-blue-800 px-2 py-1 rounded mb-1">
                    <span>${language}</span>
                    <button type="button" onclick="removeEditLanguage(${index})" class="text-red-500 hover:text-red-700 ml-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function removeEditLanguage(index) {
            const eTourLanguagesField3 = document.getElementById('eTourLanguages');
            let languages = eTourLanguagesField3.value ? eTourLanguagesField3.value.split(', ') : [];
            languages.splice(index, 1);
            eTourLanguagesField3.value = languages.join(', ');
            updateEditSelectedLanguages();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–∞–ª–µ—Ä–µ–µ–π –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function addEditGalleryImage() {
            const input = document.getElementById('eNewImageUrl');
            const imageUrl = input.value.trim();
            
            if (imageUrl && !window.tourGalleryImages.includes(imageUrl)) {
                window.tourGalleryImages.push(imageUrl);
                updateGalleryImagesList();
                input.value = '';
            } else if (window.tourGalleryImages.includes(imageUrl)) {
                alert('–≠—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            }
        }

        function updateEditGalleryImagesList() {
            const container = document.getElementById('eGalleryImagesList');
            if (!container) {
                console.warn('eGalleryImagesList container not found');
                return;
            }
            container.innerHTML = window.tourGalleryImages.map((imageUrl, index) => `
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded border">
                    <img data-image-placeholder="tour-image" alt="Tour image" class="w-16 h-16 object-cover rounded">
                    <div class="flex-1">
                        <p class="text-sm text-gray-700 break-all">${imageUrl}</p>
                    </div>
                    <button type="button" onclick="removeEditGalleryImage(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('') || '<p class="text-gray-500 text-sm">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –≥–∞–ª–µ—Ä–µ–µ</p>';
        }

        function removeEditGalleryImage(index) {
            window.tourGalleryImages.splice(index, 1);
            updateEditGalleryImagesList();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥
        function getSelectedIncludes() {
            const checkboxes = document.querySelectorAll('#includesOptions input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }

        function updateEditStartTimesList() {
            const container = document.getElementById('startTimesList');
            if (!container) {
                console.warn('startTimesList container not found');
                return;
            }
            container.innerHTML = window.editStartTimes.map((time, index) => `
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                    <span>üïê ${time}</span>
                    <button type="button" onclick="removeEditStartTime(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }


        // Add category to tour
        function addCategoryToTour() {
            const select = document.getElementById('availableCategories');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const categoryValue = selectedOption.value;
                const categoryName = selectedOption.getAttribute('data-name') || selectedOption.text;
                
                // Check if it's a category that needs to be created
                if (categoryValue.startsWith('add_')) {
                    // Create new category first
                    const categoryMap = {
                        'add_day_tours': { ru: '–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã', en: 'Day Tours' },
                        'add_multi_day_tours': { ru: '–ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã', en: 'Multi-day Tours' },
                        'add_excursions': { ru: '–≠–∫—Å–∫—É—Ä—Å–∏–∏', en: 'Excursions' },
                        'add_city_tours': { ru: '–ì–æ—Ä–æ–¥—Å–∫–∏–µ —Ç—É—Ä—ã', en: 'City Tours' },
                        'add_nature_eco_tours': { ru: '–ü—Ä–∏—Ä–æ–¥–∞/—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', en: 'Nature/Eco Tours' },
                        'add_cultural_tours': { ru: '–ö—É–ª—å—Ç—É—Ä–Ω–æ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—É—Ä—ã', en: 'Cultural Educational Tours' },
                        'add_historical_tours': { ru: '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', en: 'Historical Tours' },
                        'add_hiking_trekking': { ru: '–ü–æ—Ö–æ–¥—ã/—Ç—Ä–µ–∫–∏–Ω–≥–∏', en: 'Hiking/Trekking' },
                        'add_mountain_landscapes': { ru: '–ì–æ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã', en: 'Mountain Landscapes' },
                        'add_lake_landscapes': { ru: '–û–∑–µ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã', en: 'Lake Landscapes' },
                        'add_adventure_tours': { ru: '–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', en: 'Adventure Tours' },
                        'add_gastronomic_tours': { ru: '–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã', en: 'Gastronomic Tours' },
                        'add_auto_tours': { ru: '–ê–≤—Ç–æ—Ç—É—Ä—ã/—Å–∞—Ñ–∞—Ä–∏/–¥–∂–∏–ø-—Ç—É—Ä—ã', en: 'Auto Tours/Safari/Jeep Tours' },
                        'add_agro_tours': { ru: '–ê–≥—Ä–æ—Ç—É—Ä—ã', en: 'Agro Tours' },
                        'add_vip_tours': { ru: 'VIP —Ç—É—Ä—ã', en: 'VIP Tours' }
                    };
                    
                    const categoryInfo = categoryMap[categoryValue];
                    if (categoryInfo) {
                        const categoryData = {
                            name: {
                                ru: categoryInfo.ru,
                                en: categoryInfo.en,
                                tj: ''
                            }
                        };
                        
                        fetch(`${getApiUrl()}/categories`, {
                            method: 'POST',
                            headers: getAuthHeaders(),
                            body: JSON.stringify(categoryData)
                        })
                            .then(res => res.json())
                            .then(data => {
                                if (data.success && data.data && data.data.id) {
                                    // Category created successfully, add to selected
                                    const categoryId = data.data.id;
                                    
                                    // Check if already added
                                    if (selectedCategories.find(cat => cat.id === categoryId)) {
                                        alert('–≠—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                                        return;
                                    }
                                    
                                    selectedCategories.push({id: categoryId, name: categoryName});
                                    updateSelectedCategoriesDisplay();
                                    
                                    // Reload categories to show the new one
                                    loadCategories();
                                } else {
                                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                                }
                            })
                            .catch(err => {
                                console.error('Error creating category:', err);
                                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                            });
                    }
                } else {
                    // Existing category, just add it
                    const categoryId = categoryValue;
                    
                    // Check if already added
                    if (selectedCategories.find(cat => cat.id === categoryId)) {
                        alert('–≠—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                        return;
                    }
                    
                    selectedCategories.push({id: categoryId, name: categoryName});
                    updateSelectedCategoriesDisplay();
                }
                
                // Reset select
                select.selectedIndex = 0;
            }
        }

        // Remove category from tour
        function removeCategoryFromTour(categoryId) {
            selectedCategories = selectedCategories.filter(cat => cat.id !== categoryId);
            updateSelectedCategoriesDisplay();
        }

        // Update selected categories display
        function updateSelectedCategoriesDisplay() {
            const container = document.getElementById('selectedCategories');
            const categoryHiddenInput = document.getElementById('tourCategory');
            
            if (selectedCategories.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                categoryHiddenInput.value = '';
            } else {
                container.innerHTML = selectedCategories.map(cat => 
                    `<div class="flex justify-between items-center bg-white p-2 rounded border">
                        <span>${cat.name}</span>
                        <button type="button" onclick="removeCategoryFromTour('${cat.id}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`
                ).join('');
                
                // Set first category as primary (for required field)
                categoryHiddenInput.value = selectedCategories[0].id;
            }
        }

        // Add country to tour
        function addCountryToTour() {
            const select = document.getElementById('availableCountries');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const countryId = selectedOption.value;
                const countryName = selectedOption.text;
                
                // Check if already added
                if (selectedCountries.find(country => country.id === countryId)) {
                    alert('–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                    return;
                }
                
                selectedCountries.push({id: countryId, name: countryName});
                updateSelectedCountriesDisplay();
                
                // Update available cities based on selected countries
                updateAvailableCitiesForSelectedCountries();
                
                // Reset select
                select.selectedIndex = 0;
            }
        }

        // Remove country from tour
        function removeCountryFromTour(countryId) {
            selectedCountries = selectedCountries.filter(country => country.id !== countryId);
            updateSelectedCountriesDisplay();
            
            // Update available cities and remove cities from removed countries
            selectedCities = selectedCities.filter(city => selectedCountries.some(country => city.countryId === country.id));
            updateSelectedCitiesDisplay();
            updateAvailableCitiesForSelectedCountries();
        }

        // Update selected countries display
        function updateSelectedCountriesDisplay() {
            const container = document.getElementById('selectedCountries');
            const countriesHiddenInput = document.getElementById('tourCountries');
            const legacyCountryInput = document.getElementById('tourCountry');
            
            if (selectedCountries.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                countriesHiddenInput.value = '';
                legacyCountryInput.value = '';
            } else {
                container.innerHTML = selectedCountries.map(country => 
                    `<div class="flex justify-between items-center bg-white p-2 rounded border">
                        <span>${country.name}</span>
                        <button type="button" onclick="removeCountryFromTour('${country.id}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`
                ).join('');
                
                // Set data for new system (array of IDs)
                countriesHiddenInput.value = JSON.stringify(selectedCountries.map(c => c.id));
                // Set data for legacy system (first country name)
                legacyCountryInput.value = selectedCountries[0].name;
            }
        }

        // Add city to tour
        function addCityToTour() {
            const select = document.getElementById('availableCities');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const cityId = selectedOption.value;
                const cityName = selectedOption.text;
                const countryId = selectedOption.getAttribute('data-country-id');
                
                // Check if already added
                if (selectedCities.find(city => city.id === cityId)) {
                    alert('–≠—Ç–æ—Ç –≥–æ—Ä–æ–¥ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω');
                    return;
                }
                
                selectedCities.push({id: cityId, name: cityName, countryId: countryId});
                updateSelectedCitiesDisplay();
                
                // Reset select
                select.selectedIndex = 0;
            }
        }

        // Remove city from tour
        function removeCityFromTour(cityId) {
            selectedCities = selectedCities.filter(city => city.id !== cityId);
            updateSelectedCitiesDisplay();
        }

        // Update selected cities display
        function updateSelectedCitiesDisplay() {
            const container = document.getElementById('selectedCities');
            const citiesHiddenInput = document.getElementById('tourCities');
            const legacyCityInput = document.getElementById('tourCity');
            
            if (selectedCities.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                citiesHiddenInput.value = '';
                legacyCityInput.value = '';
            } else {
                container.innerHTML = selectedCities.map(city => 
                    `<div class="flex justify-between items-center bg-white p-2 rounded border">
                        <span>${city.name}</span>
                        <button type="button" onclick="removeCityFromTour('${city.id}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`
                ).join('');
                
                // Set data for new system (array of IDs)
                citiesHiddenInput.value = JSON.stringify(selectedCities.map(c => c.id));
                // Set data for legacy system (first city name)
                legacyCityInput.value = selectedCities[0].name;
            }
        }

        // Update available cities based on selected countries
        function updateAvailableCitiesForSelectedCountries() {
            const citiesSelect = document.getElementById('availableCities');
            if (!citiesSelect || selectedCountries.length === 0) {
                if (citiesSelect) {
                    citiesSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—ã</option>';
                }
                return;
            }
            
            // Load cities for selected countries
            const countryIds = selectedCountries.map(c => c.id);
            fetch(`${getApiUrl()}/cities?countryIds=${countryIds.join(',')}`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const cities = data.data || [];
                    citiesSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>';
                    cities.forEach(city => {
                        citiesSelect.innerHTML += `<option value="${city.id}" data-country-id="${city.countryId}">${city.nameRu}</option>`;
                    });
                })
                .catch(err => {
                    console.error('Error loading cities:', err);
                    citiesSelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤</option>';
                });
        }

        // Load countries for tour form
        function loadCountriesForTourForm() {
            fetch(`${getApiUrl()}/countries`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const countries = data.data || [];
                    const countriesSelect = document.getElementById('availableCountries');
                    if (countriesSelect) {
                        countriesSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>';
                        countries.forEach(country => {
                            countriesSelect.innerHTML += `<option value="${country.id}">${country.nameRu}</option>`;
                        });
                    }
                })
                .catch(err => {
                    console.error('Error loading countries:', err);
                });
        }

        // Add language to tour (main form)
        function addLanguageToTourMain() {
            const select = document.getElementById('availableLanguages');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const language = selectedOption.value;
                
                // Check if already added
                if (selectedLanguages.includes(language)) {
                    alert('–≠—Ç–æ—Ç —è–∑—ã–∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω');
                    return;
                }
                
                // Add to selected languages
                selectedLanguages.push(language);
                
                // Update display
                updateSelectedLanguagesDisplay();
                
                // Reset select
                select.selectedIndex = 0;
            }
        }

        // Remove language from tour
        function removeLanguageFromTour(language) {
            selectedLanguages = selectedLanguages.filter(lang => lang !== language);
            updateSelectedLanguagesDisplay();
        }

        // Update selected languages display
        function updateSelectedLanguagesDisplay() {
            const container = document.getElementById('selectedLanguages');
            const languagesHiddenInput = document.getElementById('tourLanguages');
            
            if (selectedLanguages.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                languagesHiddenInput.value = '';
            } else {
                container.innerHTML = selectedLanguages.map(lang => 
                    `<div class="flex justify-between items-center bg-white p-2 rounded border">
                        <span>${lang}</span>
                        <button type="button" onclick="removeLanguageFromTour('${lang}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`
                ).join('');
                
                hiddenInput.value = JSON.stringify(selectedLanguages);
            }
        }
        

        // Tours functions
        function loadTours() {
            fetch(`${getApiUrl()}/tours?includeRaw=true`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('toursTable');
                    const tours = data.data || data.tours || [];
                    if (tours.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="9" class="text-center text-gray-500">–ù–µ—Ç —Ç—É—Ä–æ–≤</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = tours.map(tour => {
                        // –° includeRaw=true API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ title –∏ category.name
                        const tourTitle = tour.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                        const categoryName = tour.category ? tour.category.name || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                        return `
                            <tr>
                                <td>${tour.id}</td>
                                <td class="font-medium">${tourTitle}</td>
                                <td>${categoryName}</td>
                                <td>${tour.country || '-'}</td>
                                <td>${tour.city || '-'}</td>
                                <td>${tour.duration || tour.durationDays || '-'} –¥–Ω–µ–π</td>
                                <td class="font-semibold">${tour.price} —Å–æ–º.</td>
                                <td>${tour.isActive ? 
                                    '<span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>' : 
                                    '<span class="badge badge-danger">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>'}</td>
                                <td>
                                    <button onclick="editTour(${tour.id})" class="text-blue-600 hover:text-blue-800 mr-2" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="copyReviewLink(${tour.id})" class="text-green-600 hover:text-green-800 mr-2" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤">
                                        <i class="fas fa-link"></i>
                                    </button>
                                    <button onclick="deleteTour(${tour.id})" class="text-red-600 hover:text-red-800" title="–£–¥–∞–ª–∏—Ç—å —Ç—É—Ä">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                })
                .catch(err => {
                    console.error('Error loading tours:', err);
                    document.getElementById('toursTable').innerHTML = 
                        '<tr><td colspan="9" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                });
        }
        
        function openTourModal(tourId = null) {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –º—É–ª—å—Ç–∏—Å–µ–ª–µ–∫—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            loadCountriesForTourForm();
            // üéØ –î–û–ë–ê–í–õ–ï–ù–û: –ó–∞–≥—Ä—É–∂–∞–µ–º –±–ª–æ–∫–∏ —Ç—É—Ä–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã
            loadTourBlocksForForm();
            console.log('üîµ Opening tour modal with tourId:', tourId);
            currentTourId = tourId;
            console.log('üîµ Set currentTourId to:', currentTourId);
            window.currentTourId = tourId; // –¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ
            window.tourImageURLs = [];
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –û—á–∏—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            selectedCategories = [];
            updateSelectedCategoriesDisplay();
            selectedCountries = [];
            updateSelectedCountriesDisplay();
            selectedCities = [];
            updateSelectedCitiesDisplay();
            
            // –û—á–∏—â–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const excludedContainer = document.getElementById('excludedOptions');
            const excludedPlaceholder = document.getElementById('excludedPlaceholder');
            if (excludedContainer) {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥
                const checkboxes = excludedContainer.querySelectorAll('.checkbox-item');
                checkboxes.forEach(checkbox => checkbox.remove());
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
                if (excludedPlaceholder) {
                    excludedPlaceholder.style.display = 'block';
                }
            }
            
            
            // –ö–†–ò–¢–ò–ß–ù–û: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤
            if (!window.tourDaysItinerary || Object.keys(window.tourDaysItinerary).length === 0) {
                window.tourDaysItinerary = { 1: [] }; // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—É—Å—Ç—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–∞
            }
            convertLegacyItinerary(); // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)
            initializeDayProgram(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
            
            document.getElementById('tourModal').classList.add('active');
            
            // Initialize the uploader
            setTimeout(() => {
                initializeTourUploader();
                initializeTourEditUploader();
            }, 100);
            
            // Load hotels and guides for checkboxes
            loadHotelsForCheckboxes();
            loadGuidesForCheckboxes();
            
            // Load categories for tour form
            loadCategoriesForTourForm();
            
            if (tourId) {
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ ID —Ç—É—Ä–∞
                document.getElementById('tour-id').value = tourId;
                
                // Load tour data for editing
                fetch(`${getApiUrl()}/tours/${tourId}?includeRaw=true`, {
                    headers: getAuthHeaders()
                })
                    .then(res => {
                        console.log('API response status:', res.status);
                        if (!res.ok) {
                            throw new Error(`HTTP error! status: ${res.status}`);
                        }
                        return res.json();
                    })
                    .then(data => {
                        console.log('API response data:', data);
                        const tour = data.data || data.tour || data;
                        if (!tour) {
                            throw new Error('Tour data not found in response');
                        }
                        console.log('Tour object:', tour);
                        
                        // Parse title and description from raw JSON data
                        let title, description;
                        
                        // –° includeRaw=true API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –æ–±—ä–µ–∫—Ç—ã, –Ω–µ —Å—Ç—Ä–æ–∫–∏
                        if (typeof tour.title === 'object' && tour.title !== null) {
                            title = tour.title;
                        } else if (typeof tour.title === 'string') {
                            try {
                                title = JSON.parse(tour.title);
                            } catch (e) {
                                console.warn('Failed to parse title:', e);
                                title = { ru: tour.title || '', en: tour.title || '' };
                            }
                        } else {
                            title = { ru: '', en: '' };
                        }
                        
                        if (typeof tour.description === 'object' && tour.description !== null) {
                            description = tour.description;
                        } else if (typeof tour.description === 'string') {
                            try {
                                description = JSON.parse(tour.description);
                            } catch (e) {
                                console.warn('Failed to parse description:', e);
                                description = { ru: tour.description || '', en: tour.description || '' };
                            }
                        } else {
                            description = { ru: '', en: '' };
                        }
                        
                        // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–ø–æ–ª–Ω—è–µ–º –û–ë–ï —Ñ–æ—Ä–º—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!
                        
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –û–°–ù–û–í–ù–û–ô —Ñ–æ—Ä–º—ã tourForm
                        const tourTitleRu = document.getElementById('tourTitleRu');
                        if (tourTitleRu) {
                            tourTitleRu.value = title.ru || '';
                        }
                        
                        const tourTitleEn = document.getElementById('tourTitleEn');
                        if (tourTitleEn) {
                            tourTitleEn.value = title.en || '';
                        }
                        
                        const tourDescRu = document.getElementById('tourDescRu');
                        if (tourDescRu) {
                            tourDescRu.value = description.ru || '';
                        }
                        
                        const tourDescEn = document.getElementById('tourDescEn');
                        if (tourDescEn) {
                            tourDescEn.value = description.en || '';
                        }
                        
                        // –£–î–ê–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π Enhanced —Ñ–æ—Ä–º—ã (—Ñ–æ—Ä–º–∞ —É–¥–∞–ª–µ–Ω–∞)
                        
                        const tourType = document.getElementById('tourType');
                        if (tourType) {
                            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–ª—É—á—à–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–∞ —Ç—É—Ä–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–µ–π
                            const typeValue = tour.tourType || tour.format || '';
                            tourType.value = typeValue;
                        }
                        
                        // –£–î–ê–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ eTourType (–ø–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ)
                        
                        const tourCategory = document.getElementById('tourCategory');
                        if (tourCategory) {
                            tourCategory.value = tour.categoryId || '';
                        }
                        
                        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Å–∏—Å—Ç–µ–º—É –≤—ã–±–æ—Ä–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
                        if (tour.categoryId) {
                            // –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ ID
                            fetch(`${getApiUrl()}/categories`)
                                .then(res => res.json())
                                .then(data => {
                                    const categories = data.data || data.categories || [];
                                    const category = categories.find(cat => cat.id === tour.categoryId);
                                    if (category) {
                                        let categoryName;
                                        if (typeof category.name === 'object' && category.name !== null) {
                                            categoryName = category.name;
                                        } else if (typeof category.name === 'string') {
                                            try {
                                                categoryName = JSON.parse(category.name);
                                            } catch (e) {
                                                console.warn('Failed to parse category name:', e);
                                                categoryName = { ru: category.name, en: '' };
                                            }
                                        } else {
                                            categoryName = { ru: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', en: 'Category' };
                                        }
                                        selectedCategories = [{
                                            id: tour.categoryId, 
                                            name: categoryName.ru || categoryName.en || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è'
                                        }];
                                        updateSelectedCategoriesDisplay();
                                    }
                                })
                                .catch(e => console.warn('Failed to load category for editing:', e));
                        }
                        
                        // –£–î–ê–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ eTourCategoryId (–ø–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ)
                        
                        const tourBlockIdElement = document.getElementById('tourBlockId');
                        if (tourBlockIdElement) {
                            tourBlockIdElement.value = tour.tourBlockId || '';
                        }
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω—ã –∏ –≥–æ—Ä–æ–¥–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
                        if (tour.country) {
                            setTimeout(() => {
                                const tourCountry = document.getElementById('tourCountry');
                                if (tourCountry) {
                                    tourCountry.value = tour.country;
                                    
                                    // –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç—Ä–∞–Ω—ã –∑–∞–≥—Ä—É–∂–∞–µ–º –≥–æ—Ä–æ–¥–∞
                                    if (tour.city) {
                                        loadCitiesForCountry(tour.country, 'tourCity').then(() => {
                                            setTimeout(() => {
                                                const tourCity = document.getElementById('tourCity');
                                                if (tourCity) {
                                                    tourCity.value = tour.city;
                                                }
                                            }, 200);
                                        });
                                    }
                                }
                            }, 700); // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω
                        }
                        
                        const tourDurationDays = document.getElementById('tourDurationDays');
                        if (tourDurationDays) {
                            tourDurationDays.value = tour.durationDays || '';
                        }
                        
                        // –£–î–ê–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ eTourDurationDays (–ø–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ)
                        
                        const tourPrice = document.getElementById('tourPrice');
                        if (tourPrice) {
                            tourPrice.value = tour.price || '';
                        }
                        
                        // Load pricing components for editing
                        if (tour.pricingData) {
                            try {
                                const components = typeof tour.pricingData === 'string' 
                                    ? JSON.parse(tour.pricingData) 
                                    : tour.pricingData;
                                
                                // Wait for components to be loaded, then populate selections
                                setTimeout(() => {
                                    loadTourPricingComponentsForEdit(components);
                                }, 500);
                                
                            } catch (e) {
                                console.warn('Failed to parse pricing components:', e);
                            }
                        }
                        
                        const tourPriceTypeElement = document.getElementById('tourPriceType');
                        if (tourPriceTypeElement) {
                            tourPriceTypeElement.value = tour.priceType || '–∑–∞ —á–µ–ª–æ–≤–µ–∫–∞';
                        }
                        
                        const tourPickupInfoElement = document.getElementById('tourPickupInfo');
                        if (tourPickupInfoElement) {
                            tourPickupInfoElement.value = tour.pickupInfo || '';
                        }
                        
                        
                        const tourMinPeopleElement = document.getElementById('tourMinPeople');
                        if (tourMinPeopleElement) {
                            tourMinPeopleElement.value = tour.minPeople || '';
                        }
                        
                        const tourMaxPeopleElement = document.getElementById('tourMaxPeople');
                        if (tourMaxPeopleElement) {
                            tourMaxPeopleElement.value = tour.maxPeople || '';
                        }
                        
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ª–æ–∂–Ω—ã–µ –ø–æ–ª—è (–º–∞—Å—Å–∏–≤—ã)
                        if (tour.services || tour.highlights) {
                            try {
                                const services = tour.services ? (typeof tour.services === 'string' ? JSON.parse(tour.services) : tour.services) 
                                                              : (tour.highlights ? (typeof tour.highlights === 'string' ? JSON.parse(tour.highlights) : tour.highlights) : []);
                                // –í—ã–±–∏—Ä–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —á–µ–∫–±–æ–∫—Å—ã —É—Å–ª—É–≥
                                selectTourServices(services);
                            } catch (e) {
                                console.warn('Failed to parse services:', e);
                            }
                        }
                        
                        if (tour.itinerary) {
                            try {
                                const itinerary = typeof tour.itinerary === 'string' ? JSON.parse(tour.itinerary) : tour.itinerary;
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö: —Å—Ç–∞—Ä—ã–π (–º–∞—Å—Å–∏–≤) –∏–ª–∏ –Ω–æ–≤—ã–π (–æ–±—ä–µ–∫—Ç –ø–æ –¥–Ω—è–º)
                                if (Array.isArray(itinerary)) {
                                    // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≤ –î–µ–Ω—å 1
                                    window.tourDaysItinerary = { 1: itinerary };
                                } else if (itinerary && typeof itinerary === 'object') {
                                    // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: —É–∂–µ –æ–±—ä–µ–∫—Ç –ø–æ –¥–Ω—è–º
                                    window.tourDaysItinerary = itinerary;
                                } else {
                                    window.tourDaysItinerary = { 1: [] };
                                }
                                
                                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
                                initializeDayProgram();
                            } catch (e) {
                                console.warn('Failed to parse itinerary:', e);
                                window.tourDaysItinerary = { 1: [] };
                                initializeDayProgram();
                            }
                        } else {
                            window.tourDaysItinerary = { 1: [] };
                            initializeDayProgram();
                        }
                        
                        if (tour.startTimeOptions) {
                            try {
                                const startTimes = typeof tour.startTimeOptions === 'string' ? JSON.parse(tour.startTimeOptions) : tour.startTimeOptions;
                                window.tourStartTimes = startTimes || [];
                                updateStartTimesList();
                            } catch (e) {
                                console.warn('Failed to parse start times:', e);
                            }
                        }
                        
                        if (tour.languages) {
                            try {
                                const languages = typeof tour.languages === 'string' ? JSON.parse(tour.languages) : tour.languages;
                                window.tourLanguages = languages || [];
                                updateSelectedLanguages();
                            } catch (e) {
                                console.warn('Failed to parse languages:', e);
                            }
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Å—è—Ü—ã –∏ –¥–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
                        if (tour.availableMonths) {
                            try {
                                const months = typeof tour.availableMonths === 'string' ? JSON.parse(tour.availableMonths) : tour.availableMonths;
                                months.forEach(month => {
                                    const checkbox = document.getElementById(`month-${month}`);
                                    if (checkbox) checkbox.checked = true;
                                });
                            } catch (e) {
                                console.warn('Failed to parse available months:', e);
                            }
                        }
                        
                        if (tour.availableDays) {
                            try {
                                const days = typeof tour.availableDays === 'string' ? JSON.parse(tour.availableDays) : tour.availableDays;
                                days.forEach(day => {
                                    const checkbox = document.getElementById(`day-${day}`);
                                    if (checkbox) checkbox.checked = true;
                                });
                            } catch (e) {
                                console.warn('Failed to parse available days:', e);
                            }
                        }
                        // –£–î–ê–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ eTourPriceType (–ø–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ)
                        // –£–î–ê–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ eTourPickupInfo (–ø–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ)
                        
                        // –£–î–ê–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ eTourFullDesc (–ø–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ)
                        
                        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —è–∑—ã–∫–æ–≤
                        let languages = '';
                        if (tour.languages) {
                            try {
                                const langArray = JSON.parse(tour.languages);
                                languages = langArray.join(', ');
                            } catch (e) {
                                languages = tour.languages;
                            }
                        }
                        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ —è–∑—ã–∫–æ–≤ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã
                        const tourLanguagesField = document.getElementById('tourLanguages');
                        if (tourLanguagesField) {
                            tourLanguagesField.value = languages;
                        }
                        
                        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–∞ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Ä–µ–º–µ–Ω –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–∞
                        if (tour.startTimeOptions) {
                            try {
                                const startTimes = typeof tour.startTimeOptions === 'string' ? JSON.parse(tour.startTimeOptions) : tour.startTimeOptions;
                                window.tourStartTimes = startTimes || [];
                                updateStartTimesList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–µ
                            } catch (e) {
                                console.warn('Failed to parse start times:', e);
                                window.tourStartTimes = [];
                            }
                        }
                        
                        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª–µ–π –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã
                        
                        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ minPeople –∏ maxPeople –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–µ
                        const tourMinPeopleField = document.getElementById('tourMinPeople');
                        if (tourMinPeopleField && tour.minPeople) {
                            tourMinPeopleField.value = tour.minPeople.toString();
                        }
                        
                        const tourMaxPeopleField = document.getElementById('tourMaxPeople');
                        if (tourMaxPeopleField && tour.maxPeople) {
                            tourMaxPeopleField.value = tour.maxPeople.toString();
                        }
                        
                        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ tourBlockId –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–µ
                        const tourBlockIdField = document.getElementById('tourBlockId');
                        if (tourBlockIdField && tour.tourBlockId) {
                            tourBlockIdField.value = tour.tourBlockId.toString();
                        }
                        
                        // üéØ –î–û–ë–ê–í–õ–ï–ù–û: –û—Ç–º–µ—á–∞–µ–º —É–∂–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Ç—É—Ä–æ–≤ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
                        setTimeout(() => {
                            if (tour.tourBlockAssignments && Array.isArray(tour.tourBlockAssignments)) {
                                console.log('üîÑ –û—Ç–º–µ—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Ç—É—Ä–æ–≤:', tour.tourBlockAssignments);
                                const selectedBlockIds = tour.tourBlockAssignments.map(assignment => assignment.tourBlockId);
                                
                                selectedBlockIds.forEach(blockId => {
                                    const checkbox = document.querySelector(`input[name="tourBlocks"][value="${blockId}"]`);
                                    if (checkbox) {
                                        checkbox.checked = true;
                                        console.log('‚úÖ –ë–ª–æ–∫ —Ç—É—Ä–∞ –æ—Ç–º–µ—á–µ–Ω:', blockId);
                                    }
                                });
                                
                                console.log('‚úÖ –í—Å–µ –±–ª–æ–∫–∏ —Ç—É—Ä–æ–≤ –æ—Ç–º–µ—á–µ–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                            }
                        }, 800); // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–æ–≤ —Ç—É—Ä–æ–≤
                        
                        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ pickupInfo –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–µ
                        const tourPickupInfoField = document.getElementById('tourPickupInfo');
                        if (tourPickupInfoField && tour.pickupInfo) {
                            tourPickupInfoField.value = tour.pickupInfo;
                        }
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ç—É—Ä–∞ –∏–∑ services (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
                        if (tour.services) {
                            try {
                                const services = typeof tour.services === 'string' ? JSON.parse(tour.services) : tour.services;
                                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Ü–µ–Ω
                                setTimeout(() => {
                                    loadTourPricingComponentsForEdit(services);
                                }, 600); // –ù–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                            } catch (e) {
                                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ services:', e);
                            }
                        }
                        // Fallback –∫ highlights –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Ç—É—Ä–æ–≤
                        else if (tour.highlights) {
                            try {
                                const highlights = typeof tour.highlights === 'string' ? JSON.parse(tour.highlights) : tour.highlights;
                                setTimeout(() => selectTourServices(highlights), 500);
                            } catch (e) {
                                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ highlights:', e);
                            }
                        }
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ (itinerary)
                        window.tourItinerary = [];
                        if (tour.itinerary) {
                            try {
                                window.tourItinerary = typeof tour.itinerary === 'string' ? JSON.parse(tour.itinerary) : tour.itinerary;
                            } catch (e) {
                                console.warn('Failed to parse itinerary:', e);
                                window.tourItinerary = [];
                            }
                        }
                        try {
                            updateItineraryList();
                        } catch (e) {
                            console.error('‚ùå Failed to update itinerary list:', e);
                        }
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
                        if (tour.availableMonths) {
                            try {
                                const availableMonths = typeof tour.availableMonths === 'string' ? JSON.parse(tour.availableMonths) : tour.availableMonths;
                                // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤
                                for (let i = 1; i <= 12; i++) {
                                    const checkbox = document.getElementById(`month-${i}`);
                                    if (checkbox) checkbox.checked = false;
                                }
                                // –í—ã–¥–µ–ª—è–µ–º –Ω—É–∂–Ω—ã–µ –º–µ—Å—è—Ü—ã
                                availableMonths.forEach(month => {
                                    const checkbox = document.getElementById(`month-${month}`);
                                    if (checkbox) {
                                        checkbox.checked = true;
                                    }
                                });
                            } catch (e) {
                                console.warn('Failed to parse availableMonths:', e);
                            }
                        }
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ –¥–Ω—è–º –º–µ—Å—è—Ü–∞
                        if (tour.availableDays) {
                            try {
                                const availableDays = typeof tour.availableDays === 'string' ? JSON.parse(tour.availableDays) : tour.availableDays;
                                // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –¥–Ω–µ–π –º–µ—Å—è—Ü–∞
                                for (let i = 1; i <= 31; i++) {
                                    const checkbox = document.getElementById(`day-${i}`);
                                    if (checkbox) checkbox.checked = false;
                                }
                                // –í—ã–¥–µ–ª—è–µ–º –Ω—É–∂–Ω—ã–µ –¥–Ω–∏ –º–µ—Å—è—Ü–∞
                                availableDays.forEach(day => {
                                    const checkbox = document.getElementById(`day-${day}`);
                                    if (checkbox) {
                                        checkbox.checked = true;
                                    }
                                });
                            } catch (e) {
                                console.warn('Failed to parse availableDays:', e);
                            }
                        }
                        
                        // –£–î–ê–õ–ï–ù–û: –¥—É–±–ª–∏—Ä—É—é—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–±–ª–æ–∫–∞ (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—ã—à–µ)
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        const tourMainImageField = document.getElementById('tourMainImage');
                        if (tourMainImageField && tour.mainImage) {
                            tourMainImageField.value = tour.mainImage;
                        }
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–∞–ª–µ—Ä–µ–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                        window.tourGalleryImages = [];
                        if (tour.images) {
                            try {
                                window.tourGalleryImages = typeof tour.images === 'string' ? JSON.parse(tour.images) : tour.images;
                            } catch (e) {
                                console.warn('Failed to parse gallery images:', e);
                                window.tourGalleryImages = [];
                            }
                        }
                        try {
                            updateGalleryImagesList();
                            
                            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥–∞–ª–µ—Ä–µ–∏
                            const galleryContainer = document.getElementById('galleryImagesList');
                            if (galleryContainer) {
                                if (window.tourGalleryImages && window.tourGalleryImages.length > 0) {
                                } else {
                                }
                            } else {
                                console.error('‚ùå Element galleryImagesList container not found');
                            }
                        } catch (e) {
                            console.error('‚ùå Failed to update gallery images list:', e);
                        }
                        
                        // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π –∏ –≥–∏–¥–æ–≤
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª–µ–π
                        if (tour.tourHotels && Array.isArray(tour.tourHotels)) {
                            tour.tourHotels.forEach(tourHotel => {
                                const hotelId = tourHotel.hotelId;
                                const checkbox = document.querySelector(`input[name="selectedHotels"][value="${hotelId}"]`);
                                if (checkbox) {
                                    checkbox.checked = true;
                                } else {
                                    console.warn('‚ùå Hotel checkbox not found for:', hotelId);
                                }
                            });
                        } else {
                            console.log('‚ùå No tourHotels found or not array:', tour.tourHotels);
                        }
                        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≥–∏–¥–æ–≤
                        if (tour.tourGuides && Array.isArray(tour.tourGuides)) {
                            tour.tourGuides.forEach(tourGuide => {
                                const guideId = tourGuide.guideId;
                                const checkbox = document.querySelector(`input[name="selectedGuides"][value="${guideId}"]`);
                                if (checkbox) {
                                    checkbox.checked = true;
                                } else {
                                    console.warn('‚ùå Guide checkbox not found for:', guideId);
                                }
                            });
                        } else {
                            console.log('‚ùå No tourGuides found or not array:', tour.tourGuides);
                        }
                        
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
                        if (tour.excluded) {
                            try {
                                const excludedServices = typeof tour.excluded === 'string' 
                                    ? JSON.parse(tour.excluded) 
                                    : tour.excluded;
                                
                                if (Array.isArray(excludedServices)) {
                                    const excludedContainer = document.getElementById('excludedOptions');
                                    const placeholder = document.getElementById('excludedPlaceholder');
                                    
                                    if (placeholder) placeholder.style.display = 'none';
                                    
                                    excludedServices.forEach(service => {
                                        const newCheckbox = document.createElement('label');
                                        newCheckbox.className = 'checkbox-item';
                                        newCheckbox.innerHTML = `
                                            <input type="checkbox" value="${service}" checked> ${service}
                                            <button type="button" onclick="removeExcludedService(this)" class="ml-2 text-red-500 hover:text-red-700">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        `;
                                        excludedContainer.appendChild(newCheckbox);
                                    });
                                    
                                }
                            } catch (e) {
                                console.warn('Failed to parse excluded services:', e);
                            }
                        }
                        
                        console.log('üîç Final currentTourId check:', currentTourId, 'window.currentTourId:', window.currentTourId);
                        
                    })
                    .catch(err => {
                        console.error('‚ùå Error loading tour data:', err);
                        console.error('‚ùå Error stack:', err.stack);
                        console.error('‚ùå Error message:', err.message);
                        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç—É—Ä–∞: ' + err.message);
                    });
            }
        }
        
        // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã tourForm
        function saveTourForm() {
            // –ü–æ–ª—É—á–∞–µ–º ID —Ç—É—Ä–∞ –∏–∑ —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è
            const tourId = document.getElementById('tour-id').value;
            const isEditing = tourId && tourId.trim() !== '';
            
            console.log('üíæ Saving tour:', { tourId, isEditing });
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            const titleRuValue = document.getElementById('tourTitleRu').value;
            const titleEnValue = document.getElementById('tourTitleEn').value;
            
            const categoryValue = document.getElementById('tourCategory').value;
            const priceValue = document.getElementById('tourPrice').value;
            const durationDaysValue = document.getElementById('tourDurationDays').value;
            
            if (!titleRuValue || titleRuValue.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ');
                return;
            }
            
            if (!categoryValue || categoryValue === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç—É—Ä–∞');
                return;
            }
            
            if (!priceValue || isNaN(parseFloat(priceValue))) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç—É—Ä–∞');
                return;
            }
            
            if (!durationDaysValue || isNaN(parseInt(durationDaysValue))) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—É—Ä–∞ –≤ –¥–Ω—è—Ö');
                return;
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏
            const selectedHotels = [];
            document.querySelectorAll('input[name="selectedHotels"]:checked').forEach(checkbox => {
                selectedHotels.push(parseInt(checkbox.value));
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≥–∏–¥–æ–≤
            const selectedGuides = [];
            document.querySelectorAll('input[name="selectedGuides"]:checked').forEach(checkbox => {
                selectedGuides.push(parseInt(checkbox.value));
            });
            
            // üéØ –î–û–ë–ê–í–õ–ï–ù–û: –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Ç—É—Ä–æ–≤
            const selectedTourBlocks = [];
            document.querySelectorAll('input[name="tourBlocks"]:checked').forEach(checkbox => {
                selectedTourBlocks.push(parseInt(checkbox.value));
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
            const excludedServices = [];
            document.querySelectorAll('#excludedOptions input[type="checkbox"]:checked').forEach(checkbox => {
                excludedServices.push(checkbox.value);
            });
            
            // üéØ –î–û–ë–ê–í–õ–ï–ù–û: –°–æ–±–∏—Ä–∞–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
            const includedServices = [];
            document.querySelectorAll('#includesOptions input[type="checkbox"]:checked').forEach(checkbox => {
                includedServices.push(checkbox.value);
            });
            
            console.log('üè® Selected hotels:', selectedHotels);
            console.log('üë®‚Äçüè´ Selected guides:', selectedGuides);
            console.log('üì¶ Selected tour blocks:', selectedTourBlocks);
            console.log('‚ùå Excluded services:', excludedServices);
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
            const tourDescRuEl = document.getElementById('tourDescRu');
            const tourDescEnEl = document.getElementById('tourDescEn');
            const tourPriceTypeEl = document.getElementById('tourPriceType');
            const tourBlockIdEl = document.getElementById('tourBlockId');
            const tourCountryEl = document.getElementById('tourCountry');
            const tourCityEl = document.getElementById('tourCity');
            const tourTypeEl = document.getElementById('tourType');
            const tourPickupInfoEl = document.getElementById('tourPickupInfo');
            const tourMinPeopleEl = document.getElementById('tourMinPeople');
            const tourMaxPeopleEl = document.getElementById('tourMaxPeople');
            const tourMainImageEl = document.getElementById('tourMainImage');
            
            const formData = {
                title: JSON.stringify({
                    ru: titleRuValue,
                    en: titleEnValue || titleRuValue
                }),
                description: JSON.stringify({
                    ru: tourDescRuEl ? tourDescRuEl.value || '' : '',
                    en: tourDescEnEl ? tourDescEnEl.value || '' : ''
                }),
                price: String(priceValue),
                priceType: tourPriceTypeEl ? tourPriceTypeEl.value || '–∑–∞ —á–µ–ª–æ–≤–µ–∫–∞' : '–∑–∞ —á–µ–ª–æ–≤–µ–∫–∞',
                categoryId: categoryValue ? parseInt(categoryValue) : null,
                tourBlockId: tourBlockIdEl && tourBlockIdEl.value ? parseInt(tourBlockIdEl.value) : null,
                country: tourCountryEl && tourCountryEl.selectedIndex >= 0 && tourCountryEl.options[tourCountryEl.selectedIndex] ? tourCountryEl.options[tourCountryEl.selectedIndex].text : '',
                city: tourCityEl && tourCityEl.selectedIndex >= 0 && tourCityEl.options[tourCityEl.selectedIndex] ? tourCityEl.options[tourCityEl.selectedIndex].text : '',
                countryId: tourCountryEl && tourCountryEl.value ? parseInt(tourCountryEl.value) : null,
                cityId: tourCityEl && tourCityEl.value ? parseInt(tourCityEl.value) : null,
                // –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω –∏ –≥–æ—Ä–æ–¥–æ–≤
                countriesIds: safeGetValue('tourCountries', '[]') !== '[]' ? JSON.parse(safeGetValue('tourCountries', '[]')) : [],
                citiesIds: safeGetValue('tourCities', '[]') !== '[]' ? JSON.parse(safeGetValue('tourCities', '[]')) : [],
                durationDays: parseInt(durationDaysValue),
                duration: durationDaysValue.toString(),
                format: tourTypeEl ? tourTypeEl.value || '' : '',
                tourType: tourTypeEl ? tourTypeEl.value || '' : '',
                pickupInfo: tourPickupInfoEl ? tourPickupInfoEl.value || '' : '',
                minPeople: tourMinPeopleEl && tourMinPeopleEl.value ? parseInt(tourMinPeopleEl.value) : null,
                maxPeople: tourMaxPeopleEl && tourMaxPeopleEl.value ? parseInt(tourMaxPeopleEl.value) : null,
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—É—Ä–∞ –≤ –ø–æ–ª–µ services
                services: JSON.stringify(selectedTourComponents || []),
                itinerary: JSON.stringify(convertDaysItineraryToArray()), // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –º–∞—Å—Å–∏–≤
                startTimeOptions: JSON.stringify(window.tourStartTimes || []),
                languages: JSON.stringify(window.tourLanguages || ['–†—É—Å—Å–∫–∏–π']),
                availableMonths: JSON.stringify(getSelectedCheckboxValues('month-')),
                availableDays: JSON.stringify(getSelectedCheckboxValues('day-')),
                mainImage: tourMainImageEl ? tourMainImageEl.value || '' : '',
                images: JSON.stringify(window.tourGalleryImages || []),
                hotelIds: selectedHotels,
                guideIds: selectedGuides,
                tourBlockIds: selectedTourBlocks, // üéØ –î–û–ë–ê–í–õ–ï–ù–û: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Ç—É—Ä–æ–≤
                excluded: JSON.stringify(excludedServices),
                includes: JSON.stringify(includedServices), // üéØ –î–û–ë–ê–í–õ–ï–ù–û: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
                isActive: true,
                isFeatured: false
            };
            
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º URL –∏ –º–µ—Ç–æ–¥
            const url = isEditing ? `${getApiUrl()}/tours/${tourId}` : `${getApiUrl()}/tours`;
            const method = isEditing ? 'PUT' : 'POST';
            
            console.log('üöÄ Request:', { url, method, isEditing });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => {
                console.log('üåê HTTP Response status:', res.status, 'OK:', res.ok);
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                console.log('üì¨ Server response:', data);
                console.log('üîç Success check:', 'data.success =', data.success, 'Type:', typeof data.success);
                
                if (data.success === true) {
                    const message = isEditing ? '‚úÖ –¢—É—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!' : '‚úÖ –¢—É—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!';
                    alert(message);
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                    closeTourModal();
                    loadTours();
                } else {
                    console.log('‚ùå Error path triggered - data.success:', data.success);
                    const action = isEditing ? '–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏' : '—Å–æ–∑–¥–∞–Ω–∏–∏';
                    alert(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ ${action} —Ç—É—Ä–∞: ` + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('‚ùå Error saving tour:', err);
                console.error('‚ùå Error details:', err.message, err.stack);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + err.message);
            });
        }
        
        function closeTourModal() {
            document.getElementById('tourModal').classList.remove('active');
            document.getElementById('tourForm').reset();
            
            // Clear the uploader
            if (tourUploader) {
                tourUploader.clear('tour-uploader-container');
            }
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π uploader
            
            // –û—á–∏—â–∞–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ ID –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            document.getElementById('tour-id').value = '';
            currentTourId = null;
            window.currentTourId = null;
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            window.tourItinerary = [];
            window.tourGalleryImages = [];
            window.editStartTimes = [];
            window.tourStartTimes = [];
            window.tourLanguages = window.tourLanguages || [];
            window.tourImageURLs = [];
            
            // –û—á–∏—â–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã —É—Å–ª—É–≥
            const serviceCheckboxes = document.querySelectorAll('input[name="includedServices"]');
            serviceCheckboxes.forEach(checkbox => checkbox.checked = false);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ (–±–µ–∑ updateHighlightsList)
            updateItineraryList();
            updateGalleryImagesList();
            updateEditStartTimesList();
            updateStartTimesList();
            updateSelectedLanguages();
            
            // –û—á–∏—â–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
            for (let i = 1; i <= 12; i++) {
                const checkbox = document.getElementById(`month-${i}`);
                if (checkbox) checkbox.checked = false;
            }
            for (let i = 0; i <= 6; i++) {
                const checkbox = document.getElementById(`day-${i}`);
                if (checkbox) checkbox.checked = false;
            }
            
            console.log('üîí Modal closed and form reset');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ –∏ —Å–ø–∏—Å–∫–∞–º–∏
        function getSelectedCheckboxValues(prefix) {
            const checkboxes = document.querySelectorAll(`input[id^="${prefix}"]:checked`);
            return Array.from(checkboxes).map(cb => cb.id.replace(prefix, ''));
        }
        
        // –§—É–Ω–∫—Ü–∏—è updateHighlightsList —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —á–µ–∫–±–æ–∫—Å—ã —É—Å–ª—É–≥
        
        // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
        
        function updateStartTimesList() {
            const container = document.getElementById('startTimesList');
            if (!container) return;
            
            const startTimes = window.tourStartTimes || [];
            container.innerHTML = startTimes.map((time, index) => `
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                    <span>${time}</span>
                    <button type="button" onclick="removeStartTime(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        function updateSelectedLanguages() {
            const container = document.getElementById('selectedLanguages');
            if (!container) return;
            
            const languages = window.tourLanguages || [];
            if (languages.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                return;
            }
            
            container.innerHTML = (Array.isArray(languages) ? languages : []).map((language, index) => `
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                    <span>${language}</span>
                    <button type="button" onclick="removeLanguage(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏
        // –£–±—Ä–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è addHighlight - –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –≤—ã–±–æ—Ä —É—Å–ª—É–≥ –∏–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        
        // –§—É–Ω–∫—Ü–∏—è removeHighlight —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —á–µ–∫–±–æ–∫—Å—ã —É—Å–ª—É–≥
        
        
        function addStartTime() {
            const startTimeInput = document.getElementById('newStartTime');
            const value = startTimeInput.value;
            if (value) {
                window.tourStartTimes = window.tourStartTimes || [];
                window.tourStartTimes.push(value);
                startTimeInput.value = '';
                updateStartTimesList();
            }
        }
        
        function removeStartTime(index) {
            window.tourStartTimes.splice(index, 1);
            updateStartTimesList();
        }
        
        function addLanguageToTour() {
            const select = document.getElementById('availableLanguages');
            const language = select.value;
            if (language) {
                // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —ç—Ç–æ –º–∞—Å—Å–∏–≤
                if (!Array.isArray(window.tourLanguages)) {
                    window.tourLanguages = [];
                }
                if (!window.tourLanguages.includes(language)) {
                    window.tourLanguages.push(language);
                    updateSelectedLanguages();
                }
                select.value = '';
            }
        }
        
        function removeLanguage(index) {
            window.tourLanguages.splice(index, 1);
            updateSelectedLanguages();
        }
        
        function loadHotelsForCheckboxes() {
            fetch(`${getApiUrl()}/hotels?includeRaw=true`, {
                headers: getAuthHeaders()
            })
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    const container = document.getElementById('hotelCheckboxes');
                    if (!container) {
                        console.error('hotelCheckboxes container not found');
                        return;
                    }
                    
                    const hotels = data.data || data.hotels || [];
                    container.innerHTML = hotels.map(hotel => {
                        let name;
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º _localized –¥–∞–Ω–Ω—ã–µ –¥–ª—è checkboxes
                        if (hotel._localized && hotel._localized.name) {
                            name = { ru: hotel._localized.name, en: hotel._localized.name };
                        } else {
                            try {
                                name = typeof hotel.name === 'string' ? JSON.parse(hotel.name) : (hotel.name || {});
                            } catch (e) {
                                console.warn('Failed to parse hotel name in checkboxes:', hotel.name);
                                name = hotel.name || {};
                            }
                        }
                        return `
                            <label class="checkbox-item">
                                <input type="checkbox" name="selectedHotels" value="${hotel.id}"> ${name.ru || name.en || '–û—Ç–µ–ª—å'}
                            </label>
                        `;
                    }).join('');
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–µ–ª–µ–π –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤:', error);
                    const container = document.getElementById('hotelCheckboxes');
                    if (container) {
                        container.innerHTML = '<div class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–µ–ª–µ–π</div>';
                    }
                });
        }
        
        function loadGuidesForCheckboxes() {
            fetch(`${getApiUrl()}/guides`, {
                headers: getAuthHeaders()
            })
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    const container = document.getElementById('guideCheckboxes');
                    if (!container) {
                        console.error('guideCheckboxes container not found');
                        return;
                    }
                    
                    const guides = data.data || data.guides || [];
                    container.innerHTML = guides.map(guide => {
                        let displayName;
                        
                        // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–º–µ–Ω–∏ –≥–∏–¥–∞
                        if (typeof guide.name === 'string') {
                            // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–Ω–µ JSON), –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                            if (!guide.name.startsWith('{')) {
                                displayName = guide.name;
                            } else {
                                // –ï—Å–ª–∏ —ç—Ç–æ JSON —Å—Ç—Ä–æ–∫–∞, –ø–∞—Ä—Å–∏–º
                                try {
                                    const nameObj = JSON.parse(guide.name);
                                    displayName = nameObj.ru || nameObj.en || guide.name;
                                } catch(e) {
                                    displayName = guide.name;
                                }
                            }
                        } else if (typeof guide.name === 'object' && guide.name !== null) {
                            displayName = guide.name.ru || guide.name.en || '–ì–∏–¥';
                        } else {
                            displayName = '–ì–∏–¥';
                        }
                        
                        return `
                            <label class="checkbox-item">
                                <input type="checkbox" name="selectedGuides" value="${guide.id}"> ${displayName}
                            </label>
                        `;
                    }).join('');
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∏–¥–æ–≤ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤:', error);
                    console.error('Unhandled promise rejection:', error);
                    const container = document.getElementById('guideCheckboxes');
                    if (container) {
                        container.innerHTML = '<div class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∏–¥–æ–≤</div>';
                    } else {
                        console.error('guideCheckboxes container not found');
                    }
                });
        }
        
        
        // Categories functions
        function loadCategories() {
            fetch(`${getApiUrl()}/categories?includeRaw=true`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('categoriesTable');
                    const categories = data.data || data.categories || [];
                    if (categories.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = categories.map(category => {
                        // Extract Russian and English names
                        let nameRu = '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                        let nameEn = 'Untitled';
                        
                        if (category.name) {
                            if (typeof category.name === 'object' && category.name !== null) {
                                nameRu = category.name.ru || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                                nameEn = category.name.en || 'Untitled';
                            } else if (typeof category.name === 'string') {
                                try {
                                    const parsed = JSON.parse(category.name);
                                    nameRu = parsed.ru || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                                    nameEn = parsed.en || 'Untitled';
                                } catch (e) {
                                    nameRu = category.name;
                                    nameEn = category.name;
                                }
                            }
                        }
                        
                        // Remove tours count column for now (backend might not support it)
                        
                        // Get category type
                        const categoryType = category.type || 'tour';
                        const typeDisplay = categoryType === 'tour' ? 'üéØ –¢—É—Ä—ã' : 'üè® –û—Ç–µ–ª–∏';
                        
                        return `
                            <tr>
                                <td>${category.id}</td>
                                <td class="font-medium">${nameRu}</td>
                                <td class="font-medium">${nameEn}</td>
                                <td><span class="badge ${categoryType === 'tour' ? 'badge-info' : 'badge-success'}">${typeDisplay}</span></td>
                                <td>
                                    <button onclick="editCategory(${category.id})" class="text-blue-600 hover:text-blue-800 mr-2" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteCategory(${category.id})" class="text-red-600 hover:text-red-800" title="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                })
                .catch(err => {
                    console.error('Error loading categories:', err);
                    document.getElementById('categoriesTable').innerHTML = 
                        '<tr><td colspan="5" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                });
        }
        
        function openCategoryModal(categoryId = null) {
            const modal = document.getElementById('categoryModal');
            const modalTitle = document.getElementById('categoryModalTitle');
            const form = document.getElementById('categoryForm');
            
            if (categoryId) {
                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
                
                // Load category data for editing
                fetch(`${getApiUrl()}/categories/${categoryId}?includeRaw=true`, {
                    headers: getAuthHeaders()
                })
                    .then(res => res.json())
                    .then(data => {
                        const category = data.data || data.category;
                        if (category && category.name) {
                            document.getElementById('editCategoryId').value = categoryId;
                            
                            if (typeof category.name === 'object' && category.name !== null) {
                                document.getElementById('categoryNameRu').value = category.name.ru || '';
                                document.getElementById('categoryNameEn').value = category.name.en || '';
                            } else if (typeof category.name === 'string') {
                                try {
                                    const parsed = JSON.parse(category.name);
                                    document.getElementById('categoryNameRu').value = parsed.ru || '';
                                    document.getElementById('categoryNameEn').value = parsed.en || '';
                                } catch (e) {
                                    document.getElementById('categoryNameRu').value = category.name;
                                    document.getElementById('categoryNameEn').value = category.name;
                                }
                            }
                            
                            // Load category type
                            const categoryType = document.getElementById('categoryType');
                            if (categoryType) {
                                categoryType.value = category.type || 'tour';
                            }
                        }
                    })
                    .catch(err => {
                        console.error('Error loading category:', err);
                        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                    });
            } else {
                modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
                document.getElementById('editCategoryId').value = '';
                form.reset();
            }
            
            modal.style.display = 'flex';
        }
        
        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
            document.getElementById('categoryForm').reset();
            document.getElementById('editCategoryId').value = '';
            document.getElementById('categoryType').value = 'tour'; // Reset to default
        }
        
        function editCategory(id) {
            openCategoryModal(id);
        }
        
        function deleteCategory(id) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?')) {
                return;
            }
            
            fetch(`${getApiUrl()}/categories/${id}`, {
                method: 'DELETE',
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        loadCategories(); // Refresh the list
                        alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞');
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting category:', err);
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                });
        }
        
        // Handle category form submission
        document.addEventListener('DOMContentLoaded', function() {
            const categoryForm = document.getElementById('categoryForm');
            if (categoryForm) {
                categoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const categoryId = document.getElementById('editCategoryId').value;
                    const nameRu = document.getElementById('categoryNameRu').value.trim();
                    const nameEn = document.getElementById('categoryNameEn').value.trim();
                    const categoryType = document.getElementById('categoryType').value;
                    
                    if (!nameRu || !nameEn) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ –æ–±–æ–∏—Ö —è–∑—ã–∫–∞—Ö');
                        return;
                    }
                    
                    if (!categoryType) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                        return;
                    }
                    
                    const categoryData = {
                        name: {
                            ru: nameRu,
                            en: nameEn
                        },
                        type: categoryType
                    };
                    
                    const url = categoryId ? 
                        `${getApiUrl()}/categories/${categoryId}` : 
                        `${getApiUrl()}/categories`;
                    
                    const method = categoryId ? 'PUT' : 'POST';
                    
                    fetch(url, {
                        method: method,
                        headers: {
                            ...getAuthHeaders(),
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(categoryData)
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                closeCategoryModal();
                                loadCategories(); // Refresh the list
                                alert(categoryId ? '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞');
                            } else {
                                alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é'));
                            }
                        })
                        .catch(err => {
                            console.error('Error saving category:', err);
                            alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                        });
                });
            }
        });
        
        
        // Hotels functions
        // –£–¥–∞–ª–µ–Ω–æ: currentHotelId - –∏—Å–ø–æ–ª—å–∑—É–µ–º hotel-id
        
        // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        function validateImageUrl(url) {
            if (!url) return '';
            const urlStr = String(url).trim();
            // –¢–æ–ª—å–∫–æ https –∏ root-relative URLs –¥–ª—è production –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            if (urlStr.startsWith('https://') || urlStr.startsWith('/')) {
                return urlStr;
            }
            return '';
        }
        
        function validateHttpUrl(url) {
            if (!url) return '';
            const urlStr = String(url).trim();
            // –¢–æ–ª—å–∫–æ https URLs –¥–ª—è website links
            if (urlStr.startsWith('https://')) {
                return urlStr;
            }
            return '';
        }
        
        function ensureArray(value) {
            if (Array.isArray(value)) return value;
            if (!value) return [];
            if (typeof value === 'string') {
                try {
                    const parsed = JSON.parse(value);
                    return Array.isArray(parsed) ? parsed : [];
                } catch (e) {
                    // –§–æ–ª–ª–±—ç–∫ –Ω–∞ CSV –ø–∞—Ä—Å–∏–Ω–≥
                    return value.split(',').map(item => item.trim()).filter(item => item);
                }
            }
            return [];
        }
        
        function getLocalizedField(item, field, fallback = '', currentLocale = 'ru') {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º _localized –ø–æ–ª–µ
            if (item._localized && item._localized[field]) {
                const localized = item._localized[field];
                if (typeof localized === 'object' && localized) {
                    return String(localized[currentLocale] || localized.ru || localized.en || fallback);
                }
                return String(localized);
            }
            
            // –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ–º—Å—è –ø–∞—Ä—Å–∏—Ç—å JSON –æ–±—ä–µ–∫—Ç
            const rawField = item[field];
            if (typeof rawField === 'string') {
                try {
                    const parsed = JSON.parse(rawField);
                    if (typeof parsed === 'object' && parsed) {
                        return String(parsed[currentLocale] || parsed.ru || parsed.en || fallback);
                    }
                } catch (e) {
                    // –ï—Å–ª–∏ –Ω–µ JSON, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    return String(rawField || fallback);
                }
            } else if (typeof rawField === 'object' && rawField) {
                return String(rawField[currentLocale] || rawField.ru || rawField.en || fallback);
            }
            
            return String(rawField || fallback);
        }
        
        function loadHotels() {
            console.log('Loading hotels...');
            const apiUrl = getApiUrl();
            fetch(`${apiUrl}/hotels?includeRaw=true`, {
                headers: getAuthHeaders()
            })
                .then(res => {
                    console.log('Hotels response:', res.status);
                    return res.json();
                })
                .then(data => {
                    console.log('Hotels data:', data);
                    const container = document.getElementById('hotelsList');
                    if (!data.success || !data.data || data.data.length === 0) {
                        container.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500">–ù–µ—Ç –æ—Ç–µ–ª–µ–π</div>';
                        return;
                    }
                    
                    // –ë–ï–ó–û–ü–ê–°–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
                    container.innerHTML = data.data.map(hotel => {
                        const hotelName = escapeHtml(getLocalizedField(hotel, 'name', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'));
                        const hotelDesc = escapeHtml(getLocalizedField(hotel, 'description', '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'));
                        const hotelAddress = escapeHtml(getLocalizedField(hotel, 'address', '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'));
                        const images = ensureArray(hotel.images);
                        const amenities = ensureArray(hotel.amenities);
                        const mainImageUrl = images.length > 0 ? validateImageUrl(images[0]) : '';
                        
                        return `
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow">
                                ${mainImageUrl ? `
                                    <div class="h-48 overflow-hidden">
                                        <img src="${getAbsoluteImageUrl(mainImageUrl)}" alt="${hotelName}" class="w-full h-full object-cover">
                                    </div>
                                ` : ''}
                                <div class="p-6">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 text-lg mb-1">${hotelName}</h3>
                                            <p class="text-sm text-gray-600 mb-2">${hotelAddress}</p>
                                            <div class="flex items-center mb-3">
                                                <span class="text-yellow-400 mr-1">‚òÖ</span>
                                                <span class="text-sm font-medium">${hotel.stars || 0} –∑–≤–µ–∑–¥</span>
                                                <span class="mx-2 text-gray-300">‚Ä¢</span>
                                                <span class="text-sm text-gray-600">${escapeHtml(hotel.categoryTranslated || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞')}</span>
                                            </div>
                                        </div>
                                        <span class="px-2 py-1 text-xs rounded-full ${hotel.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                            ${hotel.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                                        </span>
                                    </div>
                                    
                                    <p class="text-sm text-gray-700 mb-4 line-clamp-2">${hotelDesc}</p>
                                    
                                    ${amenities && amenities.length > 0 ? `
                                        <div class="mb-4">
                                            <div class="flex flex-wrap gap-1">
                                                ${amenities.slice(0, 3).map(amenity => `
                                                    <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${escapeHtml(amenity)}</span>
                                                `).join('')}
                                                ${amenities.length > 3 ? `
                                                    <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">+${amenities.length - 3}</span>
                                                ` : ''}
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="flex justify-between items-center">
                                        <button onclick="editHotel(${hotel.id})" class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit mr-1"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </button>
                                        <button onclick="deleteHotel(${hotel.id})" class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash mr-1"></i> –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                })
                .catch(err => {
                    console.error('Error loading hotels:', err);
                    document.getElementById('hotelsList').innerHTML = 
                        '<div class="col-span-full text-center py-12 text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + err.message + '</div>';
                });
        }
        
        function openHotelModal(hotelId = null) {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã
            loadCountriesForSelect('hotelCountry');
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ hotel-id –≤–º–µ—Å—Ç–æ currentHotelId
            document.getElementById('hotel-id').value = hotelId;
            window.hotelImageURLs = [];
            document.getElementById('hotelModal').classList.add('active');
            
            // Reset the hidden input
            document.getElementById('hotelImages').value = '';
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            updateHotelImagesList();
            
            // Initialize the uploader
            setTimeout(() => {
                initializeHotelUploader();
            }, 100);
            
            if (hotelId) {
                document.getElementById('hotelModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–µ–ª—å';
                loadHotelData(hotelId);
            } else {
                document.getElementById('hotelModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–µ–ª—å';
                document.getElementById('hotelForm').reset();
                clearRoomTypeFields(); // –ù–û–í–û–ï: –û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ—Ç–µ–ª—è
                if (hotelUploader) {
                    hotelUploader.clear('hotel-uploader-container');
                }
            }
        }
        
        function closeHotelModal() {
            document.getElementById('hotelModal').classList.remove('active');
            document.getElementById('hotelForm').reset();
            if (hotelUploader) {
                hotelUploader.clear('hotel-uploader-container');
            }
            window.hotelImageURLs = [];
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –æ—á–∏—Å—Ç–∫–∞ hotel-id –≤–º–µ—Å—Ç–æ currentHotelId
            document.getElementById('hotel-id').value = '';
            
            // Reset the hidden input
            document.getElementById('hotelImages').value = '';
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            updateHotelImagesList();
            
            // –ù–û–í–û–ï: –û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ–º–µ—Ä–æ–≤ –∏ —Ç–∏–ø—ã –ø–∏—Ç–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∞
            clearRoomTypeFields();
        }
        
        // –ù–û–í–û–ï: –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–æ–º–µ—Ä–æ–≤
        function clearRoomTypeFields() {
            document.getElementById('roomSGL').checked = false;
            document.getElementById('roomTWL').checked = false;
            document.getElementById('roomDBL').checked = false;
            document.getElementById('priceSGL').value = '';
            document.getElementById('priceTWL').value = '';
            document.getElementById('priceDBL').value = '';
            document.getElementById('priceSGL').disabled = true;
            document.getElementById('priceTWL').disabled = true;
            document.getElementById('priceDBL').disabled = true;
        }
        
        
        function loadHotelData(hotelId) {
            const apiUrl = getApiUrl();
            fetch(`${apiUrl}/hotels/${hotelId}?includeRaw=true`, {
                headers: getAuthHeaders()  // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!
            })
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    const hotel = data.data;
                    
                    // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ JSON
                    let name, description, amenities;
                    try {
                        name = typeof hotel.name === 'string' ? JSON.parse(hotel.name) : (hotel.name || {});
                    } catch (e) {
                        console.warn('Failed to parse hotel name, using as object:', hotel.name);
                        name = hotel.name || {};
                    }
                    
                    try {
                        description = typeof hotel.description === 'string' ? JSON.parse(hotel.description) : (hotel.description || {});
                    } catch (e) {
                        console.warn('Failed to parse hotel description, using as object:', hotel.description);
                        description = hotel.description || {};
                    }
                    
                    try {
                        amenities = typeof hotel.amenities === 'string' ? JSON.parse(hotel.amenities) : (hotel.amenities || []);
                    } catch (e) {
                        console.warn('Failed to parse hotel amenities, using as array:', hotel.amenities);
                        amenities = Array.isArray(hotel.amenities) ? hotel.amenities : [];
                    }
                    
                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã—Ö –ø–æ–ª–µ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    
                    // –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è (—Ä—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
                    const hotelNameRu = document.getElementById('hotelNameRu');
                    const hotelNameEn = document.getElementById('hotelNameEn');
                    
                    if (hotelNameRu) {
                        hotelNameRu.value = name.ru || '';
                    }
                    if (hotelNameEn) {
                        hotelNameEn.value = name.en || '';
                    }
                    
                    // –û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–µ–ª—è (—Ä—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
                    const hotelDescRu = document.getElementById('hotelDescRu');
                    const hotelDescEn = document.getElementById('hotelDescEn');
                    
                    if (hotelDescRu) {
                        hotelDescRu.value = description.ru || '';
                    }
                    if (hotelDescEn) {
                        hotelDescEn.value = description.en || '';
                    }
                    
                    // –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–æ–º–µ—Ä–æ–≤ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
                    if (hotel.roomTypes) {
                        try {
                            const roomTypes = typeof hotel.roomTypes === 'string' ? JSON.parse(hotel.roomTypes) : hotel.roomTypes;
                            
                            // SGL - –û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π
                            if (roomTypes.SGL) {
                                document.getElementById('roomSGL').checked = true;
                                document.getElementById('priceSGL').disabled = false;
                                document.getElementById('priceSGL').value = roomTypes.SGL.price || '';
                            }
                            
                            // TWL - –î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π
                            if (roomTypes.TWL) {
                                document.getElementById('roomTWL').checked = true;
                                document.getElementById('priceTWL').disabled = false;
                                document.getElementById('priceTWL').value = roomTypes.TWL.price || '';
                            }
                            
                            // DBL - –î–≤—É—Ö—Å–ø–∞–ª—å–Ω—ã–π
                            if (roomTypes.DBL) {
                                document.getElementById('roomDBL').checked = true;
                                document.getElementById('priceDBL').disabled = false;
                                document.getElementById('priceDBL').value = roomTypes.DBL.price || '';
                            }
                        } catch (e) {
                            console.warn('Failed to parse room types:', hotel.roomTypes, e);
                        }
                    }
                    
                    // –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
                    if (hotel.mealTypes) {
                        try {
                            const mealTypes = typeof hotel.mealTypes === 'string' ? JSON.parse(hotel.mealTypes) : hotel.mealTypes;
                            
                            // RO - –ë–µ–∑ –ø–∏—Ç–∞–Ω–∏—è
                            if (mealTypes.RO) {
                                document.getElementById('mealRO').checked = true;
                                document.getElementById('priceMealRO').disabled = false;
                                document.getElementById('priceMealRO').value = mealTypes.RO.price || '';
                            }
                            
                            // BB - –ó–∞–≤—Ç—Ä–∞–∫
                            if (mealTypes.BB) {
                                document.getElementById('mealBB').checked = true;
                                document.getElementById('priceMealBB').disabled = false;
                                document.getElementById('priceMealBB').value = mealTypes.BB.price || '';
                            }
                            
                            // HB - –ü–æ–ª—É–ø–∞–Ω—Å–∏–æ–Ω
                            if (mealTypes.HB) {
                                document.getElementById('mealHB').checked = true;
                                document.getElementById('priceMealHB').disabled = false;
                                document.getElementById('priceMealHB').value = mealTypes.HB.price || '';
                            }
                            
                            // FB - –ü–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω
                            if (mealTypes.FB) {
                                document.getElementById('mealFB').checked = true;
                                document.getElementById('priceMealFB').disabled = false;
                                document.getElementById('priceMealFB').value = mealTypes.FB.price || '';
                            }
                            
                            // AI - –í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ
                            if (mealTypes.AI) {
                                document.getElementById('mealAI').checked = true;
                                document.getElementById('priceMealAI').disabled = false;
                                document.getElementById('priceMealAI').value = mealTypes.AI.price || '';
                            }
                        } catch (e) {
                            console.warn('Failed to parse meal types:', hotel.mealTypes, e);
                        }
                    }
                    const addressField = document.getElementById('hotelAddress');
                    const starsField = document.getElementById('hotelStars');
                    
                    if (addressField) {
                        addressField.value = hotel.address || '';
                    }
                    
                    if (starsField) {
                        starsField.value = hotel.stars || '';
                    }
                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–µ–Ω–¥–∞ —Å —É—á–µ—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
                    const brandSelect = document.getElementById('hotelBrand');
                    const brandCustom = document.getElementById('hotelBrandCustom');
                    
                    if (hotel.brand) {
                        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –±—Ä–µ–Ω–¥ –≤ —Å–ø–∏—Å–∫–µ
                        const brandOption = Array.from(brandSelect.options).find(option => option.value === hotel.brand);
                        if (brandOption) {
                            brandSelect.value = hotel.brand;
                            brandCustom.style.display = 'none';
                        } else {
                            // –ë—Ä–µ–Ω–¥ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥
                            brandSelect.value = 'custom';
                            brandCustom.value = hotel.brand;
                            brandCustom.style.display = 'block';
                        }
                    } else {
                        brandSelect.value = '';
                        brandCustom.style.display = 'none';
                    }
                    const categoryField = document.getElementById('hotelCategory');
                    if (categoryField) categoryField.value = hotel.category || '';
                    
                    const countryField = document.getElementById('hotelCountry');
                    if (countryField) countryField.value = hotel.countryId || '';
                    
                    const cityField = document.getElementById('hotelCity');
                    if (cityField) cityField.value = hotel.cityId || '';
                    
                    // –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ countryId, –∑–∞–≥—Ä—É–∂–∞–µ–º –≥–æ—Ä–æ–¥–∞ –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω—ã
                    if (hotel.countryId) {
                        loadCitiesForCountry(hotel.countryId, 'hotelCity').then(() => {
                            // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cityId
                            if (hotel.cityId && cityField) {
                                cityField.value = hotel.cityId;
                            }
                        });
                    }
                    
                    const pensionField = document.getElementById('hotelPension');
                    if (pensionField) pensionField.value = hotel.pension || 'none';
                    const hotelActiveField = document.getElementById('hotelActive');
                    if (hotelActiveField) {
                        hotelActiveField.checked = hotel.isActive;
                    } else {
                        console.warn('‚ùå hotelActive field not found');
                    }
                    
                    // Set amenities - —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ amenities –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
                    if (amenities && Array.isArray(amenities)) {
                        document.querySelectorAll('#hotelForm input[type="checkbox"]').forEach(checkbox => {
                            if (checkbox.id !== 'hotelActive') {
                                checkbox.checked = amenities.includes(checkbox.value);
                                if (checkbox.checked) {
                                }
                            }
                        });
                    } else {
                        console.warn('‚ùå Amenities not loaded properly:', amenities);
                    }
                    
                    // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç–µ–ª—è
                    if (hotel.images) {
                        try {
                            const images = typeof hotel.images === 'string' ? JSON.parse(hotel.images) : hotel.images;
                            if (Array.isArray(images) && images.length > 0) {
                                window.hotelImageURLs = [...images]; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                document.getElementById('hotelImages').value = JSON.stringify(images); // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ
                                
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                                updateHotelImagesList();  
                                setTimeout(() => {
                                    const uploaderContainer = document.getElementById('hotel-uploader-container');
                                    if (uploaderContainer) {
                                        let imagesHtml = '<div class="uploaded-images-preview mb-3"><h4 class="text-sm font-semibold mb-2">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</h4><div class="flex gap-2 flex-wrap">';
                                        images.forEach((img, index) => {
                                            imagesHtml += `<div class="image-preview-item relative">
                                                <img src="${getAbsoluteImageUrl(img)}" data-image-placeholder="hotel-gallery" alt="Hotel image" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                                                <div class="text-xs text-gray-500 text-center mt-1">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}</div>
                                            </div>`;
                                        });
                                        imagesHtml += '</div></div>';
                                        uploaderContainer.insertAdjacentHTML('afterbegin', imagesHtml);
                                    }
                                }, 500); // –ó–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã uploader —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
                            } else {
                                window.hotelImageURLs = [];
                                document.getElementById('hotelImages').value = '';
                            }
                        } catch (e) {
                            console.error('Error parsing hotel images:', e);
                            window.hotelImageURLs = [];
                            document.getElementById('hotelImages').value = '';
                        }
                    } else {
                        window.hotelImageURLs = [];
                        document.getElementById('hotelImages').value = '';
                    }
                })
                .catch(err => {
                    console.error('Error loading hotel data:', err);
                    console.error('Error details:', err.message, err.stack);
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–µ–ª—è: ' + err.message);
                });
        }
        
        function editHotel(hotelId) {
            openHotelModal(hotelId);
        }
        
        function deleteHotel(hotelId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–µ–ª—å?')) {
                return;
            }
            
            const apiUrl = getApiUrl();
            fetch(`${apiUrl}/hotels/${hotelId}`, {
                method: 'DELETE',
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–û—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                        loadHotels();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–µ–ª—è: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting hotel:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–µ–ª—è');
                });
        }
        
        function searchHotels() {
            const searchTerm = document.getElementById('hotelSearch').value.toLowerCase();
            const hotelCards = document.querySelectorAll('#hotelsList > div');
            
            hotelCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }
        
        function filterHotels() {
            const filter = document.getElementById('hotelFilter').value;
            const hotelCards = document.querySelectorAll('#hotelsList > div');
            
            hotelCards.forEach(card => {
                if (filter === '') {
                    card.style.display = 'block';
                } else if (filter === 'active') {
                    const isActive = card.innerHTML.includes('badge-success');
                    card.style.display = isActive ? 'block' : 'none';
                } else if (filter === 'inactive') {
                    const isInactive = card.innerHTML.includes('badge-danger');
                    card.style.display = isInactive ? 'block' : 'none';
                }
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±—Ä–µ–Ω–¥–∞
        function getSelectedBrand() {
            const brandSelect = document.getElementById('hotelBrand');
            const brandCustom = document.getElementById('hotelBrandCustom');
            
            if (brandSelect.value === 'custom') {
                return brandCustom.value.trim() || null;
            }
            return brandSelect.value || null;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç–µ–ª—è
        function addNewAmenity() {
            const newAmenityInput = document.getElementById('newAmenity');
            const amenityName = newAmenityInput.value.trim();
            
            if (!amenityName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–¥–æ–±—Å—Ç–≤–∞');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–µ —É–¥–æ–±—Å—Ç–≤–æ
            const existingAmenities = document.querySelectorAll('#hotelAmenities input[type="checkbox"]');
            for (let checkbox of existingAmenities) {
                if (checkbox.value === amenityName) {
                    alert('–¢–∞–∫–æ–µ —É–¥–æ–±—Å—Ç–≤–æ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    return;
                }
            }
            
            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–µ–∫–±–æ–∫—Å
            const amenitiesContainer = document.getElementById('hotelAmenities');
            const newCheckbox = document.createElement('label');
            newCheckbox.className = 'checkbox-item';
            newCheckbox.innerHTML = `
                <input type="checkbox" value="${amenityName}" checked> ${amenityName}
            `;
            
            amenitiesContainer.appendChild(newCheckbox);
            newAmenityInput.value = '';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —É—Å–ª—É–≥–∏ —Ç—É—Ä–∞
        function addNewTourService() {
            const newServiceInput = document.getElementById('newTourService');
            const serviceName = newServiceInput.value.trim();
            
            if (!serviceName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è —É—Å–ª—É–≥–∞
            const existingServices = document.querySelectorAll('#includesOptions input[type="checkbox"]');
            for (let checkbox of existingServices) {
                if (checkbox.value === serviceName) {
                    alert('–¢–∞–∫–∞—è —É—Å–ª—É–≥–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    return;
                }
            }
            
            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–µ–∫–±–æ–∫—Å
            const servicesContainer = document.getElementById('includesOptions');
            const newCheckbox = document.createElement('label');
            newCheckbox.className = 'checkbox-item';
            newCheckbox.innerHTML = `
                <input type="checkbox" value="${serviceName}" checked> ${serviceName}
            `;
            
            servicesContainer.appendChild(newCheckbox);
            newServiceInput.value = '';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∏—Å–∫–ª—é—á–µ–Ω–Ω–æ–π —É—Å–ª—É–≥–∏
        function addNewExcludedService() {
            const newServiceInput = document.getElementById('newExcludedService');
            const serviceName = newServiceInput.value.trim();
            
            if (!serviceName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è —É—Å–ª—É–≥–∞
            const existingServices = document.querySelectorAll('#excludedOptions input[type="checkbox"]');
            for (let checkbox of existingServices) {
                if (checkbox.value === serviceName) {
                    alert('–¢–∞–∫–∞—è —É—Å–ª—É–≥–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    return;
                }
            }
            
            // –°–∫—Ä—ã—Ç—å placeholder –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è —É—Å–ª—É–≥–∞
            const placeholder = document.getElementById('excludedPlaceholder');
            if (placeholder) {
                placeholder.style.display = 'none';
            }
            
            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–µ–∫–±–æ–∫—Å
            const servicesContainer = document.getElementById('excludedOptions');
            const newCheckbox = document.createElement('label');
            newCheckbox.className = 'checkbox-item';
            newCheckbox.innerHTML = `
                <input type="checkbox" value="${serviceName}" checked> ${serviceName}
                <button type="button" onclick="removeExcludedService(this)" class="ml-2 text-red-500 hover:text-red-700">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            servicesContainer.appendChild(newCheckbox);
            newServiceInput.value = '';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–Ω–æ–π —É—Å–ª—É–≥–∏
        function removeExcludedService(button) {
            const labelElement = button.closest('label');
            labelElement.remove();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å placeholder –µ—Å–ª–∏ —É—Å–ª—É–≥ –±–æ–ª—å—à–µ –Ω–µ—Ç
            const servicesContainer = document.getElementById('excludedOptions');
            const remainingServices = servicesContainer.querySelectorAll('input[type="checkbox"]');
            if (remainingServices.length === 0) {
                const placeholder = document.getElementById('excludedPlaceholder');
                if (placeholder) {
                    placeholder.style.display = 'block';
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–∞ –±—Ä–µ–Ω–¥–∞
        document.addEventListener('DOMContentLoaded', function() {
            const brandSelect = document.getElementById('hotelBrand');
            const brandCustomInput = document.getElementById('hotelBrandCustom');
            
            if (brandSelect && brandCustomInput) {
                brandSelect.addEventListener('change', function() {
                    if (this.value === 'custom') {
                        brandCustomInput.style.display = 'block';
                        brandCustomInput.focus();
                    } else {
                        brandCustomInput.style.display = 'none';
                        brandCustomInput.value = '';
                    }
                });
            }
        });
        
        // Hotel form submit handler
        document.getElementById('hotelForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Build name object from bilingual fields (RU/EN)
            const nameRuValue = safeGetValue('hotelNameRu', '');
            const nameEnValue = safeGetValue('hotelNameEn', '');
            
            if (!nameRuValue.trim() || !nameEnValue.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–∞—Ö');
                return;
            }
            
            const name = {
                ru: nameRuValue,
                en: nameEnValue
            };
            
            // Build description object from bilingual fields (RU/EN)
            const descRuValue = safeGetValue('hotelDescRu', '');
            const descEnValue = safeGetValue('hotelDescEn', '');
            
            if (!descRuValue.trim() || !descEnValue.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–µ–ª—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–∞—Ö');
                return;
            }
            
            const description = {
                ru: descRuValue,
                en: descEnValue
            };
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π: —Å—Ç—Ä–∞–Ω–∞ –∏ –≥–æ—Ä–æ–¥
            const countryValue = document.getElementById('hotelCountry')?.value;
            const cityValue = document.getElementById('hotelCity')?.value;
            
            if (!countryValue || countryValue.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –æ—Ç–µ–ª—è');
                return;
            }
            
            if (!cityValue || cityValue.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è –æ—Ç–µ–ª—è');
                return;
            }
            
            // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–æ–º–µ—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
            const roomTypes = {};
            
            // SGL - –û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
            if (safeGetValue('roomSGL', false, 'checkbox')) {
                const price = safeGetValue('priceSGL', '', 'float');
                if (price && !isNaN(price)) {
                    roomTypes.SGL = {
                        name: '–û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π',
                        price: price
                    };
                }
            }
            
            // TWL - –î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
            if (safeGetValue('roomTWL', false, 'checkbox')) {
                const price = safeGetValue('priceTWL', '', 'float');
                if (price && !isNaN(price)) {
                    roomTypes.TWL = {
                        name: '–î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π', 
                        price: price
                    };
                }
            }
            
            // DBL - –î–≤—É—Ö—Å–ø–∞–ª—å–Ω—ã–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
            if (safeGetValue('roomDBL', false, 'checkbox')) {
                const price = safeGetValue('priceDBL', '', 'float');
                if (price && !isNaN(price)) {
                    roomTypes.DBL = {
                        name: '–î–≤—É—Ö—Å–ø–∞–ª—å–Ω—ã–π',
                        price: price
                    };
                }
            }
            
            // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è —Å —Ü–µ–Ω–∞–º–∏ (—Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
            const mealTypes = {};
            
            // RO - –ë–µ–∑ –ø–∏—Ç–∞–Ω–∏—è
            const mealROEl = document.getElementById('mealRO');
            const priceMealROEl = document.getElementById('priceMealRO');
            if (mealROEl && mealROEl.checked && priceMealROEl) {
                const price = priceMealROEl.value;
                mealTypes.RO = {
                    name: '–ë–µ–∑ –ø–∏—Ç–∞–Ω–∏—è',
                    price: price && !isNaN(parseFloat(price)) ? parseFloat(price) : 0
                };
            }
            
            // BB - –ó–∞–≤—Ç—Ä–∞–∫
            const mealBBEl = document.getElementById('mealBB');
            const priceMealBBEl = document.getElementById('priceMealBB');
            if (mealBBEl && mealBBEl.checked && priceMealBBEl) {
                const price = priceMealBBEl.value;
                if (price && !isNaN(parseFloat(price))) {
                    mealTypes.BB = {
                        name: '–ó–∞–≤—Ç—Ä–∞–∫',
                        price: parseFloat(price)
                    };
                }
            }
            
            // HB - –ü–æ–ª—É–ø–∞–Ω—Å–∏–æ–Ω
            const mealHBEl = document.getElementById('mealHB');
            const priceMealHBEl = document.getElementById('priceMealHB');
            if (mealHBEl && mealHBEl.checked && priceMealHBEl) {
                const price = priceMealHBEl.value;
                if (price && !isNaN(parseFloat(price))) {
                    mealTypes.HB = {
                        name: '–ü–æ–ª—É–ø–∞–Ω—Å–∏–æ–Ω',
                        price: parseFloat(price)
                    };
                }
            }
            
            // FB - –ü–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω
            const mealFBEl = document.getElementById('mealFB');
            const priceMealFBEl = document.getElementById('priceMealFB');
            if (mealFBEl && mealFBEl.checked && priceMealFBEl) {
                const price = priceMealFBEl.value;
                if (price && !isNaN(parseFloat(price))) {
                    mealTypes.FB = {
                        name: '–ü–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω',
                        price: parseFloat(price)
                    };
                }
            }
            
            // AI - –í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ
            const mealAIEl = document.getElementById('mealAI');
            const priceMealAIEl = document.getElementById('priceMealAI');
            if (mealAIEl && mealAIEl.checked && priceMealAIEl) {
                const price = priceMealAIEl.value;
                if (price && !isNaN(parseFloat(price))) {
                    mealTypes.AI = {
                        name: '–í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ',
                        price: parseFloat(price)
                    };
                }
            }
            
            // Get amenities (–∏—Å–∫–ª—é—á–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–æ–º–µ—Ä–æ–≤ –∏ —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è)
            const amenities = [];
            document.querySelectorAll('#hotelForm input[type="checkbox"]:checked').forEach(checkbox => {
                if (checkbox.id !== 'hotelActive' && 
                    checkbox.id !== 'roomSGL' && 
                    checkbox.id !== 'roomTWL' && 
                    checkbox.id !== 'roomDBL' &&
                    checkbox.id !== 'mealRO' &&
                    checkbox.id !== 'mealBB' &&
                    checkbox.id !== 'mealHB' &&
                    checkbox.id !== 'mealFB' &&
                    checkbox.id !== 'mealAI') {
                    amenities.push(checkbox.value);
                }
            });
            
            // Build hotel data
            const hotelData = {
                name: JSON.stringify(name),
                description: JSON.stringify(description),
                address: document.getElementById('hotelAddress').value,
                stars: parseInt(document.getElementById('hotelStars').value) || null,
                brand: getSelectedBrand() || null,
                category: document.getElementById('hotelCategory')?.value || null,
                countryId: parseInt(document.getElementById('hotelCountry')?.value) || null,
                cityId: parseInt(document.getElementById('hotelCity')?.value) || null,
                pension: 'none', // Legacy field - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º mealTypes
                amenities: JSON.stringify(amenities),
                roomTypes: JSON.stringify(roomTypes), // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ–º–µ—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
                mealTypes: JSON.stringify(mealTypes), // –ù–û–í–û–ï: –¢–∏–ø—ã –ø–∏—Ç–∞–Ω–∏—è —Å —Ü–µ–Ω–∞–º–∏
                isActive: document.getElementById('hotelActive').checked,
                images: JSON.stringify(window.hotelImageURLs || []) // Use uploaded images
            };
            
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º hotel-id –¥–ª—è –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ POST/PUT
            const hotelId = document.getElementById('hotel-id').value;
            const isEditing = hotelId && hotelId.trim() !== '';
            
            const apiUrl = getApiUrl();
            const url = isEditing ? `${apiUrl}/hotels/${hotelId}` : `${apiUrl}/hotels`;
            const method = isEditing ? 'PUT' : 'POST';
            
            // For now, send as JSON instead of FormData (images handled separately)
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    ...getAuthHeaders()
                },
                body: JSON.stringify(hotelData)
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert(isEditing ? '–û—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω' : '–û—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω');
                        closeHotelModal();
                        loadHotels();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error saving hotel:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–µ–ª—è');
                });
        });
        
        // –ù–û–í–û–ï: JavaScript –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–æ–º–µ—Ä–æ–≤ –∏ —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–µ–π —Ü–µ–Ω—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–æ–º–µ—Ä–æ–≤
            document.getElementById('roomSGL').addEventListener('change', function() {
                document.getElementById('priceSGL').disabled = !this.checked;
                if (!this.checked) document.getElementById('priceSGL').value = '';
            });
            
            document.getElementById('roomTWL').addEventListener('change', function() {
                document.getElementById('priceTWL').disabled = !this.checked;
                if (!this.checked) document.getElementById('priceTWL').value = '';
            });
            
            document.getElementById('roomDBL').addEventListener('change', function() {
                document.getElementById('priceDBL').disabled = !this.checked;
                if (!this.checked) document.getElementById('priceDBL').value = '';
            });
            
            // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–µ–π —Ü–µ–Ω—ã —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è (—Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
            const mealROEl = document.getElementById('mealRO');
            const priceMealROEl = document.getElementById('priceMealRO');
            if (mealROEl && priceMealROEl) {
                mealROEl.addEventListener('change', function() {
                    priceMealROEl.disabled = !this.checked;
                    if (!this.checked) priceMealROEl.value = '';
                });
            }
            
            const mealBBEl = document.getElementById('mealBB');
            const priceMealBBEl = document.getElementById('priceMealBB');
            if (mealBBEl && priceMealBBEl) {
                mealBBEl.addEventListener('change', function() {
                    priceMealBBEl.disabled = !this.checked;
                    if (!this.checked) priceMealBBEl.value = '';
                });
            }
            
            const mealHBEl = document.getElementById('mealHB');
            const priceMealHBEl = document.getElementById('priceMealHB');
            if (mealHBEl && priceMealHBEl) {
                mealHBEl.addEventListener('change', function() {
                    priceMealHBEl.disabled = !this.checked;
                    if (!this.checked) priceMealHBEl.value = '';
                });
            }
            
            const mealFBEl = document.getElementById('mealFB');
            const priceMealFBEl = document.getElementById('priceMealFB');
            if (mealFBEl && priceMealFBEl) {
                mealFBEl.addEventListener('change', function() {
                    priceMealFBEl.disabled = !this.checked;
                    if (!this.checked) priceMealFBEl.value = '';
                });
            }
            
            const mealAIElementCheck = document.getElementById('mealAI');
            const priceMealAIElementCheck = document.getElementById('priceMealAI');
            if (mealAIElementCheck && priceMealAIElementCheck) {
                mealAIElementCheck.addEventListener('change', function() {
                    priceMealAIElementCheck.disabled = !this.checked;
                    if (!this.checked) priceMealAIElementCheck.value = '';
                });
            }
        });

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function safeGetValue(elementId, defaultValue = '', parseType = null) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.warn(`‚ö†Ô∏è Element with ID "${elementId}" not found, using default value:`, defaultValue);
                return defaultValue;
            }
            
            let value;
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è
            if (parseType === 'checkbox' || element.type === 'checkbox') {
                value = element.checked;
            } else {
                value = element.value;
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ä—Å–∏–Ω–≥ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
            if (parseType === 'int') {
                const parsed = parseInt(value);
                return isNaN(parsed) ? (typeof defaultValue === 'number' ? defaultValue : 0) : parsed;
            }
            if (parseType === 'float') {
                const parsed = parseFloat(value);
                return isNaN(parsed) ? (typeof defaultValue === 'number' ? defaultValue : 0) : parsed;
            }
            
            return value || defaultValue;
        }

        // Initialize ObjectUploader for hotels
        let hotelUploader = null;
        let tourUploader = null;
        window.hotelImageURLs = [];
        window.tourImageURLs = [];

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –æ—Ç–µ–ª–µ–π
        function removeHotelImage(index) {
            window.hotelImageURLs.splice(index, 1);
            updateHotelImagesList();
            // Update hidden input
            const hiddenField = document.getElementById('hotelImages');
            if (hiddenField) {
                hiddenField.value = JSON.stringify(window.hotelImageURLs);
            }
        }

        function updateHotelImagesList() {
            const container = document.getElementById('hotelImagesList');
            if (!container) {
                console.warn('hotelImagesList container not found');
                return;
            }
            
            if (!window.hotelImageURLs || window.hotelImageURLs.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>';
                return;
            }
            
            container.innerHTML = window.hotelImageURLs.map((imageUrl, index) => `
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded border mb-2">
                    <div class="flex items-center gap-3">
                        <img data-image-placeholder="hotel-thumb" alt="Hotel image" class="w-16 h-16 object-cover rounded" onerror="this.style.display='none';">
                        <div class="flex-1 min-w-0">
                            <div class="text-sm font-medium text-gray-900 truncate">${imageUrl}</div>
                        </div>
                    </div>
                    <button type="button" onclick="removeHotelImage(${index})" class="text-red-500 hover:text-red-700 ml-2">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function initializeHotelUploader() {
            if (hotelUploader) return;
            
            hotelUploader = new ObjectUploader({
                maxFiles: 10,
                maxFileSize: 10 * 1024 * 1024, // 10MB
                onComplete: (fileInfo, allFiles) => {
                    console.log('Hotel image uploaded:', fileInfo);
                    
                    // Normalize the object path for database storage
                    fetch('/api/images', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ imageURL: fileInfo.url })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.hotelImageURLs = window.hotelImageURLs || [];
                            window.hotelImageURLs.push(data.objectPath);
                            // Update hidden input for form submission
                            const hiddenField = document.getElementById('hotelImages');
                            if (hiddenField) {
                                hiddenField.value = JSON.stringify(window.hotelImageURLs);
                            }
                            // Update the display
                            updateHotelImagesList();
                            console.log('Hotel image processed:', data.objectPath);
                        }
                    })
                    .catch(error => {
                        console.error('Error processing uploaded image:', error);
                    });
                },
                onError: (error) => {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error);
                }
            });
            
            hotelUploader.createElement('hotel-uploader-container');
        }

        function initializeTourUploader() {
            if (tourUploader) return;
            
            tourUploader = new ObjectUploader({
                maxFiles: 15,
                maxFileSize: 10 * 1024 * 1024, // 10MB
                onComplete: (fileInfo, allFiles) => {
                    console.log('Tour image uploaded:', fileInfo);
                    
                    // Normalize the object path for database storage
                    fetch('/api/images', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ imageURL: fileInfo.url })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.tourImageURLs = window.tourImageURLs || [];
                            window.tourGalleryImages = window.tourGalleryImages || [];
                            
                            window.tourImageURLs.push(data.objectPath);
                            window.tourGalleryImages.push(data.objectPath);
                            
                            // Update hidden input for form submission
                            const hiddenField = document.getElementById('tourImages');
                            if (hiddenField) {
                                hiddenField.value = JSON.stringify(window.tourImageURLs);
                            }
                            
                            // Set as main image if it's the first one
                            if (window.tourGalleryImages.length === 1) {
                                const mainImageInput = document.getElementById('tourMainImage');
                                if (mainImageInput) {
                                    mainImageInput.value = data.objectPath;
                                    console.log('Set main image for create:', data.objectPath);
                                }
                            }
                            
                            // Update gallery display
                            updateGalleryImagesList();
                            console.log('Tour image processed:', data.objectPath);
                        }
                    })
                    .catch(error => {
                        console.error('Error processing uploaded image:', error);
                    });
                },
                onError: (error) => {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error);
                }
            });
            
            tourUploader.createElement('tour-uploader-container');
        }

        function initializeTourEditUploader() {
            if (window.tourEditUploader) return;
            
            window.tourEditUploader = new ObjectUploader({
                maxFiles: 15,
                maxFileSize: 10 * 1024 * 1024, // 10MB
                onComplete: (fileInfo, allFiles) => {
                    console.log('Tour edit image uploaded:', fileInfo);
                    
                    // Normalize the object path for database storage
                    fetch('/api/images', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ imageURL: fileInfo.url })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.tourImageURLs.push(data.objectPath);
                            // Update gallery images array
                            window.tourGalleryImages = window.tourGalleryImages || [];
                            window.tourGalleryImages.push(data.objectPath);
                            
                            // Set as main image if it's the first one
                            if (window.tourGalleryImages.length === 1) {
                                const editMainImageInput = document.getElementById('eTourMainImage');
                                if (editMainImageInput) {
                                    editMainImageInput.value = data.objectPath;
                                    console.log('Set edit main image:', data.objectPath);
                                }
                            }
                            
                            // Update gallery display for edit form
                            updateGalleryImagesList();
                        }
                    })
                    .catch(error => {
                        console.error('Error processing uploaded image:', error);
                    });
                },
                onError: (error) => {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error);
                }
            });
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π tour-edit-uploader-container
        }

        // Bookings functions
        function loadBookings(status = 'all') {
            let url = `${getApiUrl()}/orders`;
            if (status !== 'all') {
                url += `?status=${status}`;
            }
            
            fetch(url, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('bookingsTable');
                    const orders = data.data || data.orders || [];
                    if (orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="10" class="text-center text-gray-500">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = orders.map(order => `
                        <tr>
                            <td class="font-medium">${order.orderNumber || 'N/A'}</td>
                            <td>${formatDate(order.createdAt)}</td>
                            <td>${order.customer?.fullName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                            <td>${getTourName(order.tour)}</td>
                            <td>${order.tourDate || '-'}</td>
                            <td>${JSON.parse(order.tourists || '[]').length} —á–µ–ª.</td>
                            <td class="font-semibold">$${order.totalAmount}</td>
                            <td>${getPaymentBadge(order.paymentStatus)}</td>
                            <td>${getStatusBadge(order.status)}</td>
                            <td>
                                <button onclick="viewBooking(${order.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(err => {
                    console.error('Error loading bookings:', err);
                    const tbody = document.getElementById('bookingsTable');
                    if (tbody) {
                        tbody.innerHTML = '<tr><td colspan="10" class="text-center text-red-500 py-4">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                    }
                });
        }
        
        function viewBooking(bookingId) {
            currentBookingId = bookingId;
            document.getElementById('bookingModal').classList.add('active');
            
            fetch(`${getApiUrl()}/orders/${bookingId}`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const order = data.order;
                    const tourists = JSON.parse(order.tourists || '[]');
                    
                    document.getElementById('bookingDetails').innerHTML = `
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</p>
                                    <p class="font-semibold">${order.orderNumber}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</p>
                                    <p class="font-semibold">${formatDate(order.createdAt)}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">–ö–ª–∏–µ–Ω—Ç</p>
                                    <p class="font-semibold">${order.customer?.fullName}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Email</p>
                                    <p class="font-semibold">${order.customer?.email}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">–¢—É—Ä</p>
                                    <p class="font-semibold">${getTourName(order.tour)}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">–î–∞—Ç–∞ —Ç—É—Ä–∞</p>
                                    <p class="font-semibold">${order.tourDate}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">–û—Ç–µ–ª—å</p>
                                    <p class="font-semibold">${order.hotel ? getHotelName(order.hotel) : '–ù–µ –≤—ã–±—Ä–∞–Ω'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">–ì–∏–¥</p>
                                    <p class="font-semibold">${order.guide ? getGuideName(order.guide) : '–ù–µ –≤—ã–±—Ä–∞–Ω'}</p>
                                </div>
                            </div>
                            
                            <div>
                                <p class="text-sm text-gray-600 mb-2">–°–ø–∏—Å–æ–∫ —Ç—É—Ä–∏—Å—Ç–æ–≤</p>
                                <div class="bg-gray-50 p-3 rounded">
                                    ${tourists.map((t, i) => `
                                        <div class="mb-2">
                                            ${i + 1}. ${t.fullName} (${t.birthDate})
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            ${order.wishes ? `
                                <div>
                                    <p class="text-sm text-gray-600 mb-2">–ü–æ–∂–µ–ª–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞</p>
                                    <div class="bg-gray-50 p-3 rounded">
                                        ${order.wishes}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="flex justify-between items-center pt-4 border-t">
                                <div>
                                    <p class="text-sm text-gray-600">–û–±—â–∞—è —Å—É–º–º–∞</p>
                                    <p class="text-2xl font-bold text-green-600">$${order.totalAmount}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-gray-600">–°—Ç–∞—Ç—É—Å</p>
                                    <p>${getStatusBadge(order.status)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
        }
        
        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('active');
            currentBookingId = null;
        }
        
        // Hotels functions - moved to line 4302
        
        // Guides functions
        function loadGuides() {
            fetch(`${getApiUrl()}/guides?includeRaw=true`, {
                headers: getAuthHeaders()
            })
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    const container = document.getElementById('guidesList');
                    if (!container) {
                        console.error('guidesList container not found');
                        return;
                    }
                    
                    const guides = data.data || data.guides || [];
                    if (guides.length === 0) {
                        container.innerHTML = '<p class="text-gray-500">–ù–µ—Ç –≥–∏–¥–æ–≤</p>';
                        return;
                    }
                    
                    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º
                    container.innerHTML = guides.map(guide => {
                        const guideName = escapeHtml(getLocalizedField(guide, 'name', '–ë–µ–∑ –∏–º–µ–Ω–∏'));
                        const guideDesc = escapeHtml(getLocalizedField(guide, 'description', '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'));
                        
                        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —è–∑—ã–∫–æ–≤
                        let languages = [];
                        if (Array.isArray(guide.languages)) {
                            languages = guide.languages;
                        } else if (typeof guide.languages === 'string') {
                            if (guide.languages.startsWith('[')) {
                                try {
                                    languages = JSON.parse(guide.languages);
                                } catch (e) {
                                    languages = guide.languages.split(',').map(lang => lang.trim());
                                }
                            } else {
                                languages = guide.languages.split(',').map(lang => lang.trim());
                            }
                        }
                        
                        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                        let contact = {};
                        if (typeof guide.contact === 'string') {
                            try {
                                contact = JSON.parse(guide.contact);
                            } catch (e) {
                                contact = {};
                            }
                        } else if (typeof guide.contact === 'object' && guide.contact) {
                            contact = guide.contact;
                        }
                        
                        const phoneNumber = contact.phone || guide.phone || '–ù–µ —É–∫–∞–∑–∞–Ω';
                        const emailAddress = contact.email || guide.email || '–ù–µ —É–∫–∞–∑–∞–Ω';
                        
                        return `
                            <div class="bg-white rounded-lg shadow-sm p-4">
                                <div class="flex items-center mb-4">
                                    ${guide.photo ? 
                                        `<img src="${validateImageUrl(guide.photo)}" alt="${guideName}" class="w-16 h-16 rounded-full object-cover mr-4" onerror="this.style.display='none';">` :
                                        `<div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center mr-4">
                                            <i class="fas fa-user text-gray-400 text-2xl"></i>
                                        </div>`
                                    }
                                    <div>
                                        <h3 class="font-semibold text-lg">${guideName}</h3>
                                        <p class="text-sm text-gray-600">${guide.experience || 0} –ª–µ—Ç –æ–ø—ã—Ç–∞</p>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <p class="text-sm text-gray-600 mb-1">–Ø–∑—ã–∫–∏:</p>
                                    <div class="flex flex-wrap gap-1">
                                        ${languages.map(lang => `
                                            <span class="badge badge-info text-xs">${escapeHtml(lang)}</span>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-3 text-sm">
                                    <div>
                                        <p class="text-gray-600">–õ–æ–∫–∞—Ü–∏—è:</p>
                                        <p class="font-medium">${guide.guideCountry?.name || guide.country || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}, ${guide.guideCity?.name || guide.city || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">–°—Ç–∞—Ç—É—Å:</p>
                                        <span class="badge ${guide.isActive ? 'badge-success' : 'badge-danger'} text-xs">
                                            ${guide.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 gap-2 mb-3 text-sm">
                                    <div class="flex items-center">
                                        <i class="fas fa-phone text-gray-400 w-4 mr-2"></i>
                                        <span>${phoneNumber}</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-envelope text-gray-400 w-4 mr-2"></i>
                                        <span>${emailAddress}</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3 p-2 bg-gray-50 rounded border">
                                    <p class="text-sm text-gray-600 font-semibold mb-1">–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</p>
                                    <div class="text-sm">
                                        <div class="mb-1">
                                            <span class="font-medium">–õ–æ–≥–∏–Ω:</span> 
                                            <span class="font-mono bg-gray-200 px-1 rounded">${guide.login || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
                                        </div>
                                        <div>
                                            <span class="font-medium">–ü–∞—Ä–æ–ª—å:</span> 
                                            <span class="font-mono bg-gray-200 px-1 rounded">${guide.hasPassword ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <span class="text-yellow-500">
                                        ${'‚òÖ'.repeat(Math.floor(guide.rating || 5))}${'‚òÜ'.repeat(5 - Math.floor(guide.rating || 5))}
                                    </span>
                                    <div class="flex items-center gap-2">
                                        <button onclick="toggleGuideStatus(${guide.id}, ${guide.isActive ? 'false' : 'true'})" 
                                                class="px-2 py-1 rounded text-xs font-medium ${guide.isActive ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-green-100 text-green-700 hover:bg-green-200'}">
                                            ${guide.isActive ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'}
                                        </button>
                                        <button onclick="editGuide(${guide.id})" class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteGuide(${guide.id})" class="text-red-600 hover:text-red-800">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                })
                .catch(error => {
                    console.error('Error loading guides:', error);
                    console.error('Unhandled promise rejection:', error);
                    const container = document.getElementById('guidesList');
                    if (container) {
                        container.innerHTML = '<p class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∏–¥–æ–≤</p>';
                    } else {
                        console.error('guidesList container not found');
                    }
                });
        }
        
        // Reviews functions
        function loadReviews(filter = 'all') {
            fetch(`${getApiUrl()}/reviews?status=${filter}`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('reviewsTable');
                    let reviews = data.data || data.reviews || [];
                    
                    if (reviews.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="9" class="text-center text-gray-500">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = reviews.map(review => `
                        <tr>
                            <td>${review.id}</td>
                            <td>${formatDate(review.createdAt)}</td>
                            <td>${review.reviewerName || review.customer?.fullName || '–ê–Ω–æ–Ω–∏–º'}</td>
                            <td>${getTourName(review.tour)}</td>
                            <td>
                                <span class="text-yellow-500">
                                    ${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}
                                </span>
                            </td>
                            <td class="max-w-xs">
                                <div class="truncate" title="${review.text}">${review.text}</div>
                                ${review.text.length > 100 ? 
                                    `<button onclick="showFullReview('${review.text.replace(/'/g, "\\'")}')" class="text-blue-600 text-xs">–ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</button>` 
                                    : ''
                                }
                            </td>
                            <td>
                                ${review.photos ? renderReviewPhotos(review.photos) : '<span class="text-gray-400">–ù–µ—Ç —Ñ–æ—Ç–æ</span>'}
                            </td>
                            <td>
                                ${!review.isModerated ? 
                                    '<span class="badge badge-warning">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>' :
                                    review.isApproved ?
                                        '<span class="badge badge-success">–û–¥–æ–±—Ä–µ–Ω</span>' :
                                        '<span class="badge badge-danger">–û—Ç–∫–ª–æ–Ω–µ–Ω</span>'
                                }
                            </td>
                            <td>
                                ${!review.isModerated ? `
                                    <button onclick="approveReview(${review.id})" class="text-green-600 hover:text-green-800 mr-2" title="–û–¥–æ–±—Ä–∏—Ç—å">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button onclick="rejectReview(${review.id})" class="text-red-600 hover:text-red-800" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">
                                        <i class="fas fa-times"></i>
                                    </button>
                                ` : `
                                    <button onclick="deleteReview(${review.id})" class="text-red-600 hover:text-red-800" title="–£–¥–∞–ª–∏—Ç—å">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                `}
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(err => {
                    console.error('Error loading bookings:', err);
                    const tbody = document.getElementById('bookingsTable');
                    if (tbody) {
                        tbody.innerHTML = '<tr><td colspan="10" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤</td></tr>';
                    }
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ—Ç–∑—ã–≤–∞
        function renderReviewPhotos(photosData) {
            try {
                // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç photos –∫–∞–∫ –º–∞—Å—Å–∏–≤, –Ω–µ –∫–∞–∫ JSON —Å—Ç—Ä–æ–∫—É
                let photos = photosData;
                if (typeof photosData === 'string') {
                    photos = JSON.parse(photosData);
                }
                
                if (!Array.isArray(photos) || photos.length === 0) {
                    return '<span class="text-gray-400">–ù–µ—Ç —Ñ–æ—Ç–æ</span>';
                }
                
                return `
                    <div class="flex gap-1">
                        ${photos.slice(0, 3).map(photo => `
                            <img data-image-placeholder="review-photo" alt="–§–æ—Ç–æ –æ—Ç–∑—ã–≤–∞" 
                                 class="w-8 h-8 object-cover rounded cursor-pointer" 
                                 onclick="showPhotoModal('${photo}')"
                                 title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è">
                        `).join('')}
                        ${photos.length > 3 ? `<span class="text-xs text-gray-500">+${photos.length - 3}</span>` : ''}
                    </div>
                `;
            } catch (e) {
                return '<span class="text-gray-400">–ù–µ—Ç —Ñ–æ—Ç–æ</span>';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–∑—ã–≤–∞
        function showFullReview(text) {
            alert(text);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function showPhotoModal(photoUrl) {
            const modal = `
                <div id="photoModal" class="modal active" onclick="closePhotoModal()">
                    <div class="modal-content" style="max-width: 90%; background: transparent; padding: 0;">
                        <img data-image-placeholder="photo-modal" alt="–§–æ—Ç–æ –æ—Ç–∑—ã–≤–∞" style="max-width: 100%; max-height: 90vh; border-radius: 8px;">
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π
        function closePhotoModal() {
            const modal = document.getElementById('photoModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Helper functions
        function getTourName(tour) {
            if (!tour) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç title –∫–∞–∫ –æ–±—ä–µ–∫—Ç, –Ω–µ –∫–∞–∫ JSON —Å—Ç—Ä–æ–∫—É
            if (typeof tour.title === 'object') {
                return tour.title.ru || tour.title.en || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            }
            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ JSON, –ø–∞—Ä—Å–∏–º –µ—ë
            try {
                const title = JSON.parse(tour.title || '{}');
                return title.ru || title.en || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            } catch {
                return tour.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            }
        }
        
        function getHotelName(hotel) {
            if (!hotel) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            const name = JSON.parse(hotel.name || '{}');
            return name.ru || name.en || '–û—Ç–µ–ª—å';
        }
        
        function getGuideName(guide) {
            if (!guide) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø guide.name
            if (typeof guide.name === 'string') {
                // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                if (!guide.name.startsWith('{')) {
                    return guide.name;
                }
                // –ï—Å–ª–∏ —ç—Ç–æ JSON —Å—Ç—Ä–æ–∫–∞, –ø–∞—Ä—Å–∏–º
                try {
                    const name = JSON.parse(guide.name);
                    return name.ru || name.en || guide.name;
                } catch {
                    return guide.name;
                }
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –æ–±—ä–µ–∫—Ç
            if (typeof guide.name === 'object' && guide.name !== null) {
                return guide.name.ru || guide.name.en || '–ì–∏–¥';
            }
            
            return '–ì–∏–¥';
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }
        
        function getStatusBadge(status) {
            const badges = {
                pending: '<span class="badge badge-warning">–û–∂–∏–¥–∞–µ—Ç</span>',
                confirmed: '<span class="badge badge-info">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</span>',
                paid: '<span class="badge badge-success">–û–ø–ª–∞—á–µ–Ω</span>',
                completed: '<span class="badge badge-success">–ó–∞–≤–µ—Ä—à–µ–Ω</span>',
                cancelled: '<span class="badge badge-danger">–û—Ç–º–µ–Ω–µ–Ω</span>'
            };
            return badges[status] || '<span class="badge">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>';
        }
        
        function getPaymentBadge(status) {
            const badges = {
                unpaid: '<span class="badge badge-warning">–ù–µ –æ–ø–ª–∞—á–µ–Ω</span>',
                paid: '<span class="badge badge-success">–û–ø–ª–∞—á–µ–Ω</span>',
                refunded: '<span class="badge badge-danger">–í–æ–∑–≤—Ä–∞—Ç</span>'
            };
            return badges[status] || '<span class="badge">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>';
        }
        
        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const parent = this.parentElement;
                parent.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                const status = this.dataset.status;
                const filter = this.dataset.filter;
                
                if (status) {
                    loadBookings(status);
                } else if (filter) {
                    loadReviews(filter);
                }
            });
        });
        
        // Form submissions - –ò–°–ü–û–õ–¨–ó–£–ï–ú –ï–î–ò–ù–£–Æ –§–£–ù–ö–¶–ò–Æ –°–û–•–†–ê–ù–ï–ù–ò–Ø  
        const tourFormElement = document.getElementById('tourForm');
        if (tourFormElement) {
            tourFormElement.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('üî• tourForm submit - calling saveTourForm');
                saveTourForm(); // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã
            });
        }
        
        // Additional functions
        function editTour(id) {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            document.querySelectorAll('input[name="selectedHotels"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[name="selectedGuides"]').forEach(cb => cb.checked = false);
            openTourModal(id);
        }
        
        function deleteTour(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç—É—Ä?')) {
                fetch(`${getApiUrl()}/tours/${id}`, {
                    method: 'DELETE'
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–¢—É—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                        loadTours();
                    }
                });
            }
        }
        
        function copyReviewLink(tourId) {
            const baseUrl = window.location.origin;
            const reviewLink = `${baseUrl}/review-form.html?tourId=${tourId}`;
            
            // –ö–æ–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            navigator.clipboard.writeText(reviewLink).then(() => {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
                showNotification('–°—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textArea = document.createElement('textarea');
                textArea.value = reviewLink;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('–°—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
                } catch (err) {
                    showNotification('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏', 'error');
                }
                document.body.removeChild(textArea);
            });
        }
        
        function showNotification(message, type = 'info') {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.body.appendChild(notification);
            
            // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        function confirmBooking() {
            if (currentBookingId) {
                fetch(`${getApiUrl()}/orders/${currentBookingId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'confirmed' })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–ó–∞–∫–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω');
                        closeBookingModal();
                        loadBookings();
                    }
                });
            }
        }
        
        function cancelBooking() {
            if (currentBookingId && confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')) {
                fetch(`${getApiUrl()}/orders/${currentBookingId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'cancelled' })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω');
                        closeBookingModal();
                        loadBookings();
                    }
                });
            }
        }
        
        function approveReview(id) {
            fetch(`${getApiUrl()}/reviews/${id}/approve`, {
                method: 'PUT',
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('–û—Ç–∑—ã–≤ –æ–¥–æ–±—Ä–µ–Ω');
                    loadReviews();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞');
            });
        }
        
        function rejectReview(id) {
            fetch(`${getApiUrl()}/reviews/${id}/reject`, {
                method: 'PUT',
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('–û—Ç–∑—ã–≤ –æ—Ç–∫–ª–æ–Ω–µ–Ω');
                    loadReviews();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞');
            });
        }
        
        function deleteReview(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–∑—ã–≤?')) {
                fetch(`${getApiUrl()}/reviews/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–û—Ç–∑—ã–≤ —É–¥–∞–ª–µ–Ω');
                        loadReviews();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞');
                });
            }
        }
        
        function openGuideModal() {
            const modal = `
                <div id="guideModal" class="modal active">
                    <div class="modal-content" style="width: 600px;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-semibold">–î–æ–±–∞–≤–∏—Ç—å –≥–∏–¥–∞</h2>
                            <button onclick="closeGuideModal()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="guideForm">
                            <div class="grid grid-cols-1 gap-4">
                                <!-- üåê –ú–ù–û–ì–û–Ø–ó–´–ß–ù–´–ï –ü–û–õ–Ø –ì–ò–î–û–í -->
                                <div class="p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-medium text-gray-700 mb-3">üåê –§–ò–û –≥–∏–¥–∞ (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–µ)</h4>
                                    <div class="grid grid-cols-1 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–§–ò–û (–†—É—Å—Å–∫–∏–π) *</label>
                                            <input type="text" class="form-input" id="guideFullNameRu" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–§–ò–û (English) *</label>
                                            <input type="text" class="form-input" id="guideFullNameEn" placeholder="John Smith, Alex Johnson, etc." required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-3">üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                                            <input type="text" class="form-input" id="guidePassportSeries" placeholder="–ê–ê 1234567">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ì–æ—Å. —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</label>
                                            <input type="text" class="form-input" id="guideRegistration" placeholder="–ù–æ–º–µ—Ä —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
                                        <input type="text" class="form-input" id="guideResidenceAddress" placeholder="–≥. –î—É—à–∞–Ω–±–µ, —É–ª. –§–∏—Ä–¥–∞–≤—Å–∏, –¥.1">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–Ø–∑—ã–∫–∏</label>
                                    <div class="flex gap-2 mb-2">
                                        <select class="form-input flex-1" id="guideAvailableLanguages">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                                            <option value="–†—É—Å—Å–∫–∏–π">–†—É—Å—Å–∫–∏–π</option>
                                            <option value="English">English</option>

                                            <option value="–é–∑–±–µ–∫">–é–∑–±–µ–∫</option>
                                            <option value="“ö—ã—Ä“ì–∞–Ω">“ö—ã—Ä“ì–∞–Ω</option>
                                            <option value="T√ºrkmen">T√ºrkmen</option>
                                            <option value="–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                                            <option value="–ù–µ–º–µ—Ü–∫–∏–π">–ù–µ–º–µ—Ü–∫–∏–π</option>
                                            <option value="–ò—Å–ø–∞–Ω—Å–∫–∏–π">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                                            <option value="–ö–∏—Ç–∞–π—Å–∫–∏–π">–ö–∏—Ç–∞–π—Å–∫–∏–π</option>
                                            <option value="–ê—Ä–∞–±—Å–∫–∏–π">–ê—Ä–∞–±—Å–∫–∏–π</option>
                                        </select>
                                        <button type="button" onclick="addLanguageToGuide()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <div id="selectedGuideLanguages" class="space-y-1 max-h-32 overflow-y-auto border rounded p-2 bg-gray-50">
                                        <small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                                    </div>
                                    <input type="hidden" id="guideLanguagesHidden">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã (–ª–µ—Ç)</label>
                                    <input type="number" class="form-input" id="guideExperience" min="0" max="50">
                                </div>

                                <!-- –í—ã–±–æ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω—ã –∏ –≥–æ—Ä–æ–¥–∞ -->
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="form-group">
                                        <label class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                                        <select class="form-input" id="guideCountry" onchange="loadGuideCitiesByCountry()">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–ì–æ—Ä–æ–¥</label>
                                        <select class="form-input" id="guideCity" disabled>
                                            <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="tel" class="form-input" id="guidePhone" placeholder="+992901234567">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input" id="guideEmail" placeholder="guide@example.com">
                                </div>
                                
                                <!-- üåê –ú–ù–û–ì–û–Ø–ó–´–ß–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –ì–ò–î–ê -->
                                <div class="p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-medium text-gray-700 mb-3">üìù –û–ø–∏—Å–∞–Ω–∏–µ –≥–∏–¥–∞ (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–µ)</h4>
                                    <div class="grid grid-cols-1 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–†—É—Å—Å–∫–∏–π)</label>
                                            <textarea class="form-input" rows="3" id="guideCommentsRu" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–∏–¥–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ..."></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (English)</label>
                                            <textarea class="form-input" rows="3" id="guideCommentsEn" placeholder="Additional information about the guide in English..."></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ -->
                                <div class="form-group">
                                    <label class="form-label">–§–æ—Ç–æ –≥–∏–¥–∞</label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                        <input type="file" id="guideAvatar" accept="image/*" class="hidden" onchange="handleGuideAvatarUpload(this)">
                                        <div class="text-center">
                                            <div id="guideAvatarPreview" class="mb-3" style="display: none;">
                                                <img id="guideAvatarImg" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" class="w-24 h-24 object-cover rounded-full mx-auto">
                                            </div>
                                            <button type="button" onclick="document.getElementById('guideAvatar').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
                                                <i class="fas fa-upload mr-2"></i>–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
                                            </button>
                                            <p class="text-sm text-gray-500 mt-2">JPG, PNG –¥–æ 5MB</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
                                <div class="form-group">
                                    <label class="form-label">–î–æ–∫—É–º–µ–Ω—Ç—ã</label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                        <input type="file" id="guideDocuments" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="hidden" onchange="handleGuideDocumentsUpload(this)">
                                        <div class="text-center">
                                            <button type="button" onclick="document.getElementById('guideDocuments').click()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md">
                                                <i class="fas fa-file-upload mr-2"></i>–í—ã–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
                                            </button>
                                            <p class="text-sm text-gray-500 mt-2">PDF, DOC, DOCX, JPG, PNG –¥–æ 10MB –∫–∞–∂–¥—ã–π</p>
                                        </div>
                                        <div id="guideDocumentsList" class="mt-3" style="display: none;">
                                            <h4 class="font-medium text-gray-700 mb-2">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                                            <div id="guideDocumentsPreview" class="space-y-1"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-blue-900 mb-3">üîê –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–õ–æ–≥–∏–Ω</label>
                                            <input type="text" class="form-input" id="guideLogin" placeholder="guide_login">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                            <input type="password" class="form-input" id="guidePassword" placeholder="********">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–°—Ç–∞—Ç—É—Å *</label>
                                        <select class="form-input" id="guideIsActive" required>
                                            <option value="true">–ê–∫—Ç–∏–≤–µ–Ω</option>
                                            <option value="false">–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</option>
                                        </select>
                                    </div>
                                    <small class="text-blue-600">–ì–∏–¥ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–≤–æ–π –∫–∞–±–∏–Ω–µ—Ç —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</small>
                                </div>
                                
                                <!-- üí∞ –¶–ï–ù–û–û–ë–†–ê–ó–û–í–ê–ù–ò–ï –î–õ–Ø –ù–ê–ô–ú–ê –ì–ò–î–ê -->
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-green-900 mb-3">üí∞ –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–∞–π–º–∞</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–¶–µ–Ω–∞ –∑–∞ –¥–µ–Ω—å</label>
                                            <input type="number" class="form-input" id="guidePricePerDay" min="0" step="0.01" placeholder="200.00">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–í–∞–ª—é—Ç–∞</label>
                                            <select class="form-input" id="guideCurrency">
                                                <option value="TJS" selected>TJS - –°–æ–º–æ–Ω–∏</option>
                                                <option value="USD">USD - –î–æ–ª–ª–∞—Ä –°–®–ê</option>
                                                <option value="EUR">EUR - –ï–≤—Ä–æ</option>
                                                <option value="RUB">RUB - –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å</option>
                                                <option value="CNY">CNY - –ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –Ω–∞–π–º–∞</label>
                                        <select class="form-input" id="guideIsHireable">
                                            <option value="true" selected>–î–∞, –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –Ω–∞–π–º–∞</option>
                                            <option value="false">–ù–µ—Ç, –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –Ω–∞–π–º–∞</option>
                                        </select>
                                    </div>
                                    <small class="text-green-600">–¢—É—Ä–∏—Å—Ç—ã —Å–º–æ–≥—É—Ç –Ω–∞–Ω—è—Ç—å —ç—Ç–æ–≥–æ –≥–∏–¥–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ü–µ–Ω–µ</small>
                                </div>
                            </div>
                            
                            <div class="flex justify-end gap-3 mt-6">
                                <button type="button" onclick="closeGuideModal()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('guideForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveGuide();
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            loadGuideCountries();
        }
        
        function closeGuideModal() {
            const modal = document.getElementById('guideModal');
            if (modal) {
                modal.remove();
            }
            // –û—á–∏—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            selectedGuideLanguages = [];
            // –û—á–∏—â–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
            guideAvatarFile = null;
            guideDocumentFiles = [];
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω –∏ –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è –≥–∏–¥–æ–≤
        async function loadGuideCountries() {
            try {
                const response = await fetch(`${getApiUrl()}/countries`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    const countrySelect = document.getElementById('guideCountry');
                    if (countrySelect) {
                        countrySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>' +
                            data.data.map(country => {
                                const nameRu = country.nameRu || country.name?.ru || country.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞';
                                return `<option value="${country.id}">${nameRu}</option>`;
                            }).join('');
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω:', error);
            }
        }

        async function loadGuideCitiesByCountry() {
            const countrySelect = document.getElementById('guideCountry');
            const citySelect = document.getElementById('guideCity');
            
            if (!countrySelect || !citySelect) return;
            
            const countryId = countrySelect.value;
            
            if (!countryId) {
                citySelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                citySelect.disabled = true;
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/cities?countryId=${countryId}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    citySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>' +
                        data.data.map(city => {
                            const nameRu = city.nameRu || city.name?.ru || city.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≥–æ—Ä–æ–¥';
                            return `<option value="${city.id}">${nameRu}</option>`;
                        }).join('');
                    citySelect.disabled = false;
                } else {
                    citySelect.innerHTML = '<option value="">–ì–æ—Ä–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</option>';
                    citySelect.disabled = true;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤:', error);
                citySelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
                citySelect.disabled = true;
            }
        }
        
        // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –§–û–†–ú–´ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ì–ò–î–ê
        async function loadEditGuideCountries() {
            try {
                const response = await fetch(`${getApiUrl()}/countries`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    const countrySelect = document.getElementById('editGuideCountry');
                    if (countrySelect) {
                        countrySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>' +
                            data.data.map(country => {
                                const nameRu = country.nameRu || country.name?.ru || country.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞';
                                return `<option value="${country.id}">${nameRu}</option>`;
                            }).join('');
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
            }
        }

        async function loadEditGuideCitiesByCountry() {
            const countrySelect = document.getElementById('editGuideCountry');
            const citySelect = document.getElementById('editGuideCity');
            
            if (!countrySelect || !citySelect) return;
            
            const countryId = countrySelect.value;
            
            if (!countryId) {
                citySelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                citySelect.disabled = true;
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/cities?countryId=${countryId}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    citySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>' +
                        data.data.map(city => {
                            const nameRu = city.nameRu || city.name?.ru || city.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≥–æ—Ä–æ–¥';
                            return `<option value="${city.id}">${nameRu}</option>`;
                        }).join('');
                    citySelect.disabled = false;
                } else {
                    citySelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
                    citySelect.disabled = true;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                citySelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
                citySelect.disabled = true;
            }
        }

        function openEditGuideModal(guide) {
            // –ü–∞—Ä—Å–∏–º –∏–º—è –≥–∏–¥–∞ (–º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ–µ –ø–æ–ª–µ)
            let guideName = '';
            try {
                if (typeof guide.name === 'string') {
                    // –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON
                    try {
                        const parsedName = JSON.parse(guide.name);
                        guideName = parsedName.ru || parsedName.en || '';
                    } catch {
                        // –ï—Å–ª–∏ –Ω–µ JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                        guideName = guide.name;
                    }
                } else if (typeof guide.name === 'object' && guide.name) {
                    guideName = guide.name.ru || guide.name.en || '';
                }
            } catch (e) {
                console.warn('Error parsing guide name:', e);
                guideName = '';
            }

            // –ü–∞—Ä—Å–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ –≥–∏–¥–∞ (–º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ–µ –ø–æ–ª–µ)
            let guideDescription = '';
            try {
                if (typeof guide.description === 'string') {
                    // –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON
                    try {
                        const parsedDescription = JSON.parse(guide.description);
                        guideDescription = parsedDescription.ru || parsedDescription.en || '';
                    } catch {
                        // –ï—Å–ª–∏ –Ω–µ JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                        guideDescription = guide.description;
                    }
                } else if (typeof guide.description === 'object' && guide.description) {
                    guideDescription = guide.description.ru || guide.description.en || '';
                } else if (guide.description) {
                    guideDescription = guide.description;
                }
            } catch (e) {
                console.warn('Error parsing guide description:', e);
                guideDescription = '';
            }
            
            // –ü–∞—Ä—Å–∏–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
            let contact = {};
            try {
                if (guide.contact) {
                    if (typeof guide.contact === 'string') {
                        contact = JSON.parse(guide.contact);
                    } else if (typeof guide.contact === 'object') {
                        contact = guide.contact;
                    }
                }
            } catch (e) {
                console.warn('Error parsing contact:', guide.contact, e);
                contact = {};
            }
            
            let documents = [];
            try {
                documents = guide.documents ? JSON.parse(guide.documents) : [];
            } catch (e) {
                console.warn('Error parsing documents:', e);
            }
            
            // –ü–∞—Ä—Å–∏–º —è–∑—ã–∫–∏
            selectedGuideLanguages = guide.languages ? guide.languages.split(', ').filter(lang => lang.trim()) : [];
            
            const modal = `
                <div id="editGuideModal" class="modal active">
                    <div class="modal-content" style="width: 600px;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-semibold">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–∏–¥–∞</h2>
                            <button onclick="closeEditGuideModal()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="editGuideForm">
                            <input type="hidden" id="editGuideId" value="${guide.id}">
                            <div class="grid grid-cols-1 gap-4">
                                <div class="form-group">
                                    <label class="form-label">–§–ò–û *</label>
                                    <input type="text" class="form-input" id="editGuideFullName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" value="${guideName}" required>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-3">üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                                            <input type="text" class="form-input" id="editGuidePassportSeries" placeholder="–ê–ê 1234567" value="${escapeHtml(guide.passportSeries || '')}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ì–æ—Å. —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</label>
                                            <input type="text" class="form-input" id="editGuideRegistration" placeholder="–ù–æ–º–µ—Ä —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞" value="${escapeHtml(guide.registration || '')}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
                                        <input type="text" class="form-input" id="editGuideResidenceAddress" placeholder="–≥. –î—É—à–∞–Ω–±–µ, —É–ª. –§–∏—Ä–¥–∞–≤—Å–∏, –¥.1" value="${escapeHtml(guide.residenceAddress || '')}">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–Ø–∑—ã–∫–∏ *</label>
                                    <div class="flex gap-2 mb-2">
                                        <select class="form-input flex-1" id="editGuideAvailableLanguages">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                                            <option value="–†—É—Å—Å–∫–∏–π">–†—É—Å—Å–∫–∏–π</option>
                                            <option value="English">English</option>

                                            <option value="–é–∑–±–µ–∫">–é–∑–±–µ–∫</option>
                                            <option value="“ö—ã—Ä“ì–∞–Ω">“ö—ã—Ä“ì–∞–Ω</option>
                                            <option value="T√ºrkmen">T√ºrkmen</option>
                                            <option value="–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                                            <option value="–ù–µ–º–µ—Ü–∫–∏–π">–ù–µ–º–µ—Ü–∫–∏–π</option>
                                            <option value="–ò—Å–ø–∞–Ω—Å–∫–∏–π">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                                            <option value="–ö–∏—Ç–∞–π—Å–∫–∏–π">–ö–∏—Ç–∞–π—Å–∫–∏–π</option>
                                            <option value="–ê—Ä–∞–±—Å–∫–∏–π">–ê—Ä–∞–±—Å–∫–∏–π</option>
                                        </select>
                                        <button type="button" onclick="addLanguageToEditGuide()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <div id="editSelectedGuideLanguages" class="space-y-1 max-h-32 overflow-y-auto border rounded p-2 bg-gray-50">
                                        <small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                                    </div>
                                    <input type="hidden" id="editGuideLanguagesHidden">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã (–ª–µ—Ç) *</label>
                                    <input type="number" class="form-input" id="editGuideExperience" min="0" max="50" value="${guide.experience || 0}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                                    <input type="tel" class="form-input" id="editGuidePhone" placeholder="+992901234567" value="${contact.phone || ''}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Email *</label>
                                    <input type="email" class="form-input" id="editGuideEmail" placeholder="guide@example.com" value="${contact.email || ''}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
                                    <textarea class="form-input" rows="3" id="editGuideComments" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–∏–¥–µ...">${guideDescription}</textarea>
                                </div>
                                
                                <!-- –ù–û–í–û–ï: –ü–æ–ª—è –¥–ª—è —Å—Ç—Ä–∞–Ω—ã –∏ –≥–æ—Ä–æ–¥–∞ -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-3">üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è —Ä–∞–±–æ—Ç—ã</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–°—Ç—Ä–∞–Ω–∞ *</label>
                                            <select class="form-input" id="editGuideCountry" onchange="loadEditGuideCitiesByCountry()" required>
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ì–æ—Ä–æ–¥ *</label>
                                            <select class="form-input" id="editGuideCity" required>
                                                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ -->
                                <div class="form-group">
                                    <label class="form-label">–§–æ—Ç–æ –≥–∏–¥–∞</label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                        <input type="file" id="editGuideAvatar" accept="image/*" class="hidden" onchange="handleEditGuideAvatarUpload(this)">
                                        <div class="text-center">
                                            <div id="editGuideAvatarPreview" class="mb-3" style="${guide.photo ? '' : 'display: none;'}">
                                                <img id="editGuideAvatarImg" src="${guide.photo ? (guide.photo.startsWith('/') ? guide.photo : '/' + guide.photo) : '#'}" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" class="w-24 h-24 object-cover rounded-full mx-auto">
                                            </div>
                                            <button type="button" onclick="document.getElementById('editGuideAvatar').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
                                                <i class="fas fa-upload mr-2"></i>–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
                                            </button>
                                            <p class="text-sm text-gray-500 mt-2">JPG, PNG –¥–æ 5MB</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
                                <div class="form-group">
                                    <label class="form-label">–î–æ–∫—É–º–µ–Ω—Ç—ã</label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                        <input type="file" id="editGuideDocuments" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="hidden" onchange="handleEditGuideDocumentsUpload(this)">
                                        <div class="text-center">
                                            <button type="button" onclick="document.getElementById('editGuideDocuments').click()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md">
                                                <i class="fas fa-file-upload mr-2"></i>–í—ã–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
                                            </button>
                                            <p class="text-sm text-gray-500 mt-2">PDF, DOC, DOCX, JPG, PNG –¥–æ 10MB –∫–∞–∂–¥—ã–π</p>
                                        </div>
                                        <div id="editGuideDocumentsList" class="mt-3" style="display: none;">
                                            <h4 class="font-medium text-gray-700 mb-2">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                                            <div id="editGuideDocumentsPreview" class="space-y-1"></div>
                                        </div>
                                    </div>
                                    
                                    ${documents.length > 0 ? `
                                        <div class="mt-4">
                                            <h4 class="font-semibold mb-2">–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:</h4>
                                            <div id="editExistingDocuments">
                                                ${documents.map(doc => `
                                                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded mb-2">
                                                        <div>
                                                            <span class="font-medium">${doc.originalName || doc.filename}</span>
                                                            <small class="text-gray-500 ml-2">(${Math.round(doc.size/1024)}KB)</small>
                                                        </div>
                                                        <button type="button" onclick="deleteGuideDocument(${guide.id}, '${doc.path}')" class="text-red-500 hover:text-red-700">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>

                                <!-- üîê –î–ê–ù–ù–´–ï –î–õ–Ø –í–•–û–î–ê –í –ö–ê–ë–ò–ù–ï–¢ -->
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-blue-900 mb-3">üîê –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="form-group">
                                            <label class="form-label">–õ–æ–≥–∏–Ω</label>
                                            <input type="text" class="form-input" id="editGuideLogin" placeholder="guide_login" value="${guide.login || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                            <input type="password" class="form-input" id="editGuidePassword" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å">
                                            <small class="text-gray-500">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å ${guide.hasPassword ? '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å.</small>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                        <select class="form-input" id="editGuideIsActive">
                                            <option value="true" ${guide.isActive ? 'selected' : ''}>–ê–∫—Ç–∏–≤–µ–Ω</option>
                                            <option value="false" ${!guide.isActive ? 'selected' : ''}>–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</option>
                                        </select>
                                    </div>
                                    <small class="text-blue-600">–ì–∏–¥ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–≤–æ–π –∫–∞–±–∏–Ω–µ—Ç —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</small>
                                </div>
                            </div>
                            
                            <div class="flex justify-end gap-3 mt-6">
                                <button type="button" onclick="closeEditGuideModal()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —è–∑—ã–∫–∏
            updateEditSelectedGuideLanguagesDisplay();
            
            // –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            loadEditGuideCountries().then(() => {
                // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω—É
                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –∏—Å–ø–æ–ª—å–∑—É–µ–º guide.guideCountry.id –∏–ª–∏ countryId –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                const countryId = guide.guideCountry ? guide.guideCountry.id : guide.countryId;
                if (countryId) {
                    const countrySelect = document.getElementById('editGuideCountry');
                    if (countrySelect) {
                        countrySelect.value = countryId;
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–æ—Ä–æ–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω—ã
                        loadEditGuideCitiesByCountry().then(() => {
                            // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –≥–æ—Ä–æ–¥
                            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –∏—Å–ø–æ–ª—å–∑—É–µ–º guide.guideCity.id –∏–ª–∏ cityId –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                            const cityId = guide.guideCity ? guide.guideCity.id : guide.cityId;
                            if (cityId) {
                                const citySelect = document.getElementById('editGuideCity');
                                if (citySelect) {
                                    citySelect.value = cityId;
                                }
                            }
                        });
                    }
                }
            });
            
            document.getElementById('editGuideForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEditGuide();
            });
        }

        function closeEditGuideModal() {
            const modal = document.getElementById('editGuideModal');
            if (modal) {
                modal.remove();
            }
            selectedGuideLanguages = [];
        }
        
        // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –Ø–ó–´–ö–ê–ú–ò –ì–ò–î–û–í
        function addLanguageToGuide() {
            const select = document.getElementById('guideAvailableLanguages');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const language = selectedOption.value;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —è–∑—ã–∫
                if (selectedGuideLanguages.includes(language)) {
                    alert('–≠—Ç–æ—Ç —è–∑—ã–∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω');
                    return;
                }
                
                selectedGuideLanguages.push(language);
                updateSelectedGuideLanguagesDisplay();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º select
                select.selectedIndex = 0;
            }
        }
        
        function removeLanguageFromGuide(language) {
            selectedGuideLanguages = selectedGuideLanguages.filter(lang => lang !== language);
            updateSelectedGuideLanguagesDisplay();
        }
        
        function updateSelectedGuideLanguagesDisplay() {
            const container = document.getElementById('selectedGuideLanguages');
            const hiddenInput = document.getElementById('guideLanguagesHidden');
            
            if (selectedGuideLanguages.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                hiddenInput.value = '';
            } else {
                container.innerHTML = selectedGuideLanguages.map(lang => 
                    `<div class="flex justify-between items-center bg-white p-2 rounded border">
                        <span>${lang}</span>
                        <button type="button" onclick="removeLanguageFromGuide('${lang}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`
                ).join('');
                hiddenInput.value = selectedGuideLanguages.join(', ');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–∏–¥–∞
        function addLanguageToEditGuide() {
            const select = document.getElementById('editGuideAvailableLanguages');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const language = selectedOption.value;
                
                if (selectedGuideLanguages.includes(language)) {
                    alert('–≠—Ç–æ—Ç —è–∑—ã–∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω');
                    return;
                }
                
                selectedGuideLanguages.push(language);
                updateEditSelectedGuideLanguagesDisplay();
                select.selectedIndex = 0;
            }
        }

        function removeLanguageFromEditGuide(language) {
            selectedGuideLanguages = selectedGuideLanguages.filter(lang => lang !== language);
            updateEditSelectedGuideLanguagesDisplay();
        }

        function updateEditSelectedGuideLanguagesDisplay() {
            const container = document.getElementById('editSelectedGuideLanguages');
            const hiddenInput = document.getElementById('editGuideLanguagesHidden');
            
            if (selectedGuideLanguages.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                hiddenInput.value = '';
            } else {
                container.innerHTML = selectedGuideLanguages.map(lang => 
                    `<div class="flex justify-between items-center bg-white p-2 rounded border">
                        <span>${lang}</span>
                        <button type="button" onclick="removeLanguageFromEditGuide('${lang}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`
                ).join('');
                hiddenInput.value = selectedGuideLanguages.join(', ');
            }
        }

        async function saveEditGuide() {
            const guideId = document.getElementById('editGuideId').value;
            const name = document.getElementById('editGuideFullName').value.trim();
            const email = document.getElementById('editGuideEmail').value.trim();
            const phone = document.getElementById('editGuidePhone').value.trim();
            const description = document.getElementById('editGuideComments').value.trim();
            const experience = document.getElementById('editGuideExperience').value;
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ JSON (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π —Å–æ–∑–¥–∞–Ω–∏—è)
            const nameJson = JSON.stringify({
                ru: name,
                en: name  // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤
            });
            
            const descriptionJson = JSON.stringify({
                ru: description,
                en: description  // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤
            });
            
            // –ù–æ–≤—ã–µ –ø–æ–ª—è
            const passportSeries = document.getElementById('editGuidePassportSeries').value.trim();
            const registration = document.getElementById('editGuideRegistration').value.trim();
            const residenceAddress = document.getElementById('editGuideResidenceAddress').value.trim();
            
            // üîê –ü–æ–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const login = document.getElementById('editGuideLogin').value.trim();
            const password = document.getElementById('editGuidePassword').value.trim();
            const isActive = document.getElementById('editGuideIsActive').value === 'true';
            
            // –ù–û–í–û–ï: –ü–æ–ª—É—á–∞–µ–º countryId –∏ cityId
            const countryId = document.getElementById('editGuideCountry')?.value;
            const cityId = document.getElementById('editGuideCity')?.value;

            if (!name || !email || selectedGuideLanguages.length === 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω—ã –∏ –≥–æ—Ä–æ–¥–∞
            if (!countryId || countryId.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –≥–∏–¥–∞');
                return;
            }
            
            if (!cityId || cityId.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è –≥–∏–¥–∞');
                return;
            }

            console.log('üîç –í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏:', selectedGuideLanguages);
            console.log('üì∑ –î–æ–±–∞–≤–ª–µ–Ω –∞–≤–∞—Ç–∞—Ä:', editGuideAvatarFile ? editGuideAvatarFile.name : '–ù–µ—Ç');
            console.log('üìÑ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:', editGuideDocumentFiles.length);
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≥–∏–¥–∞ —Å —Ñ–∞–π–ª–∞–º–∏');

            try {
                const formData = new FormData();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
                formData.append('name', nameJson);
                formData.append('description', descriptionJson);
                formData.append('email', email);
                formData.append('phone', phone);
                formData.append('languages', selectedGuideLanguages.join(', '));
                formData.append('experience', experience);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è
                formData.append('passportSeries', passportSeries);
                formData.append('registration', registration);
                formData.append('residenceAddress', residenceAddress);
                
                // üîê –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                formData.append('login', login);
                formData.append('isActive', isActive.toString());
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –Ω–µ –ø—É—Å—Ç–æ–π
                if (password) {
                    formData.append('password', password);
                }
                
                // –ù–û–í–û–ï: –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω—É –∏ –≥–æ—Ä–æ–¥
                if (countryId) {
                    formData.append('countryId', countryId.toString());
                }
                if (cityId) {
                    formData.append('cityId', cityId.toString());
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã
                if (editGuideAvatarFile) {
                    formData.append('avatar', editGuideAvatarFile);
                }
                
                if (editGuideDocumentFiles.length > 0) {
                    editGuideDocumentFiles.forEach(file => {
                        formData.append('documents', file);
                    });
                }

                const response = await fetch(`${getApiUrl()}/guide/profile/${guideId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': getAuthHeaders()['Authorization']
                    },
                    body: formData
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('–ì–∏–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    closeEditGuideModal();
                    loadGuides();
                } else {
                    throw new Error(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≥–∏–¥–∞');
                }

            } catch (err) {
                console.error('Error updating guide:', err);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≥–∏–¥–∞: ' + err.message);
            }
        }

        async function deleteGuideDocument(guideId, documentPath) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç?')) {
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/guide/profile/${guideId}/document`, {
                    method: 'DELETE',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ documentPath })
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞');
                }

                alert('–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ DOM
                const docElement = document.querySelector(`[onclick="deleteGuideDocument(${guideId}, '${documentPath}')"]`).closest('div');
                if (docElement) {
                    docElement.remove();
                }

            } catch (err) {
                console.error('Error deleting document:', err);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: ' + err.message);
            }
        }
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        let guideAvatarFile = null;
        let guideDocumentFiles = [];
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        let editGuideAvatarFile = null;
        let editGuideDocumentFiles = [];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞
        function handleGuideAvatarUpload(input) {
            const file = input.files[0];
            if (!file) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (5MB –º–∞–∫—Å–∏–º—É–º)
            if (file.size > 5 * 1024 * 1024) {
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
                input.value = '';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            if (!allowedTypes.includes(file.type)) {
                alert('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞. –†–∞–∑—Ä–µ—à–µ–Ω—ã: JPG, PNG');
                input.value = '';
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            guideAvatarFile = file;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('guideAvatarImg').src = e.target.result;
                document.getElementById('guideAvatarPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        function handleGuideDocumentsUpload(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
            const validFiles = [];
            const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/jpg', 'image/png'];
            
            for (const file of files) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (10MB –º–∞–∫—Å–∏–º—É–º)
                if (file.size > 10 * 1024 * 1024) {
                    alert(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB`);
                    continue;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
                if (!allowedTypes.includes(file.type)) {
                    alert(`–§–∞–π–ª "${file.name}" –∏–º–µ–µ—Ç –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø. –†–∞–∑—Ä–µ—à–µ–Ω—ã: PDF, DOC, DOCX, JPG, PNG`);
                    continue;
                }

                validFiles.push(file);
            }

            if (validFiles.length === 0) {
                input.value = '';
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            guideDocumentFiles = validFiles;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            const previewContainer = document.getElementById('guideDocumentsPreview');
            previewContainer.innerHTML = '';
            
            validFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'flex items-center justify-between bg-white p-2 rounded border';
                fileDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-gray-500 mr-2"></i>
                        <span class="text-sm">${file.name}</span>
                        <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                    <button type="button" onclick="removeGuideDocument(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                previewContainer.appendChild(fileDiv);
            });

            document.getElementById('guideDocumentsList').style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        function removeGuideDocument(index) {
            guideDocumentFiles.splice(index, 1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            const previewContainer = document.getElementById('guideDocumentsPreview');
            previewContainer.innerHTML = '';
            
            if (guideDocumentFiles.length === 0) {
                document.getElementById('guideDocumentsList').style.display = 'none';
                document.getElementById('guideDocuments').value = '';
                return;
            }

            guideDocumentFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'flex items-center justify-between bg-white p-2 rounded border';
                fileDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-gray-500 mr-2"></i>
                        <span class="text-sm">${file.name}</span>
                        <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                    <button type="button" onclick="removeGuideDocument(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                previewContainer.appendChild(fileDiv);
            });
        }

        // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –§–û–†–ú–´ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ===

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function handleEditGuideAvatarUpload(input) {
            const file = input.files[0];
            if (!file) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (5MB –º–∞–∫—Å–∏–º—É–º)
            if (file.size > 5 * 1024 * 1024) {
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
                input.value = '';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            if (!allowedTypes.includes(file.type)) {
                alert('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞. –†–∞–∑—Ä–µ—à–µ–Ω—ã: JPG, PNG');
                input.value = '';
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            editGuideAvatarFile = file;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('editGuideAvatarImg').src = e.target.result;
                document.getElementById('editGuideAvatarPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function handleEditGuideDocumentsUpload(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
            const validFiles = [];
            const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/jpg', 'image/png'];
            
            for (const file of files) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (10MB –º–∞–∫—Å–∏–º—É–º)
                if (file.size > 10 * 1024 * 1024) {
                    alert(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB`);
                    continue;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
                if (!allowedTypes.includes(file.type)) {
                    alert(`–§–∞–π–ª "${file.name}" –∏–º–µ–µ—Ç –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø. –†–∞–∑—Ä–µ—à–µ–Ω—ã: PDF, DOC, DOCX, JPG, PNG`);
                    continue;
                }

                validFiles.push(file);
            }

            if (validFiles.length === 0) {
                input.value = '';
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            editGuideDocumentFiles = validFiles;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            const previewContainer = document.getElementById('editGuideDocumentsPreview');
            previewContainer.innerHTML = '';
            
            validFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'flex items-center justify-between bg-white p-2 rounded border';
                fileDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-gray-500 mr-2"></i>
                        <span class="text-sm">${file.name}</span>
                        <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                    <button type="button" onclick="removeEditGuideDocument(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                previewContainer.appendChild(fileDiv);
            });

            document.getElementById('editGuideDocumentsList').style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function removeEditGuideDocument(index) {
            editGuideDocumentFiles.splice(index, 1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            const previewContainer = document.getElementById('editGuideDocumentsPreview');
            previewContainer.innerHTML = '';
            
            if (editGuideDocumentFiles.length === 0) {
                document.getElementById('editGuideDocumentsList').style.display = 'none';
                document.getElementById('editGuideDocuments').value = '';
                return;
            }

            editGuideDocumentFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'flex items-center justify-between bg-white p-2 rounded border';
                fileDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-gray-500 mr-2"></i>
                        <span class="text-sm">${file.name}</span>
                        <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                    <button type="button" onclick="removeEditGuideDocument(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                previewContainer.appendChild(fileDiv);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —è–∑—ã–∫–∞ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function addLanguageToEditGuide() {
            const select = document.getElementById('editGuideAvailableLanguages');
            const language = select.value;
            
            if (!language || selectedGuideLanguages.includes(language)) {
                return;
            }
            
            selectedGuideLanguages.push(language);
            updateEditSelectedGuideLanguagesDisplay();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
            select.value = '';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function updateEditSelectedGuideLanguagesDisplay() {
            const container = document.getElementById('editSelectedGuideLanguages');
            
            if (selectedGuideLanguages.length === 0) {
                container.innerHTML = '<small class="text-gray-500">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>';
                return;
            }
            
            container.innerHTML = selectedGuideLanguages.map((lang, index) => `
                <div class="flex items-center justify-between bg-white p-2 rounded border">
                    <span class="text-sm">${lang}</span>
                    <button type="button" onclick="removeEditLanguageFromGuide(${index})" class="text-red-500 hover:text-red-700 ml-2">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            `).join('');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —è–∑—ã–∫–∞ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function removeEditLanguageFromGuide(index) {
            selectedGuideLanguages.splice(index, 1);
            updateEditSelectedGuideLanguagesDisplay();
        }













        




        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        function saveGuide() {
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –∏–∑ –Ω–æ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            console.log('üîç –í—ã–±—Ä–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏:', selectedGuideLanguages);
            
            // –ü–æ–ª—É—á–∞–µ–º –§–ò–û –∏–∑ –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π
            const fullNameRu = safeGetValue('guideFullNameRu', '').trim();
            const fullNameEn = safeGetValue('guideFullNameEn', '').trim();
            
            // –°–æ–∑–¥–∞–µ–º –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–µ –§–ò–û
            const fullName = JSON.stringify({
                ru: fullNameRu,
                en: fullNameEn
            });
            
            // –ü–æ–ª—É—á–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–≤—Å–µ —Ç–µ–ø–µ—Ä—å –ù–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
            const experience = safeGetValue('guideExperience', '', 'int') || 0;
            const phone = safeGetValue('guidePhone', '').trim();
            const email = safeGetValue('guideEmail', '').trim();
            const login = safeGetValue('guideLogin', '').trim();
            const password = safeGetValue('guidePassword', '').trim();
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π
            const commentsRu = safeGetValue('guideCommentsRu', '').trim();
            const commentsEn = safeGetValue('guideCommentsEn', '').trim();
            const comments = JSON.stringify({
                ru: commentsRu,
                en: commentsEn
            });
            
            // –ù–æ–≤—ã–µ –ø–æ–ª—è
            const passportSeries = safeGetValue('guidePassportSeries', '').trim();
            const registration = safeGetValue('guideRegistration', '').trim();
            const residenceAddress = safeGetValue('guideResidenceAddress', '').trim();
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—É –∏ –≥–æ—Ä–æ–¥
            const countryId = safeGetValue('guideCountry', '', 'int') || null;
            const cityId = safeGetValue('guideCity', '', 'int') || null;
            
            // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å
            const isActive = safeGetValue('guideIsActive', 'true');
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
            const pricePerDay = safeGetValue('guidePricePerDay', '', 'float') || null;
            const currency = safeGetValue('guideCurrency', 'TJS');
            const isHireable = safeGetValue('guideIsHireable', 'true');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ - –§–ò–û
            if (!fullNameRu && !fullNameEn) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û —Ö–æ—Ç—è –±—ã –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ (—Ä—É—Å—Å–∫–æ–º –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º)');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö
            const formData = new FormData();
            formData.append('name', fullName);
            formData.append('description', comments);
            formData.append('languages', JSON.stringify(selectedGuideLanguages.length > 0 ? selectedGuideLanguages : ['–†—É—Å—Å–∫–∏–π']));
            formData.append('experience', experience.toString());
            formData.append('phone', phone || '');
            formData.append('email', email || 'noemail@example.com');
            formData.append('login', login || `guide_${Date.now()}`);
            if (password && password.trim()) {
                formData.append('password', password);
            }
            formData.append('isActive', isActive === 'true' ? 'true' : 'false');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è
            formData.append('passportSeries', passportSeries);
            formData.append('registration', registration);
            formData.append('residenceAddress', residenceAddress);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω—É –∏ –≥–æ—Ä–æ–¥
            if (countryId) {
                formData.append('countryId', countryId.toString());
            }
            if (cityId) {
                formData.append('cityId', cityId.toString());
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
            if (pricePerDay !== null && !isNaN(pricePerDay) && pricePerDay > 0) {
                formData.append('pricePerDay', pricePerDay.toString());
            }
            formData.append('currency', currency);
            formData.append('isHireable', isHireable === 'true' ? 'true' : 'false');

            // –î–æ–±–∞–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω
            if (guideAvatarFile) {
                formData.append('avatar', guideAvatarFile);
                console.log('üì∑ –î–æ–±–∞–≤–ª–µ–Ω –∞–≤–∞—Ç–∞—Ä:', guideAvatarFile.name);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã
            guideDocumentFiles.forEach((file, index) => {
                formData.append('documents', file);
            });
            if (guideDocumentFiles.length > 0) {
                console.log('üìÑ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:', guideDocumentFiles.length);
            }
            
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≥–∏–¥–∞ —Å —Ñ–∞–π–ª–∞–º–∏');
            
            // –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑ Content-Type (–±—Ä–∞—É–∑–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–ª—è FormData)
            const headers = getAuthHeaders();
            delete headers['Content-Type'];
            
            fetch(`${getApiUrl()}/guide/create-with-auth`, {
                method: 'POST',
                headers: headers,
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('–ì–∏–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    closeGuideModal();
                    loadGuides();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥–∏–¥–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('Error saving guide:', err);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≥–∏–¥–∞');
            });
        }
        
        async function editGuide(id) {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≥–∏–¥–∞ —Å –≤–∫–ª—é—á–µ–Ω–∏–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const response = await fetch(`${getApiUrl()}/guides/${id}?includeRaw=true`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≥–∏–¥–∞');
                }
                
                const data = await response.json();
                const guide = data.data;
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                openEditGuideModal(guide);
                
            } catch (err) {
                console.error('Error loading guide:', err);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –≥–∏–¥–∞');
            }
        }
        
        function deleteGuide(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –≥–∏–¥–∞?')) {
                fetch(`${getApiUrl()}/guides/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–ì–∏–¥ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                        loadGuides();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≥–∏–¥–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting guide:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≥–∏–¥–∞');
                });
            }
        }
        
        function toggleGuideStatus(guideId, newStatus) {
            const statusText = newStatus === 'true' ? '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å';
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${statusText} —ç—Ç–æ–≥–æ –≥–∏–¥–∞?`)) {
                fetch(`${getApiUrl()}/guides/${guideId}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        isActive: newStatus === 'true'
                    })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert(`–ì–∏–¥ —É—Å–ø–µ—à–Ω–æ ${newStatus === 'true' ? '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω' : '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω'}`);
                        loadGuides();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –≥–∏–¥–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error toggling guide status:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –≥–∏–¥–∞');
                });
            }
        }
        
        function togglePassword(guideId, hasPassword) {
            const passwordElement = document.getElementById(`password-${guideId}`);
            const buttonElement = passwordElement.nextElementSibling;
            const icon = buttonElement.querySelector('i');
            
            if (passwordElement.textContent === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–∞—Ä–æ–ª—è
                passwordElement.textContent = hasPassword ? '–ü–∞—Ä–æ–ª—å –∑–∞–¥–∞–Ω' : '–ü–∞—Ä–æ–ª—å –Ω–µ –∑–∞–¥–∞–Ω';
                icon.className = 'fas fa-eye-slash';
            } else {
                // –°–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å
                passwordElement.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                icon.className = 'fas fa-eye';
            }
        }

        // =============================================
        // TOUR AGENTS FUNCTIONS
        // =============================================
        
        // Variables for tour agent management
        let tourAgentPhotoFile = null;
        let allTourAgents = [];
        let filteredTourAgents = [];
        
        // Load tour agents
        async function loadTourAgents() {
            try {
                console.log('üîÑ Loading tour agents...');
                
                const response = await fetch(`${getApiUrl()}/tour-agents`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                allTourAgents = data.data || [];
                filteredTourAgents = [...allTourAgents];
                
                displayTourAgents(filteredTourAgents);
            } catch (error) {
                console.error('‚ùå Error loading tour agents:', error);
                document.getElementById('tourAgentsList').innerHTML = 
                    '<div class="text-center py-8 text-red-600">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç–æ–≤</div>';
            }
        }
        
        // Display tour agents
        function displayTourAgents(tourAgents) {
            const container = document.getElementById('tourAgentsList');
            
            if (!tourAgents || tourAgents.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-handshake text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl text-gray-500 mb-2">–ù–µ—Ç —Ç—É—Ä–∞–≥–µ–Ω—Ç–æ–≤</h3>
                        <p class="text-gray-400">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = tourAgents.map(agent => `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow">
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-12 h-12 rounded-full overflow-hidden mr-3 bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                                    ${validateImageUrl(agent.photo) ? 
                                        `<img src="${validateImageUrl(agent.photo)}" alt="${escapeHtml(agent.name)}" class="w-full h-full object-cover">` :
                                        `<i class="fas fa-handshake text-white text-lg"></i>`
                                    }
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">${escapeHtml(agent.name)}</h3>
                                    <p class="text-sm text-gray-600">${escapeHtml(agent.organization || '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞')}</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 text-xs rounded-full ${agent.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${agent.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                            </span>
                        </div>
                        
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            ${agent.website ? `
                                <div class="flex items-center">
                                    <i class="fas fa-globe w-4 mr-2"></i>
                                    <a href="${validateHttpUrl(agent.website) || '#'}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">${escapeHtml(agent.website)}</a>
                                </div>
                            ` : ''}
                            ${agent.contactPhone ? `
                                <div class="flex items-center">
                                    <i class="fas fa-phone w-4 mr-2"></i>
                                    <span>${escapeHtml(agent.contactPhone)}</span>
                                </div>
                            ` : ''}
                            ${agent.contactEmail ? `
                                <div class="flex items-center">
                                    <i class="fas fa-envelope w-4 mr-2"></i>
                                    <span>${escapeHtml(agent.contactEmail)}</span>
                                </div>
                            ` : ''}
                            ${agent.stateRegistration ? `
                                <div class="flex items-center">
                                    <i class="fas fa-certificate w-4 mr-2"></i>
                                    <span>–†–µ–≥: ${escapeHtml(agent.stateRegistration)}</span>
                                </div>
                            ` : ''}
                            ${agent.country?.nameRu ? `
                                <div class="flex items-center">
                                    <i class="fas fa-map-marker-alt w-4 mr-2"></i>
                                    <span>${escapeHtml(agent.country.nameRu)}${agent.city?.nameRu ? ', ' + escapeHtml(agent.city.nameRu) : ''}</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${agent.description ? `
                            <p class="text-sm text-gray-700 mb-4 line-clamp-3">${agent.description}</p>
                        ` : ''}
                        
                        <div class="flex gap-2">
                            <button onclick="editTourAgent(${agent.id})" class="btn btn-secondary btn-sm flex-1">
                                <i class="fas fa-edit mr-1"></i>
                                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button onclick="toggleTourAgentStatus(${agent.id}, ${!agent.isActive})" 
                                    class="btn ${agent.isActive ? 'btn-warning' : 'btn-success'} btn-sm">
                                <i class="fas fa-${agent.isActive ? 'pause' : 'play'} mr-1"></i>
                                ${agent.isActive ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'}
                            </button>
                            <button onclick="deleteTourAgent(${agent.id})" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash mr-1"></i>
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Search tour agents
        function searchTourAgents() {
            const searchTerm = document.getElementById('tourAgentSearch').value.toLowerCase();
            filteredTourAgents = allTourAgents.filter(agent => 
                agent.name.toLowerCase().includes(searchTerm) ||
                agent.organization.toLowerCase().includes(searchTerm) ||
                (agent.contactName && agent.contactName.toLowerCase().includes(searchTerm)) ||
                (agent.description && agent.description.toLowerCase().includes(searchTerm))
            );
            displayTourAgents(filteredTourAgents);
        }
        
        // Filter tour agents
        function filterTourAgents() {
            const filter = document.getElementById('tourAgentFilter').value;
            let filtered = [...allTourAgents];
            
            if (filter === 'active') {
                filtered = filtered.filter(agent => agent.isActive);
            } else if (filter === 'inactive') {
                filtered = filtered.filter(agent => !agent.isActive);
            }
            
            const searchTerm = document.getElementById('tourAgentSearch').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(agent => 
                    agent.name.toLowerCase().includes(searchTerm) ||
                    agent.organization.toLowerCase().includes(searchTerm) ||
                    (agent.contactName && agent.contactName.toLowerCase().includes(searchTerm)) ||
                    (agent.description && agent.description.toLowerCase().includes(searchTerm))
                );
            }
            
            filteredTourAgents = filtered;
            displayTourAgents(filteredTourAgents);
        }
        
        // Open tour agent modal
        function openTourAgentModal() {
            const modal = `
                <div id="tourAgentModal" class="modal active">
                    <div class="modal-content" style="width: 700px; max-height: 90vh; overflow-y: auto;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-semibold">–î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞</h2>
                            <button onclick="closeTourAgentModal()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="tourAgentForm">
                            <div class="grid grid-cols-1 gap-6">
                                <!-- Basic Information -->
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-blue-900 mb-3">üè¢ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                                            <input type="text" class="form-input" id="tourAgentName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è *</label>
                                            <input type="text" class="form-input" id="tourAgentOrganization" placeholder="–û–û–û –¢—É—Ä–∞–≥–µ–Ω—Ç—Å—Ç–≤–æ" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–í–µ–±-—Å–∞–π—Ç</label>
                                            <input type="url" class="form-input" id="tourAgentWebsite" placeholder="https://example.com">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ì–æ—Å. —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</label>
                                            <input type="text" class="form-input" id="tourAgentStateRegistration" placeholder="–ù–æ–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Contact Information -->
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-green-900 mb-3">üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                                            <input type="text" class="form-input" id="tourAgentContactName" placeholder="–§–ò–û –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                            <input type="tel" class="form-input" id="tourAgentContactPhone" placeholder="+992901234567">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-input" id="tourAgentContactEmail" placeholder="info@example.com">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ê–¥—Ä–µ—Å</label>
                                            <input type="text" class="form-input" id="tourAgentAddress" placeholder="–ê–¥—Ä–µ—Å –æ—Ñ–∏—Å–∞">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Location -->
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-purple-900 mb-3">üåç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                                            <select class="form-input" id="tourAgentCountry" onchange="loadCitiesForTourAgent()">
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ì–æ—Ä–æ–¥</label>
                                            <select class="form-input" id="tourAgentCity">
                                                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Description and Photo -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="form-group">
                                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                        <textarea class="form-input" rows="4" id="tourAgentDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞..."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–§–æ—Ç–æ/–õ–æ–≥–æ—Ç–∏–ø</label>
                                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                            <input type="file" id="tourAgentPhoto" accept="image/*" class="hidden" onchange="handleTourAgentPhotoUpload(this)">
                                            <div class="text-center" id="tourAgentPhotoUploader">
                                                <button type="button" onclick="document.getElementById('tourAgentPhoto').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
                                                    <i class="fas fa-image mr-2"></i>–í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                                </button>
                                                <p class="text-sm text-gray-500 mt-2">JPG, PNG –¥–æ 5MB</p>
                                            </div>
                                            <div id="tourAgentPhotoPreview" class="hidden mt-3">
                                                <img id="tourAgentPhotoImg" src="" alt="Preview" class="w-full h-32 object-cover rounded-lg">
                                                <button type="button" onclick="removeTourAgentPhoto()" class="text-red-600 text-sm mt-2 hover:underline">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end gap-3 mt-6">
                                <button type="button" onclick="closeTourAgentModal()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // Load countries for dropdown
            loadCountriesForTourAgent();
            
            document.getElementById('tourAgentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveTourAgent();
            });
        }
        
        // Close tour agent modal
        function closeTourAgentModal() {
            const modal = document.getElementById('tourAgentModal');
            if (modal) {
                modal.remove();
            }
            tourAgentPhotoFile = null;
        }
        
        // Handle photo upload
        function handleTourAgentPhotoUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB');
                    return;
                }
                
                tourAgentPhotoFile = file;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('tourAgentPhotoImg').src = e.target.result;
                    document.getElementById('tourAgentPhotoUploader').classList.add('hidden');
                    document.getElementById('tourAgentPhotoPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Remove photo
        function removeTourAgentPhoto() {
            tourAgentPhotoFile = null;
            document.getElementById('tourAgentPhotoUploader').classList.remove('hidden');
            document.getElementById('tourAgentPhotoPreview').classList.add('hidden');
            document.getElementById('tourAgentPhoto').value = '';
        }
        
        // Load countries for dropdown
        async function loadCountriesForTourAgent() {
            try {
                const response = await fetch(`${getApiUrl()}/countries`);
                const data = await response.json();
                
                const select = document.getElementById('tourAgentCountry');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                
                data.data.forEach(country => {
                    select.innerHTML += `<option value="${country.id}">${country.nameRu}</option>`;
                });
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }
        
        // Load cities for tour agent
        async function loadCitiesForTourAgent() {
            const countryId = document.getElementById('tourAgentCountry').value;
            const citySelect = document.getElementById('tourAgentCity');
            
            if (!countryId) {
                citySelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/cities?countryId=${countryId}`);
                const data = await response.json();
                
                citySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
                data.data.forEach(city => {
                    citySelect.innerHTML += `<option value="${city.id}">${city.nameRu}</option>`;
                });
            } catch (error) {
                console.error('Error loading cities:', error);
                citySelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤</option>';
            }
        }
        
        // Save tour agent
        async function saveTourAgent() {
            const name = document.getElementById('tourAgentName').value.trim();
            const organization = document.getElementById('tourAgentOrganization').value.trim();
            
            if (!name || !organization) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é');
                return;
            }
            
            const formData = new FormData();
            formData.append('name', name);
            formData.append('organization', organization);
            formData.append('website', document.getElementById('tourAgentWebsite').value.trim());
            formData.append('stateRegistration', document.getElementById('tourAgentStateRegistration').value.trim());
            formData.append('contactName', document.getElementById('tourAgentContactName').value.trim());
            formData.append('contactPhone', document.getElementById('tourAgentContactPhone').value.trim());
            formData.append('contactEmail', document.getElementById('tourAgentContactEmail').value.trim());
            formData.append('address', document.getElementById('tourAgentAddress').value.trim());
            formData.append('description', document.getElementById('tourAgentDescription').value.trim());
            
            const countryId = document.getElementById('tourAgentCountry').value;
            const cityId = document.getElementById('tourAgentCity').value;
            if (countryId) formData.append('countryId', countryId);
            if (cityId) formData.append('cityId', cityId);
            
            if (tourAgentPhotoFile) {
                formData.append('photo', tourAgentPhotoFile);
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/tour-agents`, {
                    method: 'POST',
                    headers: {
                        'Authorization': getAuthHeaders()['Authorization']
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('–¢—É—Ä–∞–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    closeTourAgentModal();
                    loadTourAgents();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('Error saving tour agent:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞');
            }
        }
        
        // Edit tour agent
        async function editTourAgent(id) {
            try {
                const response = await fetch(`${getApiUrl()}/tour-agents/${id}`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞');
                }
                
                const data = await response.json();
                const agent = data.data;
                
                openEditTourAgentModal(agent);
            } catch (error) {
                console.error('Error loading tour agent:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞');
            }
        }
        
        // Open edit tour agent modal
        function openEditTourAgentModal(agent) {
            const modal = `
                <div id="editTourAgentModal" class="modal active">
                    <div class="modal-content" style="width: 700px; max-height: 90vh; overflow-y: auto;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-semibold">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞</h2>
                            <button onclick="closeEditTourAgentModal()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="editTourAgentForm">
                            <input type="hidden" id="editTourAgentId" value="${agent.id}">
                            <div class="grid grid-cols-1 gap-6">
                                <!-- Basic Information -->
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-blue-900 mb-3">üè¢ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                                            <input type="text" class="form-input" id="editTourAgentName" value="${agent.name || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è *</label>
                                            <input type="text" class="form-input" id="editTourAgentOrganization" value="${agent.organization || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–í–µ–±-—Å–∞–π—Ç</label>
                                            <input type="url" class="form-input" id="editTourAgentWebsite" value="${agent.website || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ì–æ—Å. —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</label>
                                            <input type="text" class="form-input" id="editTourAgentStateRegistration" value="${agent.stateRegistration || ''}">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Contact Information -->
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-green-900 mb-3">üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                                            <input type="text" class="form-input" id="editTourAgentContactName" value="${agent.contactName || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                            <input type="tel" class="form-input" id="editTourAgentContactPhone" value="${agent.contactPhone || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-input" id="editTourAgentContactEmail" value="${agent.contactEmail || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ê–¥—Ä–µ—Å</label>
                                            <input type="text" class="form-input" id="editTourAgentAddress" value="${agent.address || ''}">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Location -->
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-purple-900 mb-3">üåç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                                            <select class="form-input" id="editTourAgentCountry" onchange="loadCitiesForEditTourAgent()">
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ì–æ—Ä–æ–¥</label>
                                            <select class="form-input" id="editTourAgentCity">
                                                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Description and Photo -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="form-group">
                                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                        <textarea class="form-input" rows="4" id="editTourAgentDescription">${agent.description || ''}</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–§–æ—Ç–æ/–õ–æ–≥–æ—Ç–∏–ø</label>
                                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                            <input type="file" id="editTourAgentPhoto" accept="image/*" class="hidden" onchange="handleEditTourAgentPhotoUpload(this)">
                                            <div class="text-center" id="editTourAgentPhotoUploader" ${agent.photo ? 'style="display: none;"' : ''}>
                                                <button type="button" onclick="document.getElementById('editTourAgentPhoto').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
                                                    <i class="fas fa-image mr-2"></i>–í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                                </button>
                                                <p class="text-sm text-gray-500 mt-2">JPG, PNG –¥–æ 5MB</p>
                                            </div>
                                            <div id="editTourAgentPhotoPreview" class="${agent.photo ? '' : 'hidden'} mt-3">
                                                <img id="editTourAgentPhotoImg" src="${agent.photo || ''}" alt="Preview" class="w-full h-32 object-cover rounded-lg">
                                                <button type="button" onclick="removeEditTourAgentPhoto()" class="text-red-600 text-sm mt-2 hover:underline">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Status -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-medium text-gray-900 mb-3">‚öôÔ∏è –°—Ç–∞—Ç—É—Å</h4>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="editTourAgentIsActive" ${agent.isActive ? 'checked' : ''} class="mr-2">
                                        <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="flex justify-end gap-3 mt-6">
                                <button type="button" onclick="closeEditTourAgentModal()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // Load countries and set selected values
            loadCountriesForEditTourAgent(agent);
            
            document.getElementById('editTourAgentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateTourAgent();
            });
        }
        
        // Load countries for edit modal
        async function loadCountriesForEditTourAgent(agent = null) {
            try {
                const response = await fetch(`${getApiUrl()}/countries`);
                const data = await response.json();
                
                const select = document.getElementById('editTourAgentCountry');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                
                data.data.forEach(country => {
                    const selected = agent && agent.countryId === country.id ? 'selected' : '';
                    select.innerHTML += `<option value="${country.id}" ${selected}>${country.nameRu}</option>`;
                });
                
                // Load cities if country is selected
                if (agent && agent.countryId) {
                    await loadCitiesForEditTourAgent(agent);
                }
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }
        
        // Load cities for edit tour agent
        async function loadCitiesForEditTourAgent(agent = null) {
            const countryId = document.getElementById('editTourAgentCountry').value;
            const citySelect = document.getElementById('editTourAgentCity');
            
            if (!countryId) {
                citySelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/cities?countryId=${countryId}`);
                const data = await response.json();
                
                citySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
                data.data.forEach(city => {
                    const selected = agent && agent.cityId === city.id ? 'selected' : '';
                    citySelect.innerHTML += `<option value="${city.id}" ${selected}>${city.nameRu}</option>`;
                });
            } catch (error) {
                console.error('Error loading cities:', error);
                citySelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤</option>';
            }
        }
        
        // Handle edit photo upload
        function handleEditTourAgentPhotoUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB');
                    return;
                }
                
                tourAgentPhotoFile = file;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('editTourAgentPhotoImg').src = e.target.result;
                    document.getElementById('editTourAgentPhotoUploader').style.display = 'none';
                    document.getElementById('editTourAgentPhotoPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Remove edit photo
        function removeEditTourAgentPhoto() {
            tourAgentPhotoFile = null;
            document.getElementById('editTourAgentPhotoUploader').style.display = 'block';
            document.getElementById('editTourAgentPhotoPreview').classList.add('hidden');
            document.getElementById('editTourAgentPhoto').value = '';
        }
        
        // Close edit tour agent modal
        function closeEditTourAgentModal() {
            const modal = document.getElementById('editTourAgentModal');
            if (modal) {
                modal.remove();
            }
            tourAgentPhotoFile = null;
        }
        
        // Update tour agent
        async function updateTourAgent() {
            const id = document.getElementById('editTourAgentId').value;
            const name = document.getElementById('editTourAgentName').value.trim();
            const organization = document.getElementById('editTourAgentOrganization').value.trim();
            
            if (!name || !organization) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é');
                return;
            }
            
            const formData = new FormData();
            formData.append('name', name);
            formData.append('organization', organization);
            formData.append('website', document.getElementById('editTourAgentWebsite').value.trim());
            formData.append('stateRegistration', document.getElementById('editTourAgentStateRegistration').value.trim());
            formData.append('contactName', document.getElementById('editTourAgentContactName').value.trim());
            formData.append('contactPhone', document.getElementById('editTourAgentContactPhone').value.trim());
            formData.append('contactEmail', document.getElementById('editTourAgentContactEmail').value.trim());
            formData.append('address', document.getElementById('editTourAgentAddress').value.trim());
            formData.append('description', document.getElementById('editTourAgentDescription').value.trim());
            formData.append('isActive', document.getElementById('editTourAgentIsActive').checked);
            
            const countryId = document.getElementById('editTourAgentCountry').value;
            const cityId = document.getElementById('editTourAgentCity').value;
            if (countryId) formData.append('countryId', countryId);
            if (cityId) formData.append('cityId', cityId);
            
            if (tourAgentPhotoFile) {
                formData.append('photo', tourAgentPhotoFile);
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/tour-agents/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': getAuthHeaders()['Authorization']
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('–¢—É—Ä–∞–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!');
                    closeEditTourAgentModal();
                    loadTourAgents();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('Error updating tour agent:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞');
            }
        }
        
        // Delete tour agent
        function deleteTourAgent(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞?')) {
                fetch(`${getApiUrl()}/tour-agents/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–¢—É—Ä–∞–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
                        loadTourAgents();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting tour agent:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞');
                });
            }
        }
        
        // Toggle tour agent status
        function toggleTourAgentStatus(id, newStatus) {
            const statusText = newStatus ? '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å';
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${statusText} —ç—Ç–æ–≥–æ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞?`)) {
                fetch(`${getApiUrl()}/tour-agents/${id}/toggle-status`, {
                    method: 'PATCH',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert(`–¢—É—Ä–∞–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ ${newStatus ? '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω' : '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω'}`);
                        loadTourAgents();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error toggling tour agent status:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞');
                });
            }
        }

        // =============================================
        // CMS FUNCTIONS
        // =============================================
        
        // CMS Tab switching - –ò–°–ü–†–ê–í–õ–ï–ù–û
        function switchCMSTab(tab) {
            // Hide all CMS tabs
            document.getElementById('cmsBlocksTab').style.display = 'none';
            document.getElementById('cmsSettingsTab').style.display = 'none';
            document.getElementById('cmsPagesTab').style.display = 'none';
            document.getElementById('cmsMenusTab').style.display = 'none';
            
            // Show selected tab
            document.getElementById(`cms${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`).style.display = 'block';
            
            // Update tab buttons
            document.querySelectorAll('#cmsSection .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load data for the selected tab
            switch(tab) {
                case 'blocks':
                    loadCMSContentBlocks();
                    break;
                case 'settings':
                    loadCMSSettings();
                    break;
                case 'pages':
                    loadCMSPages();
                    break;
                case 'menus':
                    loadCMSMenus();
                    break;
            }
        }
        
        // Load CMS Content Blocks
        function loadCMSContentBlocks() {
            console.log('Loading CMS content blocks...');
            fetch(`${getApiUrl()}/cms/content-blocks`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                console.log('CMS Content blocks response:', data);
                const tbody = document.getElementById('contentBlocksTable');
                
                if (!data.success || !data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">–ù–µ—Ç –±–ª–æ–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.data.map(block => {
                    const title = JSON.parse(block.title || '{}');
                    return `
                        <tr>
                            <td class="font-medium">${block.id}</td>
                            <td>${block.type}</td>
                            <td>${title.ru || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td>${title.en || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td>${block.isActive ? '<span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>' : '<span class="badge badge-warning">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>'}</td>
                            <td>${formatDate(block.updatedAt)}</td>
                            <td class="flex gap-2">
                                <button onclick="editContentBlock(${block.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteContentBlock(${block.id})" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            })
            .catch(err => {
                console.error('Error loading content blocks:', err);
                const tbody = document.getElementById('contentBlocksTable');
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            });
        }
        
        // Open Content Block Modal
        function openContentBlockModal(id = null) {
            currentContentBlockId = id;
            const modal = document.getElementById('contentBlockModal');
            const title = document.getElementById('contentBlockModalTitle');
            
            if (id) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞';
                loadContentBlockData(id);
            } else {
                title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞';
                document.getElementById('contentBlockForm').reset();
            }
            
            modal.classList.add('active');
        }
        
        // Close Content Block Modal
        function closeContentBlockModal() {
            document.getElementById('contentBlockModal').classList.remove('active');
            currentContentBlockId = null;
        }
        
        // Load Content Block Data for editing
        function loadContentBlockData(id) {
            fetch(`${getApiUrl()}/cms/content-blocks/${id}`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const block = data.data;
                    const title = JSON.parse(block.title || '{}');
                    const content = JSON.parse(block.content || '{}');
                    
                    document.getElementById('blockType').value = block.type;
                    document.getElementById('blockOrder').value = block.sortOrder;
                    document.getElementById('blockActive').checked = block.isActive;
                    
                    // Fill multilingual fields
                    ['ru', 'en', 'tj', 'fa', 'de', 'zh'].forEach(lang => {
                        const titleField = document.getElementById(`blockTitle_${lang}`);
                        const contentField = document.getElementById(`blockContent_${lang}`);
                        if (titleField) titleField.value = title[lang] || '';
                        if (contentField) contentField.value = content[lang] || '';
                    });
                }
            })
            .catch(err => {
                console.error('Error loading content block:', err);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞');
            });
        }
        
        // Save Content Block
        document.getElementById('contentBlockForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = {};
            const content = {};
            
            ['ru', 'en', 'tj', 'fa', 'de', 'zh'].forEach(lang => {
                const titleField = document.getElementById(`blockTitle_${lang}`);
                const contentField = document.getElementById(`blockContent_${lang}`);
                if (titleField) title[lang] = titleField.value;
                if (contentField) content[lang] = contentField.value;
            });
            
            const formData = {
                type: document.getElementById('blockType').value,
                title: JSON.stringify(title),
                content: JSON.stringify(content),
                sortOrder: parseInt(document.getElementById('blockOrder').value),
                isActive: document.getElementById('blockActive').checked
            };
            
            const url = currentContentBlockId ? 
                `${getApiUrl()}/cms/content-blocks/${currentContentBlockId}` : 
                `${getApiUrl()}/cms/content-blocks`;
            const method = currentContentBlockId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('–ë–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                    closeContentBlockModal();
                    loadCMSContentBlocks();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('Error saving content block:', err);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        });
        
        // Edit Content Block
        function editContentBlock(id) {
            openContentBlockModal(id);
        }
        
        // Delete Content Block
        function deleteContentBlock(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞?')) {
                fetch(`${getApiUrl()}/cms/content-blocks/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–ë–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É–¥–∞–ª–µ–Ω');
                        loadCMSContentBlocks();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting content block:', err);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                });
            }
        }
        
        // Load CMS Settings
        function loadCMSSettings() {
            fetch(`${getApiUrl()}/cms/settings`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const settings = data.data;
                    const siteTitle = JSON.parse(settings.siteTitle || '{}');
                    const siteDescription = JSON.parse(settings.siteDescription || '{}');
                    
                    document.getElementById('siteTitle_ru').value = siteTitle.ru || '';
                    document.getElementById('siteTitle_en').value = siteTitle.en || '';
                    document.getElementById('siteDescription_ru').value = siteDescription.ru || '';
                    document.getElementById('siteDescription_en').value = siteDescription.en || '';
                    document.getElementById('contactEmail').value = settings.contactEmail || '';
                    document.getElementById('contactPhone').value = settings.contactPhone || '';
                }
            })
            .catch(err => {
                console.error('Error loading CMS settings:', err);
            });
        }
        
        // Save CMS Settings
        document.getElementById('siteSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                siteTitle: JSON.stringify({
                    ru: document.getElementById('siteTitle_ru').value,
                    en: document.getElementById('siteTitle_en').value
                }),
                siteDescription: JSON.stringify({
                    ru: document.getElementById('siteDescription_ru').value,
                    en: document.getElementById('siteDescription_en').value
                }),
                contactEmail: document.getElementById('contactEmail').value,
                contactPhone: document.getElementById('contactPhone').value
            };
            
            fetch(`${getApiUrl()}/cms/settings`, {
                method: 'PUT',
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('Error saving settings:', err);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        });
        
        // Load CMS Homepage Content
        function loadCMSHomepageContent() {
            fetch(`${getApiUrl()}/public/homepage?lang=ru`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('homepageContentList');
                
                if (!data.success || !data.data) {
                    container.innerHTML = '<div class="text-center text-gray-500">–ù–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã</div>';
                    return;
                }
                
                const { settings, contentBlocks } = data.data;
                
                let html = '<div class="bg-white rounded-xl shadow-sm p-6 mb-4">';
                html += '<h3 class="text-lg font-semibold mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞</h3>';
                html += `<p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞:</strong> ${settings.siteTitle || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>`;
                html += `<p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${settings.siteDescription || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>`;
                html += `<p><strong>Email:</strong> ${settings.contactEmail || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>`;
                html += `<p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${settings.contactPhone || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>`;
                html += '</div>';
                
                if (contentBlocks.length > 0) {
                    html += '<div class="bg-white rounded-xl shadow-sm p-6">';
                    html += '<h3 class="text-lg font-semibold mb-4">–ê–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h3>';
                    contentBlocks.forEach(block => {
                        html += `
                            <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-medium">${block.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
                                        <p class="text-sm text-gray-600">${block.type}</p>
                                        <p class="text-sm text-gray-500 mt-2">${(block.content || '').substring(0, 150)}...</p>
                                    </div>
                                    <button onclick="editContentBlock(${block.id})" class="btn btn-primary btn-sm">
                                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                container.innerHTML = html;
            })
            .catch(err => {
                console.error('Error loading homepage content:', err);
                const container = document.getElementById('homepageContentList');
                container.innerHTML = '<div class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>';
            });
        }

        // CMS Pages Management Functions
        function loadCMSPages() {
            console.log('Loading CMS pages...');
            fetch(`${getApiUrl()}/cms/pages`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                console.log('CMS Pages response:', data);
                const tbody = document.getElementById('cmsPagesTable');
                
                if (!data.success || !data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">–ù–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.data.map(page => {
                    const title = typeof page.title === 'string' ? JSON.parse(page.title || '{}') : page.title || {};
                    return `
                        <tr>
                            <td class="font-medium">${page.id}</td>
                            <td><code class="bg-gray-100 px-2 py-1 rounded text-sm">${page.slug}</code></td>
                            <td>${title.ru || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td>${title.en || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td>${page.isPublished ? '<span class="badge badge-success">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞</span>' : '<span class="badge badge-warning">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>'}</td>
                            <td>${formatDate(page.updatedAt)}</td>
                            <td class="flex gap-2">
                                <button onclick="editPage(${page.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deletePage(${page.id})" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            })
            .catch(err => {
                console.error('Error loading CMS pages:', err);
                const tbody = document.getElementById('cmsPagesTable');
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            });
        }

        // CMS Pages CRUD Functions
        function openPageModal(id = null) {
            console.log('Opening page modal for ID:', id);
            // Simple create/edit functionality - placeholder for now
            const title = id ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É' : '–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É';
            const slug = id ? 'existing-page' : '';
            
            const newSlug = prompt(`${title}\n–í–≤–µ–¥–∏—Ç–µ slug —Å—Ç—Ä–∞–Ω–∏—Ü—ã:`, slug);
            if (newSlug) {
                const titleRu = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º:');
                const titleEn = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:');
                const contentRu = prompt('–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º:');
                const contentEn = prompt('–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:');
                
                if (titleRu && titleEn) {
                    const pageData = {
                        slug: newSlug,
                        title: { ru: titleRu, en: titleEn },
                        content: { ru: contentRu || '', en: contentEn || '' },
                        isPublished: true
                    };
                    
                    const method = id ? 'PUT' : 'POST';
                    const url = id ? `/cms/pages/${id}` : '/cms/pages';
                    
                    fetch(`${getApiUrl()}${url}`, {
                        method: method,
                        headers: { ...getAuthHeaders(), 'Content-Type': 'application/json' },
                        body: JSON.stringify(pageData)
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert(`–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${id ? '–æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '—Å–æ–∑–¥–∞–Ω–∞'} —É—Å–ø–µ—à–Ω–æ`);
                            loadCMSPages();
                        } else {
                            alert('–û—à–∏–±–∫–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                        }
                    })
                    .catch(err => {
                        console.error('Error saving page:', err);
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                    });
                }
            }
        }
        
        function editPage(id) {
            openPageModal(id);
        }
        
        function deletePage(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) {
                fetch(`${getApiUrl()}/cms/pages/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                        loadCMSPages();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting page:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                });
            }
        }

        // CMS Menu CRUD Functions
        function openMenuItemModal(id = null) {
            console.log('Opening menu item modal for ID:', id);
            // Simple create/edit functionality - placeholder for now
            const title = id ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é' : '–°–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é';
            const url = id ? '/existing-url' : '';
            
            const newUrl = prompt(`${title}\n–í–≤–µ–¥–∏—Ç–µ URL:`, url);
            if (newUrl) {
                const titleRu = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º:');
                const titleEn = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:');
                const type = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–∏–ø (page/link/dropdown):', 'page');
                const sortOrder = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:', '1');
                
                if (titleRu && titleEn && type) {
                    const menuData = {
                        title: { ru: titleRu, en: titleEn },
                        url: newUrl,
                        type: type,
                        sortOrder: parseInt(sortOrder) || 1,
                        isActive: true
                    };
                    
                    const method = id ? 'PUT' : 'POST';
                    const endpoint = id ? `/cms/menu-items/${id}` : '/cms/menu-items';
                    
                    fetch(`${getApiUrl()}${endpoint}`, {
                        method: method,
                        headers: { ...getAuthHeaders(), 'Content-Type': 'application/json' },
                        body: JSON.stringify(menuData)
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert(`–≠–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é ${id ? '–æ–±–Ω–æ–≤–ª–µ–Ω' : '—Å–æ–∑–¥–∞–Ω'} —É—Å–ø–µ—à–Ω–æ`);
                            loadCMSMenus();
                        } else {
                            alert('–û—à–∏–±–∫–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                        }
                    })
                    .catch(err => {
                        console.error('Error saving menu item:', err);
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–µ–Ω—é');
                    });
                }
            }
        }
        
        function editMenuItem(id) {
            openMenuItemModal(id);
        }
        
        function deleteMenuItem(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é?')) {
                fetch(`${getApiUrl()}/cms/menu-items/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–≠–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é —É–¥–∞–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                        loadCMSMenus();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting menu item:', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–µ–Ω—é');
                });
            }
        }

        // CMS Menu Management Functions
        function loadCMSMenus() {
            console.log('Loading CMS menu items...');
            fetch(`${getApiUrl()}/cms/menu-items`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                console.log('CMS Menu items response:', data);
                const tbody = document.getElementById('cmsMenusTable');
                
                if (!data.success || !data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–Ω—é</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.data.map(menuItem => {
                    const title = typeof menuItem.title === 'string' ? JSON.parse(menuItem.title || '{}') : menuItem.title || {};
                    return `
                        <tr>
                            <td class="font-medium">${menuItem.id}</td>
                            <td>${title.ru || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td>${title.en || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td><code class="bg-gray-100 px-2 py-1 rounded text-sm">${menuItem.url}</code></td>
                            <td>${menuItem.type}</td>
                            <td>${menuItem.sortOrder}</td>
                            <td class="flex gap-2">
                                <button onclick="editMenuItem(${menuItem.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteMenuItem(${menuItem.id})" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            })
            .catch(err => {
                console.error('Error loading CMS menu items:', err);
                const tbody = document.getElementById('cmsMenusTable');
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            });
        }

        // Load Tour Blocks
        function loadTourBlocks() {
            fetch(`${getApiUrl()}/tour-blocks`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('tourBlocksTable');
                
                if (!data.success || !data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center text-gray-500">–ù–µ—Ç –±–ª–æ–∫–æ–≤ —Ç—É—Ä–æ–≤</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.data.map(block => {
                    const title = typeof block.title === 'string' ? JSON.parse(block.title || '{}') : block.title || {};
                    const toursCount = block.tours ? block.tours.length : 0;
                    return `
                        <tr>
                            <td class="font-medium">${block.id}</td>
                            <td>${title.ru || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td>${title.en || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td><code class="bg-gray-100 px-2 py-1 rounded text-sm">${block.slug}</code></td>
                            <td>${toursCount} —Ç—É—Ä–æ–≤</td>
                            <td>${block.isActive ? '<span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>' : '<span class="badge badge-warning">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>'}</td>
                            <td>${block.sortOrder}</td>
                            <td class="flex gap-2">
                                <button onclick="editTourBlock(${block.id})" class="text-blue-600 hover:text-blue-800" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="manageTourBlockTours(${block.id})" class="text-green-600 hover:text-green-800" title="–£–ø—Ä–∞–≤–ª—è—Ç—å —Ç—É—Ä–∞–º–∏">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button onclick="deleteTourBlock(${block.id})" class="text-red-600 hover:text-red-800" title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            })
            .catch(err => {
                console.error('Error loading tour blocks:', err);
                const tbody = document.getElementById('tourBlocksTable');
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            });
        }

        // üéØ –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ó–∞–≥—Ä—É–∑–∫–∞ –±–ª–æ–∫–æ–≤ —Ç—É—Ä–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã —Ç—É—Ä–∞
        function loadTourBlocksForForm() {
            console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –±–ª–æ–∫–∏ —Ç—É—Ä–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã...');
            console.log('üåê API URL:', `${getApiUrl()}/tour-blocks`);
            
            fetch(`${getApiUrl()}/tour-blocks`, {
                headers: getAuthHeaders()
            })
            .then(res => {
                console.log('üì° Response status:', res.status);
                return res.json();
            })
            .then(data => {
                console.log('üìä Tour blocks API response:', data);
                const container = document.getElementById('tourBlocksCheckboxes');
                
                if (!container) {
                    console.error('‚ùå Element tourBlocksCheckboxes not found!');
                    return;
                }
                
                if (!data.success || !data.data || data.data.length === 0) {
                    console.log('‚ö†Ô∏è No tour blocks available');
                    container.innerHTML = '<p class="text-gray-500">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–ª–æ–∫–æ–≤ —Ç—É—Ä–æ–≤</p>';
                    return;
                }
                
                console.log('üîÑ Processing', data.data.length, 'tour blocks');
                
                container.innerHTML = data.data.map(block => {
                    // block.title is a plain string, not JSON
                    const blockName = block.title || `–ë–ª–æ–∫ ${block.id}`;
                    console.log('üìù Block:', block.id, '- Name:', blockName);
                    return `
                        <label class="checkbox-item">
                            <input type="checkbox" value="${block.id}" name="tourBlocks"> ${blockName}
                        </label>
                    `;
                }).join('');
                
                console.log('‚úÖ –ë–ª–æ–∫–∏ —Ç—É—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è —Ñ–æ—Ä–º—ã:', data.data.length, '–±–ª–æ–∫–æ–≤');
            })
            .catch(err => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–æ–≤ —Ç—É—Ä–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã:', err);
                const container = document.getElementById('tourBlocksCheckboxes');
                if (container) {
                    container.innerHTML = '<p class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–æ–≤</p>';
                }
            });
        }

        // Global variables for modal handling
        let currentTourBlockId = null;

        // Open Tour Block Modal
        function openTourBlockModal(id = null) {
            currentTourBlockId = id;
            
            // Create modal HTML if it doesn't exist
            let modal = document.getElementById('tourBlockModal');
            if (!modal) {
                const modalHTML = `
                    <div id="tourBlockModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2 id="tourBlockModalTitle">–°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫ —Ç—É—Ä–æ–≤</h2>
                                <button onclick="closeTourBlockModal()" class="modal-close">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form id="tourBlockForm">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div class="form-group">
                                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ (RU)</label>
                                            <input type="text" class="form-input" id="blockTitleRu" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ (EN)</label>
                                            <input type="text" class="form-input" id="blockTitleEn" required>
                                        </div>
                                        <div class="form-group lg:col-span-2">
                                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –±–ª–æ–∫–∞ (RU)</label>
                                            <textarea class="form-input" id="blockDescRu" rows="3"></textarea>
                                        </div>
                                        <div class="form-group lg:col-span-2">
                                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –±–ª–æ–∫–∞ (EN)</label>
                                            <textarea class="form-input" id="blockDescEn" rows="3"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–°–ª–∞–≥ (URL)</label>
                                            <input type="text" class="form-input" id="blockSlug" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                                            <input type="number" class="form-input" id="blockSortOrder" value="0">
                                        </div>
                                        <div class="form-group lg:col-span-2">
                                            <label class="form-label flex items-center">
                                                <input type="checkbox" id="blockIsActive" class="mr-2" checked>
                                                –ê–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mt-6 flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i>
                                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                        </button>
                                        <button type="button" onclick="closeTourBlockModal()" class="btn btn-secondary">
                                            –û—Ç–º–µ–Ω–∞
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                modal = document.getElementById('tourBlockModal');
            }
            
            const title = document.getElementById('tourBlockModalTitle');
            
            if (id) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫ —Ç—É—Ä–æ–≤';
                loadTourBlockData(id);
            } else {
                title.textContent = '–°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫ —Ç—É—Ä–æ–≤';
                document.getElementById('tourBlockForm').reset();
                document.getElementById('blockIsActive').checked = true;
            }
            
            modal.classList.add('active');
        }

        // Close Tour Block Modal
        function closeTourBlockModal() {
            const modal = document.getElementById('tourBlockModal');
            if (modal) {
                modal.classList.remove('active');
            }
            currentTourBlockId = null;
        }

        // Load Tour Block Data for editing
        function loadTourBlockData(id) {
            fetch(`${getApiUrl()}/tour-blocks/${id}`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const block = data.data;
                    const title = JSON.parse(block.title || '{}');
                    const description = JSON.parse(block.description || '{}');
                    
                    document.getElementById('blockTitleRu').value = title.ru || '';
                    document.getElementById('blockTitleEn').value = title.en || '';
                    document.getElementById('blockDescRu').value = description.ru || '';
                    document.getElementById('blockDescEn').value = description.en || '';
                    document.getElementById('blockSlug').value = block.slug || '';
                    document.getElementById('blockSortOrder').value = block.sortOrder || 0;
                    document.getElementById('blockIsActive').checked = block.isActive;
                }
            })
            .catch(err => {
                console.error('Error loading tour block:', err);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞');
            });
        }

        // Initialize form handlers when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Tour Block Form Handler
            setTimeout(() => {
                const form = document.getElementById('tourBlockForm');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                        saveTourBlock();
                    });
                }
            }, 100);
        });

        // Save Tour Block
        function saveTourBlock() {
            const formData = {
                title: JSON.stringify({
                    ru: safeGetValue('blockTitleRu', ''),
                    en: safeGetValue('blockTitleEn', '')
                }),
                description: JSON.stringify({
                    ru: safeGetValue('blockDescRu', ''),
                    en: safeGetValue('blockDescEn', '')
                }),
                slug: safeGetValue('blockSlug', ''),
                sortOrder: safeGetValue('blockSortOrder', 0, 'int'),
                isActive: safeGetValue('blockIsActive', true, 'checkbox')
            };
            
            const url = currentTourBlockId ? 
                `${getApiUrl()}/tour-blocks/${currentTourBlockId}` : 
                `${getApiUrl()}/tour-blocks`;
            const method = currentTourBlockId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('–ë–ª–æ–∫ —Ç—É—Ä–æ–≤ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                    closeTourBlockModal();
                    loadTourBlocks();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('Error saving tour block:', err);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        }

        // Edit Tour Block
        function editTourBlock(id) {
            openTourBlockModal(id);
        }

        // Delete Tour Block
        function deleteTourBlock(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–ª–æ–∫ —Ç—É—Ä–æ–≤? –í—Å–µ —Ç—É—Ä—ã –∏–∑ –±–ª–æ–∫–∞ –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –±—É–¥—É—Ç –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –±–ª–æ–∫—É.')) {
                fetch(`${getApiUrl()}/tour-blocks/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('–ë–ª–æ–∫ —Ç—É—Ä–æ–≤ —É–¥–∞–ª–µ–Ω');
                        loadTourBlocks();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting tour block:', err);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                });
            }
        }

        // Manage Tour Block Tours
        function manageTourBlockTours(blockId) {
            alert('–§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—É—Ä–∞–º–∏ –≤ –±–ª–æ–∫–µ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞');
        }

        // Load Enhanced Tour Form
        function loadEnhancedTourForm() {
            // Load tour blocks for selection
            fetch(`${getApiUrl()}/tour-blocks`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('eTourBlockId');
                if (select && data.success && data.data) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫ —Ç—É—Ä–æ–≤</option>' +
                        data.data.map(block => {
                            const title = JSON.parse(block.title || '{}');
                            return `<option value="${block.id}">${title.ru || title.en || `–ë–ª–æ–∫ ${block.id}`}</option>`;
                        }).join('');
                }
            })
            .catch(err => console.error('Error loading tour blocks for form:', err));

            // Load categories for selection
            loadCategories().then(categories => {
                // –£–¥–∞–ª–µ–Ω–æ: eTourCategoryId –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                // –£–¥–∞–ª–µ–Ω–æ: –ª–æ–≥–∏–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è eTourCategoryId
            });
        }

        // –£–î–ê–õ–ï–ù–û: Enhanced Tour Form Handler - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω

        // –£–î–ê–õ–ï–ù–û: function saveEnhancedTour() - –∑–∞–º–µ–Ω–µ–Ω–∞ –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
        // function saveEnhancedTour() {
        // –£–î–ê–õ–ï–ù–û: –í—Å—è —Ñ—É–Ω–∫—Ü–∏—è saveEnhancedTour() –∑–∞–º–µ–Ω–µ–Ω–∞ –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
        
        // ===== TOUR FUNCTIONALITY CLEANED =====
        // –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù–ê –î–£–ë–õ–ò–†–û–í–ê–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø saveEnhancedTour()
        
        // ===== TRANSLATION FUNCTIONALITY =====
        
        // Show translations section
        function showTranslations() {
            showSection('translations');
            loadTranslationData();
        }

        // Load translation-related data
        function loadTranslationData() {
            loadTourSelectOptions();
            loadTranslationStatistics();
        }

        // Load tour options for translation dropdown
        function loadTourSelectOptions() {
            fetch(`${getApiUrl()}/tours`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('translationTourSelect');
                if (select && data.success && data.data) {
                    select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä --</option>' +
                        data.data.map(tour => {
                            const title = JSON.parse(tour.title || '{}');
                            return `<option value="${tour.id}">${title.ru || title.en || `–¢—É—Ä ${tour.id}`}</option>`;
                        }).join('');
                }
            })
            .catch(err => console.error('Error loading tours for translation:', err));
        }

        // Load translation statistics
        function loadTranslationStatistics() {
            fetch(`${getApiUrl()}/tours`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const tours = data.data;
                    let translatedCount = 0;
                    let pendingCount = 0;
                    
                    tours.forEach(tour => {
                        const title = JSON.parse(tour.title || '{}');
                        const description = JSON.parse(tour.description || '{}');
                        
                        // Check if all 6 languages are present
                        const supportedLanguages = ['ru', 'en', 'tj', 'fa', 'de', 'zh'];
                        const titleComplete = supportedLanguages.every(lang => title[lang] && title[lang].trim());
                        const descComplete = supportedLanguages.every(lang => description[lang] && description[lang].trim());
                        
                        if (titleComplete && descComplete) {
                            translatedCount++;
                        } else {
                            pendingCount++;
                        }
                    });
                    
                    document.getElementById('translatedToursCount').textContent = translatedCount;
                    document.getElementById('pendingTranslationsCount').textContent = pendingCount;
                }
            })
            .catch(err => console.error('Error loading translation statistics:', err));
        }

        // Single tour translation form handler
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const singleForm = document.getElementById('singleTranslationForm');
                if (singleForm) {
                    singleForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        translateSingleTour();
                    });
                }
                
                const manualForm = document.getElementById('manualTranslationForm');
                if (manualForm) {
                    manualForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        translateManualText();
                    });
                }
            }, 200);
        });

        // Translate single tour
        function translateSingleTour() {
            const tourId = document.getElementById('translationTourSelect').value;
            if (!tourId) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞');
                return;
            }
            
            const btn = document.getElementById('translateSingleBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>–ü–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è...';
            
            fetch(`${getApiUrl()}/translate/tour/${tourId}`, {
                method: 'POST',
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('–¢—É—Ä —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ –≤—Å–µ —è–∑—ã–∫–∏!');
                    loadTranslationStatistics(); // Refresh stats
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('Translation error:', err);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        }

        // Batch translate all tours
        function batchTranslateAllTours() {
            if (!confirm('–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –≤—Å–µ—Ö —Ç—É—Ä–æ–≤?')) {
                return;
            }
            
            showTranslationProgress();
            
            fetch(`${getApiUrl()}/tours`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const tourIds = data.data.map(tour => tour.id);
                    return batchTranslateTours(tourIds);
                } else {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤');
                }
            })
            .catch(err => {
                console.error('Batch translation error:', err);
                alert('–û—à–∏–±–∫–∞: ' + err.message);
                hideTranslationProgress();
            });
        }

        // Batch translate selected tours
        function batchTranslateTours(tourIds) {
            return fetch(`${getApiUrl()}/translate/tours/batch`, {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify({ tourIds })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    updateProgressBar(100);
                    document.getElementById('progressText').textContent = 
                        `–ó–∞–≤–µ—Ä—à–µ–Ω–æ! ${data.data.successCount} —Ç—É—Ä–æ–≤ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ, ${data.data.errorCount} –æ—à–∏–±–æ–∫`;
                    
                    // Show results
                    const results = document.getElementById('translationResults');
                    results.innerHTML = `
                        <div class="text-green-600 font-medium">‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ: ${data.data.successCount} —Ç—É—Ä–æ–≤</div>
                        ${data.data.errors.length > 0 ? 
                            `<div class="text-red-600 font-medium">‚ùå –û—à–∏–±–∫–∏: ${data.data.errors.join(', ')}</div>` : ''
                        }
                    `;
                    
                    loadTranslationStatistics(); // Refresh stats
                    
                    setTimeout(() => {
                        hideTranslationProgress();
                    }, 5000);
                } else {
                    throw new Error(data.error || 'Batch translation failed');
                }
            })
            .catch(err => {
                console.error('Batch translation error:', err);
                alert('–û—à–∏–±–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞: ' + err.message);
                hideTranslationProgress();
            });
        }

        // Manual text translation
        function translateManualText() {
            const sourceText = document.getElementById('sourceText').value;
            const sourceLanguage = document.getElementById('sourceLanguage').value;
            const targetLanguage = document.getElementById('targetLanguage').value;
            
            if (!sourceText.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞');
                return;
            }
            
            if (sourceLanguage === targetLanguage) {
                alert('–ò—Å—Ö–æ–¥–Ω—ã–π –∏ —Ü–µ–ª–µ–≤–æ–π —è–∑—ã–∫–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–ª–∏—á–∞—Ç—å—Å—è');
                return;
            }
            
            const btn = document.getElementById('manualTranslateBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>–ü–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è...';
            
            fetch(`${getApiUrl()}/translate/text`, {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify({
                    text: sourceText,
                    fromLanguage: sourceLanguage,
                    toLanguage: targetLanguage,
                    context: 'tour_description'
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('translatedText').value = data.data.translatedText;
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(err => {
                console.error('Manual translation error:', err);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        }

        // Copy translation to clipboard
        function copyTranslation() {
            const text = document.getElementById('translatedText').value;
            if (!text) {
                alert('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                alert('–ü–µ—Ä–µ–≤–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }).catch(err => {
                console.error('Copy failed:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç');
            });
        }

        // Get selected checkbox values
        function getSelectedCheckboxValues(prefix) {
            const checkboxes = document.querySelectorAll(`input[id^="${prefix}"]`);
            const selected = [];
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selected.push(checkbox.value);
                }
            });
            return selected;
        }

        // Price Calculator Functions - Clean API-based system
        let calculatorComponents = [];
        
        // Load all components from database via API (like tour form does)
        async function loadCalculatorComponents() {
            try {
                console.log('üîÑ Loading calculator components from database...');
                const response = await fetch(`${getApiUrl()}/price-calculator`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    calculatorComponents = data.data;
                    renderCalculatorComponents();
                } else {
                    console.error('‚ùå Failed to load components:', data.message);
                    showErrorMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: ' + data.message);
                }
            } catch (error) {
                console.error('üí• Error loading components:', error);
                showErrorMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Render components grouped by category
        function renderCalculatorComponents() {
            const container = document.getElementById('priceCalculatorComponents');
            
            if (calculatorComponents.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-info-circle text-4xl mb-4"></i>
                        <h3 class="text-lg font-semibold mb-2">–ù–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ü–µ–Ω</h3>
                        <p class="mb-4">–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ, –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.</p>
                        <button class="btn btn-secondary" onclick="initializeDefaultComponents()">
                            <i class="fas fa-download mr-2"></i>
                            –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
                        </button>
                    </div>
                `;
                return;
            }
            
            // Group by category
            const categories = {};
            calculatorComponents.forEach(component => {
                if (!categories[component.category]) {
                    categories[component.category] = [];
                }
                categories[component.category].push(component);
            });
            
            // Render by category
            let html = '';
            Object.keys(categories).sort().forEach(categoryKey => {
                const categoryName = getCategoryDisplayName(categoryKey);
                const categoryComponents = categories[categoryKey].sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));
                
                html += `
                    <div class="mb-6 border rounded-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-3">
                            <h3 class="font-semibold flex items-center">
                                <i class="fas ${getCategoryIcon(categoryKey)} mr-2"></i>
                                ${categoryName}
                                <span class="ml-2 bg-blue-800 text-blue-200 px-2 py-1 rounded-full text-xs">
                                    ${categoryComponents.length}
                                </span>
                            </h3>
                        </div>
                        <div class="bg-white">
                            ${categoryComponents.map(component => `
                                <div class="flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50 transition">
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-900">${component.name}</h4>
                                        ${component.description ? `<p class="text-sm text-gray-600 mt-1">${component.description}</p>` : ''}
                                        <div class="flex items-center mt-2 text-sm text-gray-500">
                                            <i class="fas fa-tag mr-1"></i>
                                            –ï–¥–∏–Ω–∏—Ü–∞: <span class="ml-1 px-2 py-1 bg-gray-100 rounded">${component.unit}</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="text-right">
                                            <label class="block text-xs text-gray-500 mb-1">–¶–µ–Ω–∞ (TJS)</label>
                                            <input type="number" value="${component.price}" 
                                                   class="w-24 px-3 py-2 border rounded-lg text-center font-semibold text-blue-600 focus:ring-2 focus:ring-blue-500" 
                                                   min="0" step="0.01" id="price_${component.id}"
                                                   onchange="updateComponentPriceInline(${component.id}, this.value, '${component.name.replace(/'/g, "\\'")}' )"
                                                   oninput="this.style.backgroundColor = this.value != ${component.price} ? '#fef3c7' : 'white'">
                                        </div>
                                        <button class="btn btn-sm btn-primary" onclick="renameComponent(${component.id}, '${component.name.replace(/'/g, "\\'")}' )" 
                                                title="–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteComponentFromCalculator(${component.id}, '${component.name.replace(/'/g, "\\'")}' )" 
                                                title="–£–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Get display name for category
        function getCategoryDisplayName(category) {
            const categoryNames = {
                'transport': '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
                'accommodation': '–ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ', 
                'meals': '–ü–∏—Ç–∞–Ω–∏–µ',
                'guides': '–ì–∏–¥—ã/–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ',
                'tickets': '–ë–∏–ª–µ—Ç—ã/–í—Ö–æ–¥—ã',
                'transfer': '–¢—Ä–∞–Ω—Å—Ñ–µ—Ä',
                'documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã',
                'other': '–ü—Ä–æ—á–µ–µ'
            };
            return categoryNames[category] || category.charAt(0).toUpperCase() + category.slice(1);
        }
        
        // Get icon for category
        function getCategoryIcon(category) {
            const icons = {
                'transport': 'fa-car',
                'accommodation': 'fa-bed',
                'meals': 'fa-utensils',
                'guides': 'fa-user-tie',
                'tickets': 'fa-ticket-alt',
                'transfer': 'fa-shuttle-van',
                'documents': 'fa-passport',
                'other': 'fa-cube'
            };
            return icons[category] || 'fa-cube';
        }
        
        // Auto-determine category based on service name
        function determineCategory(name) {
            if (name.includes('–ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ') || name.includes('–æ—Ç–µ–ª—å') || name.includes('–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞') || name.includes('–Ω–æ—á—å')) {
                return 'accommodation';
            }
            if (name.includes('–ø–∏—Ç–∞–Ω–∏–µ') || name.includes('–∑–∞–≤—Ç—Ä–∞–∫') || name.includes('–æ–±–µ–¥') || name.includes('—É–∂–∏–Ω') || name.includes('–µ–¥–∞')) {
                return 'meals';
            }
            if (name.includes('–ø—Ä–æ–≤–æ–¥–Ω–∏–∫') || name.includes('–≥–∏–¥') || name.includes('—ç–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥') || name.includes('—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ')) {
                return 'guides';
            }
            if (name.includes('—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä') || name.includes('–∞—ç—Ä–æ–ø–æ—Ä—Ç') || name.includes('–≤—Å—Ç—Ä–µ—á–∞')) {
                return 'transfer';
            }
            if (name.includes('—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç') || name.includes('–∞–≤—Ç–æ–±—É—Å') || name.includes('–º–∞—à–∏–Ω–∞') || name.includes('–∫–º')) {
                return 'transport';
            }
            if (name.includes('–±–∏–ª–µ—Ç') || name.includes('–≤—Ö–æ–¥') || name.includes('–ø–æ—Å–µ—â–µ–Ω–∏–µ') || name.includes('–º—É–∑–µ–π')) {
                return 'tickets';
            }
            if (name.includes('–≤–∏–∑–∞') || name.includes('–¥–æ–∫—É–º–µ–Ω—Ç') || name.includes('–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ')) {
                return 'documents';
            }
            return 'other'; // Default category
        }

        // Add new component
        async function addNewComponent() {
            const name = document.getElementById('newComponentName').value.trim();
            const price = parseFloat(document.getElementById('newComponentPrice').value);
            const unit = document.getElementById('newComponentUnit').value.trim();
            const description = document.getElementById('newComponentDescription').value.trim();
            
            // Auto-determine category based on keywords
            const category = determineCategory(name.toLowerCase());
            
            // Validation
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏');
                document.getElementById('newComponentName').focus();
                return;
            }
            
            if (isNaN(price) || price < 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É');
                document.getElementById('newComponentPrice').focus();
                return;
            }
            
            if (!unit) {
                alert('–í–≤–µ–¥–∏—Ç–µ –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è');
                document.getElementById('newComponentUnit').focus();
                return;
            }
            
            console.log('‚ûï Adding new component:', name);
            
            try {
                const response = await fetch(`${getApiUrl()}/price-calculator`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        key: name.toLowerCase().replace(/[^a-z0-9–∞-—è]/g, '_'),
                        category: category,
                        name: name,
                        price: price,
                        unit: unit,
                        description: description || null,
                        sortOrder: 0
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification('‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    
                    // Clear form
                    document.getElementById('newComponentName').value = '';
                    document.getElementById('newComponentPrice').value = '';
                    document.getElementById('newComponentUnit').value = '';
                    document.getElementById('newComponentDescription').value = '';
                    
                    // Reload components
                    await loadCalculatorComponents();
                    
                    // Update tour pricing components if loaded
                    if (typeof loadTourPricingComponents === 'function') {
                        await loadTourPricingComponents();
                    }
                } else {
                    console.error('Failed to create component:', data.message);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ' + data.message);
                }
            } catch (error) {
                console.error('Error creating component:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Update component price inline
        async function updateComponentPriceInline(componentId, newPrice, componentName) {
            const numericPrice = parseFloat(newPrice);
            if (isNaN(numericPrice) || numericPrice < 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É');
                document.getElementById(`price_${componentId}`).value = calculatorComponents.find(c => c.id === componentId)?.price || 0;
                return;
            }
            
            
            try {
                const response = await fetch(`${getApiUrl()}/price-calculator/${componentId}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ price: numericPrice })
                });
                
                const data = await response.json();
                if (data.success) {
                    // Update local array
                    const component = calculatorComponents.find(c => c.id === componentId);
                    if (component) {
                        component.price = numericPrice;
                    }
                    
                    // Update tour pricing components if loaded
                    if (typeof tourPricingComponents !== 'undefined' && tourPricingComponents.length > 0) {
                        const tourComponent = tourPricingComponents.find(c => c.id === componentId);
                        if (tourComponent) {
                            tourComponent.price = numericPrice;
                            console.log(`üîÑ Also updated tour pricing component: ${componentName}`);
                        }
                    }
                    
                    // Visual feedback
                    document.getElementById(`price_${componentId}`).style.backgroundColor = '#dcfce7';
                    setTimeout(() => {
                        document.getElementById(`price_${componentId}`).style.backgroundColor = 'white';
                    }, 1000);
                    
                    showNotification(`üí∞ ${componentName} = ${numericPrice} TJS ‚úÖ`, 'success');
                } else {
                    console.error('Failed to update component:', data.message);
                    alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã: ' + data.message);
                    // Reset to original value
                    document.getElementById(`price_${componentId}`).value = calculatorComponents.find(c => c.id === componentId)?.price || 0;
                }
            } catch (error) {
                console.error('Error updating component:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                // Reset to original value
                document.getElementById(`price_${componentId}`).value = calculatorComponents.find(c => c.id === componentId)?.price || 0;
            }
        }

        // Rename a component
        async function renameComponent(componentId, currentName) {
            const newName = prompt(`–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É "${currentName}".\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:`, currentName);
            
            if (!newName || newName.trim() === '' || newName.trim() === currentName) {
                return; // User cancelled or no changes
            }
            
            const trimmedName = newName.trim();
            
            try {
                
                const response = await fetch(`${getApiUrl()}/price-calculator/${componentId}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        name: trimmedName
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification(`‚úÖ –£—Å–ª—É–≥–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞: "${trimmedName}"`, 'success');
                    
                    // Update local component data
                    const componentIndex = calculatorComponents.findIndex(c => c.id === componentId);
                    if (componentIndex !== -1) {
                        calculatorComponents[componentIndex].name = trimmedName;
                    }
                    
                    // Refresh display
                    renderCalculatorComponents();
                    
                    // Update tour pricing components if loaded
                    if (typeof loadTourPricingComponents === 'function') {
                        await loadTourPricingComponents();
                    }
                } else {
                    console.error('Failed to rename component:', data.message);
                    alert('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —É—Å–ª—É–≥–∏: ' + data.message);
                }
            } catch (error) {
                console.error('Error renaming component:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Delete component
        async function deleteComponentFromCalculator(componentId, componentName) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç "${componentName}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) return;
            
            
            try {
                const response = await fetch(`${getApiUrl()}/price-calculator/${componentId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification(`üóëÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç "${componentName}" —É–¥–∞–ª–µ–Ω`, 'success');
                    
                    // Reload components
                    await loadCalculatorComponents();
                    
                    // Update tour pricing components if loaded  
                    if (typeof loadTourPricingComponents === 'function') {
                        await loadTourPricingComponents();
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + data.message);
                }
            } catch (error) {
                console.error('Error deleting component:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }
        
        // Refresh components list
        async function refreshPriceComponents() {
            console.log('üîÑ Refreshing price components...');
            await loadCalculatorComponents();
            showNotification('üîÑ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'info');
        }
        
        // Initialize default components
        async function initializeDefaultComponents() {
            if (!confirm('–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ü–µ–Ω?\n\n–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä —É—Å–ª—É–≥ –¥–ª—è —Ç—É—Ä–æ–≤.')) return;
            
            console.log('üì• Initializing default components...');
            
            try {
                const response = await fetch(`${getApiUrl()}/price-calculator/initialize`, {
                    method: 'POST',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.data?.length || '–Ω–µ—Å–∫–æ–ª—å–∫–æ'} —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤!`, 'success');
                    
                    // Reload components
                    await loadCalculatorComponents();
                    
                    // Update tour pricing components if loaded
                    if (typeof loadTourPricingComponents === 'function') {
                        await loadTourPricingComponents();
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + data.message);
                }
            } catch (error) {
                console.error('Error initializing components:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // Show error message in components container
        function showErrorMessage(message) {
            const container = document.getElementById('priceCalculatorComponents');
            container.innerHTML = `
                <div class="text-center text-red-500 py-8">
                    <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                    <h3 class="text-lg font-semibold mb-2">–û—à–∏–±–∫–∞</h3>
                    <p>${message}</p>
                    <button class="btn btn-secondary mt-4" onclick="refreshPriceComponents()">
                        <i class="fas fa-retry mr-2"></i>
                        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
        }
        
        // Main function called when section loads
        function loadPriceCalculator() {
            loadCalculatorComponents();
        }

        // REMOVED - old localStorage table render function

        // REMOVED - old localStorage updateComponentPrice function
        
        // REMOVED - old localStorage syncComponentWithDatabase function
        
        // REMOVED - old localStorage syncAllWithDatabase function
        
        // REMOVED - old localStorage clearLocalStorage function

        async function savePriceCalculator() {
            console.log('üíæ Manual save triggered - collecting all current prices');
            
            // Get all current input values and save them
            const priceInputs = document.querySelectorAll('#priceCalculatorTable input[type="number"]');
            const savePromises = [];
            
            for (let input of priceInputs) {
                const onchangeAttr = input.getAttribute('onchange');
                const componentId = onchangeAttr.match(/updateComponentPrice\((\d+),/)?.[1];
                
                if (componentId && input.value) {
                    const currentPrice = parseFloat(input.value);
                    const originalComponent = priceCalculatorComponents.find(c => c.id == componentId);
                    
                    // Only save if price actually changed
                    if (originalComponent && originalComponent.price !== currentPrice) {
                        savePromises.push(updateComponentPrice(componentId, currentPrice));
                    }
                }
            }
            
            if (savePromises.length > 0) {
                try {
                    await Promise.all(savePromises);
                    showNotification(`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${savePromises.length} –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω!`, 'success');
                } catch (error) {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ü–µ–Ω', 'error');
                }
            } else {
                showNotification('‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'info');
            }
        }

        function addNewPriceRow() {
            const service = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:');
            if (!service) return;
            
            const price = prompt('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É (TJS):');
            if (!price || isNaN(parseFloat(price))) return;
            
            const unit = prompt('–í–≤–µ–¥–∏—Ç–µ –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è:');
            if (!unit) return;

            // –£—Å–ª—É–≥–∞ - —ç—Ç–æ –∏ –µ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω—É–∂–Ω–∞
            createNewComponent(service, parseFloat(price), unit, 'service');
        }

        async function createNewComponent(name, price, unit, category) {
            try {
                const response = await fetch(`${getApiUrl()}/price-calculator`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        key: `${category}_${Date.now()}`, // Generate unique key
                        category,
                        name,
                        price,
                        unit,
                        sortOrder: priceCalculatorComponents.filter(c => c.category === category).length + 1
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadCalculatorComponents(); // Reload table
                } else {
                    console.error('Failed to create component:', data.message);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ' + data.message);
                }
            } catch (error) {
                console.error('Error creating component:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function deleteComponent(componentId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ü–µ–Ω—ã?')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/price-calculator/${componentId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    loadCalculatorComponents(); // Reload table
                } else {
                    console.error('Failed to delete component:', data.message);
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ' + data.message);
                }
            } catch (error) {
                console.error('Error deleting component:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function resetPrices() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ü–µ–Ω—ã –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å–æ–∑–¥–∞—Å—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ.')) {
                try {
                    // Delete all existing components first
                    for (const component of priceCalculatorComponents) {
                        await fetch(`${getApiUrl()}/price-calculator/${component.id}`, {
                            method: 'DELETE',
                            headers: getAuthHeaders()
                        });
                    }
                    
                    // Initialize defaults
                    const response = await fetch(`${getApiUrl()}/price-calculator/initialize`, {
                        method: 'POST',
                        headers: getAuthHeaders()
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        loadCalculatorComponents(); // Reload table
                        alert('–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ü–µ–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');
                    } else {
                        console.error('Failed to initialize defaults:', data.message);
                        alert('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ü–µ–Ω');
                    }
                } catch (error) {
                    console.error('Error resetting prices:', error);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                }
            }
        }

        // Banner Management Functions
        async function loadCurrentSlides() {
            try {
                const response = await fetch(`${getApiUrl()}/slides/admin`, {
                    headers: getAuthHeaders()
                });
                const result = await response.json();
                
                if (result.success) {
                    displayCurrentSlides(result.data);
                } else {
                    console.error('Failed to load slides:', result.message);
                }
            } catch (error) {
                console.error('Error loading slides:', error);
            }
        }

        function displayCurrentSlides(slides) {
            const container = document.getElementById('currentSlides');
            if (!container) return;

            container.innerHTML = slides.map(slide => {
                const title = JSON.parse(slide.title || '{}');
                const description = JSON.parse(slide.description || '{}');
                const buttonText = JSON.parse(slide.buttonText || '{}');
                
                return `
                    <div class="border rounded-lg p-4 bg-white">
                        ${slide.image ? `<img data-image-placeholder="slide-image" alt="Slide" class="w-full h-32 object-cover rounded mb-2" onerror="this.style.display='none'">` : ''}
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">${title.ru || title.en || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
                                <p class="text-sm text-gray-600">${(description.ru || description.en || '').substring(0, 80)}${(description.ru || description.en || '').length > 80 ? '...' : ''}</p>
                            </div>
                            <span class="px-2 py-1 text-xs rounded ${slide.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}">
                                ${slide.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">–ü–æ—Ä—è–¥–æ–∫: ${slide.order}</span>
                            <div class="flex gap-2">
                                <button class="text-blue-600 hover:text-blue-800 mr-2" onclick="editSlide(${slide.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–∞–π–¥">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteSlide(${slide.id})">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('') || '<p class="text-gray-500">–ù–µ—Ç —Å–ª–∞–π–¥–æ–≤</p>';
        }

        function editSlide(id) {
            openSlideEditModal(id);
        }

        async function deleteSlide(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–ª–∞–π–¥?')) return;

            try {
                const response = await fetch(`${getApiUrl()}/slides/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('–°–ª–∞–π–¥ —É–¥–∞–ª–µ–Ω');
                    loadCurrentSlides();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–ª–∞–π–¥–∞');
                }
            } catch (error) {
                console.error('Error deleting slide:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–ª–∞–π–¥–∞');
            }
        }

        // Banner form submission
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const bannerForm = document.getElementById('bannerForm');
                if (bannerForm) {
                    bannerForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        saveBannerSlide();
                    });
                }
            }, 100);
        });

        async function saveBannerSlide() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const imageFile = document.getElementById('bannerImageFile').files[0];
            if (!imageFile) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –±–∞–Ω–Ω–µ—Ä–∞');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –∏ –¥–∞–Ω–Ω—ã—Ö
            const formData = new FormData();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            formData.append('image', imageFile);
            
            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–ª–∞–π–¥–∞
            const slideData = {
                title: {
                    ru: safeGetValue('bannerTitleRu', '')
                },
                description: {
                    ru: safeGetValue('bannerDescRu', '')
                },
                link: safeGetValue('bannerLink', ''),
                buttonText: {
                    ru: safeGetValue('bannerButtonTextRu', '')
                },
                order: safeGetValue('bannerOrder', 1, 'int'),
                isActive: safeGetValue('bannerActive', false, 'checkbox')
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º JSON –¥–∞–Ω–Ω—ã–µ
            Object.keys(slideData).forEach(key => {
                if (typeof slideData[key] === 'object') {
                    formData.append(key, JSON.stringify(slideData[key]));
                } else {
                    formData.append(key, slideData[key]);
                }
            });

            try {
                // –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º Content-Type –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è FormData
                const headers = getAuthHeaders();
                delete headers['Content-Type'];
                
                const response = await fetch(`${getApiUrl()}/slides`, {
                    method: 'POST',
                    headers: headers,
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('–°–ª–∞–π–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    loadCurrentSlides();
                    document.getElementById('bannerForm').reset();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–ª–∞–π–¥–∞: ' + result.message);
                }
            } catch (error) {
                console.error('Error creating slide:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–ª–∞–π–¥–∞');
            }
        }

        // üìù SLIDE EDITING FUNCTIONS (by pattern of categoryController)
        function openSlideEditModal(slideId = null) {
            const modal = document.getElementById('slideEditModal');
            const modalTitle = document.getElementById('slideEditModalTitle');
            const form = document.getElementById('slideEditForm');
            
            if (slideId) {
                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–∞–π–¥';
                
                // Load slide data for editing with includeRaw=true (like categories)
                fetch(`${getApiUrl()}/slides/${slideId}?includeRaw=true`, {
                    headers: getAuthHeaders()
                })
                    .then(res => res.json())
                    .then(data => {
                        const slide = data.data || data.slide;
                        if (slide) {
                            document.getElementById('editSlideId').value = slideId;
                            
                            // üîß MULTILINGUAL PARSING (robust like categories)
                            // Parse title
                            if (slide._raw && slide._raw.title) {
                                document.getElementById('editSlideTitleRu').value = slide._raw.title.ru || '';
                            } else if (slide.title) {
                                try {
                                    const titleParsed = JSON.parse(slide.title);
                                    document.getElementById('editSlideTitleRu').value = titleParsed.ru || '';
                                } catch (e) {
                                    document.getElementById('editSlideTitleRu').value = slide.title || '';
                                }
                            }
                            
                            // Parse description
                            if (slide._raw && slide._raw.description) {
                                document.getElementById('editSlideDescRu').value = slide._raw.description.ru || '';
                            } else if (slide.description) {
                                try {
                                    const descParsed = JSON.parse(slide.description);
                                    document.getElementById('editSlideDescRu').value = descParsed.ru || '';
                                } catch (e) {
                                    document.getElementById('editSlideDescRu').value = slide.description || '';
                                }
                            }
                            
                            // Parse button text
                            if (slide._raw && slide._raw.buttonText) {
                                document.getElementById('editSlideButtonTextRu').value = slide._raw.buttonText.ru || '';
                            } else if (slide.buttonText) {
                                try {
                                    const btnParsed = JSON.parse(slide.buttonText);
                                    document.getElementById('editSlideButtonTextRu').value = btnParsed.ru || '';
                                } catch (e) {
                                    document.getElementById('editSlideButtonTextRu').value = slide.buttonText || '';
                                }
                            }
                            
                            // Simple fields
                            document.getElementById('editSlideLink').value = slide.link || '';
                            document.getElementById('editSlideOrder').value = slide.order || 1;
                            document.getElementById('editSlideActive').checked = slide.isActive || false;
                            
                            // Show current image preview
                            const imagePreview = document.getElementById('editSlideImagePreview');
                            if (slide.image && imagePreview) {
                                imagePreview.src = getSafeImageUrl(slide.image);
                                imagePreview.style.display = 'block';
                            }
                        }
                    })
                    .catch(err => {
                        console.error('Error loading slide:', err);
                        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–ª–∞–π–¥–∞');
                    });
            } else {
                // This shouldn't happen for edit modal, but just in case
                modalTitle.textContent = '–ù–æ–≤—ã–π —Å–ª–∞–π–¥';
                document.getElementById('editSlideId').value = '';
                form.reset();
            }
            
            modal.style.display = 'flex';
        }
        
        function closeSlideEditModal() {
            const modal = document.getElementById('slideEditModal');
            const form = document.getElementById('slideEditForm');
            const imagePreview = document.getElementById('editSlideImagePreview');
            
            modal.style.display = 'none';
            form.reset();
            document.getElementById('editSlideId').value = '';
            if (imagePreview) {
                imagePreview.style.display = 'none';
            }
        }
        
        async function saveSlideEdit() {
            const slideId = document.getElementById('editSlideId').value;
            if (!slideId) {
                alert('–û—à–∏–±–∫–∞: ID —Å–ª–∞–π–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // Prepare slide data (similar to saveBannerSlide but for editing)
            const slideData = {
                title: {
                    ru: document.getElementById('editSlideTitleRu').value || ''
                },
                description: {
                    ru: document.getElementById('editSlideDescRu').value || ''
                },
                buttonText: {
                    ru: document.getElementById('editSlideButtonTextRu').value || ''
                },
                link: document.getElementById('editSlideLink').value || '',
                order: parseInt(document.getElementById('editSlideOrder').value) || 1,
                isActive: document.getElementById('editSlideActive').checked
            };
            
            // Check if new image is uploaded
            const imageFile = document.getElementById('editSlideImageFile').files[0];
            
            try {
                let response;
                
                if (imageFile) {
                    // If new image uploaded, use FormData (multipart)
                    const formData = new FormData();
                    formData.append('image', imageFile);
                    
                    // Add slide data to FormData
                    Object.keys(slideData).forEach(key => {
                        if (typeof slideData[key] === 'object') {
                            formData.append(key, JSON.stringify(slideData[key]));
                        } else {
                            formData.append(key, slideData[key]);
                        }
                    });
                    
                    const headers = getAuthHeaders();
                    delete headers['Content-Type']; // Let browser set multipart boundary
                    
                    response = await fetch(`${getApiUrl()}/slides/${slideId}`, {
                        method: 'PUT',
                        headers: headers,
                        body: formData
                    });
                } else {
                    // If no new image, send JSON (preserves existing image)
                    response = await fetch(`${getApiUrl()}/slides/${slideId}`, {
                        method: 'PUT',
                        headers: getAuthHeaders(),
                        body: JSON.stringify(slideData)
                    });
                }
                
                const result = await response.json();
                
                if (result.success) {
                    alert('–°–ª–∞–π–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!');
                    closeSlideEditModal();
                    loadCurrentSlides(); // Refresh slides list
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ª–∞–π–¥–∞: ' + (result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('Error updating slide:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ª–∞–π–¥–∞');
            }
        }
        
        // Show batch translation modal (placeholder)
        function showBatchTranslationModal() {
            alert('–§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç—É—Ä–æ–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
        }

        // Show/hide translation progress
        function showTranslationProgress() {
            document.getElementById('translationProgress').style.display = 'block';
            updateProgressBar(0);
            document.getElementById('progressText').textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–µ—Ä–µ–≤–æ–¥—É...';
            document.getElementById('translationResults').innerHTML = '';
        }

        function hideTranslationProgress() {
            document.getElementById('translationProgress').style.display = 'none';
        }

        function updateProgressBar(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // Global error handlers
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            // Prevent the default error logging
            event.preventDefault();
        });
        
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
        });

        
        // Category selection functions
        const categoryMapping = {
            '–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã': 1,
            '–ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã': 2,
            '–≠–∫—Å–∫—É—Ä—Å–∏–∏': 3,
            '–ì–æ—Ä–æ–¥—Å–∫–∏–µ —Ç—É—Ä—ã': 4,
            '–ü—Ä–∏—Ä–æ–¥–∞/—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã': 5,
            '–ö—É–ª—å—Ç—É—Ä–Ω–æ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—É—Ä—ã': 6,
            '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã': 7,
            '–ü–æ—Ö–æ–¥—ã/—Ç—Ä–µ–∫–∏–Ω–≥–∏': 8,
            '–ì–æ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã': 9,
            '–û–∑–µ—Ä–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã': 10,
            '–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã': 11,
            '–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—É—Ä—ã': 12,
            '–ê–≤—Ç–æ—Ç—É—Ä—ã/—Å–∞—Ñ–∞—Ä–∏/–¥–∂–∏–ø-—Ç—É—Ä—ã': 13,
            '–ê–≥—Ä–æ—Ç—É—Ä—ã': 14,
            'VIP —Ç—É—Ä—ã': 15
        };

        function selectCategory(categoryNameRu, categoryNameEn) {
            const categoryId = categoryMapping[categoryNameRu];
            if (categoryId) {
                // Set the category ID in the hidden field
                document.getElementById('tourCategory').value = categoryId;
                
                // Update the category selection display
                const categoryButton = document.querySelector('[onclick="showCategoryListModal()"]');
                if (categoryButton) {
                    const textElement = categoryButton.querySelector('.text-gray-600');
                    if (textElement) {
                        textElement.textContent = categoryNameRu;
                        textElement.classList.remove('text-gray-600');
                        textElement.classList.add('text-blue-600');
                    }
                }
                
                // Handle day tour logic
                handleDayTourLogic(categoryId, categoryNameRu);
                
                // Close the modal
                closeCategoryListModal();
            } else {
                console.error('Category ID not found for:', categoryNameRu);
                alert('–û—à–∏–±–∫–∞: –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–∏–∫–∏ –æ–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã—Ö —Ç—É—Ä–æ–≤
        function handleDayTourLogic(categoryId, categoryName) {
            const isDayTour = categoryId === 1; // "–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã" –∏–º–µ—é—Ç ID = 1
            const durationLabel = document.getElementById('durationLabel');
            const durationDaysField = document.getElementById('tourDurationDays');
            const durationHoursField = document.getElementById('durationHoursField');
            const hotelSection = document.getElementById('hotelSection');
            
            if (isDayTour) {
                // –î–ª—è –æ–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã—Ö —Ç—É—Ä–æ–≤
                durationLabel.textContent = '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å–æ–≤)';
                durationDaysField.placeholder = '8';
                durationDaysField.min = '1';
                durationDaysField.max = '24';
                durationHoursField.style.display = 'block';
                
                // –°–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é –æ—Ç–µ–ª–µ–π
                if (hotelSection) {
                    hotelSection.style.display = 'none';
                }
                
                console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ —Ä–µ–∂–∏–º –æ–¥–Ω–æ–¥–Ω–µ–≤–Ω–æ–≥–æ —Ç—É—Ä–∞');
            } else {
                // –î–ª—è –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã—Ö —Ç—É—Ä–æ–≤
                durationLabel.textContent = '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–µ–π)';
                durationDaysField.placeholder = '';
                durationDaysField.min = '1';
                durationDaysField.max = '';
                durationHoursField.style.display = 'none';
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –æ—Ç–µ–ª–µ–π
                if (hotelSection) {
                    hotelSection.style.display = 'block';
                }
                
                console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ —Ä–µ–∂–∏–º –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω–æ–≥–æ —Ç—É—Ä–∞');
            }
        }

        function showCategoryListModal() {
            document.getElementById('categoryListModal').classList.add('active');
        }

        function closeCategoryListModal() {
            document.getElementById('categoryListModal').classList.remove('active');
        }

        // Check authentication on page load
        function checkAuthOnLoad() {
            const token = localStorage.getItem('authToken');
            if (token) {
                // Verify token with backend before showing dashboard
                fetch(`${getApiUrl()}/admin/verify-token`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Token is valid, show dashboard
                        document.getElementById('loginScreen').style.display = 'none';
                        document.getElementById('adminDashboard').style.display = 'block';
                        showSection('dashboard');
                        loadDashboard();
                    } else {
                        // Token is invalid, show login
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('user');
                        document.getElementById('loginScreen').style.display = 'flex';
                        document.getElementById('adminDashboard').style.display = 'none';
                    }
                })
                .catch(err => {
                    console.error('Token verification failed:', err);
                    // On error, show login
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('user');
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('adminDashboard').style.display = 'none';
                });
            } else {
                // Show login screen
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
            }
        }

        // Navigation handling
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            checkAuthOnLoad();
            
            // Add click handlers for all navigation items
            const navItems = document.querySelectorAll('.nav-item[data-section]');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    
                    // Update active state
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });

        // Tour Pricing Components Functions
        let tourPricingComponents = [];
        let selectedTourComponents = [];

        async function loadTourPricingComponents() {
            console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ü–µ–Ω—ã –¥–ª—è —Ñ–æ—Ä–º—ã —Ç—É—Ä–∞...');
            try {
                const response = await fetch(`${getApiUrl()}/price-calculator`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                
                if (data.success) {
                    tourPricingComponents = data.data;
                    renderTourPricingComponents();
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:', data.message);
                    document.getElementById('tourPricingComponents').innerHTML = 
                        '<div class="text-center text-red-500 py-4">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ü–µ–Ω</div>';
                }
            } catch (error) {
                console.error('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:', error);
                document.getElementById('tourPricingComponents').innerHTML = 
                    '<div class="text-center text-red-500 py-4">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º</div>';
            }
        }

        function renderTourPricingComponents() {
            const container = document.getElementById('tourPricingComponents');
            
            if (tourPricingComponents.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ü–µ–Ω. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–Ω"</div>';
                return;
            }
            

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –í–°–ï –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            container.innerHTML = `
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-700 mb-3 border-b pb-2">
                        <i class="fas fa-calculator mr-2 text-blue-600"></i>
                        –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Ü–µ–Ω
                    </h4>
                    <div class="space-y-2">
                        ${tourPricingComponents.map(component => `
                            <div class="flex items-center gap-3 p-3 bg-white rounded border hover:bg-blue-50 transition">
                                <input type="checkbox" id="component_${component.id}" 
                                       onchange="toggleTourComponent(${component.id}, this.checked)"
                                       class="w-4 h-4 text-blue-600">
                                <label for="component_${component.id}" class="flex-1 cursor-pointer font-medium text-gray-800">
                                    <i class="fas fa-tag mr-2 text-green-600"></i>
                                    ${component.name}
                                </label>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm text-gray-600 font-medium">TJS</span>
                                    <input type="number" min="0" step="0.01" value="${component.price}" 
                                           class="w-24 px-2 py-1 border rounded text-center font-semibold text-blue-600 disabled:bg-gray-100 disabled:cursor-not-allowed"
                                           id="tour_price_${component.id}"
                                           onchange="updateTourComponentPrice(${component.id}, this.value)"
                                           disabled>
                                    <span class="text-sm text-gray-500">/ ${component.unit}</span>
                                </div>
                                <div class="flex items-center gap-2" id="tour_quantity_container_${component.id}" style="display: none;">
                                    <span class="text-sm font-medium">–ö–æ–ª-–≤–æ:</span>
                                    <input type="number" min="1" value="1" 
                                           class="w-16 px-2 py-1 border rounded text-center"
                                           id="tour_quantity_${component.id}"
                                           onchange="updateTourComponentQuantity(${component.id}, this.value)">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }


        function toggleTourComponent(componentId, isChecked) {
            const quantityContainer = document.getElementById(`tour_quantity_container_${componentId}`);
            const priceInput = document.getElementById(`tour_price_${componentId}`);
            
            
            if (isChecked) {
                quantityContainer.style.display = 'flex';
                priceInput.disabled = false; // Enable price editing when selected
                priceInput.style.backgroundColor = 'white'; // –í–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ
                priceInput.style.cursor = 'text';
                
                
                const component = tourPricingComponents.find(c => c.id === componentId);
                if (component) {
                    selectedTourComponents.push({
                        id: componentId,
                        key: component.key,
                        name: component.name,
                        price: parseFloat(priceInput.value) || component.price,
                        unit: component.unit,
                        quantity: 1
                    });
                }
            } else {
                quantityContainer.style.display = 'none';
                priceInput.disabled = true; // Disable price editing when unselected
                priceInput.style.backgroundColor = '#f3f4f6'; // –°–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
                priceInput.style.cursor = 'not-allowed';
                priceInput.value = tourPricingComponents.find(c => c.id === componentId)?.price || 0; // Reset to original price
                selectedTourComponents = selectedTourComponents.filter(c => c.id !== componentId);
                
                console.log(`‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ input –¥–ª—è —Ç—É—Ä-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ${componentId}`);
            }
            
            calculateTourTotalPrice();
            syncIncludedServices(); // üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ª—É–≥
        }

        function updateTourComponentPrice(componentId, newPrice) {
            const component = selectedTourComponents.find(c => c.id === componentId);
            if (component) {
                const numericPrice = parseFloat(newPrice) || 0;
                component.price = numericPrice;
                calculateTourTotalPrice();
                
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                const priceInput = document.getElementById(`tour_price_${componentId}`);
                if (priceInput) {
                    priceInput.style.backgroundColor = '#dcfce7'; // –ó–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω –Ω–∞ 1 —Å–µ–∫
                    setTimeout(() => {
                        priceInput.style.backgroundColor = 'white';
                    }, 1000);
                }
            } else {
                console.error(`‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ${componentId} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç—É—Ä-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö`);
            }
        }

        function updateTourComponentQuantity(componentId, quantity) {
            const component = selectedTourComponents.find(c => c.id === componentId);
            if (component) {
                const numericQuantity = parseInt(quantity) || 1;
                component.quantity = numericQuantity;
                calculateTourTotalPrice();
                console.log(`üìä –û–±–Ω–æ–≤–ª–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—É—Ä-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ${component.name}: ${numericQuantity}`);
            } else {
                console.error(`‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ${componentId} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç—É—Ä-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö`);
            }
        }

        function calculateTourTotalPrice() {
            let totalPrice = 0;
            
            selectedTourComponents.forEach(component => {
                totalPrice += component.price * component.quantity;
            });
            
            // Update display
            document.getElementById('calculatedTotalPrice').textContent = `${totalPrice.toFixed(2)} TJS`;
            // Update hidden field for form submission
            document.getElementById('tourPrice').value = totalPrice.toFixed(2);
            // Save selected components data
            document.getElementById('tourPricingData').value = JSON.stringify(selectedTourComponents);
        }

        // ‚ú® –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ª—É–≥
        function syncIncludedServices() {
            console.log('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ª—É–≥ —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Ç—É—Ä–∞...');
            
            const includesContainer = document.getElementById('includesOptions');
            const placeholder = document.getElementById('includesPlaceholder');
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            includesContainer.innerHTML = '';
            
            if (selectedTourComponents.length === 0) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
                includesContainer.innerHTML = `
                    <div class="text-center text-gray-400 py-4" id="includesPlaceholder">
                        <i class="fas fa-magic mr-2"></i>
                        –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—É—Ä–∞ –≤—ã—à–µ, –∏ —É—Å–ª—É–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å
                    </div>
                `;
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            selectedTourComponents.forEach(component => {
                const serviceName = component.name;
                
                const serviceItem = document.createElement('label');
                serviceItem.className = 'checkbox-item';
                serviceItem.innerHTML = `
                    <input type="checkbox" value="${serviceName}" checked readonly>
                    <span>${serviceName}</span>
                `;
                
                includesContainer.appendChild(serviceItem);
            });
            
        }

        function loadTourPricingComponentsForEdit(savedComponents) {
            
            // Clear current selections
            selectedTourComponents = [];
            
            // Reset all checkboxes and disable price inputs
            document.querySelectorAll('#tourPricingComponents input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('[id^="tour_quantity_container_"]').forEach(container => {
                container.style.display = 'none';
            });
            document.querySelectorAll('[id^="tour_price_"]').forEach(priceInput => {
                priceInput.disabled = true;
                priceInput.style.backgroundColor = '#f3f4f6';
                priceInput.style.cursor = 'not-allowed';
            });
            
            if (!savedComponents || savedComponents.length === 0) {
                console.log('No saved pricing components to load');
                return;
            }
            
            // Populate saved selections
            savedComponents.forEach(savedComponent => {
                const componentId = savedComponent.id;
                const quantity = savedComponent.quantity || 1;
                const price = savedComponent.price;
                
                // Find checkbox and check it
                const checkbox = document.getElementById(`component_${componentId}`);
                if (checkbox) {
                    checkbox.checked = true;
                    
                    // Show quantity container and enable price input
                    const quantityContainer = document.getElementById(`tour_quantity_container_${componentId}`);
                    if (quantityContainer) {
                        quantityContainer.style.display = 'flex';
                    }
                    
                    const priceInput = document.getElementById(`tour_price_${componentId}`);
                    if (priceInput) {
                        priceInput.disabled = false;
                        priceInput.value = price; // Set saved custom price
                    }
                    
                    // Set quantity
                    const quantityInput = document.getElementById(`tour_quantity_${componentId}`);
                    if (quantityInput) {
                        quantityInput.value = quantity;
                    }
                    
                    // Add to selected components
                    selectedTourComponents.push({
                        id: componentId,
                        key: savedComponent.key,
                        name: savedComponent.name,
                        price: price,
                        unit: savedComponent.unit,
                        quantity: quantity
                    });
                    
                }
            });
            
            // Recalculate total price
            calculateTourTotalPrice();
            syncIncludedServices(); // üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ª—É–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        }

        // Show section function
        function showSection(sectionName) {
            // Hide all sections
            const sections = ['dashboardSection', 'toursSection', 'categoriesSection', 'priceCalculatorSection', 'bannerManagementSection', 'bookingsSection', 'hotelsSection', 'guidesSection', 'tourAgentsSection', 'driversSection', 'tripsSection', 'transfersSection', 'countriesSection', 'citiesSection', 'customersSection', 'reviewsSection', 'newsSection', 'paymentsSection', 'exchangeRatesSection', 'cmsSection', 'translationSection', 'settingsSection'];
            sections.forEach(sectionId => {
                const element = document.getElementById(sectionId);
                if (element) element.style.display = 'none';
            });

            // Show selected section - map section names to section IDs
            let sectionId;
            switch(sectionName) {
                case 'price-calculator':
                    sectionId = 'priceCalculatorSection';
                    loadPriceCalculator(); // Load with new system
                    break;
                case 'tours':
                    sectionId = 'toursSection';
                    loadTourPricingComponents(); // Load pricing components for tour form
                    break;
                case 'banner-management':
                    sectionId = 'bannerManagementSection';
                    break;
                default:
                    sectionId = sectionName + 'Section';
            }
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Load section-specific data
            switch(sectionName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'tours':
                    loadTours();
                    break;
                case 'categories':
                    loadCategories();
                    break;
                case 'price-calculator':
                    loadPriceCalculator();
                    break;
                case 'banner-management':
                    loadBannerManagement();
                    break;
                case 'bookings':
                    loadBookings();
                    break;
                case 'hotels':
                    loadHotels();
                    break;
                case 'guides':
                    loadGuides();
                    break;
                case 'tour-agents':
                    loadTourAgents();
                    break;
                case 'drivers':
                    loadDrivers();
                    break;
                case 'trips':
                    loadTrips();
                    break;
                case 'transfers':
                    loadTransfers();
                    break;
                case 'countries':
                    loadCountries();
                    break;
                case 'cities':
                    loadCities();
                    break;
                case 'reviews':
                    loadReviews();
                    break;
                case 'news':
                    loadNews();
                    break;
                case 'cms':
                    switchCMSTab('blocks');
                    break;
                case 'translations':
                    showTranslations();
                    break;
                case 'exchange-rates':
                    loadExchangeRates();
                    break;
                case 'settings':
                    // Load settings if needed
                    break;
            }
        }

        // Load functions for new sections
        // REMOVED - old loadPriceCalculator function (conflicted with new one)

        function loadBannerManagement() {
            loadCurrentSlides();
        }

        // Exchange Rates Functions
        async function loadExchangeRates() {
            try {
                const response = await fetch(`${getApiUrl()}/exchange-rates`);
                const data = await response.json();
                
                if (data.success) {
                    displayExchangeRates(data.data);
                } else {
                    console.error('Error loading exchange rates:', data.message);
                }
            } catch (error) {
                console.error('Error loading exchange rates:', error);
                showErrorMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç');
            }
        }

        function displayExchangeRates(rates) {
            const tbody = document.getElementById('exchangeRatesTableBody');
            
            if (!rates || rates.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = rates.map(rate => `
                <tr>
                    <td>
                        <span class="font-semibold">${rate.currency}</span>
                    </td>
                    <td>${rate.name}</td>
                    <td>
                        <span class="bg-gray-100 px-2 py-1 rounded text-sm">${rate.symbol}</span>
                    </td>
                    <td>
                        <span class="font-mono">${rate.rate}</span>
                        ${rate.currency === 'TJS' ? '<small class="text-gray-500 block">–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞</small>' : ''}
                    </td>
                    <td>
                        <span class="text-sm text-gray-600">
                            ${new Date(rate.updatedAt).toLocaleDateString('ru-RU', { 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </span>
                    </td>
                    <td>
                        ${rate.currency !== 'TJS' ? `
                            <div class="flex gap-2">
                                <button onclick="editExchangeRate('${rate.currency}')" class="btn btn-sm btn-primary">
                                    <i class="fas fa-edit"></i>
                                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button onclick="deleteExchangeRate('${rate.currency}')" class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i>
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        ` : '<span class="text-gray-400 text-sm">–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞</span>'}
                    </td>
                </tr>
            `).join('');
        }

        function editExchangeRate(currency) {
            fetch(`${getApiUrl()}/exchange-rates`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const rate = data.data.find(r => r.currency === currency);
                        if (rate) {
                            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
                            document.getElementById('editCurrency').value = rate.currency;
                            document.getElementById('editCurrencyCode').value = rate.currency;
                            document.getElementById('editCurrencyName').value = rate.name;
                            document.getElementById('editCurrencySymbol').value = rate.symbol;
                            document.getElementById('editCurrencyRate').value = rate.rate;
                            
                            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                            document.getElementById('exchangeRateModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã';
                            const currencyCodeField = document.getElementById('editCurrencyCode');
                            currencyCodeField.readOnly = true;
                            currencyCodeField.style.backgroundColor = '#f9fafb';
                            currencyCodeField.style.cursor = 'not-allowed';
                            window.isEditMode = true;
                            
                            document.getElementById('exchangeRateModal').classList.add('active');
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading exchange rate:', error);
                    showErrorMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç—ã');
                });
        }

        function closeExchangeRateModal() {
            document.getElementById('exchangeRateModal').classList.remove('active');
            document.getElementById('exchangeRateForm').reset();
            // –°–±—Ä–æ—Å —Ä–µ–∂–∏–º–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            delete window.isEditMode;
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –≤–∞–ª—é—Ç—ã
        function openAddExchangeRateModal() {
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('exchangeRateForm').reset();
            document.getElementById('editCurrency').value = '';
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
            document.getElementById('exchangeRateModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–∞–ª—é—Ç—É';
            const currencyCodeField = document.getElementById('editCurrencyCode');
            currencyCodeField.readOnly = false;
            currencyCodeField.style.backgroundColor = '';
            currencyCodeField.style.cursor = '';
            window.isEditMode = false;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('exchangeRateModal').classList.add('active');
        }

        // –£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã
        async function deleteExchangeRate(currency) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–∞–ª—é—Ç—É ${currency}?`)) {
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/exchange-rates/${currency}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccessMessage('–í–∞–ª—é—Ç–∞ —É–¥–∞–ª–µ–Ω–∞');
                    loadExchangeRates();
                } else {
                    showErrorMessage(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤–∞–ª—é—Ç—ã');
                }
            } catch (error) {
                console.error('Error deleting exchange rate:', error);
                showErrorMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤–∞–ª—é—Ç—ã');
            }
        }

        async function calculateCurrency() {
            const amount = document.getElementById('calcAmount').value;
            const targetCurrency = document.getElementById('calcTargetCurrency').value;
            
            if (!amount || amount <= 0) {
                showErrorMessage('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/exchange-rates/convert?amount=${amount}&targetCurrency=${targetCurrency}`);
                const data = await response.json();
                
                if (data.success) {
                    const result = document.getElementById('calcResult');
                    result.textContent = `${data.data.symbol}${data.data.convertedAmount}`;
                } else {
                    showErrorMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏');
                }
            } catch (error) {
                console.error('Error calculating currency:', error);
                showErrorMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç—ã');
            }
        }

        // Exchange Rate Form Handler
        document.getElementById('exchangeRateForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const isEdit = window.isEditMode;
            const currencyCode = safeGetValue('editCurrencyCode', '').toUpperCase();
            const originalCurrency = safeGetValue('editCurrency', '');
            const rate = safeGetValue('editCurrencyRate', 0, 'float');
            const symbol = safeGetValue('editCurrencySymbol', '');
            const name = safeGetValue('editCurrencyName', '');
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!currencyCode || !name || !symbol || !rate) {
                showErrorMessage('–í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è');
                return;
            }

            if (currencyCode.length !== 3) {
                showErrorMessage('–ö–æ–¥ –≤–∞–ª—é—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 3 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            try {
                let response;
                let successMessage;
                
                if (isEdit) {
                    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≤–∞–ª—é—Ç—ã
                    response = await fetch(`${getApiUrl()}/exchange-rates/${originalCurrency}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ rate, symbol, name })
                    });
                    successMessage = '–ö—É—Ä—Å –≤–∞–ª—é—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω';
                } else {
                    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–∞–ª—é—Ç—ã
                    response = await fetch(`${getApiUrl()}/exchange-rates`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            currency: currencyCode, 
                            rate, 
                            symbol, 
                            name 
                        })
                    });
                    successMessage = '–ù–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞';
                }
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccessMessage(successMessage);
                    closeExchangeRateModal();
                    loadExchangeRates();
                } else {
                    showErrorMessage(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–∞–ª—é—Ç—ã');
                }
            } catch (error) {
                console.error('Error saving exchange rate:', error);
                showErrorMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–∞–ª—é—Ç—ã');
            }
        });

        // ============== –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í–´–ü–ê–î–ê–Æ–©–ò–• –°–ü–ò–°–ö–û–í –°–¢–†–ê–ù –ò –ì–û–†–û–î–û–í ==============
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
        async function loadCountriesForSelect(selectId) {
            try {
                const response = await fetch(`${getApiUrl()}/countries`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const select = document.getElementById(selectId);
                
                if (select && data.success && data.data) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    const currentValue = select.value;
                    
                    // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                    
                    data.data.forEach(country => {
                        if (country.isActive) {
                            const option = document.createElement('option');
                            option.value = country.nameRu; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ
                            option.textContent = country.nameRu;
                            option.dataset.countryId = country.id;
                            select.appendChild(option);
                        }
                    });
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ
                    if (currentValue) {
                        select.value = currentValue;
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã
        async function loadCitiesForCountry(countryName, citySelectId) {
            const citySelect = document.getElementById(citySelectId);
            
            if (!citySelect) return Promise.resolve();
            
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
            citySelect.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∂–∞–µ–º –≥–æ—Ä–æ–¥–∞...</option>';
            
            if (!countryName) {
                citySelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                return Promise.resolve();
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/cities`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    // –§–∏–ª—å—Ç—Ä—É–µ–º –≥–æ—Ä–æ–¥–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–µ
                    const countryCities = data.data.filter(city => 
                        city.isActive && city.country && city.country.nameRu === countryName
                    );
                    
                    citySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
                    
                    if (countryCities.length > 0) {
                        countryCities.forEach(city => {
                            const option = document.createElement('option');
                            option.value = city.nameRu;
                            option.textContent = city.nameRu;
                            option.dataset.cityId = city.id;
                            citySelect.appendChild(option);
                        });
                    } else {
                        citySelect.innerHTML = '<option value="">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤</option>';
                    }
                }
                
                return Promise.resolve();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤:', error);
                citySelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
                return Promise.resolve();
            }
        }
        
        // ============== –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–†–ê–ù–ê–ú–ò –ò –ì–û–†–û–î–ê–ú–ò ==============
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω
        async function loadCountries() {
            try {
                const response = await fetch(`${getApiUrl()}/countries`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const countriesList = document.getElementById('countriesList');
                
                if (data.success && data.data && data.data.length > 0) {
                    countriesList.innerHTML = data.data.map(country => `
                        <div class="bg-white rounded-lg shadow-sm border p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center">
                                    <i class="fas fa-globe text-blue-500 text-xl mr-3"></i>
                                    <div>
                                        <h3 class="font-semibold text-gray-900">${country.nameRu}</h3>
                                        <p class="text-sm text-gray-600">–ö–æ–¥: ${country.code}</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 text-xs rounded-full ${country.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${country.isActive ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞'}
                                </span>
                            </div>
                            <div class="text-sm text-gray-600 mb-3">
                                <p><strong>EN:</strong> ${country.nameEn}</p>
                                <p><strong>TJ:</strong> ${country.nameTj}</p>
                                <p><strong>–ì–æ—Ä–æ–¥–æ–≤:</strong> ${country.cities ? country.cities.length : 0}</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editCountry(${country.id})" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button onclick="deleteCountry(${country.id})" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    countriesList.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="bg-gray-50 rounded-xl p-8">
                                <i class="fas fa-globe text-gray-400 text-4xl mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">–ù–µ—Ç —Å—Ç—Ä–∞–Ω</h3>
                                <p class="text-gray-600 mb-6">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω—É</p>
                                <button onclick="openCountryModal()" class="btn btn-primary">
                                    <i class="fas fa-plus mr-2"></i>
                                    –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É
                                </button>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω:', error);
                document.getElementById('countriesList').innerHTML = `
                    <div class="col-span-full">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <span class="text-red-700">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω</span>
                        </div>
                    </div>
                `;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ—Ä–æ–¥–æ–≤
        async function loadCities() {
            try {
                const response = await fetch(`${getApiUrl()}/cities`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const citiesList = document.getElementById('citiesList');
                
                if (!citiesList) {
                    console.error('citiesList element not found');
                    return;
                }
                
                if (data.success && data.data && data.data.length > 0) {
                    citiesList.innerHTML = data.data.map(city => `
                        <div class="bg-white rounded-lg shadow-sm border p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center">
                                    <i class="fas fa-city text-blue-500 text-xl mr-3"></i>
                                    <div>
                                        <h3 class="font-semibold text-gray-900">${city.nameRu || ''}</h3>
                                        <p class="text-sm text-gray-600">${city.country ? city.country.nameRu : '–ë–µ–∑ —Å—Ç—Ä–∞–Ω—ã'}</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 text-xs rounded-full ${city.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${city.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                                </span>
                            </div>
                            <div class="text-sm text-gray-600 mb-3">
                                <p><strong>EN:</strong> ${city.nameEn || ''}</p>
                                <p><strong>TJ:</strong> ${city.nameTj || ''}</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editCity(${city.id})" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button onclick="deleteCity(${city.id})" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    citiesList.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="bg-gray-50 rounded-xl p-8">
                                <i class="fas fa-city text-gray-400 text-4xl mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">–ù–µ—Ç –≥–æ—Ä–æ–¥–æ–≤</h3>
                                <p class="text-gray-600 mb-6">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –≥–æ—Ä–æ–¥</p>
                                <button onclick="openCityModal()" class="btn btn-primary">
                                    <i class="fas fa-plus mr-2"></i>
                                    –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥
                                </button>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤:', error);
                const citiesList = document.getElementById('citiesList');
                if (citiesList) {
                    citiesList.innerHTML = `
                        <div class="col-span-full">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <span class="text-red-700">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤</span>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω —Å—Ç—Ä–∞–Ω –∏ –≥–æ—Ä–æ–¥–æ–≤
        
        // === –°–¢–†–ê–ù–´ ===
        function openCountryModal(countryId = null) {
            document.getElementById('countryModal').style.display = 'flex';
            document.getElementById('countryForm').reset();
            document.getElementById('countryId').value = '';
            
            if (countryId) {
                // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                document.getElementById('countryModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω—É';
                loadCountryForEdit(countryId);
            } else {
                // –†–µ–∂–∏–º —Å–æ–∑–¥–∞–Ω–∏—è
                document.getElementById('countryModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É';
            }
        }
        
        function closeCountryModal() {
            document.getElementById('countryModal').style.display = 'none';
        }
        
        async function saveCountry() {
            const countryId = document.getElementById('countryId').value;
            const isEditing = !!countryId;
            
            const countryData = {
                name: document.getElementById('countryName').value,
                nameRu: document.getElementById('countryNameRu').value,
                nameEn: document.getElementById('countryName').value,
                code: document.getElementById('countryCode').value.toUpperCase()
            };
            
            try {
                const url = isEditing ? `${getApiUrl()}/countries/${countryId}` : `${getApiUrl()}/countries`;
                const method = isEditing ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        ...getAuthHeaders(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(countryData)
                });
                
                const data = await response.json();
                if (data.success) {
                    alert(isEditing ? '–°—Ç—Ä–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!' : '–°—Ç—Ä–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
                    closeCountryModal();
                    loadCountries();
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (data.message || data.error));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }
        
        function editCountry(id) { openCountryModal(id); }
        
        async function loadCountryForEdit(countryId) {
            try {
                const response = await fetch(`${getApiUrl()}/countries/${countryId}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    const country = data.data;
                    document.getElementById('countryId').value = country.id;
                    document.getElementById('countryName').value = country.nameEn || country.name;
                    document.getElementById('countryNameRu').value = country.nameRu;
                    document.getElementById('countryCode').value = country.code;
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω—ã: ' + error.message);
            }
        }
        
        // === –ì–û–†–û–î–ê ===
        function openCityModal(cityId = null) {
            document.getElementById('cityModal').style.display = 'flex';
            document.getElementById('cityForm').reset();
            document.getElementById('cityId').value = '';
            loadCountriesForCityModal();
            
            if (cityId) {
                // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                document.getElementById('cityModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä–æ–¥';
                loadCityForEdit(cityId);
            } else {
                // –†–µ–∂–∏–º —Å–æ–∑–¥–∞–Ω–∏—è
                document.getElementById('cityModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥';
            }
        }
        
        function closeCityModal() {
            document.getElementById('cityModal').style.display = 'none';
        }
        
        async function saveCity() {
            const cityId = document.getElementById('cityId').value;
            const isEditing = !!cityId;
            
            const cityData = {
                countryId: parseInt(document.getElementById('cityCountryId').value),
                name: document.getElementById('cityName').value,
                nameRu: document.getElementById('cityNameRu').value,
                nameEn: document.getElementById('cityName').value,
            };
            
            try {
                const url = isEditing ? `${getApiUrl()}/cities/${cityId}` : `${getApiUrl()}/cities`;
                const method = isEditing ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        ...getAuthHeaders(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(cityData)
                });
                
                const data = await response.json();
                if (data.success) {
                    alert(isEditing ? '–ì–æ—Ä–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!' : '–ì–æ—Ä–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    closeCityModal();
                    loadCountries();
                    loadCities();
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (data.message || data.error));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }
        
        function editCity(id) { openCityModal(id); }
        
        async function loadCountriesForCityModal() {
            try {
                const response = await fetch(`${getApiUrl()}/countries`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    const select = document.getElementById('cityCountryId');
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
                    
                    data.data.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country.id;
                        option.textContent = country.nameRu || country.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω:', error);
            }
        }
        
        async function loadCityForEdit(cityId) {
            try {
                const response = await fetch(`${getApiUrl()}/cities/${cityId}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    const city = data.data;
                    document.getElementById('cityId').value = city.id;
                    document.getElementById('cityCountryId').value = city.countryId;
                    document.getElementById('cityName').value = city.nameEn || city.name;
                    document.getElementById('cityNameRu').value = city.nameRu;
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–∞: ' + error.message);
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã
        async function deleteCountry(countryId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω—É? –≠—Ç–æ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –≥–æ—Ä–æ–¥–∞.')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/countries/${countryId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–°—Ç—Ä–∞–Ω–∞ —É–¥–∞–ª–µ–Ω–∞');
                    loadCountries();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.message || data.error));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
        async function deleteCity(cityId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≥–æ—Ä–æ–¥?')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/cities/${cityId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–ì–æ—Ä–æ–¥ —É–¥–∞–ª–µ–Ω');
                    loadCities();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.message || data.error));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        // ============== –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–û–î–ò–¢–ï–õ–Ø–ú–ò ==============
        
        async function loadDrivers() {
            try {
                const response = await fetch(`${getApiUrl()}/drivers`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const driversList = document.getElementById('driversList');
                
                if (data.success && data.data && data.data.length > 0) {
                    driversList.innerHTML = data.data.map(driver => `
                        <div class="bg-white rounded-lg shadow-sm border p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                        ${driver.photo ? 
                                            `<img data-image-placeholder="driver-photo" alt="Avatar" class="w-full h-full rounded-full object-cover">` :
                                            `<i class="fas fa-id-card text-blue-500 text-xl"></i>`
                                        }
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900">${driver.name}</h3>
                                        <p class="text-sm text-gray-600">${driver.vehicleBrand || '–ë–µ–∑ –∞–≤—Ç–æ–º–æ–±–∏–ª—è'} ${driver.vehicleYear || ''}</p>
                                        <p class="text-sm text-gray-500">–û–ø—ã—Ç: ${driver.experience || 0} –ª–µ—Ç</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 text-xs rounded-full ${driver.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${driver.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                                </span>
                            </div>
                            <div class="text-sm text-gray-600 mb-3">
                                <p><strong>–õ–∏—Ü–µ–Ω–∑–∏—è:</strong> ${driver.licenseCategory || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                                <p><strong>–¶–µ–Ω–∞/–¥–µ–Ω—å:</strong> ${driver.pricePerDay || 0} ${driver.currency || 'TJS'}</p>
                                <p><strong>–Ø–∑—ã–∫–∏:</strong> ${driver.languages || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editDriver(${driver.id})" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button onclick="deleteDriver(${driver.id})" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    driversList.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="bg-gray-50 rounded-xl p-8">
                                <i class="fas fa-id-card text-gray-400 text-4xl mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">–ù–µ—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–π</h3>
                                <p class="text-gray-600 mb-6">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è</p>
                                <button onclick="openDriverModal()" class="btn btn-primary">
                                    <i class="fas fa-plus mr-2"></i>
                                    –î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è
                                </button>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π:', error);
                document.getElementById('driversList').innerHTML = `
                    <div class="col-span-full">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <span class="text-red-700">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π</span>
                        </div>
                    </div>
                `;
            }
        }

        function openDriverModal(driverId = null) {
            document.getElementById('driverModal').classList.add('active');
            if (driverId) {
                // –õ–æ–≥–∏–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ)
                console.log('Editing driver:', driverId);
            }
        }

        function closeDriverModal() {
            document.getElementById('driverModal').classList.remove('active');
            document.getElementById('driverForm').reset();
        }

        async function saveDriver() {
            const form = document.getElementById('driverForm');
            const formData = new FormData(form);
            
            // –°–æ–±–∏—Ä–∞–µ–º —Ç–∏–ø—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
            const vehicleTypes = [];
            form.querySelectorAll('input[name="vehicleTypes"]:checked').forEach(checkbox => {
                vehicleTypes.push(checkbox.value);
            });
            formData.set('vehicleTypes', JSON.stringify(vehicleTypes));

            try {
                const response = await fetch(`${getApiUrl()}/drivers/create-with-auth`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: formData
                });

                const data = await response.json();
                if (data.success) {
                    alert('–í–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    closeDriverModal();
                    loadDrivers();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        function editDriver(driverId) {
            // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è
            openDriverModal(driverId);
        }

        async function deleteDriver(driverId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è?')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/drivers/${driverId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–í–æ–¥–∏—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
                    loadDrivers();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.message || data.error));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        // ============== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–ï–ó–î–ö–ê–ú–ò ==============
        
        async function loadTrips() {
            try {
                const response = await fetch(`${getApiUrl()}/trips`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const tripsTable = document.getElementById('tripsTable');
                
                if (data && data.length > 0) {
                    tripsTable.innerHTML = data.map(trip => `
                        <tr>
                            <td>${trip.id}</td>
                            <td>${trip.direction}</td>
                            <td>${trip.routeFrom}</td>
                            <td>${trip.routeTo}</td>
                            <td>${trip.driverName || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</td>
                            <td>${trip.pickupTime}</td>
                            <td>${trip.dropoffTime}</td>
                            <td>
                                <span class="badge badge-${trip.status === 'completed' ? 'success' : trip.status === 'pending' ? 'warning' : 'info'}">
                                    ${trip.status}
                                </span>
                            </td>
                            <td>
                                <button onclick="editTrip(${trip.id})" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteTrip(${trip.id})" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    tripsTable.innerHTML = '<tr><td colspan="9" class="text-center py-8 text-gray-500">–ù–µ—Ç –ø–æ–µ–∑–¥–æ–∫</td></tr>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–µ–∑–¥–æ–∫:', error);
                document.getElementById('tripsTable').innerHTML = '<tr><td colspan="9" class="text-center py-8 text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–µ–∑–¥–æ–∫</td></tr>';
            }
        }

        async function loadTripDrivers() {
            try {
                const response = await fetch(`${getApiUrl()}/drivers`, {
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                const driverSelect = document.getElementById('tripDriverId');
                
                if (data.success && data.data) {
                    driverSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è</option>' +
                        data.data.map(driver => `<option value="${driver.id}">${driver.name}</option>`).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –ø–æ–µ–∑–¥–æ–∫:', error);
            }
        }

        // ============== –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–†–ê–ù–°–§–ï–†–ê–ú–ò ==============
        
        async function loadTransfers() {
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests`, {
                    headers: getAuthHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const transfersTable = document.getElementById('transfersTable');
                
                if (data.success && data.data && data.data.length > 0) {
                    transfersTable.innerHTML = data.data.map(transfer => `
                        <tr>
                            <td>${transfer.id}</td>
                            <td>${transfer.clientName}</td>
                            <td>${transfer.clientPhone}</td>
                            <td>${transfer.fromLocation}</td>
                            <td>${transfer.toLocation}</td>
                            <td>${transfer.pickupDate}</td>
                            <td>${transfer.pickupTime}</td>
                            <td>$${transfer.requestedPrice}</td>
                            <td>
                                <span class="badge badge-${
                                    transfer.status === 'approved' ? 'success' : 
                                    transfer.status === 'pending' ? 'warning' : 
                                    transfer.status === 'rejected' ? 'danger' : 'info'
                                }">
                                    ${transfer.status}
                                </span>
                            </td>
                            <td>
                                ${transfer.status === 'pending' ? `
                                    <button onclick="approveTransfer(${transfer.id})" class="btn btn-sm btn-success me-1">
                                        <i class="fas fa-check"></i> –û–¥–æ–±—Ä–∏—Ç—å
                                    </button>
                                    <button onclick="rejectTransfer(${transfer.id})" class="btn btn-sm btn-danger me-1">
                                        <i class="fas fa-times"></i> –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                    </button>
                                ` : ''}
                                <button onclick="editTransfer(${transfer.id})" class="btn btn-sm btn-outline-primary me-1">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteTransfer(${transfer.id})" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    transfersTable.innerHTML = '<tr><td colspan="10" class="text-center py-8 text-gray-500">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã</td></tr>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤:', error);
                document.getElementById('transfersTable').innerHTML = '<tr><td colspan="10" class="text-center py-8 text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤</td></tr>';
            }
        }

        async function approveTransfer(transferId) {
            const finalPrice = prompt('–í–≤–µ–¥–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É (USD):');
            const adminNotes = prompt('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):') || '–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º';
            
            if (finalPrice === null) return; // User cancelled
            
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests/${transferId}/approve`, {
                    method: 'POST',
                    headers: {
                        ...getAuthHeaders(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        adminNotes,
                        finalPrice: parseFloat(finalPrice) || null
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –æ–¥–æ–±—Ä–µ–Ω!');
                    loadTransfers();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (data.error || data.message));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function rejectTransfer(transferId) {
            const adminNotes = prompt('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:');
            if (!adminNotes) {
                alert('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è');
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests/${transferId}/reject`, {
                    method: 'POST',
                    headers: {
                        ...getAuthHeaders(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ adminNotes })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç–∫–ª–æ–Ω–µ–Ω');
                    loadTransfers();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (data.error || data.message));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function editTransfer(transferId) {
            // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
            alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        async function deleteTransfer(transferId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä?')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests/${transferId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–ó–∞—è–≤–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä —É–¥–∞–ª–µ–Ω–∞');
                    loadTransfers();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.error || data.message));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        function openTripModal() {
            document.getElementById('tripModal').style.display = 'flex';
            loadTripDrivers();
            loadTripTours(); // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ç—É—Ä–æ–≤
        }

        function closeTripModal() {
            document.getElementById('tripModal').style.display = 'none';
            document.getElementById('tripForm').reset();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤ –≤ Trip Modal
        async function loadTripTours() {
            try {
                const response = await fetch(`${getApiUrl()}/tours`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    const select = document.getElementById('tripTourId');
                    select.innerHTML = '<option value="">–ù–µ —Å–≤—è–∑–∞–Ω —Å —Ç—É—Ä–æ–º</option>';
                    
                    data.data.forEach(tour => {
                        const option = document.createElement('option');
                        option.value = tour.id;
                        // –ü–∞—Ä—Å–∏–º title –µ—Å–ª–∏ —ç—Ç–æ JSON
                        let title = tour.title;
                        if (typeof title === 'string' && title.startsWith('{')) {
                            try {
                                const titleObj = JSON.parse(title);
                                title = titleObj.ru || titleObj.en || title;
                            } catch (e) {
                                // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                            }
                        }
                        option.textContent = `#${tour.id}: ${title}`;
                        select.appendChild(option);
                    });
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤:', data.error);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤:', error);
            }
        }
        
        async function createTrip() {
            const form = document.getElementById('tripForm');
            const formData = new FormData(form);
            const tripData = Object.fromEntries(formData.entries());
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ID –ø–æ–ª—è –≤ —á–∏—Å–ª–∞
            if (tripData.driverId) tripData.driverId = parseInt(tripData.driverId);
            if (tripData.tourId) tripData.tourId = parseInt(tripData.tourId);

            try {
                const response = await fetch(`${getApiUrl()}/trips`, {
                    method: 'POST',
                    headers: {
                        ...getAuthHeaders(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(tripData)
                });

                const data = await response.json();
                if (data.success) {
                    const tourInfo = tripData.tourId ? ` (—Å–≤—è–∑–∞–Ω–∞ —Å —Ç—É—Ä–æ–º #${tripData.tourId})` : '';
                    alert('–ü–æ–µ–∑–¥–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!' + tourInfo);
                    closeTripModal();
                    loadTrips();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        function editTrip(tripId) {
            console.log('Editing trip:', tripId);
            // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏ (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ)
        }

        async function deleteTrip(tripId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–µ–∑–¥–∫—É?')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/trips/${tripId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–ü–æ–µ–∑–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
                    loadTrips();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.message || data.error));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        // ============== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–Ø–í–ö–ê–ú–ò –ù–ê –¢–†–ê–ù–°–§–ï–† ==============
        
        async function loadTransferRequests() {
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to load transfer requests');
                }
                
                const transferRequests = result.data || [];
                const transferRequestsTable = document.getElementById('transferRequestsTable');
                
                if (transferRequests && transferRequests.length > 0) {
                    transferRequestsTable.innerHTML = transferRequests.map(request => `
                        <tr>
                            <td>#${request.id}</td>
                            <td>
                                <div class="font-medium">${request.fullName}</div>
                                <div class="text-sm text-gray-500">${new Date(request.createdAt).toLocaleDateString('ru-RU')}</div>
                            </td>
                            <td>
                                <div>${request.email ? `üìß ${request.email}` : ''}</div>
                                <div>${request.phone ? `üì± ${request.phone}` : ''}</div>
                            </td>
                            <td>
                                <div class="font-medium">${request.pickupLocation}</div>
                                <div class="text-sm text-gray-500">‚Üì</div>
                                <div class="font-medium">${request.dropoffLocation}</div>
                            </td>
                            <td>
                                <div class="font-medium">${request.pickupDate}</div>
                                <div class="text-sm text-gray-500">${request.pickupTime}</div>
                            </td>
                            <td class="text-center">${request.numberOfPeople || 1}</td>
                            <td>
                                <span class="badge badge-info">${getVehicleTypeName(request.vehicleType)}</span>
                            </td>
                            <td>
                                <span class="badge badge-${getStatusBadgeColor(request.status)}">${getStatusName(request.status)}</span>
                            </td>
                            <td>
                                ${request.assignedDriver ? 
                                    `<div class="font-medium">${request.assignedDriver.fullName}</div><div class="text-sm text-gray-500">${request.assignedDriver.contact}</div>` : 
                                    '<span class="text-gray-500">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</span>'
                                }
                            </td>
                            <td>
                                ${request.finalPrice ? 
                                    `<div class="font-medium">${request.finalPrice} TJS</div>` : 
                                    (request.estimatedPrice ? 
                                        `<div class="text-gray-500">~${request.estimatedPrice} TJS</div>` : 
                                        '<span class="text-gray-400">-</span>'
                                    )
                                }
                            </td>
                            <td>
                                <div class="flex flex-col gap-1">
                                    ${request.status === 'pending' ? `
                                        <button onclick="approveTransferRequest(${request.id})" class="btn btn-sm btn-success" title="–û–¥–æ–±—Ä–∏—Ç—å">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button onclick="rejectTransferRequest(${request.id})" class="btn btn-sm btn-danger" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    ` : ''}
                                    <button onclick="viewTransferRequestDetails(${request.id})" class="btn btn-sm btn-outline-info" title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    ${request.status !== 'pending' ? `
                                        <button onclick="deleteTransferRequest(${request.id})" class="btn btn-sm btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    transferRequestsTable.innerHTML = '<tr><td colspan="11" class="text-center py-8 text-gray-500">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä</td></tr>';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateTransferStats(transferRequests);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä:', error);
                document.getElementById('transferRequestsTable').innerHTML = '<tr><td colspan="11" class="text-center py-8 text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä</td></tr>';
            }
        }

        // Approve transfer request
        async function approveTransferRequest(requestId) {
            if (!confirm('–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä?')) {
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests/${requestId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!');
                    loadTransferRequests();
                } else {
                    alert('–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        // Reject transfer request
        async function rejectTransferRequest(requestId) {
            const reason = prompt('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):');
            if (reason === null) return; // User cancelled
            
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests/${requestId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        adminNotes: reason || '–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º' 
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
                    loadTransferRequests();
                } else {
                    alert('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        // View transfer request details
        async function viewTransferRequestDetails(requestId) {
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests/${requestId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to load transfer request details');
                }
                
                const request = result.data;
                
                const detailsHTML = `
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h4>
                                <div class="mt-2 space-y-1">
                                    <div><strong>–§–ò–û:</strong> ${request.fullName}</div>
                                    ${request.email ? `<div><strong>Email:</strong> ${request.email}</div>` : ''}
                                    ${request.phone ? `<div><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${request.phone}</div>` : ''}
                                    <div><strong>–ü–æ–¥–∞–Ω–∞:</strong> ${new Date(request.createdAt).toLocaleString('ru-RU')}</div>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700">–î–µ—Ç–∞–ª–∏ –ø–æ–µ–∑–¥–∫–∏</h4>
                                <div class="mt-2 space-y-1">
                                    <div><strong>–û—Ç–∫—É–¥–∞:</strong> ${request.pickupLocation}</div>
                                    <div><strong>–ö—É–¥–∞:</strong> ${request.dropoffLocation}</div>
                                    <div><strong>–î–∞—Ç–∞:</strong> ${request.pickupDate}</div>
                                    <div><strong>–í—Ä–µ–º—è:</strong> ${request.pickupTime}</div>
                                    <div><strong>–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤:</strong> ${request.numberOfPeople || 1}</div>
                                    ${request.vehicleType ? `<div><strong>–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞:</strong> ${getVehicleTypeName(request.vehicleType)}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        ${request.specialRequests ? `
                            <div>
                                <h4 class="font-semibold text-gray-700">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è</h4>
                                <div class="mt-2 p-3 bg-gray-50 rounded-lg">${request.specialRequests}</div>
                            </div>
                        ` : ''}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700">–°—Ç–∞—Ç—É—Å –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞</h4>
                                <div class="mt-2 space-y-1">
                                    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="badge badge-${getStatusBadgeColor(request.status)}">${getStatusName(request.status)}</span></div>
                                    ${request.adminNotes ? `<div><strong>–ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</strong> ${request.adminNotes}</div>` : ''}
                                    ${request.assignedDriver ? `<div><strong>–í–æ–¥–∏—Ç–µ–ª—å:</strong> ${request.assignedDriver.fullName} (${request.assignedDriver.contact})</div>` : ''}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700">–°—Ç–æ–∏–º–æ—Å—Ç—å</h4>
                                <div class="mt-2 space-y-1">
                                    ${request.estimatedPrice ? `<div><strong>–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞:</strong> ${request.estimatedPrice} TJS</div>` : ''}
                                    ${request.finalPrice ? `<div><strong>–ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞:</strong> ${request.finalPrice} TJS</div>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Show in a modal (assuming there's a universal modal system)
                showModal('–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä', detailsHTML);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞—è–≤–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞—è–≤–∫–∏');
            }
        }

        // Delete transfer request
        async function deleteTransferRequest(requestId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/transfer-requests/${requestId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('–ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
                    loadTransferRequests();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        // Update transfer request statistics
        function updateTransferStats(transferRequests) {
            const pending = transferRequests.filter(r => r.status === 'pending').length;
            const approved = transferRequests.filter(r => r.status === 'approved').length;
            const rejected = transferRequests.filter(r => r.status === 'rejected').length;
            const total = transferRequests.length;
            
            document.getElementById('pendingTransfersCount').textContent = pending;
            document.getElementById('approvedTransfersCount').textContent = approved;
            document.getElementById('rejectedTransfersCount').textContent = rejected;
            document.getElementById('totalTransfersCount').textContent = total;
        }

        // Filter transfer requests by status
        function filterTransferRequests() {
            const filter = document.getElementById('transferStatusFilter').value;
            const table = document.getElementById('transferRequestsTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const statusBadge = row.querySelector('.badge');
                
                if (filter === 'all') {
                    row.style.display = '';
                } else {
                    const statusText = statusBadge ? statusBadge.textContent.toLowerCase() : '';
                    const shouldShow = (
                        (filter === 'pending' && statusText.includes('–æ–∂–∏–¥–∞–µ—Ç')) ||
                        (filter === 'approved' && statusText.includes('–æ–¥–æ–±—Ä–µ–Ω')) ||
                        (filter === 'rejected' && statusText.includes('–æ—Ç–∫–ª–æ–Ω–µ–Ω'))
                    );
                    
                    row.style.display = shouldShow ? '' : 'none';
                }
            }
        }

        // Helper functions
        function getVehicleTypeName(type) {
            const types = {
                'sedan': '–°–µ–¥–∞–Ω',
                'suv': '–í–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫', 
                'minibus': '–ú–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å',
                'bus': '–ê–≤—Ç–æ–±—É—Å'
            };
            return types[type] || type || '–ù–µ —É–∫–∞–∑–∞–Ω';
        }

        function getStatusBadgeColor(status) {
            const colors = {
                'pending': 'warning',
                'approved': 'success',
                'rejected': 'danger'
            };
            return colors[status] || 'secondary';
        }

        function getStatusName(status) {
            const names = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'approved': '–û–¥–æ–±—Ä–µ–Ω–∞',
                'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–∞'
            };
            return names[status] || status;
        }

        function openTransferModal() {
            document.getElementById('transferModal').classList.add('active');
            loadTransferDrivers();
        }

        function closeTransferModal() {
            document.getElementById('transferModal').classList.remove('active');
            document.getElementById('transferForm').reset();
        }

        async function loadTransferDrivers() {
            try {
                const response = await fetch(`${getApiUrl()}/drivers`, {
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                const driverSelect = document.getElementById('transferDriverId');
                
                if (data.success && data.data) {
                    driverSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è</option>' +
                        data.data.map(driver => `<option value="${driver.id}">${driver.name}</option>`).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤:', error);
            }
        }

        async function createTransfer() {
            const form = document.getElementById('transferForm');
            const formData = new FormData(form);
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç –ø–æ–µ–∑–¥–∫–∏
            const transferData = {
                direction: `–¢—Ä–∞–Ω—Å—Ñ–µ—Ä: ${formData.get('pickupLocation')} ‚Üí ${formData.get('dropoffLocation')}`,
                pickupTime: formData.get('transferTime'),
                pickupLocation: formData.get('pickupLocation'),
                routeFrom: formData.get('pickupLocation'),
                routeTo: formData.get('dropoffLocation'),
                dropoffLocation: formData.get('dropoffLocation'),
                dropoffTime: formData.get('transferTime'),
                driverId: formData.get('driverId')
            };

            try {
                const response = await fetch(`${getApiUrl()}/trips`, {
                    method: 'POST',
                    headers: {
                        ...getAuthHeaders(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(transferData)
                });

                const data = await response.json();
                if (data.success) {
                    alert('–¢—Ä–∞–Ω—Å—Ñ–µ—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    closeTransferModal();
                    loadTransfers();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        function editTransfer(transferId) {
            console.log('Editing transfer:', transferId);
            // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞ (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ)
        }

        async function deleteTransfer(transferId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä?')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/trips/${transferId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('–¢—Ä–∞–Ω—Å—Ñ–µ—Ä —É–¥–∞–ª–µ–Ω');
                    loadTransfers();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.message || data.error));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        // ===================== NEWS MANAGEMENT FUNCTIONS =====================

        // Load news list with statistics
        async function loadNews() {
            try {
                // Load news statistics
                const statsResponse = await fetch(`${getApiUrl()}/news/admin/stats`, {
                    headers: getAuthHeaders()
                });
                
                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    if (statsData.success) {
                        const stats = statsData.data;
                        document.getElementById('totalNewsCount').textContent = stats.totalNews;
                        document.getElementById('publishedNewsCount').textContent = stats.publishedNews;
                        document.getElementById('draftNewsCount').textContent = stats.draftNews;
                        document.getElementById('totalNewsViews').textContent = stats.totalViews;
                    }
                }
                
                // Load news list
                const response = await fetch(`${getApiUrl()}/news/admin/all`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayNewsTable(data.data.news);
                    }
                } else {
                    console.error('Failed to load news:', response.status);
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É.');
                }
            } catch (error) {
                console.error('Error loading news:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }
        
        // Display news in table
        function displayNewsTable(newsList) {
            const tbody = document.getElementById('newsTable');
            if (!tbody) return;
            
            tbody.innerHTML = newsList.map(news => `
                <tr>
                    <td>${news.id}</td>
                    <td class="max-w-xs truncate">${news.title}</td>
                    <td>${getCategoryName(news.category)}</td>
                    <td>
                        <span class="px-2 py-1 text-xs rounded-full ${news.isPublished ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${news.isPublished ? '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ' : '–ß–µ—Ä–Ω–æ–≤–∏–∫'}
                        </span>
                        ${news.isFeatured ? '<span class="ml-1 px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">‚òÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è</span>' : ''}
                    </td>
                    <td>${news.author}</td>
                    <td>${new Date(news.publishedAt).toLocaleDateString('ru-RU')}</td>
                    <td>${news.views}</td>
                    <td>
                        <div class="flex gap-1">
                            <button onclick="editNews(${news.id})" class="btn-icon btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteNews(${news.id})" class="btn-icon btn-delete" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Open news modal for create/edit
        function openNewsModal(newsId = null) {
            const modal = document.getElementById('newsModal');
            const title = document.getElementById('newsModalTitle');
            
            if (newsId) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å';
                loadNewsForEdit(newsId);
            } else {
                title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å';
                document.getElementById('newsForm').reset();
                document.getElementById('newsId').value = '';
                document.getElementById('newsPublished').checked = true;
            }
            
            modal.classList.add('active');
        }
        
        // Close news modal
        function closeNewsModal() {
            document.getElementById('newsModal').classList.remove('active');
            document.getElementById('newsForm').reset();
        }
        
        // Load news data for editing
        async function loadNewsForEdit(newsId) {
            try {
                const response = await fetch(`${getApiUrl()}/news/${newsId}`, {
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const news = data.data;
                        document.getElementById('newsId').value = news.id;
                        
                        // Parse multilingual data
                        const title = typeof news.title === 'string' ? JSON.parse(news.title) : news.title;
                        const excerpt = typeof news.excerpt === 'string' ? JSON.parse(news.excerpt) : news.excerpt;
                        const content = typeof news.content === 'string' ? JSON.parse(news.content) : news.content;
                        
                        document.getElementById('newsTitleRu').value = title?.ru || '';
                        document.getElementById('newsTitleEn').value = title?.en || '';
                        document.getElementById('newsExcerptRu').value = excerpt?.ru || '';
                        document.getElementById('newsExcerptEn').value = excerpt?.en || '';
                        document.getElementById('newsContentRu').value = content?.ru || '';
                        document.getElementById('newsContentEn').value = content?.en || '';
                        
                        document.getElementById('newsPublished').checked = news.isPublished;
                        document.getElementById('newsFeatured').checked = news.isFeatured;
                        document.getElementById('newsReadTime').value = news.readTime || '';
                        
                        // Show image preview if exists
                        if (news.image) {
                            document.getElementById('newsImagePreview').style.display = 'block';
                            document.getElementById('newsImagePreviewImg').src = news.image;
                        } else {
                            document.getElementById('newsImagePreview').style.display = 'none';
                        }
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–∏');
                }
            } catch (error) {
                console.error('Error loading news for edit:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }
        
        // Save news (create/update)
        async function saveNews() {
            const newsId = document.getElementById('newsId').value;
            
            // Build bilingual title object
            const titleData = {
                ru: document.getElementById('newsTitleRu').value || '',
                en: document.getElementById('newsTitleEn').value || ''
            };
            
            // Build bilingual excerpt object
            const excerptData = {
                ru: document.getElementById('newsExcerptRu').value || '',
                en: document.getElementById('newsExcerptEn').value || ''
            };
            
            // Build bilingual content object
            const contentData = {
                ru: document.getElementById('newsContentRu').value || '',
                en: document.getElementById('newsContentEn').value || ''
            };
            
            // Handle image upload
            let imageUrl = null;
            const imageFile = document.getElementById('newsImageFile').files[0];
            if (imageFile) {
                // Upload image first
                const formData = new FormData();
                formData.append('file', imageFile);
                try {
                    const uploadResponse = await fetch(`${getApiUrl()}/upload/single`, {
                        method: 'POST',
                        headers: getAuthHeaders(),
                        body: formData
                    });
                    const uploadData = await uploadResponse.json();
                    if (uploadData.success) {
                        imageUrl = uploadData.data.url;
                    }
                } catch (error) {
                    console.error('Error uploading image:', error);
                }
            }
            
            const newsData = {
                title: JSON.stringify(titleData),
                excerpt: JSON.stringify(excerptData),
                content: JSON.stringify(contentData),
                isPublished: document.getElementById('newsPublished').checked,
                isFeatured: document.getElementById('newsFeatured').checked,
                readTime: parseInt(document.getElementById('newsReadTime').value) || null
            };
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º image —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (imageUrl) {
                newsData.image = imageUrl;
            }
            
            try {
                const url = newsId ? `${getApiUrl()}/news/admin/${newsId}` : `${getApiUrl()}/news/admin/create`;
                const method = newsId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify(newsData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    alert(newsId ? '–ù–æ–≤–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞!' : '–ù–æ–≤–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∞!');
                    closeNewsModal();
                    loadNews(); // Reload news list
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (data.error || data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('Error saving news:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }
        
        // Edit news
        function editNews(newsId) {
            openNewsModal(newsId);
        }
        
        // Delete news
        async function deleteNews(newsId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å?')) return;
            
            try {
                const response = await fetch(`${getApiUrl()}/news/admin/${newsId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    alert('–ù–æ–≤–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞!');
                    loadNews(); // Reload news list
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.error || data.message));
                }
            } catch (error) {
                console.error('Error deleting news:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }
        
        // getCategoryName function removed - news categories deprecated

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
            
            // üåê –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–£–ï–ú –Ø–ó–´–ö–û–í–£–Æ –°–ò–°–¢–ï–ú–£ –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
            setTimeout(() => {
                console.log('üåê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
                
                // –í—ã–∑—ã–≤–∞–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                if (typeof initializeAdminLanguage === 'function') {
                    initializeAdminLanguage();
                } else {
                    console.warn('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è initializeAdminLanguage –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
            }, 200); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ i18n.js
            
            // üì± –î–û–ë–ê–í–õ–Ø–ï–ú –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ó–ê–ö–†–´–¢–ò–Ø DROPDOWN –ü–†–ò –ö–õ–ò–ö–ï –í–ù–ï –ï–ì–û
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('languageDropdownAdmin');
                const languageButton = document.querySelector('.language-selector button');
                
                if (dropdown && !dropdown.contains(event.target) && !languageButton?.contains(event.target)) {
                    dropdown.classList.add('hidden');
                }
            });
            
            // Image preview handler for news
            const newsImageFile = document.getElementById('newsImageFile');
            if (newsImageFile) {
                newsImageFile.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('newsImagePreview').style.display = 'block';
                            document.getElementById('newsImagePreviewImg').src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        document.getElementById('newsImagePreview').style.display = 'none';
                    }
                });
            }
        });

    </script>
    
    <!-- Footer Container for dynamic footer -->
    <div id="footer-container"></div>
</body>
</html>