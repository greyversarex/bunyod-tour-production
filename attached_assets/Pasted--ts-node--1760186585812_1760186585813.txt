–ó–∞–¥–∞—á–∞: —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–¥-–¥–µ–ø–ª–æ–π –±—ç–∫–µ–Ω–¥–∞ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º (–±–µ–∑ ts-node –≤ —Ä–∞–Ω—Ç–∞–π–º–µ).
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

Prod –±–µ–∑ ts-node

–í index.js –ø–æ–¥–∫–ª—é—á–∞—Ç—å ts-node —Ç–æ–ª—å–∫–æ –≤ dev. –í prod –≥—Ä—É–∑–∏—Ç—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã.

–ü—Ä–∏–º–µ—Ä –±–ª–æ–∫–∞:

// –≤–æ–∫—Ä—É–≥ –º–µ—Å—Ç–∞, –≥–¥–µ —Å–µ–π—á–∞—Å require('ts-node/register') –∏ /api
try {
  if (process.env.NODE_ENV === 'production') {
    const apiRoutes = require('./dist/routes/index.js').default;
    app.use('/api', apiRoutes);
  } else {
    require('ts-node/register');
    const apiRoutes = require('./src/routes/index.ts').default;
    app.use('/api', apiRoutes);
  }
  console.log('‚úÖ Backend API routes loaded successfully');
} catch (error) {
  console.error('‚ùå Error loading backend routes:', error);
  console.log('üîÑ Running in frontend-only mode');
}


TypeScript build

–°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å tsconfig.json:

{
  "compilerOptions": {
    "target": "ES2020",
    "module": "CommonJS",
    "rootDir": "src",
    "outDir": "dist",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true
  },
  "include": ["src/**/*"]
}


–í package.json:

{
  "scripts": {
    "start": "NODE_ENV=production node index.js",
    "build": "tsc",
    "typecheck": "tsc --noEmit",
    "postinstall": "prisma generate"
  }
}


Prisma –∏ slides (XOR-–∫–æ–Ω—Ñ–ª–∏–∫—Ç)

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º relation-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –∞ –Ω–µ cityId –≤ data:

create: ...(cityId ? { city: { connect: { id: cityId } } } : {})

update: –µ—Å–ª–∏ parsedData.cityId === null ‚Üí city: { disconnect: true }, –∏–Ω–∞—á–µ city: { connect: { id: parsedData.cityId } }.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ npx prisma generate –ø—Ä–æ—Ö–æ–¥–∏—Ç –∏ npm run typecheck —á–∏—Å—Ç–æ.

PM2 + –¥–µ–ø–ª–æ–π

–û–±–Ω–æ–≤–∏—Ç—å update.sh: –ø–æ—Å–ª–µ npx prisma generate –≤—Å—Ç–∞–≤–∏—Ç—å npm run build, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º —Ä–µ—Å—Ç–∞—Ä—Ç PM2.
–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

npm ci
npx prisma generate
npx prisma migrate deploy   # –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
npx prisma db seed          # –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π —Å–∏–¥
npm run build               # –ù–û–í–û–ï
pm2 restart bunyod-tour


–í ecosystem.config.js –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ node index.js (—Ç–µ–ø–µ—Ä—å –æ–Ω –≤ prod –≥—Ä—É–∑–∏—Ç dist), –ª–∏–±–æ –º–µ–Ω—è–µ–º –Ω–∞ npm start. –í–∞–∂–Ω–æ, —á—Ç–æ–±—ã NODE_ENV=production.

–ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–æ–±–∞–≤–∏—Ç—å –≤ DEPLOYMENT_GUIDE.md —Ä–∞–∑–¥–µ–ª ‚ÄúTroubleshooting‚Äù: –µ—Å–ª–∏ curl /healthz –≤—ã–¥–∞—ë—Ç 000, —Å–º–æ—Ç—Ä–µ—Ç—å pm2 logs; –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ TS ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å npm run build –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Ñ–∏–∫—Å–∏—Ç—å –¥–æ —á–∏—Å—Ç–æ–≥–æ npm run typecheck.

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ GET /healthz –∏ GET /api/health –∂–∏–≤—É—Ç –≤–Ω–µ –±–ª–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ TS-—Ä–æ—É—Ç–æ–≤, —á—Ç–æ–±—ã health –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–ª.

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

–ù–∞ –ø—Ä–æ–¥–µ ./update.sh –¥–µ–ª–∞–µ—Ç build, PM2 –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –±–µ–∑ ts-node, API —Å—Ç–∞–±–∏–ª–µ–Ω.

curl /healthz ‚Üí 200, GET /api/tour-blocks ‚Üí 7, GET /api/categories ‚Üí 15, GET /api/slides ‚Üí 200.

–ù–∏–∫–∞–∫–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö ‚Äú–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç—ã‚Äù –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–¥–µ–ª–∞–π PR —Å —ç—Ç–∏–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏, –ø—Ä–æ–≥–æ–Ω–∏—Ç–µ npm run build –∏ npm run typecheck –≤ CI, –æ–ø–∏—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ replit.md –∏ DEPLOYMENT_GUIDE.md.