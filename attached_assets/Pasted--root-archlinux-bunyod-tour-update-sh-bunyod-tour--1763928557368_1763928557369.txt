[root@archlinux bunyod-tour]# ./update.sh
ğŸ”„ ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ bunyod-tour...
ğŸ§· Ğ‘ÑĞºĞ°Ğ¿ Ğ‘Ğ” Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼...
âœ… Ğ‘ÑĞºĞ°Ğ¿ Ğ³Ğ¾Ñ‚Ğ¾Ğ²
ğŸ“¥ Git fetch/reset...
ğŸ”— Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»ÑÑ symlink uploads Ğ´Ğ»Ñ git reset...
Username for 'https://github.com': greyversarex
Password for 'https://greyversarex@github.com':
HEAD is now at 7e39210 Saved progress at the end of the loop
ğŸ›¡ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° uploads symlink...
âš ï¸ Symlink uploads Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´Ñ‘Ğ½
ğŸ”— Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ symlink /srv/bunyod-tour/uploads -> /var/bunyod-tour/uploads
âš ï¸ ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ° uploads, Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰Ğ°Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ² Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ...
âœ… Symlink ÑĞ¾Ğ·Ğ´Ğ°Ğ½: uploads -> /var/bunyod-tour/uploads
âœ… Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° uploads Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ° ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾
ğŸ“¦ npm ci...
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

> workspace@1.0.0 postinstall
> prisma generate

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

âœ” Generated Prisma Client (v6.15.0) to ./node_modules/@prisma/client in 644ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate


added 489 packages, and audited 490 packages in 26s

52 packages are looking for funding
  run `npm fund` for details

2 moderate severity vulnerabilities

To address all issues, run:
  npm audit fix

Run `npm audit` for details.
ğŸ”§ Prisma generate...
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

âœ” Generated Prisma Client (v6.15.0) to ./node_modules/@prisma/client in 668ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate

ğŸ—ï¸ ĞšĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ñ...

> workspace@1.0.0 build
> tsc

ğŸ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ² (ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚)...
ğŸ—„ï¸ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑÑ manual Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸...
DO
ALTER TABLE
COMMENT
COMMENT
COMMENT
ğŸ”„ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ custom_tour_orders (TEXT -> JSONB)...
BEGIN
psql:/srv/bunyod-tour/manual_migrations/002_custom_tour_orders_jsonb.sql:75: NOTICE:  selected_countries is already JSONB, skipping
psql:/srv/bunyod-tour/manual_migrations/002_custom_tour_orders_jsonb.sql:75: NOTICE:  selected_cities is already JSONB, skipping
psql:/srv/bunyod-tour/manual_migrations/002_custom_tour_orders_jsonb.sql:75: NOTICE:  tourists is already JSONB, skipping
psql:/srv/bunyod-tour/manual_migrations/002_custom_tour_orders_jsonb.sql:75: NOTICE:  selected_components is already JSONB, skipping
DO
COMMIT
     column_name     | data_type
---------------------+-----------
 selected_cities     | jsonb
 selected_components | jsonb
 selected_countries  | jsonb
 tourists            | jsonb
(4 rows)

âœ… ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ custom_tour_orders ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ°
ğŸ”„ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Order relations (transfer/guide hire)...
BEGIN
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:43: NOTICE:  â­ï¸  ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° transfer_request_id ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:43: NOTICE:  â­ï¸  ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ° guide_hire_request_id ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
DO
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:80: NOTICE:  â­ï¸  UNIQUE Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ transfer_request_id ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:80: NOTICE:  â­ï¸  UNIQUE Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ guide_hire_request_id ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
DO
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:121: NOTICE:  â­ï¸  FK constraint Ğ´Ğ»Ñ transfer_request_id ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:121: NOTICE:  â­ï¸  FK constraint Ğ´Ğ»Ñ guide_hire_request_id ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
DO
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:150: NOTICE:  ========================================
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:150: NOTICE:  âœ… ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:150: NOTICE:  âœ… ĞĞ±Ğµ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ orders
psql:/srv/bunyod-tour/manual_migrations/003_add_order_relations.sql:150: NOTICE:  ========================================
DO
COMMIT
      column_name      | data_type | is_nullable | column_default
-----------------------+-----------+-------------+----------------
 guide_hire_request_id | integer   | YES         |
 transfer_request_id   | integer   | YES         |
(2 rows)

âœ… ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Order relations ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ°
ğŸ”„ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Prisma ÑÑ…ĞµĞ¼Ñ‹ Ñ Ğ‘Ğ”...
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "bunyod_tour", schema "public" at "localhost:5432"

The database is already in sync with the Prisma schema.

âœ” Generated Prisma Client (v6.15.0) to ./node_modules/@prisma/client in 745ms

âœ… Prisma ÑÑ…ĞµĞ¼Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°
ğŸš€ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· PM2...
[PM2] Applying action reloadProcessId on app [bunyod-tour](ids: [ 0 ])
[PM2] [bunyod-tour](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name           â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ bunyod-tour    â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 2758284  â”‚ 0s     â”‚ 1    â”‚ online    â”‚ 0%       â”‚ 19.6mb   â”‚ root     â”‚ disabled â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
ğŸ©º Healthcheck...
âš ï¸ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾, Ğ½Ğ¾ healthz != 200 (Ğ±Ñ‹Ğ» 000). ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ»Ğ¾Ğ³Ğ¸: pm2 logs bunyod-tour --lines 100
ğŸ‰ Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾.
[root@archlinux bunyod-tour]# pm2 logs bunyod-tour --lines 100
[TAILING] Tailing last 100 lines for [bunyod-tour] process (change the value with --lines option)
/srv/bunyod-tour/logs/pm2-error.log last 100 lines:
0|bunyod-t | 2025-11-21T11:46:53:     at next (/srv/bunyod-tour/node_modules/router/index.js:291:5)
0|bunyod-t | 2025-11-21T11:46:53:     at /srv/bunyod-tour/node_modules/router/index.js:688:15
0|bunyod-t | 2025-11-21T11:46:53:     at next (/srv/bunyod-tour/node_modules/router/index.js:276:14)
0|bunyod-t | 2025-11-21T11:46:53:     at router.handle (/srv/bunyod-tour/node_modules/router/index.js:186:3)
0|bunyod-t | 2025-11-21T13:04:59: âŒ TEST 1 FAILED: Connection timeout
0|bunyod-t | 2025-11-21T15:13:17: Email send error: Error: Connection timeout
0|bunyod-t | 2025-11-21T15:13:17:     at SMTPConnection._formatError (/srv/bunyod-tour/node_modules/nodemailer/lib/smtp-connection/index.js:809:19)
0|bunyod-t | 2025-11-21T15:13:17:     at SMTPConnection._onError (/srv/bunyod-tour/node_modules/nodemailer/lib/smtp-connection/index.js:795:20)
0|bunyod-t | 2025-11-21T15:13:17:     at Timeout.<anonymous> (/srv/bunyod-tour/node_modules/nodemailer/lib/smtp-connection/index.js:237:22)
0|bunyod-t | 2025-11-21T15:13:17:     at listOnTimeout (node:internal/timers:608:17)
0|bunyod-t | 2025-11-21T15:13:17:     at process.processTimers (node:internal/timers:543:7) {
0|bunyod-t | 2025-11-21T15:13:17:   code: 'ETIMEDOUT',
0|bunyod-t | 2025-11-21T15:13:17:   command: 'CONN'
0|bunyod-t | 2025-11-21T15:13:17: }
0|bunyod-t | 2025-11-21T15:50:27: Global error handler: URIError: URI malformed
0|bunyod-t | 2025-11-21T15:50:27:     at decodeURIComponent (<anonymous>)
0|bunyod-t | 2025-11-21T15:50:27:     at /srv/bunyod-tour/index.js:167:22
0|bunyod-t | 2025-11-21T15:50:27:     at Layer.handleRequest (/srv/bunyod-tour/node_modules/router/lib/layer.js:152:17)
0|bunyod-t | 2025-11-21T15:50:27:     at trimPrefix (/srv/bunyod-tour/node_modules/router/index.js:342:13)
0|bunyod-t | 2025-11-21T15:50:27:     at /srv/bunyod-tour/node_modules/router/index.js:297:9
0|bunyod-t | 2025-11-21T15:50:27:     at processParams (/srv/bunyod-tour/node_modules/router/index.js:582:12)
0|bunyod-t | 2025-11-21T15:50:27:     at next (/srv/bunyod-tour/node_modules/router/index.js:291:5)
0|bunyod-t | 2025-11-21T15:50:27:     at /srv/bunyod-tour/node_modules/router/index.js:688:15
0|bunyod-t | 2025-11-21T15:50:27:     at next (/srv/bunyod-tour/node_modules/router/index.js:276:14)
0|bunyod-t | 2025-11-21T15:50:27:     at router.handle (/srv/bunyod-tour/node_modules/router/index.js:186:3)
0|bunyod-t | 2025-11-22T20:40:43: Global error handler: URIError: URI malformed
0|bunyod-t | 2025-11-22T20:40:43:     at decodeURIComponent (<anonymous>)
0|bunyod-t | 2025-11-22T20:40:43:     at /srv/bunyod-tour/index.js:167:22
0|bunyod-t | 2025-11-22T20:40:43:     at Layer.handleRequest (/srv/bunyod-tour/node_modules/router/lib/layer.js:152:17)
0|bunyod-t | 2025-11-22T20:40:43:     at trimPrefix (/srv/bunyod-tour/node_modules/router/index.js:342:13)
0|bunyod-t | 2025-11-22T20:40:43:     at /srv/bunyod-tour/node_modules/router/index.js:297:9
0|bunyod-t | 2025-11-22T20:40:43:     at processParams (/srv/bunyod-tour/node_modules/router/index.js:582:12)
0|bunyod-t | 2025-11-22T20:40:43:     at next (/srv/bunyod-tour/node_modules/router/index.js:291:5)
0|bunyod-t | 2025-11-22T20:40:43:     at /srv/bunyod-tour/node_modules/router/index.js:688:15
0|bunyod-t | 2025-11-22T20:40:43:     at next (/srv/bunyod-tour/node_modules/router/index.js:276:14)
0|bunyod-t | 2025-11-22T20:40:43:     at router.handle (/srv/bunyod-tour/node_modules/router/index.js:186:3)
0|bunyod-t | 2025-11-23T06:41:16: Global error handler: URIError: URI malformed
0|bunyod-t | 2025-11-23T06:41:16:     at decodeURIComponent (<anonymous>)
0|bunyod-t | 2025-11-23T06:41:16:     at /srv/bunyod-tour/index.js:167:22
0|bunyod-t | 2025-11-23T06:41:16:     at Layer.handleRequest (/srv/bunyod-tour/node_modules/router/lib/layer.js:152:17)
0|bunyod-t | 2025-11-23T06:41:16:     at trimPrefix (/srv/bunyod-tour/node_modules/router/index.js:342:13)
0|bunyod-t | 2025-11-23T06:41:16:     at /srv/bunyod-tour/node_modules/router/index.js:297:9
0|bunyod-t | 2025-11-23T06:41:16:     at processParams (/srv/bunyod-tour/node_modules/router/index.js:582:12)
0|bunyod-t | 2025-11-23T06:41:16:     at next (/srv/bunyod-tour/node_modules/router/index.js:291:5)
0|bunyod-t | 2025-11-23T06:41:16:     at /srv/bunyod-tour/node_modules/router/index.js:688:15
0|bunyod-t | 2025-11-23T06:41:16:     at next (/srv/bunyod-tour/node_modules/router/index.js:276:14)
0|bunyod-t | 2025-11-23T06:41:16:     at router.handle (/srv/bunyod-tour/node_modules/router/index.js:186:3)
0|bunyod-t | 2025-11-23T06:41:17: Global error handler: URIError: URI malformed
0|bunyod-t | 2025-11-23T06:41:17:     at decodeURIComponent (<anonymous>)
0|bunyod-t | 2025-11-23T06:41:17:     at /srv/bunyod-tour/index.js:167:22
0|bunyod-t | 2025-11-23T06:41:17:     at Layer.handleRequest (/srv/bunyod-tour/node_modules/router/lib/layer.js:152:17)
0|bunyod-t | 2025-11-23T06:41:17:     at trimPrefix (/srv/bunyod-tour/node_modules/router/index.js:342:13)
0|bunyod-t | 2025-11-23T06:41:17:     at /srv/bunyod-tour/node_modules/router/index.js:297:9
0|bunyod-t | 2025-11-23T06:41:17:     at processParams (/srv/bunyod-tour/node_modules/router/index.js:582:12)
0|bunyod-t | 2025-11-23T06:41:17:     at next (/srv/bunyod-tour/node_modules/router/index.js:291:5)
0|bunyod-t | 2025-11-23T06:41:17:     at /srv/bunyod-tour/node_modules/router/index.js:688:15
0|bunyod-t | 2025-11-23T06:41:17:     at next (/srv/bunyod-tour/node_modules/router/index.js:276:14)
0|bunyod-t | 2025-11-23T06:41:17:     at router.handle (/srv/bunyod-tour/node_modules/router/index.js:186:3)
0|bunyod-t | 2025-11-23T16:08:31: Global error handler: PrismaClientKnownRequestError:
0|bunyod-t | 2025-11-23T16:08:31: Invalid `prisma.order.findMany()` invocation:
0|bunyod-t | 2025-11-23T16:08:31:
0|bunyod-t | 2025-11-23T16:08:31:
0|bunyod-t | 2025-11-23T16:08:31: The column `orders.transfer_request_id` does not exist in the current database.
0|bunyod-t | 2025-11-23T16:08:31:     at ei.handleRequestError (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:7283)
0|bunyod-t | 2025-11-23T16:08:31:     at ei.handleAndLogRequestError (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:6608)
0|bunyod-t | 2025-11-23T16:08:31:     at ei.request (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:6315)
0|bunyod-t | 2025-11-23T16:08:31:     at async a (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:130:9551)
0|bunyod-t | 2025-11-23T16:08:31:     at async getDashboardStats (/srv/bunyod-tour/dist/controllers/adminController.js:189:35) {
0|bunyod-t | 2025-11-23T16:08:31:   code: 'P2022',
0|bunyod-t | 2025-11-23T16:08:31:   meta: { modelName: 'Order', column: 'orders.transfer_request_id' },
0|bunyod-t | 2025-11-23T16:08:31:   clientVersion: '6.15.0'
0|bunyod-t | 2025-11-23T16:08:31: }
0|bunyod-t | 2025-11-23T16:08:36: Global error handler: PrismaClientKnownRequestError:
0|bunyod-t | 2025-11-23T16:08:36: Invalid `prisma.order.findMany()` invocation:
0|bunyod-t | 2025-11-23T16:08:36:
0|bunyod-t | 2025-11-23T16:08:36:
0|bunyod-t | 2025-11-23T16:08:36: The column `orders.transfer_request_id` does not exist in the current database.
0|bunyod-t | 2025-11-23T16:08:36:     at ei.handleRequestError (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:7283)
0|bunyod-t | 2025-11-23T16:08:36:     at ei.handleAndLogRequestError (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:6608)
0|bunyod-t | 2025-11-23T16:08:36:     at ei.request (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:6315)
0|bunyod-t | 2025-11-23T16:08:36:     at async a (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:130:9551)
0|bunyod-t | 2025-11-23T16:08:36:     at async getDashboardStats (/srv/bunyod-tour/dist/controllers/adminController.js:189:35) {
0|bunyod-t | 2025-11-23T16:08:36:   code: 'P2022',
0|bunyod-t | 2025-11-23T16:08:36:   meta: { modelName: 'Order', column: 'orders.transfer_request_id' },
0|bunyod-t | 2025-11-23T16:08:36:   clientVersion: '6.15.0'
0|bunyod-t | 2025-11-23T16:08:36: }
0|bunyod-t | 2025-11-23T16:20:14: Global error handler: PrismaClientKnownRequestError:
0|bunyod-t | 2025-11-23T16:20:14: Invalid `prisma.order.findMany()` invocation:
0|bunyod-t | 2025-11-23T16:20:14:
0|bunyod-t | 2025-11-23T16:20:14:
0|bunyod-t | 2025-11-23T16:20:14: The column `orders.transfer_request_id` does not exist in the current database.
0|bunyod-t | 2025-11-23T16:20:14:     at ei.handleRequestError (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:7283)
0|bunyod-t | 2025-11-23T16:20:14:     at ei.handleAndLogRequestError (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:6608)
0|bunyod-t | 2025-11-23T16:20:14:     at ei.request (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:121:6315)
0|bunyod-t | 2025-11-23T16:20:14:     at async a (/srv/bunyod-tour/node_modules/@prisma/client/runtime/library.js:130:9551)
0|bunyod-t | 2025-11-23T16:20:14:     at async getDashboardStats (/srv/bunyod-tour/dist/controllers/adminController.js:189:35) {
0|bunyod-t | 2025-11-23T16:20:14:   code: 'P2022',
0|bunyod-t | 2025-11-23T16:20:14:   meta: { modelName: 'Order', column: 'orders.transfer_request_id' },
0|bunyod-t | 2025-11-23T16:20:14:   clientVersion: '6.15.0'
0|bunyod-t | 2025-11-23T16:20:14: }

/srv/bunyod-tour/logs/pm2-out.log last 100 lines:
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Original URL: /api/objects/direct/image-1763520698820-462292111.png
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Decoded URL: /api/objects/direct/image-1763520698820-462292111.png
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Original URL: /api/objects/direct/image-1763520698896-635796911.png
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Decoded URL: /api/objects/direct/image-1763520698896-635796911.png
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Original URL: /api/objects/direct/image-1763520699129-958087549.png
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Decoded URL: /api/objects/direct/image-1763520699129-958087549.png
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Original URL: /api/objects/direct/image-1763520684952-851241477.png
0|bunyod-t | 2025-11-23T22:25:36: ğŸ”„ Middleware check - Decoded URL: /api/objects/direct/image-1763520684952-851241477.png
0|bunyod-t | 2025-11-23T22:25:39: ğŸ“‹ startBooking Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: {
0|bunyod-t | 2025-11-23T22:25:39:   tourId: 29,
0|bunyod-t | 2025-11-23T22:25:39:   hotelId: undefined,
0|bunyod-t | 2025-11-23T22:25:39:   tourDate: '2025-11-28',
0|bunyod-t | 2025-11-23T22:25:39:   numberOfTourists: 1
0|bunyod-t | 2025-11-23T22:25:39: }
0|bunyod-t | 2025-11-23T22:25:39: ğŸ“‹ Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: {
0|bunyod-t | 2025-11-23T22:25:39:   tourIdType: 'number',
0|bunyod-t | 2025-11-23T22:25:39:   tourDateType: 'string',
0|bunyod-t | 2025-11-23T22:25:39:   numberOfTouristsType: 'number'
0|bunyod-t | 2025-11-23T22:25:39: }
0|bunyod-t | 2025-11-23T22:25:39: ğŸ’° Price calculation: 1138 Ã— 1 tourists = 1138 TJS (individual, per_person)
0|bunyod-t | 2025-11-23T22:25:39: ğŸ“‹ Serving booking step 2 with params: [Object: null prototype] { bookingId: '100' }
0|bunyod-t | 2025-11-23T22:25:39: ğŸ”„ Middleware check - Original URL: /public/js/i18n.js
0|bunyod-t | 2025-11-23T22:25:39: ğŸ”„ Middleware check - Decoded URL: /public/js/i18n.js
0|bunyod-t | 2025-11-23T22:25:39: ğŸ”„ Middleware check - Original URL: /public/js/booking-state.js
0|bunyod-t | 2025-11-23T22:25:39: ğŸ”„ Middleware check - Decoded URL: /public/js/booking-state.js
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Original URL: /public/js/layout-loader.js
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Decoded URL: /public/js/layout-loader.js
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Original URL: /_footer.html?v=1.4
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Decoded URL: /_footer.html?v=1.4
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Original URL: /_header.html?v=1.6
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Decoded URL: /_header.html?v=1.6
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Original URL: /Logo-Ru_1754635713718.png
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Decoded URL: /Logo-Ru_1754635713718.png
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Original URL: /public/css/layout.css?v=1.6
0|bunyod-t | 2025-11-23T22:25:40: ğŸ”„ Middleware check - Decoded URL: /public/css/layout.css?v=1.6
0|bunyod-t | 2025-11-23T22:25:50: âœ… Step 2 - Preserving final price from Step 1: 1138 TJS (NO recalculation)
0|bunyod-t | 2025-11-23T22:25:51: ğŸ“‹ Serving booking-step3.html with params: [Object: null prototype] { bookingId: '100' }
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Original URL: /public/js/i18n.js
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Decoded URL: /public/js/i18n.js
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Original URL: /public/js/booking-state.js
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Decoded URL: /public/js/booking-state.js
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Original URL: /public/js/layout-loader.js
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Decoded URL: /public/js/layout-loader.js
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Original URL: /_footer.html?v=1.4
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Decoded URL: /_footer.html?v=1.4
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Original URL: /_header.html?v=1.6
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Decoded URL: /_header.html?v=1.6
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Original URL: /Logo-Ru_1754635713718.png
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Decoded URL: /Logo-Ru_1754635713718.png
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Original URL: /public/css/layout.css?v=1.6
0|bunyod-t | 2025-11-23T22:25:51: ğŸ”„ Middleware check - Decoded URL: /public/css/layout.css?v=1.6
0|bunyod-t | 2025-11-23T22:25:57: ğŸ”„ Creating order from booking: { bookingId: '100', paymentOption: 'full' }
0|bunyod-t | 2025-11-23T22:25:57: ğŸ’³ Full payment: 1138 TJS
0|bunyod-t | 2025-11-23T22:25:58: ğŸ”„ Creating AlifPay Legacy payment: Order 40, Amount 1138 TJS
0|bunyod-t | 2025-11-23T22:26:19: ğŸ  Serving home page with query params: [Object: null prototype] {}
0|bunyod-t | 2025-11-23T22:26:19: ğŸ  Request URL: /
0|bunyod-t | 2025-11-23T22:26:19: ğŸ  Request path: /
0|bunyod-t | 2025-11-23T22:30:47: ğŸ  Serving home page with query params: [Object: null prototype] {}
0|bunyod-t | 2025-11-23T22:30:47: ğŸ  Request URL: /
0|bunyod-t | 2025-11-23T22:30:47: ğŸ  Request path: /
0|bunyod-t | 2025-11-23T22:34:43: ğŸ  Serving home page with query params: [Object: null prototype] {}
0|bunyod-t | 2025-11-23T22:34:43: ğŸ  Request URL: /
0|bunyod-t | 2025-11-23T22:34:43: ğŸ  Request path: /
0|bunyod-t | 2025-11-23T22:38:07: ğŸ  Serving home page with query params: [Object: null prototype] {}
0|bunyod-t | 2025-11-23T22:38:07: ğŸ  Request URL: /
0|bunyod-t | 2025-11-23T22:38:07: ğŸ  Request path: /
0|bunyod-t | 2025-11-23T22:38:18: ğŸ”„ Creating AlifPay Legacy payment: Order 39, Amount 1487 TJS
0|bunyod-t | 2025-11-23T22:53:24: ğŸ  Serving home page with query params: [Object: null prototype] {}
0|bunyod-t | 2025-11-23T22:53:24: ğŸ  Request URL: /
0|bunyod-t | 2025-11-23T22:53:24: ğŸ  Request path: /
0|bunyod-t | 2025-11-23T22:53:24: ğŸ”„ Middleware check - Original URL: /favicon.ico
0|bunyod-t | 2025-11-23T22:53:24: ğŸ”„ Middleware check - Decoded URL: /favicon.ico
0|bunyod-t | 2025-11-23T23:08:36: [dotenv@17.2.3] injecting env (29) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
0|bunyod-t | 2025-11-23T23:08:36: ğŸ­ PRODUCTION MODE: Using pre-compiled JavaScript from dist/
0|bunyod-t | 2025-11-23T23:08:36:
0|bunyod-t | 2025-11-23T23:08:36: ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ...
0|bunyod-t | 2025-11-23T23:08:36:
0|bunyod-t | 2025-11-23T23:08:36: âœ… Ğ’ÑĞµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹
0|bunyod-t | 2025-11-23T23:08:36: âœ… Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹
0|bunyod-t | 2025-11-23T23:08:36: ğŸ“ ĞĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹: STRIPE_SECRET_KEY, PAYME_MERCHANT_ID, CLICK_MERCHANT_ID
0|bunyod-t | 2025-11-23T23:08:36:
0|bunyod-t | 2025-11-23T23:08:36: âœ… Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
0|bunyod-t | 2025-11-23T23:08:36:
0|bunyod-t | 2025-11-23T23:08:37: âœ… Backend API routes loaded successfully (compiled)
0|bunyod-t | 2025-11-23T23:08:37: ğŸ—„ï¸ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº PostgreSQL Ñ‡ĞµÑ€ĞµĞ· Prisma...
0|bunyod-t | 2025-11-23T23:08:37: ğŸ”§ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...
0|bunyod-t | 2025-11-23T23:08:37: ğŸ­ PRODUCTION: ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ migrate deploy Ğ½Ğ° ÑÑ‚Ğ°Ñ€Ñ‚Ğµ (RUN_MIGRATIONS_ON_BOOT!=true)
0|bunyod-t | 2025-11-23T23:08:37: ğŸ’¡ ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· ./update.sh Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸
0|bunyod-t | 2025-11-23T23:08:37: ğŸ­ PRODUCTION: ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ seed Ğ½Ğ° ÑÑ‚Ğ°Ñ€Ñ‚Ğµ (RUN_SEED_ON_BOOT!=true)
0|bunyod-t | 2025-11-23T23:08:37: ğŸ’¡ Ğ¡Ğ¸Ğ´ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· ./update.sh Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸
0|bunyod-t | 2025-11-23T23:08:37: âœ… Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ!
0|bunyod-t | 2025-11-23T23:08:37: Starting backend API server...
0|bunyod-t | 2025-11-23T23:08:37: ğŸš€ Unified server running on port 5000
0|bunyod-t | 2025-11-23T23:08:37: ğŸ“± Frontend: http://0.0.0.0:5000
0|bunyod-t | 2025-11-23T23:08:37: ğŸ”§ Admin: http://0.0.0.0:5000/admin-dashboard.html
0|bunyod-t | 2025-11-23T23:08:37: ğŸŒ API: http://0.0.0.0:5000/api
0|bunyod-t | 2025-11-23T23:08:37: ğŸ—„ï¸  Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: PostgreSQL Ñ‡ĞµÑ€ĞµĞ· Prisma
0|bunyod-t | 2025-11-23T23:08:39: ğŸ§® Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ° Ñ†ĞµĞ½...
0|bunyod-t | 2025-11-23T23:08:39: ğŸ“Š Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²: ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ 0, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ 21 (ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚)
0|bunyod-t | 2025-11-23T23:08:39: âœ… Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ 21 ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
