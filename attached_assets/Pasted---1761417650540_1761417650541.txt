–ù—É–∂–Ω–æ –¥–æ–≤–µ—Å—Ç–∏ –ø—Ä–æ–¥–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é "–º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–≥–æ —Å–ª–∞–π–¥–µ—Ä–∞" –¥–æ —Ä–∞–±–æ—á–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–¥-—Å–µ—Ä–≤–µ—Ä–∞:

–°–µ—Ä–≤–µ—Ä: Arch Linux, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ /srv/bunyod-tour.

Prod –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ pm2 startOrReload ecosystem.config.js --only bunyod-tour.

–ë–∞–∑–∞: PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ, –±–∞–∑–∞ bunyod_tour.

Prisma CLI –Ω–∞ –ø—Ä–æ–¥–µ: 6.15.0.

–í —Ç–∞–±–ª–∏—Ü–µ slides —Å–µ–π—á–∞—Å:

title –∫–æ–ª–æ–Ω–∫–∞ TEXT (NOT NULL),

description –∫–æ–ª–æ–Ω–∫–∞ TEXT (NOT NULL),

–¥–∞–Ω–Ω—ã–µ —É–∂–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ JSON-—Å—Ç—Ä–æ–∫–∏, –Ω–æ –Ω–µ–ø–æ–ª–Ω—ã–µ, –ø—Ä–∏–º–µ—Ä:
{"ru":"–û—Ç–∫—Ä–æ–π—Ç–µ –∫—Ä–∞—Å–æ—Ç—ã –ü–∞–º–∏—Ä—Å–∫–∏—Ö –≥–æ—Ä!"}
—Ç–æ –µ—Å—Ç—å —á–∞—Å—Ç–æ –ù–ï–¢ –ø–æ–ª—è "en".

–ù–æ–≤—ã–π –∫–æ–¥ –æ–∂–∏–¥–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç {"ru":"‚Ä¶","en":"‚Ä¶"} –∏ —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã –≤ –ë–î —ç—Ç–∏ –ø–æ–ª—è –±—ã–ª–∏ jsonb, –∞ –Ω–µ text.

–ü—Ä–∏ –¥–µ–ø–ª–æ–µ —Å–µ–π—á–∞—Å –ø–∞–¥–∞–µ–º –Ω–∞ —à–∞–≥–µ prisma db push, —Å –æ—à–∏–±–∫–æ–π:
"Changed the type of title on the slides table... cannot alter because column is required and has data".

‚ùó –¶–µ–ª—å:
–°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã —è –º–æ–≥ –ø—Ä–æ—Å—Ç–æ –∑–∞–π—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å ./update.sh, –∏ –æ–Ω:

–ø–æ–¥—Ç—è–Ω—É–ª –Ω–æ–≤—ã–π –∫–æ–¥,

–∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –¥–ª—è —Å–ª–∞–π–¥–æ–≤ (–≤–∫–ª—é—á–∞—è —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏),

–ø–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏–ª,

–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª PM2,

–∏ —Å–∞–π—Ç –ø—Ä–æ—Å—Ç–æ –∂–∏–≤—ë—Ç.

–Ø –ù–ï —Ö–æ—á—É —Ä—É–∫–∞–º–∏ –ª–∞–∑–∏—Ç—å –≤ psql –∫–∞–∂–¥—ã–π —Ä–∞–∑.

–°–¥–µ–ª–∞–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–ª–µ–¥—É—é—â–µ–µ –ø—Ä—è–º–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:

1. –î–æ–±–∞–≤—å –Ω–æ–≤—É—é —Ä—É—á–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é 000_slides_prepare.sql

–°–æ–∑–¥–∞–π/–æ–±–Ω–æ–≤–∏ —Ñ–∞–π–ª manual_migrations/000_slides_prepare.sql —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

-- 000_slides_prepare.sql
-- –¶–µ–ª—å: –ø—Ä–∏–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ slides –∫ –ø–æ–ª–Ω–æ–º—É JSON-–æ–±—ä–µ–∫—Ç—É {ru, en}
-- –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –ø–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏ –∫ jsonb.

-- –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ jsonb –∏–ª–∏ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç "en", –∑–∞–ø—Ä–æ—Å—ã –Ω–∏–∂–µ –ø—Ä–æ—Å—Ç–æ –Ω–µ —Å–ª–æ–º–∞—é—Ç –Ω–∏—á–µ–≥–æ.

-- 1. –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á "en" –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç.
UPDATE slides
SET title = (
    CASE
        -- –µ—Å–ª–∏ —É–∂–µ json-–ø–æ–¥–æ–±–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –ø—Ä–æ–±—É–µ–º –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ json –∏ –¥–æ–±–∞–≤–∏—Ç—å en
        WHEN left(trim(title), 1) = '{' THEN
            (
                -- –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º TEXT -> JSONB, –¥–æ–±–∞–≤–ª—è–µ–º en –µ—Å–ª–∏ –Ω–µ—Ç, –ø–æ—Ç–æ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ TEXT
                (
                    COALESCE(
                        (title::jsonb || jsonb_build_object(
                            'en',
                            COALESCE((title::jsonb ->> 'en'), '')
                        )),
                        jsonb_build_object('ru', title, 'en', '')
                    )
                )::text
            )
        ELSE
            -- –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –≥–æ–ª—ã–π —Ç–µ–∫—Å—Ç "–ü—Ä–∏–≤–µ—Ç", –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ {"ru":"–ü—Ä–∏–≤–µ—Ç","en":""}
            jsonb_build_object('ru', title, 'en', '')::text
    END
)
WHERE title IS NOT NULL;

UPDATE slides
SET description = (
    CASE
        WHEN left(trim(description), 1) = '{' THEN
            (
                (
                    COALESCE(
                        (description::jsonb || jsonb_build_object(
                            'en',
                            COALESCE((description::jsonb ->> 'en'), '')
                        )),
                        jsonb_build_object('ru', description, 'en', '')
                    )
                )::text
            )
        ELSE
            jsonb_build_object('ru', description, 'en', '')::text
    END
)
WHERE description IS NOT NULL;


–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

–≠—Ç–æ—Ç —Ñ–∞–π–ª –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ slides.title –∏ slides.description –ø—Ä–µ–≤—Ä–∞—Ç—è—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞:
{"ru":"—á—Ç–æ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ","en":""}
–¥–∞–∂–µ –µ—Å–ª–∏ —Ä–∞–Ω—å—à–µ –Ω–µ –±—ã–ª–æ "en".

–û–Ω –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω (–µ–≥–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≥–æ–Ω—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ, –Ω–µ —Å–ª–æ–º–∞–µ—Ç—Å—è).

2. –û–±–Ω–æ–≤–∏ manual_migrations/001_slides_jsonb.sql

–°–µ–π—á–∞—Å –æ–Ω –¥–µ–ª–∞–µ—Ç ALTER TABLE ... TYPE JSONB USING .... –û—Å—Ç–∞–≤—å —Å—É—Ç—å, –Ω–æ —É–±–µ–¥–∏—Å—å, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –æ–Ω –¢–û–õ–¨–ö–û –º–µ–Ω—è–µ—Ç —Ç–∏–ø—ã (–±–µ–∑ UPDATE):

-- 001_slides_jsonb.sql
-- –¶–µ–ª—å: –ø–æ—Å–ª–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏–∑ 000_... –º–µ–Ω—è–µ–º —Ç–∏–ø –∫–æ–ª–æ–Ω–æ–∫ —Å TEXT –Ω–∞ JSONB.

ALTER TABLE slides
  ALTER COLUMN title TYPE JSONB USING title::jsonb,
  ALTER COLUMN description TYPE JSONB USING description::jsonb;


–í–∞–∂–Ω–æ:

–ù–µ –¥–µ–ª–∞–π –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ —É–º–Ω–æ–≥–æ. –õ–æ–≥–∏–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç–µ–ø–µ—Ä—å –≤ 000_.

3. –û–±–Ω–æ–≤–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–ª–∞–π–¥–æ–≤ (src/controllers/slideController.ts)

–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–π –¥–≤–µ –≤–µ—â–∏:

–û—Ç–≤–µ—Ç API /api/slides –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞:

{
  id: number,
  title: { ru: string, en: string },
  description: { ru: string, en: string },
  image: string,
  link: string | null,
  buttonText: string | null,
  order: number,
  isActive: boolean
}


–î–∞–∂–µ –µ—Å–ª–∏ –≤ –ë–î –∫—Ä–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ª–∞–π–¥–∞:

–µ—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ title.ru –∏ description.ru, –Ω–∞–¥–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ en: "", —á—Ç–æ–±—ã –Ω–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

–°–¥–µ–ª–∞–π –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∫–∞–∫ –º—ã –¥–µ–ª–∞–ª–∏ —Ä–∞–Ω—å—à–µ:

function normalizeML(input: any): { ru: string; en: string } {
  // input –º–æ–∂–µ—Ç –±—ã—Ç—å:
  // - —Å—Ç—Ä–æ–∫–æ–π "–ü—Ä–∏–≤–µ—Ç"
  // - –æ–±—ä–µ–∫—Ç–æ–º {ru:"–ü—Ä–∏–≤–µ—Ç"} 
  // - –æ–±—ä–µ–∫—Ç–æ–º {ru:"–ü—Ä–∏–≤–µ—Ç", en:"Hi"}
  // - null/undefined
  try {
    if (!input) return { ru: "", en: "" };

    if (typeof input === "string") {
      // —Å—Ç–∞—Ä–∞—è –±–∞–∑–∞, –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç
      return { ru: input, en: "" };
    }

    if (typeof input === "object") {
      return {
        ru: typeof input.ru === "string" ? input.ru : "",
        en: typeof input.en === "string" ? input.en : "",
      };
    }

    return { ru: "", en: "" };
  } catch {
    return { ru: "", en: "" };
  }
}


–∏ –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë:

–ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ –±–∞–∑—ã, –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ res.json

–ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É (—á—Ç–æ–±—ã prisma.create / prisma.update –ø–æ–ª—É—á–∞–ª–∏ —É–∂–µ –æ–±—ä–µ–∫—Ç —Å ru/en)

–¶–µ–ª—å: –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –≤ title —Ç–æ–ª—å–∫–æ ru.

4. –û—á–µ–Ω—å –≤–∞–∂–Ω–æ–µ. –ü–æ—á–∏–Ω–∏ update.sh –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

–°–µ–π—á–∞—Å update.sh –¥–µ–ª–∞–µ—Ç —Ç–∞–∫:

—Å—Ç–æ–ø–∞–µ—Ç PM2

git pull

prisma db push

–ø–∞–¥–∞–µ—Ç

—Å–∞–π—Ç –º—ë—Ä—Ç–≤

–ù—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å update.sh, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –ë–ï–ó –î–ê–£–ù–¢–ê–ô–ú–ê –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.
–¢–æ –µ—Å—Ç—å:

#!/usr/bin/env bash
set -euo pipefail

APP_DIR="/srv/bunyod-tour"
BACKUP_DIR="/var/backups/bunyod-tour"
DB_NAME="bunyod_tour"
PM2_APP="bunyod-tour"

echo "üîÑ –ù–∞—á–∏–Ω–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ $PM2_APP..."

cd "$APP_DIR"

# 0. –ë—ç–∫–∞–ø –ë–î (–∫–∞–∫ —Å–µ–π—á–∞—Å)
echo "üß∑ –ë—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º..."
mkdir -p "$BACKUP_DIR"
sudo -u postgres pg_dump "$DB_NAME" > "$BACKUP_DIR/${DB_NAME}_$(date +%F_%H-%M-%S).dump"
echo "‚úÖ –ë—ç–∫–∞–ø –≥–æ—Ç–æ–≤"

# 1. –°—Ç—è–Ω—É—Ç—å —Å–≤–µ–∂–∏–π –∫–æ–¥ –ë–ï–ó –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
echo "üì• Git fetch/reset..."
git fetch origin --prune
git reset --hard origin/main

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ npm ci..."
npm ci

# 3. –°–≥–µ–Ω–µ—Ä–∏—Ç—å Prisma client
echo "üîß Prisma generate..."
npx prisma generate

# 4. –°–∫–æ–º–ø–∏–ª–∏—Ç—å TypeScript
echo "üèóÔ∏è –ö–æ–º–ø–∏–ª—è—Ü–∏—è..."
npm run build

echo "üìÅ –°–æ–∑–¥–∞—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç)..."
mkdir -p logs

# !!! –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —É –Ω–∞—Å —É–∂–µ —Å–æ–±—Ä–∞–Ω –Ω–æ–≤—ã–π –∫–æ–¥.
#    –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è –î–û —ç—Ç–æ–π —Ç–æ—á–∫–∏ ‚Äî PM2 –Ω–µ —Ç—Ä–æ–≥–∞–ª–∏, —Å–∞–π—Ç –∂–∏–≤.
#    –í—Å—ë —á—Ç–æ –Ω–∏–∂–µ ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∏–ª–¥ –æ–∫.

echo "üóÑÔ∏è –ü—Ä–∏–º–µ–Ω—è—é –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–ª–∞–π–¥–æ–≤ (–º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –±–∞–Ω–Ω–µ—Ä)..."

# –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–¥–æ–±–∞–≤–ª—è–µ—Ç en –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç JSON)
sudo -u postgres psql -d "$DB_NAME" -f "$APP_DIR/manual_migrations/000_slides_prepare.sql" || true

# –û—Å–Ω–æ–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–º–µ–Ω—è–µ—Ç —Ç–∏–ø text -> jsonb)
sudo -u postgres psql -d "$DB_NAME" -f "$APP_DIR/manual_migrations/001_slides_jsonb.sql" || true

# Prisma db push (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã, –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–∞–¥–∞—Ç—å –≤—Å—ë)
npx prisma db push || true

echo "üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ PM2..."
pm2 startOrReload ecosystem.config.js --only "$PM2_APP"
pm2 save

echo "ü©∫ Healthcheck..."
code=$(curl -s -o /dev/null -w "%{http_code}" http://127.0.0.1:5000/healthz || true)
if [ "$code" = "200" ]; then
  echo "‚úÖ –ü—Ä–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (healthz 200)"
else
  echo "‚ö†Ô∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ, –Ω–æ healthz != 200 (–±—ã–ª $code). –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ pm2 logs $PM2_APP --lines 100"
fi

echo "üéâ –ì–æ—Ç–æ–≤–æ."


–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

–ù–ï–¢ pm2 stop –≤ –Ω–∞—á–∞–ª–µ. –ú—ã –Ω–µ –≥–∞—Å–∏–º –ø—Ä–æ–¥, –ø–æ–∫–∞ –Ω–µ —Å–æ–±—Ä–∞–ª–∏ –Ω–æ–≤—ã–π –±–∏–ª–¥.

–ú—ã —Å–Ω–∞—á–∞–ª–∞ –±–∏–ª–¥–∏–º, –ø–æ—Ç–æ–º –º–∏–≥—Ä–∏—Ä—É–µ–º, –ø–æ—Ç–æ–º startOrReload.

–ò—Å–ø–æ–ª—å–∑—É–µ–º git fetch && git reset --hard origin/main –≤–º–µ—Å—Ç–æ git pull, —á—Ç–æ–±—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–π –º—É—Å–æ—Ä <<<<<<< HEAD –≤–Ω—É—Ç—Ä–∏ schema.prisma.

–ú–∏–≥—Ä–∞—Ü–∏–∏ 000/001 –ø—Ä–æ–≥–æ–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–ø–ª–æ–π, –Ω–æ —Å || true, —Ç–æ –µ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –Ω–µ –ø–∞–¥–∞–µ—Ç.

5. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Ç—ã –≤—Å—ë —ç—Ç–æ —Å–¥–µ–ª–∞–µ—à—å –∏ –∑–∞–ø—É—à–∏—à—å –≤ main

–Ø –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞—é:

cd /srv/bunyod-tour
./update.sh


–∏ –Ω–µ –±—É–¥—É —Ä—É–∫–∞–º–∏ –Ω–∏—á–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å.

TL;DR:

–î–æ–±–∞–≤—å manual_migrations/000_slides_prepare.sql (—Å–º. –∫–æ–¥ –≤—ã—à–µ).

–û–±–Ω–æ–≤–∏ manual_migrations/001_slides_jsonb.sql (—Å–º. –∫–æ–¥).

–û–±–Ω–æ–≤–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–ª–∞–π–¥–æ–≤ —Ç–∞–∫, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ {ru, en}.

–ü–µ—Ä–µ–ø–∏—à–∏ update.sh –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ (–±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∞ PM2 –≤ –Ω–∞—á–∞–ª–µ).

–£–±–µ–¥–∏—Å—å, —á—Ç–æ schema.prisma —Å–µ–π—á–∞—Å –æ–ø–∏—Å—ã–≤–∞–µ—Ç Slide.title –∏ Slide.description –∫–∞–∫ Json –∏–ª–∏ Json?.

–ó–∞–ø—É—à—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ main –∏ —Å–∫–∞–∂–∏ ¬´–≥–æ—Ç–æ–≤–æ¬ª.