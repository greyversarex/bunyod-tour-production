# üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ –ù–ê PRODUCTION (TimeWeb)

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û:
- ‚úÖ PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—á–∏—â–µ–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞ (bunyod_tour)
- ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –≤ `bunyod-tour-prod`
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`npm install`)

---

## üìù –®–ê–ì 1: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env

–ü–æ—Å–∫–æ–ª—å–∫—É `.env.example` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤—Ä—É—á–Ω—É—é:

```bash
cd /root/bunyod-tour-prod
nano .env
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```env
# ===========================================
# –ë–ê–ó–ê –î–ê–ù–ù–´–• (PostgreSQL)
# ===========================================
DATABASE_URL="postgresql://bunyod_user:your_password@localhost:5432/bunyod_tour"

# ===========================================
# –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
# ===========================================
JWT_SECRET="–≤–∞—à-—Å–ª—É—á–∞–π–Ω—ã–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-–º–∏–Ω–∏–º—É–º-32-—Å–∏–º–≤–æ–ª–∞"
NODE_ENV="production"

# ===========================================
# –°–ï–†–í–ï–†
# ===========================================
PORT=5000
PRODUCTION_DOMAIN="–≤–∞—à-–¥–æ–º–µ–Ω.com"
ALLOWED_ORIGINS="https://www.–≤–∞—à-–¥–æ–º–µ–Ω.com"

# ===========================================
# –ü–õ–ê–¢–ï–ñ–ù–´–ï –°–ò–°–¢–ï–ú–´ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# ===========================================
# AlifPay (–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω)
ALIF_MERCHANT_KEY=""
ALIF_MERCHANT_PASSWORD=""

# Payler (–†–æ—Å—Å–∏—è/–°–ù–ì)
PAYLER_MERCHANT_ID=""
PAYLER_SECRET_KEY=""

# Stripe (–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏)
STRIPE_SECRET_KEY=""
STRIPE_WEBHOOK_SECRET=""

# ===========================================
# EMAIL –û–¢–ü–†–ê–í–ö–ê (SMTP)
# ===========================================
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER="–≤–∞—à-email@gmail.com"
SMTP_PASSWORD="–≤–∞—à-app-password"
SMTP_FROM="Bunyod Tour <noreply@bunyod-tour.tj>"

# ===========================================
# –û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ===========================================
INIT_DATABASE=false
ENABLE_DYNAMIC_PRICING=true
LOG_LEVEL="info"
```

**‚ùó –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ú–ï–ù–ò–¢–ï:**
1. `DATABASE_URL` - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ PostgreSQL
2. `JWT_SECRET` - —Å–æ–∑–¥–∞–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
3. `PRODUCTION_DOMAIN` - –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
4. `SMTP_*` - –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª: `Ctrl+O`, `Enter`, `Ctrl+X`

---

## üóÑÔ∏è –®–ê–ì 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npx prisma db push

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–∞–¥–º–∏–Ω, –≤–∞–ª—é—Ç—ã, —Å—Ç—Ä–∞–Ω—ã, –≥–æ—Ä–æ–¥–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
npm run db:seed
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: `admin` / `admin12345`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 5 –≤–∞–ª—é—Ç (TJS, USD, EUR, RUB, CNY) —Å –∫—É—Ä—Å–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 5 —Å—Ç—Ä–∞–Ω (–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω, –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω, –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω)
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 12 –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 15 –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç—É—Ä–æ–≤

---

## üöÄ –®–ê–ì 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ PM2
pm2 start ecosystem.config.js

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
pm2 logs bunyod-tour

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
pm2 save

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
pm2 startup
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é PM2 –≤—ã–≤–µ–¥–µ—Ç
```

---

## üåê –®–ê–ì 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:

```bash
nano /etc/nginx/sites-available/bunyod-tour
```

–í—Å—Ç–∞–≤—å—Ç–µ:

```nginx
server {
    listen 80;
    server_name –≤–∞—à-–¥–æ–º–µ–Ω.com www.–≤–∞—à-–¥–æ–º–µ–Ω.com;

    # Frontend —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    location / {
        root /root/bunyod-tour-prod/frontend;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # API –∑–∞–ø—Ä–æ—Å—ã
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    location /uploads {
        alias /root/bunyod-tour-prod/uploads;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
ln -s /etc/nginx/sites-available/bunyod-tour /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx
```

---

## üîí –®–ê–ì 5: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL (HTTPS)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Certbot
sudo apt install certbot python3-certbot-nginx -y

# –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d –≤–∞—à-–¥–æ–º–µ–Ω.com -d www.–≤–∞—à-–¥–æ–º–µ–Ω.com

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo certbot renew --dry-run
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API:
```bash
curl http://localhost:5000/api/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "message": "Tajik Trails API is running",
  "environment": "production",
  "version": "2.0.0"
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª—é—Ç—ã:
```bash
curl http://localhost:5000/api/exchange-rates
```

–î–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è 5 –≤–∞–ª—é—Ç —Å –∫—É—Ä—Å–∞–º–∏.

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∞:
```bash
curl -X POST http://localhost:5000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin12345"}'
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JWT —Ç–æ–∫–µ–Ω.

---

## üéØ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:** `http://–≤–∞—à-–¥–æ–º–µ–Ω.com`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:** `http://–≤–∞—à-–¥–æ–º–µ–Ω.com/admin-dashboard.html`
3. **–í–æ–π–¥–∏—Ç–µ:** `admin` / `admin12345`
4. **–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç—É—Ä** —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

---

## üîß –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´ PM2

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
pm2 logs bunyod-tour

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 restart bunyod-tour

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
pm2 stop bunyod-tour

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
pm2 monit

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
pm2 flush
```

---

## ‚ùå –£–°–¢–†–ê–ù–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot connect to database"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PostgreSQL
sudo systemctl status postgresql
sudo systemctl start postgresql

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL –≤ .env
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Port 5000 already in use"
```bash
# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å
sudo lsof -i :5000

# –£–±–µ–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å
sudo kill -9 <PID>

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PM2
pm2 restart bunyod-tour
```

### –ü—Ä–æ–±–ª–µ–º–∞: "JWT_SECRET is required"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat /root/bunyod-tour-prod/.env | grep JWT_SECRET

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
```

---

## üéâ –ì–û–¢–û–í–û!

–í–∞—à —Å–∞–π—Ç Bunyod Tour —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ! üöÄ

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –°–æ–∑–¥–∞–π—Ç–µ —Ç—É—Ä—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (AlifPay, Payler, Stripe)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SMTP –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email
4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ `pm2 logs`
