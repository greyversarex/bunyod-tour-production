# üìß –°–ò–°–¢–ï–ú–ê –û–¢–ü–†–ê–í–ö–ò –ü–ò–°–ï–ú - –ü–û–õ–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

## ‚úÖ –°–¢–ê–¢–£–°: 100% –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

---

## üéØ –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
- **SMTP –°–µ—Ä–≤–µ—Ä**: Timeweb Mail (mail.timeweb.com)
- **–ü–æ—Ä—Ç**: 465 (SSL)
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: Nodemailer
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: PDF –±–∏–ª–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ

### –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–∏—Å—å–º–∞:
1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Üí –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (`POST /api/orders`)
2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã** ‚Üí –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ —á–µ—Ä–µ–∑ Alif –∏–ª–∏ Payler (—Å PDF –±–∏–ª–µ—Ç–æ–º)
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É** ‚Üí –ü—Ä–∏ –∫–∞–∂–¥–æ–º –ø–ª–∞—Ç–µ–∂–µ/–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
4. **–û—Ç–º–µ–Ω–∞** ‚Üí –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ë–ï–ó –û–ü–õ–ê–¢–´

### ‚úÖ –°–ø–æ—Å–æ–± 1: –ü—Ä–æ—Å—Ç–æ–π SMTP —Ç–µ—Å—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
curl "http://localhost:5000/api/test/smtp-test?email=greyversarex@gmail.com"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç –ø—Ä–æ—Å—Ç–æ–µ HTML –ø–∏—Å—å–º–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç SMTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ë–î

---

### ‚úÖ –°–ø–æ—Å–æ–± 2: –ü–∏—Å—å–º–æ —Å PDF –±–∏–ª–µ—Ç–æ–º
```bash
curl "http://localhost:5000/api/test/send-simple-email?email=greyversarex@gmail.com"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–∏–ª–æ–∂–∏—Ç PDF –±–∏–ª–µ—Ç
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è mock –¥–∞–Ω–Ω—ã–µ

---

### ‚úÖ –°–ø–æ—Å–æ–± 3: –ü—Ä—è–º–æ–π Node —Å–∫—Ä–∏–ø—Ç (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
node test-email.js
```

---

## ‚öôÔ∏è –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø

### Production (.env):
```env
# Timeweb SMTP
SMTP_HOST=mail.timeweb.com
SMTP_PORT=465
SMTP_USER=booking@bunyodtour.tj
SMTP_PASS=Book2025
SMTP_FROM=booking@bunyodtour.tj
ADMIN_EMAIL=admin@bunyodtour.tj
```

### Development (Replit Secrets):
```
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
- SMTP_HOST
- SMTP_PORT
- SMTP_USER
- SMTP_PASS
- SMTP_FROM
- ADMIN_EMAIL
```

---

## üìã –§–ê–ô–õ–´ –°–ò–°–¢–ï–ú–´

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `src/services/emailService.ts` | –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º (Nodemailer) |
| `src/routes/testEmailRoutes.ts` | –¢–µ—Å—Ç–æ–≤—ã–µ endpoint'—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| `src/controllers/alifController.ts` | –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å–µ–º –ø—Ä–∏ –ø–ª–∞—Ç–µ–∂–µ Alif |
| `src/controllers/paylerController.ts` | –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å–µ–º –ø—Ä–∏ –ø–ª–∞—Ç–µ–∂–µ Payler |
| `src/controllers/orderController.ts` | –ü–∏—Å—å–º–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ |
| `src/controllers/bookingController.ts` | –ü–∏—Å—å–º–æ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ |

---

## üîß –ö–û–î –í–´–ó–û–í–ê –ü–ò–°–ï–ú

### –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
```typescript
import { emailService } from '../services/emailService';

// –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ
await emailService.sendPaymentConfirmation(order, customer);
await emailService.sendAdminNotification(order, customer, tour);

// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
await emailService.sendBookingConfirmation(order, customer, tour);

// –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ
await emailService.sendCancellationEmail(order, customer);
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ù–ê –ü–†–û–î–ê–ö–®–ï–ù–ï

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env
```bash
cat /srv/bunyod-tour/.env | grep SMTP
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
SMTP_HOST=mail.timeweb.com
SMTP_PORT=465
SMTP_USER=booking@bunyodtour.tj
SMTP_PASS=Book2025
SMTP_FROM=booking@bunyodtour.tj
ADMIN_EMAIL=admin@bunyodtour.tj
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å PM2
```bash
pm2 restart bunyod-tour
pm2 logs bunyod-tour  # —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SMTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```bash
curl "http://147.45.213.8:5000/api/test/smtp-test?email=admin@bunyodtour.tj"
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∏—Å—å–º–æ —Å PDF
```bash
curl "http://147.45.213.8:5000/api/test/send-simple-email?email=admin@bunyodtour.tj"
```

---

## üêõ –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### –û—à–∏–±–∫–∞ 404 - Route not found
‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
pm2 restart bunyod-tour
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è SMTP
‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```bash
echo "Host: $SMTP_HOST"
echo "Port: $SMTP_PORT"
echo "User: $SMTP_USER"
```

### –ü–∏—Å—å–º–æ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–ø–∫—É –°–ø–∞–º –∏ –ª–æ–≥–∏
```bash
pm2 logs bunyod-tour | grep -i email
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–ò–°–ï–ú

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å:
- üìß –ü–∏—Å—å–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–∫–∞–∑–µ
- üí∞ –ü–∏—Å—å–º–∞ —Å PDF –±–∏–ª–µ—Ç–∞–º–∏ –ø—Ä–∏ –ø–ª–∞—Ç–µ–∂–∞—Ö
- üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É –æ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö
- ‚ùå –ü–∏—Å—å–º–∞ –æ–± –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–æ–≤

---

## ‚ú® –û–°–û–ë–ï–ù–ù–û–°–¢–ò

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ PDF –±–∏–ª–µ—Ç—ã**
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å—å–º–∞ –ø–ª–∞—Ç–µ–∂–∞
- –°–æ–¥–µ—Ä–∂–∞—Ç –≤—Å–µ –¥–µ—Ç–∞–ª–∏ —Ç—É—Ä–∞
- –ü—Ä–∏–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –∫ –ø–∏—Å—å–º—É

‚úÖ **–ö—Ä–∞—Å–∏–≤—ã–µ HTML —à–∞–±–ª–æ–Ω—ã**
- –ë—Ä–µ–Ω–¥–∏–Ω–≥ –∫–æ–º–ø–∞–Ω–∏–∏ (BUNYOD-TOUR)
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –ü–∞—Ä–æ–ª–∏ –≤ .env (–Ω–µ –≤ –∫–æ–¥–µ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SSL (port 465)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

---

## üöÄ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–ü—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
1. ‚úÖ .env –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã (Timeweb SMTP)
2. ‚úÖ PM2 –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω
3. ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
4. ‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–æ—Å—å

–î–∞–ª—å—à–µ –ø–∏—Å—å–º–∞ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò** –ø—Ä–∏ –ø–ª–∞—Ç–µ–∂–∞—Ö –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö!
