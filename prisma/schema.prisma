generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admins {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  full_name String
  role      String   @default("admin")
  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model agent_applications {
  id                       Int      @id @default(autoincrement())
  full_name                String
  citizenship              String
  address                  String
  phone                    String
  email                    String
  id_document              String?
  other_documents          String?
  partnership_agreement    Boolean
  privacy_policy_agreement Boolean
  status                   String   @default("pending")
  admin_notes              String?
  created_at               DateTime @default(now())
  updated_at               DateTime
}

model agent_tour_bookings {
  id                  Int         @id @default(autoincrement())
  agent_user_id       Int
  registration_number String      @unique
  tour_name           String
  application_date    DateTime
  tour_start_date     String
  tour_end_date       String
  tourist_count       Int
  tourists_list       String
  status              String      @default("pending")
  admin_notes         String?
  created_at          DateTime    @default(now())
  updated_at          DateTime
  agent_users         agent_users @relation(fields: [agent_user_id], references: [id], onDelete: Cascade)
}

model agent_users {
  id                  Int                   @id @default(autoincrement())
  unique_id           String                @unique
  full_name           String
  email               String                @unique
  password            String
  citizenship         String
  address             String
  phone               String
  is_active           Boolean               @default(true)
  created_at          DateTime              @default(now())
  updated_at          DateTime
  agent_tour_bookings agent_tour_bookings[]
}

model booking_requests {
  id               Int      @id @default(autoincrement())
  customer_name    String
  customer_email   String
  preferred_date   String
  number_of_people Int
  tour_id          Int
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  tours            tours    @relation(fields: [tour_id], references: [id], onDelete: Cascade)
}

model bookings {
  id                    Int      @id @default(autoincrement())
  tour_id               Int
  hotel_id              Int?
  tourists              String
  contact_name          String?
  contact_phone         String?
  contact_email         String?
  room_selection        String?
  meal_selection        String?
  city_nights           String?
  total_price           Float
  tour_date             String
  number_of_tourists    Int
  special_requests      String?
  status                String   @default("draft")
  payment_method        String?
  payment_option        String?  @default("full")
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  selected_currency     String   @default("TJS")
  total_price_converted Float?
  hotels                hotels?  @relation(fields: [hotel_id], references: [id])
  tours                 tours    @relation(fields: [tour_id], references: [id], onDelete: Cascade)
}

model categories {
  id                        Int                         @id @default(autoincrement())
  name                      String
  type                      String                      @default("tour")
  tour_category_assignments tour_category_assignments[]
  tours                     tours[]
}

model cities {
  id                 Int                  @id @default(autoincrement())
  name               String
  name_ru            String
  name_en            String
  country_id         Int
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  countries          countries            @relation(fields: [country_id], references: [id], onDelete: Cascade)
  city_card_photos   city_card_photos[]
  custom_tour_cities custom_tour_cities[]
  drivers            drivers[]
  guides             guides[]
  hotels             hotels[]
  slides             slides[]
  tour_agents        tour_agents[]
  tour_cities        tour_cities[]
  tours              tours[]

  @@unique([name, country_id])
}

model city_card_photos {
  id         Int      @id @default(autoincrement())
  city_id    Int
  image      String
  is_active  Boolean  @default(true)
  sort_order Int      @default(0)
  created_at DateTime @default(now())
  updated_at DateTime
  cities     cities   @relation(fields: [city_id], references: [id], onDelete: Cascade)
}

model content_blocks {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  title     String
  content   String
  type      String
  section   String
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  metadata  String?
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model countries {
  id                     Int                      @id @default(autoincrement())
  name                   String                   @unique
  name_ru                String
  name_en                String
  code                   String                   @unique
  isActive               Boolean                  @default(true)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  cities                 cities[]
  custom_tour_cities     custom_tour_cities[]
  custom_tour_components custom_tour_components[]
  drivers                drivers[]
  guides                 guides[]
  hotels                 hotels[]
  tour_agents            tour_agents[]
  tour_countries         tour_countries[]
  tours                  tours[]
}

model custom_tour_cities {
  id         Int       @id @default(autoincrement())
  country_id Int
  city_id    Int
  days_count Int
  is_active  Boolean   @default(true)
  created_at DateTime  @default(now())
  updated_at DateTime
  cities     cities    @relation(fields: [city_id], references: [id], onDelete: Cascade)
  countries  countries @relation(fields: [country_id], references: [id], onDelete: Cascade)

  @@unique([country_id, city_id])
}

model custom_tour_components {
  id          Int       @id @default(autoincrement())
  country_id  Int
  category    String
  name        Json
  price       Float
  unit        String
  description Json?
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  countries   countries @relation(fields: [country_id], references: [id], onDelete: Cascade)
}

model custom_tour_orders {
  id                  Int      @id @default(autoincrement())
  full_name           String
  email               String?
  phone               String?
  selected_countries  Json
  selected_cities     Json
  tourists            Json
  selected_components Json
  status              String   @default("pending")
  total_price         Float?
  total_days          Int?
  customer_notes      String?
  admin_notes         String?
  created_at          DateTime @default(now())
  updated_at          DateTime
}

model customers {
  id            Int             @id @default(autoincrement())
  full_name     String
  email         String          @unique
  phone         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  guide_reviews guide_reviews[]
  orders        orders[]
  reviews       reviews[]
}

model driver_profiles {
  id                Int       @id @default(autoincrement())
  name              String
  phone             String
  email             String?
  dateOfBirth       DateTime?
  experience        Int
  licenseCategories String
  licenseNumber     String
  vehicleTypes      String
  vehicleBrand      String?
  vehicleYear       Int?
  languages         String
  workingAreas      String
  dailyRate         Float
  hourlyRate        Float
  rating            Float?
  totalTrips        Int       @default(0)
  photo             String?
  vehiclePhotos     String?
  documents         String?
  isActive          Boolean   @default(true)
  password          String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  trips             trips[]
}

model drivers {
  id                Int                 @id @default(autoincrement())
  name              String
  description       String?
  photo             String?
  avatar            String?
  documents         String?
  licenseNumber     String?
  licenseCategory   String?
  vehicleTypes      String?
  vehicleInfo       String?
  vehicleBrand      String?
  vehicleYear       Int?
  vehiclePhotos     String?
  experience        Int?
  contact           String?
  login             String?
  password          String?
  isActive          Boolean             @default(true)
  languages         String?
  workingAreas      String?
  country_id        Int?
  city_id           Int?
  pricePerDay       Float?
  pricePerHour      Float?
  currency          String?             @default("TJS")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  cities            cities?             @relation(fields: [city_id], references: [id])
  countries         countries?          @relation(fields: [country_id], references: [id])
  tour_drivers      tour_drivers[]
  transfer_requests transfer_requests[]
}

model exchange_rates {
  id        Int      @id @default(autoincrement())
  currency  String   @unique
  rate      Float
  symbol    String
  name      String
  isActive  Boolean  @default(true)
  updatedAt DateTime @default(now())
  createdAt DateTime @default(now())
}

model guide_hire_requests {
  id               Int      @id @default(autoincrement())
  guide_id         Int
  tourist_name     String
  tourist_email    String?
  tourist_phone    String?
  selected_dates   String
  number_of_days   Int
  comments         String?
  total_price      Float
  base_total_price Float?
  currency         String   @default("TJS")
  base_currency    String?
  exchange_rate    Float?
  status           String   @default("pending")
  payment_status   String   @default("unpaid")
  admin_notes      String?
  created_at       DateTime @default(now())
  updated_at       DateTime
  guides           guides   @relation(fields: [guide_id], references: [id], onDelete: Cascade)
}

model guide_reviews {
  id            Int        @id @default(autoincrement())
  guide_id      Int
  customer_id   Int?
  reviewer_name String
  rating        Int
  text          String
  photos        String?
  is_moderated  Boolean    @default(false)
  is_approved   Boolean    @default(false)
  created_at    DateTime   @default(now())
  updated_at    DateTime
  customers     customers? @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  guides        guides     @relation(fields: [guide_id], references: [id], onDelete: Cascade)
}

model guides {
  id                  Int                   @id @default(autoincrement())
  name                Json
  description         Json?
  photo               String?
  avatar              String?
  documents           String?
  languages           String
  contact             String?
  experience          Int?
  rating              Float?
  country_id          Int?
  city_id             Int?
  passport_series     String?
  registration        String?
  residence_address   String?
  login               String?
  password            String?
  price_per_day       Float?
  currency            String?               @default("TJS")
  available_dates     String?
  is_hireable         Boolean               @default(true)
  isActive            Boolean               @default(true)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  guide_hire_requests guide_hire_requests[]
  guide_reviews       guide_reviews[]
  cities              cities?               @relation(fields: [city_id], references: [id])
  countries           countries?            @relation(fields: [country_id], references: [id])
  orders              orders[]
  tour_guides         tour_guides[]
  tours               tours[]
}

model hotels {
  id          Int            @id @default(autoincrement())
  name        Json
  description Json?
  images      String?
  address     Json?
  rating      Float?
  stars       Int?
  amenities   String?
  brand       String?
  category    HotelCategory?
  country_id  Int?
  city_id     Int?
  country     String?
  city        String?
  pension     String?        @default("none")
  roomTypes   String?
  mealTypes   String?
  isActive    Boolean        @default(true)
  isDraft     Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime
  bookings    bookings[]
  cities      cities?        @relation(fields: [city_id], references: [id])
  countries   countries?     @relation(fields: [country_id], references: [id])
  orders      orders[]
  tour_hotels tour_hotels[]
}

model menu_items {
  id               Int          @id @default(autoincrement())
  parent_id        Int?
  title            String
  url              String
  type             String
  isActive         Boolean      @default(true)
  sortOrder        Int          @default(0)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  menu_items       menu_items?  @relation("menu_itemsTomenu_items", fields: [parent_id], references: [id])
  other_menu_items menu_items[] @relation("menu_itemsTomenu_items")
}

model migrations {
  id          Int      @id @default(autoincrement())
  version     String   @unique
  name        String
  description String?
  appliedAt   DateTime @default(now())
  isSystem    Boolean  @default(false)
}

model news {
  id           Int      @id @default(autoincrement())
  title        String
  content      String
  excerpt      String?
  image        String?
  images       String?
  tags         String?
  is_published Boolean  @default(true)
  is_featured  Boolean  @default(false)
  published_at DateTime @default(now())
  slug         String   @unique
  views        Int      @default(0)
  read_time    Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
}

model news_posts {
  id          Int          @id @default(autoincrement())
  title       String
  slug        String       @unique
  excerpt     String?
  content     String
  imageUrl    String?
  category    NewsCategory
  author      String?
  publishDate DateTime     @default(now())
  isFeatured  Boolean      @default(false)
  isPublished Boolean      @default(true)
  views       Int          @default(0)
  metaTitle   String?
  metaDesc    String?
  tags        String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
}

model newsletter_subscribers {
  id             Int       @id @default(autoincrement())
  email          String    @unique
  isActive       Boolean   @default(true)
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?
}

model orders {
  id                Int       @id @default(autoincrement())
  order_number      String    @unique
  customer_id       Int
  tour_id           Int
  hotel_id          Int?
  guide_id          Int?
  tour_date         String
  tourists          String
  wishes            String?
  total_amount      Float
  status            String    @default("pending")
  payment_status    String    @default("unpaid")
  payment_method    String?
  payment_intent_id String?
  receipt_data      String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  customers         customers @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  guides            guides?   @relation(fields: [guide_id], references: [id])
  hotels            hotels?   @relation(fields: [hotel_id], references: [id])
  tours             tours     @relation(fields: [tour_id], references: [id], onDelete: Cascade)
}

model pages {
  id          Int      @id @default(autoincrement())
  slug        String   @unique
  title       String
  content     String
  metaTitle   String?
  metaDesc    String?
  isPublished Boolean  @default(true)
  template    String   @default("default")
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model price_calculator_components {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  category    String
  name        String
  name_en     String?
  price       Float
  unit        String
  description String?
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model reviews {
  id            Int        @id @default(autoincrement())
  customer_id   Int?
  tour_id       Int
  reviewer_name String
  rating        Int
  guide_rating  Int?
  text          String
  photos        String?
  is_moderated  Boolean    @default(false)
  is_approved   Boolean    @default(false)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime
  customers     customers? @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  tours         tours      @relation(fields: [tour_id], references: [id], onDelete: Cascade)
}

model site_settings {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  type      String
  group     String
  label     String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model slides {
  id          Int      @id @default(autoincrement())
  title       Json
  description Json
  image       String?
  link        String?
  buttonText  Json?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  city_id     Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  cities      cities?  @relation(fields: [city_id], references: [id])
}

model tour_agents {
  id                Int        @id @default(autoincrement())
  name              String
  organization      String
  website           String?
  stateRegistration String?
  description       String?
  contact_name      String?
  contact_phone     String?
  contact_email     String?
  address           String?
  photo             String?
  country_id        Int?
  city_id           Int?
  is_active         Boolean    @default(true)
  created_at        DateTime   @default(now())
  updated_at        DateTime
  cities            cities?    @relation(fields: [city_id], references: [id])
  countries         countries? @relation(fields: [country_id], references: [id])
}

model tour_block_assignments {
  id            Int         @id @default(autoincrement())
  tour_id       Int
  tour_block_id Int
  is_primary    Boolean     @default(false)
  created_at    DateTime    @default(now())
  tour_blocks   tour_blocks @relation(fields: [tour_block_id], references: [id], onDelete: Cascade)
  tours         tours       @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, tour_block_id])
}

model tour_blocks {
  id                     Int                      @id @default(autoincrement())
  title                  String
  description            String?
  slug                   String                   @unique
  isActive               Boolean                  @default(true)
  sortOrder              Int                      @default(0)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  tour_block_assignments tour_block_assignments[]
}

model tour_category_assignments {
  id          Int        @id @default(autoincrement())
  tour_id     Int
  category_id Int
  is_primary  Boolean    @default(false)
  created_at  DateTime   @default(now())
  categories  categories @relation(fields: [category_id], references: [id], onDelete: Cascade)
  tours       tours      @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, category_id])
}

model tour_cities {
  id           Int      @id @default(autoincrement())
  tour_id      Int
  city_id      Int
  nights_count Int      @default(1)
  is_primary   Boolean  @default(false)
  created_at   DateTime @default(now())
  cities       cities   @relation(fields: [city_id], references: [id], onDelete: Cascade)
  tours        tours    @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, city_id])
}

model tour_countries {
  id         Int       @id @default(autoincrement())
  tour_id    Int
  country_id Int
  is_primary Boolean   @default(false)
  created_at DateTime  @default(now())
  countries  countries @relation(fields: [country_id], references: [id], onDelete: Cascade)
  tours      tours     @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, country_id])
}

model tour_drivers {
  id         Int     @id @default(autoincrement())
  tour_id    Int
  driver_id  Int
  is_default Boolean @default(false)
  drivers    drivers @relation(fields: [driver_id], references: [id], onDelete: Cascade)
  tours      tours   @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, driver_id])
}

model tour_guide_profiles {
  id        Int      @id @default(autoincrement())
  name      String
  login     String   @unique
  password  String
  email     String?
  phone     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model tour_guides {
  id         Int     @id @default(autoincrement())
  tour_id    Int
  guide_id   Int
  is_default Boolean @default(false)
  guides     guides  @relation(fields: [guide_id], references: [id], onDelete: Cascade)
  tours      tours   @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, guide_id])
}

model tour_hotels {
  id              Int     @id @default(autoincrement())
  tour_id         Int
  hotel_id        Int
  price_per_night Float?
  is_default      Boolean @default(false)
  hotels          hotels  @relation(fields: [hotel_id], references: [id], onDelete: Cascade)
  tours           tours   @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, hotel_id])
}

model tour_map_points {
  id          Int      @id @default(autoincrement())
  tour_id     Int
  step_number Int
  latitude    Float
  longitude   Float
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime
  tours       tours    @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, step_number])
}

model tour_pricing_components {
  id            Int      @id @default(autoincrement())
  tour_id       Int
  component_key String
  quantity      Float    @default(1)
  custom_price  Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  tours         tours    @relation(fields: [tour_id], references: [id], onDelete: Cascade)

  @@unique([tour_id, component_key])
}

model tours {
  id                        Int                         @id @default(autoincrement())
  title                     Json
  description               Json
  shortDesc                 Json?
  duration                  String
  price                     String
  currency                  String                      @default("TJS")
  priceType                 String                      @default("за человека")
  originalPrice             String?
  country_id                Int?
  city_id                   Int?
  country                   String?
  city                      String?
  format                    String?
  tourType                  String?
  durationDays              Int?
  theme                     String?
  startDate                 String?
  endDate                   String?
  startTime                 String?
  startTimeOptions          String?
  pickupInfo                String?
  pickup_info_en            String?
  languages                 String?
  availableMonths           String?
  availableDays             String?
  images                    String?
  mainImage                 String?
  services                  String?
  highlights                String?
  itinerary                 String?
  itinerary_en              String?
  includes                  String?
  excluded                  String?
  requirements              String?
  difficulty                String?
  rating                    Float?
  reviewsCount              Int?
  maxPeople                 Int?
  minPeople                 Int?
  location                  String?
  tags                      String?
  isActive                  Boolean                     @default(true)
  isDraft                   Boolean                     @default(false)
  isFeatured                Boolean                     @default(false)
  categoryId                Int
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  pricingData               String?
  profit_margin             Float?                      @default(0)
  assigned_guide_id         Int?
  scheduledEndDate          DateTime?
  scheduledStartDate        DateTime?
  status                    String                      @default("pending")
  current_day               Int?
  completed_days            Int[]                       @default([])
  total_days                Int?
  uniqueCode                String?                     @unique
  durationType              String?                     @default("days")
  booking_requests          booking_requests[]
  bookings                  bookings[]
  orders                    orders[]
  reviews                   reviews[]
  tour_block_assignments    tour_block_assignments[]
  tour_category_assignments tour_category_assignments[]
  tour_cities               tour_cities[]
  tour_countries            tour_countries[]
  tour_drivers              tour_drivers[]
  tour_guides               tour_guides[]
  tour_hotels               tour_hotels[]
  tour_map_points           tour_map_points[]
  tour_pricing_components   tour_pricing_components[]
  guides                    guides?                     @relation(fields: [assigned_guide_id], references: [id])
  categories                categories                  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  cities                    cities?                     @relation(fields: [city_id], references: [id])
  countries                 countries?                  @relation(fields: [country_id], references: [id])
}

model transfer_requests {
  id                 Int      @id @default(autoincrement())
  full_name          String
  email              String?
  phone              String?
  pickup_location    String
  dropoff_location   String
  pickup_time        String
  pickup_date        String
  number_of_people   Int      @default(1)
  vehicle_type       String?
  special_requests   String?
  status             String   @default("pending")
  admin_notes        String?
  estimated_price    Float?
  final_price        Float?
  assigned_driver_id Int?
  created_at         DateTime @default(now())
  updated_at         DateTime
  drivers            drivers? @relation(fields: [assigned_driver_id], references: [id])
}

model trips {
  id              Int             @id @default(autoincrement())
  direction       String
  pickupTime      String
  pickupLocation  String
  routeFrom       String
  routeTo         String
  dropoffLocation String
  dropoffTime     String
  driverId        Int
  status          String          @default("pending")
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  driver_profiles driver_profiles @relation(fields: [driverId], references: [id], onDelete: Cascade)
}

enum HotelCategory {
  STANDARD
  SEMI_LUX
  LUX
  DELUXE
}

enum NewsCategory {
  tours
  events
  announcements
  tips
  general
}
